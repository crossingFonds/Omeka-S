(function(tt){typeof define=="function"&&define.amd?define(tt):tt()})(function(){"use strict";var Eo=Object.defineProperty;var bo=(tt,et,nt)=>et in tt?Eo(tt,et,{enumerable:!0,configurable:!0,writable:!0,value:nt}):tt[et]=nt;var eo=(tt,et,nt)=>(bo(tt,typeof et!="symbol"?et+"":et,nt),nt);var n$2,l$3,u$4,i$3,o$3,r$3,f$2,e$2,c$3={},s$4=[],a$4=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,h$2=Array.isArray;function v$3(tt,et){for(var nt in et)tt[nt]=et[nt];return tt}function p$4(tt){var et=tt.parentNode;et&&et.removeChild(tt)}function y$3(tt,et,nt){var rt,it,st,ot={};for(st in et)st=="key"?rt=et[st]:st=="ref"?it=et[st]:ot[st]=et[st];if(arguments.length>2&&(ot.children=arguments.length>3?n$2.call(arguments,2):nt),typeof tt=="function"&&tt.defaultProps!=null)for(st in tt.defaultProps)ot[st]===void 0&&(ot[st]=tt.defaultProps[st]);return d$2(tt,ot,rt,it,null)}function d$2(tt,et,nt,rt,it){var st={type:tt,props:et,key:nt,ref:rt,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:it??++u$4,__i:-1,__u:0};return it==null&&l$3.vnode!=null&&l$3.vnode(st),st}function _$2(){return{current:null}}function g$3(tt){return tt.children}function b$2(tt,et){this.props=tt,this.context=et}function m$3(tt,et){if(et==null)return tt.__?m$3(tt.__,tt.__i+1):null;for(var nt;et<tt.__k.length;et++)if((nt=tt.__k[et])!=null&&nt.__e!=null)return nt.__e;return typeof tt.type=="function"?m$3(tt):null}function w$3(tt,et,nt){var rt,it=tt.__v,st=it.__e,ot=tt.__P;if(ot)return(rt=v$3({},it)).__v=it.__v+1,l$3.vnode&&l$3.vnode(rt),M$3(ot,rt,it,tt.__n,ot.ownerSVGElement!==void 0,32&it.__u?[st]:null,et,st??m$3(it),!!(32&it.__u),nt),rt.__v=it.__v,rt.__.__k[rt.__i]=rt,rt.__d=void 0,rt.__e!=st&&k$4(rt),rt}function k$4(tt){var et,nt;if((tt=tt.__)!=null&&tt.__c!=null){for(tt.__e=tt.__c.base=null,et=0;et<tt.__k.length;et++)if((nt=tt.__k[et])!=null&&nt.__e!=null){tt.__e=tt.__c.base=nt.__e;break}return k$4(tt)}}function x$4(tt){(!tt.__d&&(tt.__d=!0)&&i$3.push(tt)&&!C$4.__r++||o$3!==l$3.debounceRendering)&&((o$3=l$3.debounceRendering)||r$3)(C$4)}function C$4(){var tt,et,nt,rt=[],it=[];for(i$3.sort(f$2);tt=i$3.shift();)tt.__d&&(nt=i$3.length,et=w$3(tt,rt,it)||et,nt===0||i$3.length>nt?(j$4(rt,et,it),it.length=rt.length=0,et=void 0,i$3.sort(f$2)):et&&l$3.__c&&l$3.__c(et,s$4));et&&j$4(rt,et,it),C$4.__r=0}function P$4(tt,et,nt,rt,it,st,ot,lt,ut,ct,dt){var ft,pt,gt,_r,Yr,mt=rt&&rt.__k||s$4,Kr=et.length;for(nt.__d=ut,S$3(nt,et,mt),ut=nt.__d,ft=0;ft<Kr;ft++)(gt=nt.__k[ft])!=null&&typeof gt!="boolean"&&typeof gt!="function"&&(pt=gt.__i===-1?c$3:mt[gt.__i]||c$3,gt.__i=ft,M$3(tt,gt,pt,it,st,ot,lt,ut,ct,dt),_r=gt.__e,gt.ref&&pt.ref!=gt.ref&&(pt.ref&&N$4(pt.ref,null,gt),dt.push(gt.ref,gt.__c||_r,gt)),Yr==null&&_r!=null&&(Yr=_r),65536&gt.__u||pt.__k===gt.__k?ut=$$2(gt,ut,tt):typeof gt.type=="function"&&gt.__d!==void 0?ut=gt.__d:_r&&(ut=_r.nextSibling),gt.__d=void 0,gt.__u&=-196609);nt.__d=ut,nt.__e=Yr}function S$3(tt,et,nt){var rt,it,st,ot,lt,ut=et.length,ct=nt.length,dt=ct,ft=0;for(tt.__k=[],rt=0;rt<ut;rt++)ot=rt+ft,(it=tt.__k[rt]=(it=et[rt])==null||typeof it=="boolean"||typeof it=="function"?null:typeof it=="string"||typeof it=="number"||typeof it=="bigint"||it.constructor==String?d$2(null,it,null,null,null):h$2(it)?d$2(g$3,{children:it},null,null,null):it.constructor===void 0&&it.__b>0?d$2(it.type,it.props,it.key,it.ref?it.ref:null,it.__v):it)!=null?(it.__=tt,it.__b=tt.__b+1,lt=I$3(it,nt,ot,dt),it.__i=lt,st=null,lt!==-1&&(dt--,(st=nt[lt])&&(st.__u|=131072)),st==null||st.__v===null?(lt==-1&&ft--,typeof it.type!="function"&&(it.__u|=65536)):lt!==ot&&(lt===ot+1?ft++:lt>ot?dt>ut-ot?ft+=lt-ot:ft--:lt<ot?lt==ot-1&&(ft=lt-ot):ft=0,lt!==rt+ft&&(it.__u|=65536))):(st=nt[ot])&&st.key==null&&st.__e&&!(131072&st.__u)&&(st.__e==tt.__d&&(tt.__d=m$3(st)),O$4(st,st,!1),nt[ot]=null,dt--);if(dt)for(rt=0;rt<ct;rt++)(st=nt[rt])!=null&&!(131072&st.__u)&&(st.__e==tt.__d&&(tt.__d=m$3(st)),O$4(st,st))}function $$2(tt,et,nt){var rt,it;if(typeof tt.type=="function"){for(rt=tt.__k,it=0;rt&&it<rt.length;it++)rt[it]&&(rt[it].__=tt,et=$$2(rt[it],et,nt));return et}tt.__e!=et&&(nt.insertBefore(tt.__e,et||null),et=tt.__e);do et=et&&et.nextSibling;while(et!=null&&et.nodeType===8);return et}function H$3(tt,et){return et=et||[],tt==null||typeof tt=="boolean"||(h$2(tt)?tt.some(function(nt){H$3(nt,et)}):et.push(tt)),et}function I$3(tt,et,nt,rt){var it=tt.key,st=tt.type,ot=nt-1,lt=nt+1,ut=et[nt];if(ut===null||ut&&it==ut.key&&st===ut.type&&!(131072&ut.__u))return nt;if(rt>(ut!=null&&!(131072&ut.__u)?1:0))for(;ot>=0||lt<et.length;){if(ot>=0){if((ut=et[ot])&&!(131072&ut.__u)&&it==ut.key&&st===ut.type)return ot;ot--}if(lt<et.length){if((ut=et[lt])&&!(131072&ut.__u)&&it==ut.key&&st===ut.type)return lt;lt++}}return-1}function T$5(tt,et,nt){et[0]==="-"?tt.setProperty(et,nt??""):tt[et]=nt==null?"":typeof nt!="number"||a$4.test(et)?nt:nt+"px"}function A$4(tt,et,nt,rt,it){var st;e:if(et==="style")if(typeof nt=="string")tt.style.cssText=nt;else{if(typeof rt=="string"&&(tt.style.cssText=rt=""),rt)for(et in rt)nt&&et in nt||T$5(tt.style,et,"");if(nt)for(et in nt)rt&&nt[et]===rt[et]||T$5(tt.style,et,nt[et])}else if(et[0]==="o"&&et[1]==="n")st=et!==(et=et.replace(/(PointerCapture)$|Capture$/i,"$1")),et=et.toLowerCase()in tt?et.toLowerCase().slice(2):et.slice(2),tt.l||(tt.l={}),tt.l[et+st]=nt,nt?rt?nt.u=rt.u:(nt.u=Date.now(),tt.addEventListener(et,st?L$4:D$5,st)):tt.removeEventListener(et,st?L$4:D$5,st);else{if(it)et=et.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(et!=="width"&&et!=="height"&&et!=="href"&&et!=="list"&&et!=="form"&&et!=="tabIndex"&&et!=="download"&&et!=="rowSpan"&&et!=="colSpan"&&et!=="role"&&et in tt)try{tt[et]=nt??"";break e}catch{}typeof nt=="function"||(nt==null||nt===!1&&et[4]!=="-"?tt.removeAttribute(et):tt.setAttribute(et,nt))}}function D$5(tt){if(this.l){var et=this.l[tt.type+!1];if(tt.t){if(tt.t<=et.u)return}else tt.t=Date.now();return et(l$3.event?l$3.event(tt):tt)}}function L$4(tt){if(this.l)return this.l[tt.type+!0](l$3.event?l$3.event(tt):tt)}function M$3(tt,et,nt,rt,it,st,ot,lt,ut,ct){var dt,ft,pt,gt,_r,Yr,mt,Kr,Xr,Zr,Qr,_i,rs,ns,ss,fs=et.type;if(et.constructor!==void 0)return null;128&nt.__u&&(ut=!!(32&nt.__u),st=[lt=et.__e=nt.__e]),(dt=l$3.__b)&&dt(et);e:if(typeof fs=="function")try{if(Kr=et.props,Xr=(dt=fs.contextType)&&rt[dt.__c],Zr=dt?Xr?Xr.props.value:dt.__:rt,nt.__c?mt=(ft=et.__c=nt.__c).__=ft.__E:("prototype"in fs&&fs.prototype.render?et.__c=ft=new fs(Kr,Zr):(et.__c=ft=new b$2(Kr,Zr),ft.constructor=fs,ft.render=q$3),Xr&&Xr.sub(ft),ft.props=Kr,ft.state||(ft.state={}),ft.context=Zr,ft.__n=rt,pt=ft.__d=!0,ft.__h=[],ft._sb=[]),ft.__s==null&&(ft.__s=ft.state),fs.getDerivedStateFromProps!=null&&(ft.__s==ft.state&&(ft.__s=v$3({},ft.__s)),v$3(ft.__s,fs.getDerivedStateFromProps(Kr,ft.__s))),gt=ft.props,_r=ft.state,ft.__v=et,pt)fs.getDerivedStateFromProps==null&&ft.componentWillMount!=null&&ft.componentWillMount(),ft.componentDidMount!=null&&ft.__h.push(ft.componentDidMount);else{if(fs.getDerivedStateFromProps==null&&Kr!==gt&&ft.componentWillReceiveProps!=null&&ft.componentWillReceiveProps(Kr,Zr),!ft.__e&&(ft.shouldComponentUpdate!=null&&ft.shouldComponentUpdate(Kr,ft.__s,Zr)===!1||et.__v===nt.__v)){for(et.__v!==nt.__v&&(ft.props=Kr,ft.state=ft.__s,ft.__d=!1),et.__e=nt.__e,et.__k=nt.__k,et.__k.forEach(function(os){os&&(os.__=et)}),Qr=0;Qr<ft._sb.length;Qr++)ft.__h.push(ft._sb[Qr]);ft._sb=[],ft.__h.length&&ot.push(ft);break e}ft.componentWillUpdate!=null&&ft.componentWillUpdate(Kr,ft.__s,Zr),ft.componentDidUpdate!=null&&ft.__h.push(function(){ft.componentDidUpdate(gt,_r,Yr)})}if(ft.context=Zr,ft.props=Kr,ft.__P=tt,ft.__e=!1,_i=l$3.__r,rs=0,"prototype"in fs&&fs.prototype.render){for(ft.state=ft.__s,ft.__d=!1,_i&&_i(et),dt=ft.render(ft.props,ft.state,ft.context),ns=0;ns<ft._sb.length;ns++)ft.__h.push(ft._sb[ns]);ft._sb=[]}else do ft.__d=!1,_i&&_i(et),dt=ft.render(ft.props,ft.state,ft.context),ft.state=ft.__s;while(ft.__d&&++rs<25);ft.state=ft.__s,ft.getChildContext!=null&&(rt=v$3(v$3({},rt),ft.getChildContext())),pt||ft.getSnapshotBeforeUpdate==null||(Yr=ft.getSnapshotBeforeUpdate(gt,_r)),P$4(tt,h$2(ss=dt!=null&&dt.type===g$3&&dt.key==null?dt.props.children:dt)?ss:[ss],et,nt,rt,it,st,ot,lt,ut,ct),ft.base=et.__e,et.__u&=-161,ft.__h.length&&ot.push(ft),mt&&(ft.__E=ft.__=null)}catch(os){et.__v=null,ut||st!=null?(et.__e=lt,et.__u|=ut?160:32,st[st.indexOf(lt)]=null):(et.__e=nt.__e,et.__k=nt.__k),l$3.__e(os,et,nt)}else st==null&&et.__v===nt.__v?(et.__k=nt.__k,et.__e=nt.__e):et.__e=z$5(nt.__e,et,nt,rt,it,st,ot,ut,ct);(dt=l$3.diffed)&&dt(et)}function j$4(tt,et,nt){for(var rt=0;rt<nt.length;rt++)N$4(nt[rt],nt[++rt],nt[++rt]);l$3.__c&&l$3.__c(et,tt),tt.some(function(it){try{tt=it.__h,it.__h=[],tt.some(function(st){st.call(it)})}catch(st){l$3.__e(st,it.__v)}})}function z$5(tt,et,nt,rt,it,st,ot,lt,ut){var ct,dt,ft,pt,gt,_r,Yr,mt=nt.props,Kr=et.props,Xr=et.type;if(Xr==="svg"&&(it=!0),st!=null){for(ct=0;ct<st.length;ct++)if((gt=st[ct])&&"setAttribute"in gt==!!Xr&&(Xr?gt.localName===Xr:gt.nodeType===3)){tt=gt,st[ct]=null;break}}if(tt==null){if(Xr===null)return document.createTextNode(Kr);tt=it?document.createElementNS("http://www.w3.org/2000/svg",Xr):document.createElement(Xr,Kr.is&&Kr),st=null,lt=!1}if(Xr===null)mt===Kr||lt&&tt.data===Kr||(tt.data=Kr);else{if(st=st&&n$2.call(tt.childNodes),mt=nt.props||c$3,!lt&&st!=null)for(mt={},ct=0;ct<tt.attributes.length;ct++)mt[(gt=tt.attributes[ct]).name]=gt.value;for(ct in mt)gt=mt[ct],ct=="children"||(ct=="dangerouslySetInnerHTML"?ft=gt:ct==="key"||ct in Kr||A$4(tt,ct,null,gt,it));for(ct in Kr)gt=Kr[ct],ct=="children"?pt=gt:ct=="dangerouslySetInnerHTML"?dt=gt:ct=="value"?_r=gt:ct=="checked"?Yr=gt:ct==="key"||lt&&typeof gt!="function"||mt[ct]===gt||A$4(tt,ct,gt,mt[ct],it);if(dt)lt||ft&&(dt.__html===ft.__html||dt.__html===tt.innerHTML)||(tt.innerHTML=dt.__html),et.__k=[];else if(ft&&(tt.innerHTML=""),P$4(tt,h$2(pt)?pt:[pt],et,nt,rt,it&&Xr!=="foreignObject",st,ot,st?st[0]:nt.__k&&m$3(nt,0),lt,ut),st!=null)for(ct=st.length;ct--;)st[ct]!=null&&p$4(st[ct]);lt||(ct="value",_r!==void 0&&(_r!==tt[ct]||Xr==="progress"&&!_r||Xr==="option"&&_r!==mt[ct])&&A$4(tt,ct,_r,mt[ct],!1),ct="checked",Yr!==void 0&&Yr!==tt[ct]&&A$4(tt,ct,Yr,mt[ct],!1))}return tt}function N$4(tt,et,nt){try{typeof tt=="function"?tt(et):tt.current=et}catch(rt){l$3.__e(rt,nt)}}function O$4(tt,et,nt){var rt,it;if(l$3.unmount&&l$3.unmount(tt),(rt=tt.ref)&&(rt.current&&rt.current!==tt.__e||N$4(rt,null,et)),(rt=tt.__c)!=null){if(rt.componentWillUnmount)try{rt.componentWillUnmount()}catch(st){l$3.__e(st,et)}rt.base=rt.__P=null,tt.__c=void 0}if(rt=tt.__k)for(it=0;it<rt.length;it++)rt[it]&&O$4(rt[it],et,nt||typeof tt.type!="function");nt||tt.__e==null||p$4(tt.__e),tt.__=tt.__e=tt.__d=void 0}function q$3(tt,et,nt){return this.constructor(tt,nt)}function B$4(tt,et,nt){var rt,it,st,ot;l$3.__&&l$3.__(tt,et),it=(rt=typeof nt=="function")?null:nt&&nt.__k||et.__k,st=[],ot=[],M$3(et,tt=(!rt&&nt||et).__k=y$3(g$3,null,[tt]),it||c$3,c$3,et.ownerSVGElement!==void 0,!rt&&nt?[nt]:it?null:et.firstChild?n$2.call(et.childNodes):null,st,!rt&&nt?nt:it?it.__e:et.firstChild,rt,ot),tt.__d=void 0,j$4(st,tt,ot)}function E$3(tt,et){B$4(tt,et,E$3)}function F$3(tt,et,nt){var rt,it,st,ot,lt=v$3({},tt.props);for(st in tt.type&&tt.type.defaultProps&&(ot=tt.type.defaultProps),et)st=="key"?rt=et[st]:st=="ref"?it=et[st]:lt[st]=et[st]===void 0&&ot!==void 0?ot[st]:et[st];return arguments.length>2&&(lt.children=arguments.length>3?n$2.call(arguments,2):nt),d$2(tt.type,lt,rt||tt.key,it||tt.ref,null)}function G$3(tt,et){var nt={__c:et="__cC"+e$2++,__:tt,Consumer:function(rt,it){return rt.children(it)},Provider:function(rt){var it,st;return this.getChildContext||(it=[],(st={})[et]=this,this.getChildContext=function(){return st},this.shouldComponentUpdate=function(ot){this.props.value!==ot.value&&it.some(function(lt){lt.__e=!0,x$4(lt)})},this.sub=function(ot){it.push(ot);var lt=ot.componentWillUnmount;ot.componentWillUnmount=function(){it.splice(it.indexOf(ot),1),lt&&lt.call(ot)}}),rt.children}};return nt.Provider.__=nt.Consumer.contextType=nt}n$2=s$4.slice,l$3={__e:function(tt,et,nt,rt){for(var it,st,ot;et=et.__;)if((it=et.__c)&&!it.__)try{if((st=it.constructor)&&st.getDerivedStateFromError!=null&&(it.setState(st.getDerivedStateFromError(tt)),ot=it.__d),it.componentDidCatch!=null&&(it.componentDidCatch(tt,rt||{}),ot=it.__d),ot)return it.__E=it}catch(lt){tt=lt}throw tt}},u$4=0,b$2.prototype.setState=function(tt,et){var nt;nt=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=v$3({},this.state),typeof tt=="function"&&(tt=tt(v$3({},nt),this.props)),tt&&v$3(nt,tt),tt!=null&&this.__v&&(et&&this._sb.push(et),x$4(this))},b$2.prototype.forceUpdate=function(tt){this.__v&&(this.__e=!0,tt&&this.__h.push(tt),x$4(this))},b$2.prototype.render=g$3,i$3=[],r$3=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,f$2=function(tt,et){return tt.__v.__b-et.__v.__b},C$4.__r=0,e$2=0;var t$2,r$2,u$3,i$2,o$2=0,f$1=[],c$2=[],e$1=l$3,a$3=e$1.__b,v$2=e$1.__r,l$2=e$1.diffed,m$2=e$1.__c,s$3=e$1.unmount,d$1=e$1.__;function h$1(tt,et){e$1.__h&&e$1.__h(r$2,tt,o$2||et),o$2=0;var nt=r$2.__H||(r$2.__H={__:[],__h:[]});return tt>=nt.__.length&&nt.__.push({__V:c$2}),nt.__[tt]}function p$3(tt){return o$2=1,y$2(D$4,tt)}function y$2(tt,et,nt){var rt=h$1(t$2++,2);if(rt.t=tt,!rt.__c&&(rt.__=[nt?nt(et):D$4(void 0,et),function(lt){var ut=rt.__N?rt.__N[0]:rt.__[0],ct=rt.t(ut,lt);ut!==ct&&(rt.__N=[ct,rt.__[1]],rt.__c.setState({}))}],rt.__c=r$2,!r$2.u)){var it=function(lt,ut,ct){if(!rt.__c.__H)return!0;var dt=rt.__c.__H.__.filter(function(pt){return!!pt.__c});if(dt.every(function(pt){return!pt.__N}))return!st||st.call(this,lt,ut,ct);var ft=!1;return dt.forEach(function(pt){if(pt.__N){var gt=pt.__[0];pt.__=pt.__N,pt.__N=void 0,gt!==pt.__[0]&&(ft=!0)}}),!(!ft&&rt.__c.props===lt)&&(!st||st.call(this,lt,ut,ct))};r$2.u=!0;var st=r$2.shouldComponentUpdate,ot=r$2.componentWillUpdate;r$2.componentWillUpdate=function(lt,ut,ct){if(this.__e){var dt=st;st=void 0,it(lt,ut,ct),st=dt}ot&&ot.call(this,lt,ut,ct)},r$2.shouldComponentUpdate=it}return rt.__N||rt.__}function _$1(tt,et){var nt=h$1(t$2++,3);!e$1.__s&&C$3(nt.__H,et)&&(nt.__=tt,nt.i=et,r$2.__H.__h.push(nt))}function A$3(tt,et){var nt=h$1(t$2++,4);!e$1.__s&&C$3(nt.__H,et)&&(nt.__=tt,nt.i=et,r$2.__h.push(nt))}function F$2(tt){return o$2=5,q$2(function(){return{current:tt}},[])}function T$4(tt,et,nt){o$2=6,A$3(function(){return typeof tt=="function"?(tt(et()),function(){return tt(null)}):tt?(tt.current=et(),function(){return tt.current=null}):void 0},nt==null?nt:nt.concat(tt))}function q$2(tt,et){var nt=h$1(t$2++,7);return C$3(nt.__H,et)?(nt.__V=tt(),nt.i=et,nt.__h=tt,nt.__V):nt.__}function x$3(tt,et){return o$2=8,q$2(function(){return tt},et)}function P$3(tt){var et=r$2.context[tt.__c],nt=h$1(t$2++,9);return nt.c=tt,et?(nt.__==null&&(nt.__=!0,et.sub(r$2)),et.props.value):tt.__}function V$3(tt,et){e$1.useDebugValue&&e$1.useDebugValue(et?et(tt):tt)}function b$1(tt){var et=h$1(t$2++,10),nt=p$3();return et.__=tt,r$2.componentDidCatch||(r$2.componentDidCatch=function(rt,it){et.__&&et.__(rt,it),nt[1](rt)}),[nt[0],function(){nt[1](void 0)}]}function g$2(){var tt=h$1(t$2++,11);if(!tt.__){for(var et=r$2.__v;et!==null&&!et.__m&&et.__!==null;)et=et.__;var nt=et.__m||(et.__m=[0,0]);tt.__="P"+nt[0]+"-"+nt[1]++}return tt.__}function j$3(){for(var tt;tt=f$1.shift();)if(tt.__P&&tt.__H)try{tt.__H.__h.forEach(z$4),tt.__H.__h.forEach(B$3),tt.__H.__h=[]}catch(et){tt.__H.__h=[],e$1.__e(et,tt.__v)}}e$1.__b=function(tt){r$2=null,a$3&&a$3(tt)},e$1.__=function(tt,et){tt&&et.__k&&et.__k.__m&&(tt.__m=et.__k.__m),d$1&&d$1(tt,et)},e$1.__r=function(tt){v$2&&v$2(tt),t$2=0;var et=(r$2=tt.__c).__H;et&&(u$3===r$2?(et.__h=[],r$2.__h=[],et.__.forEach(function(nt){nt.__N&&(nt.__=nt.__N),nt.__V=c$2,nt.__N=nt.i=void 0})):(et.__h.forEach(z$4),et.__h.forEach(B$3),et.__h=[],t$2=0)),u$3=r$2},e$1.diffed=function(tt){l$2&&l$2(tt);var et=tt.__c;et&&et.__H&&(et.__H.__h.length&&(f$1.push(et)!==1&&i$2===e$1.requestAnimationFrame||((i$2=e$1.requestAnimationFrame)||w$2)(j$3)),et.__H.__.forEach(function(nt){nt.i&&(nt.__H=nt.i),nt.__V!==c$2&&(nt.__=nt.__V),nt.i=void 0,nt.__V=c$2})),u$3=r$2=null},e$1.__c=function(tt,et){et.some(function(nt){try{nt.__h.forEach(z$4),nt.__h=nt.__h.filter(function(rt){return!rt.__||B$3(rt)})}catch(rt){et.some(function(it){it.__h&&(it.__h=[])}),et=[],e$1.__e(rt,nt.__v)}}),m$2&&m$2(tt,et)},e$1.unmount=function(tt){s$3&&s$3(tt);var et,nt=tt.__c;nt&&nt.__H&&(nt.__H.__.forEach(function(rt){try{z$4(rt)}catch(it){et=it}}),nt.__H=void 0,et&&e$1.__e(et,nt.__v))};var k$3=typeof requestAnimationFrame=="function";function w$2(tt){var et,nt=function(){clearTimeout(rt),k$3&&cancelAnimationFrame(et),setTimeout(tt)},rt=setTimeout(nt,100);k$3&&(et=requestAnimationFrame(nt))}function z$4(tt){var et=r$2,nt=tt.__c;typeof nt=="function"&&(tt.__c=void 0,nt()),r$2=et}function B$3(tt){var et=r$2;tt.__c=tt.__(),r$2=et}function C$3(tt,et){return!tt||tt.length!==et.length||et.some(function(nt,rt){return nt!==tt[rt]})}function D$4(tt,et){return typeof et=="function"?et(tt):et}function g$1(tt,et){for(var nt in et)tt[nt]=et[nt];return tt}function C$2(tt,et){for(var nt in tt)if(nt!=="__source"&&!(nt in et))return!0;for(var rt in et)if(rt!=="__source"&&tt[rt]!==et[rt])return!0;return!1}function E$2(tt,et){this.props=tt,this.context=et}function w$1(tt,et){function nt(it){var st=this.props.ref,ot=st==it.ref;return!ot&&st&&(st.call?st(null):st.current=null),et?!et(this.props,it)||!ot:C$2(this.props,it)}function rt(it){return this.shouldComponentUpdate=nt,y$3(tt,it)}return rt.displayName="Memo("+(tt.displayName||tt.name)+")",rt.prototype.isReactComponent=!0,rt.__f=!0,rt}(E$2.prototype=new b$2).isPureReactComponent=!0,E$2.prototype.shouldComponentUpdate=function(tt,et){return C$2(this.props,tt)||C$2(this.state,et)};var x$2=l$3.__b;l$3.__b=function(tt){tt.type&&tt.type.__f&&tt.ref&&(tt.props.ref=tt.ref,tt.ref=null),x$2&&x$2(tt)};var R$3=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.forward_ref")||3911;function N$3(tt){function et(nt){var rt=g$1({},nt);return delete rt.ref,tt(rt,nt.ref||null)}return et.$$typeof=R$3,et.render=et,et.prototype.isReactComponent=et.__f=!0,et.displayName="ForwardRef("+(tt.displayName||tt.name)+")",et}var k$2=function(tt,et){return tt==null?null:H$3(H$3(tt).map(et))},A$2={map:k$2,forEach:k$2,count:function(tt){return tt?H$3(tt).length:0},only:function(tt){var et=H$3(tt);if(et.length!==1)throw"Children.only";return et[0]},toArray:H$3},O$3=l$3.__e;l$3.__e=function(tt,et,nt,rt){if(tt.then){for(var it,st=et;st=st.__;)if((it=st.__c)&&it.__c)return et.__e==null&&(et.__e=nt.__e,et.__k=nt.__k),it.__c(tt,et)}O$3(tt,et,nt,rt)};var T$3=l$3.unmount;function F$1(tt,et,nt){return tt&&(tt.__c&&tt.__c.__H&&(tt.__c.__H.__.forEach(function(rt){typeof rt.__c=="function"&&rt.__c()}),tt.__c.__H=null),(tt=g$1({},tt)).__c!=null&&(tt.__c.__P===nt&&(tt.__c.__P=et),tt.__c=null),tt.__k=tt.__k&&tt.__k.map(function(rt){return F$1(rt,et,nt)})),tt}function I$2(tt,et,nt){return tt&&nt&&(tt.__v=null,tt.__k=tt.__k&&tt.__k.map(function(rt){return I$2(rt,et,nt)}),tt.__c&&tt.__c.__P===et&&(tt.__e&&nt.appendChild(tt.__e),tt.__c.__e=!0,tt.__c.__P=nt)),tt}function L$3(){this.__u=0,this.t=null,this.__b=null}function U$2(tt){var et=tt.__.__c;return et&&et.__a&&et.__a(tt)}function D$3(tt){var et,nt,rt;function it(st){if(et||(et=tt()).then(function(ot){nt=ot.default||ot},function(ot){rt=ot}),rt)throw rt;if(!nt)throw et;return y$3(nt,st)}return it.displayName="Lazy",it.__f=!0,it}function M$2(){this.u=null,this.o=null}l$3.unmount=function(tt){var et=tt.__c;et&&et.__R&&et.__R(),et&&32&tt.__u&&(tt.type=null),T$3&&T$3(tt)},(L$3.prototype=new b$2).__c=function(tt,et){var nt=et.__c,rt=this;rt.t==null&&(rt.t=[]),rt.t.push(nt);var it=U$2(rt.__v),st=!1,ot=function(){st||(st=!0,nt.__R=null,it?it(lt):lt())};nt.__R=ot;var lt=function(){if(!--rt.__u){if(rt.state.__a){var ut=rt.state.__a;rt.__v.__k[0]=I$2(ut,ut.__c.__P,ut.__c.__O)}var ct;for(rt.setState({__a:rt.__b=null});ct=rt.t.pop();)ct.forceUpdate()}};rt.__u++||32&et.__u||rt.setState({__a:rt.__b=rt.__v.__k[0]}),tt.then(ot,ot)},L$3.prototype.componentWillUnmount=function(){this.t=[]},L$3.prototype.render=function(tt,et){if(this.__b){if(this.__v.__k){var nt=document.createElement("div"),rt=this.__v.__k[0].__c;this.__v.__k[0]=F$1(this.__b,nt,rt.__O=rt.__P)}this.__b=null}var it=et.__a&&y$3(g$3,null,tt.fallback);return it&&(it.__u&=-33),[y$3(g$3,null,et.__a?null:tt.children),it]};var V$2=function(tt,et,nt){if(++nt[1]===nt[0]&&tt.o.delete(et),tt.props.revealOrder&&(tt.props.revealOrder[0]!=="t"||!tt.o.size))for(nt=tt.u;nt;){for(;nt.length>3;)nt.pop()();if(nt[1]<nt[0])break;tt.u=nt=nt[2]}};function W$3(tt){return this.getChildContext=function(){return tt.context},tt.children}function P$2(tt){var et=this,nt=tt.i;et.componentWillUnmount=function(){B$4(null,et.l),et.l=null,et.i=null},et.i&&et.i!==nt&&et.componentWillUnmount(),et.l||(et.i=nt,et.l={nodeType:1,parentNode:nt,childNodes:[],appendChild:function(rt){this.childNodes.push(rt),et.i.appendChild(rt)},insertBefore:function(rt,it){this.childNodes.push(rt),et.i.appendChild(rt)},removeChild:function(rt){this.childNodes.splice(this.childNodes.indexOf(rt)>>>1,1),et.i.removeChild(rt)}}),B$4(y$3(W$3,{context:et.context},tt.__v),et.l)}function j$2(tt,et){var nt=y$3(P$2,{__v:tt,i:et});return nt.containerInfo=et,nt}(M$2.prototype=new b$2).__a=function(tt){var et=this,nt=U$2(et.__v),rt=et.o.get(tt);return rt[0]++,function(it){var st=function(){et.props.revealOrder?(rt.push(it),V$2(et,tt,rt)):it()};nt?nt(st):st()}},M$2.prototype.render=function(tt){this.u=null,this.o=new Map;var et=H$3(tt.children);tt.revealOrder&&tt.revealOrder[0]==="b"&&et.reverse();for(var nt=et.length;nt--;)this.o.set(et[nt],this.u=[1,0,this.u]);return tt.children},M$2.prototype.componentDidUpdate=M$2.prototype.componentDidMount=function(){var tt=this;this.o.forEach(function(et,nt){V$2(tt,nt,et)})};var z$3=typeof Symbol<"u"&&Symbol.for&&Symbol.for("react.element")||60103,B$2=/^(?:accent|alignment|arabic|baseline|cap|clip(?!PathU)|color|dominant|fill|flood|font|glyph(?!R)|horiz|image(!S)|letter|lighting|marker(?!H|W|U)|overline|paint|pointer|shape|stop|strikethrough|stroke|text(?!L)|transform|underline|unicode|units|v|vector|vert|word|writing|x(?!C))[A-Z]/,H$2=/^on(Ani|Tra|Tou|BeforeInp|Compo)/,Z$1=/[A-Z0-9]/g,Y$3=typeof document<"u",$$1=function(tt){return(typeof Symbol<"u"&&typeof Symbol()=="symbol"?/fil|che|rad/:/fil|che|ra/).test(tt)};function q$1(tt,et,nt){return et.__k==null&&(et.textContent=""),B$4(tt,et),typeof nt=="function"&&nt(),tt?tt.__c:null}function G$2(tt,et,nt){return E$3(tt,et),typeof nt=="function"&&nt(),tt?tt.__c:null}b$2.prototype.isReactComponent={},["componentWillMount","componentWillReceiveProps","componentWillUpdate"].forEach(function(tt){Object.defineProperty(b$2.prototype,tt,{configurable:!0,get:function(){return this["UNSAFE_"+tt]},set:function(et){Object.defineProperty(this,tt,{configurable:!0,writable:!0,value:et})}})});var J$2=l$3.event;function K$3(){}function Q$3(){return this.cancelBubble}function X$3(){return this.defaultPrevented}l$3.event=function(tt){return J$2&&(tt=J$2(tt)),tt.persist=K$3,tt.isPropagationStopped=Q$3,tt.isDefaultPrevented=X$3,tt.nativeEvent=tt};var nn$1,tn$1={enumerable:!1,configurable:!0,get:function(){return this.class}},en$1=l$3.vnode;l$3.vnode=function(tt){typeof tt.type=="string"&&function(et){var nt=et.props,rt=et.type,it={};for(var st in nt){var ot=nt[st];if(!(st==="value"&&"defaultValue"in nt&&ot==null||Y$3&&st==="children"&&rt==="noscript"||st==="class"||st==="className")){var lt=st.toLowerCase();st==="defaultValue"&&"value"in nt&&nt.value==null?st="value":st==="download"&&ot===!0?ot="":lt==="translate"&&ot==="no"?ot=!1:lt==="ondoubleclick"?st="ondblclick":lt!=="onchange"||rt!=="input"&&rt!=="textarea"||$$1(nt.type)?lt==="onfocus"?st="onfocusin":lt==="onblur"?st="onfocusout":H$2.test(st)?st=lt:rt.indexOf("-")===-1&&B$2.test(st)?st=st.replace(Z$1,"-$&").toLowerCase():ot===null&&(ot=void 0):lt=st="oninput",lt==="oninput"&&it[st=lt]&&(st="oninputCapture"),it[st]=ot}}rt=="select"&&it.multiple&&Array.isArray(it.value)&&(it.value=H$3(nt.children).forEach(function(ut){ut.props.selected=it.value.indexOf(ut.props.value)!=-1})),rt=="select"&&it.defaultValue!=null&&(it.value=H$3(nt.children).forEach(function(ut){ut.props.selected=it.multiple?it.defaultValue.indexOf(ut.props.value)!=-1:it.defaultValue==ut.props.value})),nt.class&&!nt.className?(it.class=nt.class,Object.defineProperty(it,"className",tn$1)):(nt.className&&!nt.class||nt.class&&nt.className)&&(it.class=it.className=nt.className),et.props=it}(tt),tt.$$typeof=z$3,en$1&&en$1(tt)};var rn$1=l$3.__r;l$3.__r=function(tt){rn$1&&rn$1(tt),nn$1=tt.__c};var un$1=l$3.diffed;l$3.diffed=function(tt){un$1&&un$1(tt);var et=tt.props,nt=tt.__e;nt!=null&&tt.type==="textarea"&&"value"in et&&et.value!==nt.value&&(nt.value=et.value==null?"":et.value),nn$1=null};var on$1={ReactCurrentDispatcher:{current:{readContext:function(tt){return nn$1.__n[tt.__c].props.value}}}},ln$1="17.0.2";function cn$1(tt){return y$3.bind(null,tt)}function fn$1(tt){return!!tt&&tt.$$typeof===z$3}function an$1(tt){return fn$1(tt)&&tt.type===g$3}function sn$1(tt){return fn$1(tt)?F$3.apply(null,arguments):tt}function hn$1(tt){return!!tt.__k&&(B$4(null,tt),!0)}function vn$1(tt){return tt&&(tt.base||tt.nodeType===1&&tt)||null}var dn$1=function(tt,et){return tt(et)},pn$1=function(tt,et){return tt(et)},mn$1=g$3;function yn$1(tt){tt()}function _n$1(tt){return tt}function bn$1(){return[!1,yn$1]}var Sn$1=A$3,gn$1=fn$1;function Cn$1(tt,et){var nt=et(),rt=p$3({h:{__:nt,v:et}}),it=rt[0].h,st=rt[1];return A$3(function(){it.__=nt,it.v=et,En$1(it)&&st({h:it})},[tt,nt,et]),_$1(function(){return En$1(it)&&st({h:it}),tt(function(){En$1(it)&&st({h:it})})},[tt]),nt}function En$1(tt){var et,nt,rt=tt.v,it=tt.__;try{var st=rt();return!((et=it)===(nt=st)&&(et!==0||1/et==1/nt)||et!=et&&nt!=nt)}catch{return!0}}var wn$1={useState:p$3,useId:g$2,useReducer:y$2,useEffect:_$1,useLayoutEffect:A$3,useInsertionEffect:Sn$1,useTransition:bn$1,useDeferredValue:_n$1,useSyncExternalStore:Cn$1,startTransition:yn$1,useRef:F$2,useImperativeHandle:T$4,useMemo:q$2,useCallback:x$3,useContext:P$3,useDebugValue:V$3,version:"17.0.2",Children:A$2,render:q$1,hydrate:G$2,unmountComponentAtNode:hn$1,createPortal:j$2,createElement:y$3,createContext:G$3,createFactory:cn$1,cloneElement:sn$1,createRef:_$2,Fragment:g$3,isValidElement:fn$1,isElement:gn$1,isFragment:an$1,findDOMNode:vn$1,Component:b$2,PureComponent:E$2,memo:w$1,forwardRef:N$3,flushSync:pn$1,unstable_batchedUpdates:dn$1,StrictMode:mn$1,Suspense:L$3,SuspenseList:M$2,lazy:D$3,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:on$1};const $2AODx$react=Object.freeze(Object.defineProperty({__proto__:null,Children:A$2,Component:b$2,Fragment:g$3,PureComponent:E$2,StrictMode:mn$1,Suspense:L$3,SuspenseList:M$2,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:on$1,cloneElement:sn$1,createContext:G$3,createElement:y$3,createFactory:cn$1,createPortal:j$2,createRef:_$2,default:wn$1,findDOMNode:vn$1,flushSync:pn$1,forwardRef:N$3,hydrate:G$2,isElement:gn$1,isFragment:an$1,isValidElement:fn$1,lazy:D$3,memo:w$1,render:q$1,startTransition:yn$1,unmountComponentAtNode:hn$1,unstable_batchedUpdates:dn$1,useCallback:x$3,useContext:P$3,useDebugValue:V$3,useDeferredValue:_n$1,useEffect:_$1,useErrorBoundary:b$1,useId:g$2,useImperativeHandle:T$4,useInsertionEffect:Sn$1,useLayoutEffect:A$3,useMemo:q$2,useReducer:y$2,useRef:F$2,useState:p$3,useSyncExternalStore:Cn$1,useTransition:bn$1,version:ln$1},Symbol.toStringTag,{value:"Module"}));var __defProp=Object.defineProperty,__defNormalProp=(tt,et,nt)=>et in tt?__defProp(tt,et,{enumerable:!0,configurable:!0,writable:!0,value:nt}):tt[et]=nt,__publicField=(tt,et,nt)=>(__defNormalProp(tt,typeof et!="symbol"?et+"":et,nt),nt);const EMPTY=[];Object.freeze(EMPTY);const emptyAnnotationPage={id:"https://iiif-parser/annotation-page",type:"AnnotationPage",behavior:EMPTY,motivation:null,label:null,thumbnail:EMPTY,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,provider:EMPTY,items:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,rendering:EMPTY,service:EMPTY},emptyCanvas={id:"https://iiif-parser/empty-canvas",type:"Canvas",label:null,behavior:EMPTY,motivation:null,thumbnail:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,navDate:null,provider:EMPTY,items:EMPTY,annotations:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,partOf:EMPTY,rendering:EMPTY,service:EMPTY,duration:0,height:0,width:0},emptyCollection={id:"https://iiif-parser/empty-collection",type:"Collection",label:null,viewingDirection:"left-to-right",behavior:EMPTY,motivation:null,thumbnail:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,navDate:null,provider:EMPTY,items:EMPTY,annotations:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,partOf:EMPTY,rendering:EMPTY,service:EMPTY,services:EMPTY},emptyManifest={id:"https://iiif-parser/empty-manifest",type:"Manifest",annotations:EMPTY,behavior:EMPTY,homepage:EMPTY,items:EMPTY,label:null,logo:EMPTY,metadata:EMPTY,motivation:null,navDate:null,provider:EMPTY,partOf:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,rendering:EMPTY,requiredStatement:null,rights:null,seeAlso:EMPTY,service:EMPTY,services:EMPTY,start:null,structures:EMPTY,summary:null,thumbnail:EMPTY,viewingDirection:"left-to-right"},emptyRange={id:"https://iiif-parser/empty-canvas",type:"Range",label:null,behavior:EMPTY,motivation:null,thumbnail:EMPTY,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:EMPTY,rights:null,navDate:null,provider:EMPTY,items:EMPTY,annotations:EMPTY,seeAlso:EMPTY,homepage:EMPTY,logo:EMPTY,partOf:EMPTY,rendering:EMPTY,service:EMPTY,start:null,supplementary:null,viewingDirection:"left-to-right"},emptyAgent={id:"https://iiif-parser/empty-agent",type:"Agent",label:{},logo:EMPTY,seeAlso:EMPTY,homepage:EMPTY};function ensureArray$1(tt){return Array.isArray(tt)?tt:[tt]}const types$1=["Collection","Manifest","Canvas","AnnotationPage","AnnotationCollection","Annotation","ContentResource","Range","Service","Selector","Agent"];function identifyResource$1(tt){if(typeof tt>"u"||tt===null)throw new Error("Null or undefined is not a valid entity.");if(Array.isArray(tt))throw new Error("Array is not a valid entity");if(typeof tt!="object")throw new Error(`${typeof tt} is not a valid entity`);if(typeof tt.type=="string"){const et=types$1.indexOf(tt.type);if(et!==-1)return types$1[et]}if(tt.profile)return"Service";throw new Error("Resource type is not known")}class Traverse$1{constructor(et,nt={}){__publicField(this,"traversals"),__publicField(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationCollection:[],annotationPage:[],annotation:[],contentResource:[],choice:[],range:[],service:[],agent:[],...et},this.options={allowUndefinedReturn:!1,...nt}}static all(et){return new Traverse$1({collection:[et],manifest:[et],canvas:[et],annotationCollection:[et],annotationPage:[et],annotation:[et],contentResource:[et],choice:[et],range:[et],service:[et]})}traverseDescriptive(et){return et.thumbnail&&(et.thumbnail=et.thumbnail.map(nt=>this.traverseType(nt,this.traversals.contentResource))),et.provider&&(et.provider=et.provider.map(nt=>this.traverseAgent(nt))),et}traverseLinking(et){return et.seeAlso&&(et.seeAlso=et.seeAlso.map(nt=>this.traverseType(nt,this.traversals.contentResource))),et.service&&(et.service=ensureArray$1(et.service).map(nt=>this.traverseType(nt,this.traversals.service))),et.services&&(et.services=et.services.map(nt=>this.traverseType(nt,this.traversals.service))),et.logo&&(et.logo=et.logo.map(nt=>this.traverseType(nt,this.traversals.contentResource))),et.homepage&&(et.homepage=et.homepage.map(nt=>this.traverseType(nt,this.traversals.contentResource))),et.partOf&&(et.partOf=et.partOf.map(nt=>typeof nt=="string"||!nt.type?this.traverseType(nt,this.traversals.contentResource):nt.type==="Canvas"?this.traverseType(nt,this.traversals.canvas):nt.type==="AnnotationCollection"?this.traverseType(nt,this.traversals.annotationCollection):nt.type==="Collection"?this.traverseType(nt,this.traversals.collection):this.traverseType(nt,this.traversals.contentResource))),et.start&&(et.start=et.start?this.traverseType(et.start,this.traversals.canvas):null),et.rendering&&(et.rendering=et.rendering.map(nt=>this.traverseType(nt,this.traversals.contentResource))),et.supplementary&&(et.supplementary=et.supplementary.map(nt=>this.traverseType(nt,this.traversals.contentResource))),et}traverseCollectionItems(et){return et.items&&et.items.map(nt=>nt.type==="Collection"?this.traverseCollection(nt):this.traverseManifest(nt)),et}traverseCollection(et){return this.traverseType(this.traverseDescriptive(this.traverseInlineAnnotationPages(this.traverseLinking(this.traversePosterCanvas(this.traverseCollectionItems(et))))),this.traversals.collection)}traverseManifestItems(et){return et.items&&(et.items=et.items.map(nt=>this.traverseCanvas(nt))),et}traverseManifestStructures(et){return et.structures&&(et.structures=et.structures.map(nt=>this.traverseRange(nt))),et}traverseManifest(et){return this.traverseType(this.traverseInlineAnnotationPages(this.traverseManifestStructures(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(et)))))),this.traversals.manifest)}traverseCanvasItems(et){return et.items=(et.items||[]).map(nt=>this.traverseAnnotationPage(nt)),et}traverseInlineAnnotationPages(et){return typeof et=="string"||!et||et.annotations&&(et.annotations=et.annotations.map(nt=>this.traverseAnnotationPage(nt))),et}traverseCanvas(et){return this.traverseType(this.traverseInlineAnnotationPages(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(et))))),this.traversals.canvas)}traverseAnnotationPageItems(et){return et.items&&(et.items=et.items.map(nt=>this.traverseAnnotation(nt))),et}traverseAnnotationPage(et){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationPageItems(et))),this.traversals.annotationPage)}traverseAnnotationBody(et){return Array.isArray(et.body)?et.body=et.body.map(nt=>this.traverseContentResource(nt)):et.body&&(et.body=this.traverseContentResource(et.body)),et}traversePosterCanvas(et){return et.posterCanvas&&(et.posterCanvas=this.traverseCanvas(et.posterCanvas)),et.placeholderCanvas&&(et.placeholderCanvas=this.traverseCanvas(et.placeholderCanvas)),et.accompanyingCanvas&&(et.accompanyingCanvas=this.traverseCanvas(et.accompanyingCanvas)),et}traverseAnnotation(et){return this.traverseType(this.traverseLinking(this.traverseAnnotationBody(et)),this.traversals.annotation)}traverseContentResourceLinking(et){return typeof et=="string"||!et||et&&et.service&&(et.service=ensureArray$1(et.service||[]).map(nt=>this.traverseType(nt,this.traversals.service))),et}traverseContentResource(et){return et.type==="Choice"&&(et.items=et.items.map(nt=>this.traverseContentResource(nt))),this.traverseType(this.traverseInlineAnnotationPages(this.traverseContentResourceLinking(et)),this.traversals.contentResource)}traverseRangeRanges(et){return et.items&&(et.items=et.items.map(nt=>typeof nt=="string"?this.traverseCanvas({id:nt,type:"Canvas"}):nt.type==="Manifest"?this.traverseManifest(nt):this.traverseRange(nt))),et}traverseRange(et){return this.traverseType(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseRangeRanges(et)))),this.traversals.range)}traverseAgent(et){return this.traverseType(this.traverseDescriptive(this.traverseLinking(et)),this.traversals.agent)}traverseType(et,nt){return nt.reduce((rt,it)=>{const st=it(rt);return typeof st>"u"&&!this.options.allowUndefinedReturn?rt:st},et)}traverseService(et){return this.traverseType(et,this.traversals.service)}traverseUnknown(et){const nt=identifyResource$1(et);switch(nt){case"Collection":return this.traverseCollection(et);case"Manifest":return this.traverseManifest(et);case"Canvas":return this.traverseCanvas(et);case"AnnotationPage":return this.traverseAnnotationPage(et);case"Annotation":return this.traverseAnnotation(et);case"ContentResource":return this.traverseContentResource(et);case"Range":return this.traverseRange(et);case"Service":return this.traverseService(et);case"Agent":return this.traverseAgent(et);default:throw new Error(`Unknown or unsupported resource type of ${nt}`)}}}const types=["sc:Collection","sc:Manifest","sc:Canvas","sc:AnnotationList","oa:Annotation","sc:Range","sc:Layer","sc:Sequence","oa:Choice","Service","ContentResource"];function identifyResource(tt){if(typeof tt>"u"||tt===null)throw new Error("Null or undefined is not a valid entity.");if(Array.isArray(tt))throw new Error("Array is not a valid entity");if(typeof tt!="object")throw new Error(`${typeof tt} is not a valid entity`);if(typeof tt["@type"]=="string"){const et=types.indexOf(tt["@type"]);if(et!==-1)return types[et]}if(tt.profile)return"Service";if(tt.format||tt["@type"])return"ContentResource";throw new Error("Resource type is not known")}class Traverse{constructor(et,nt={}){__publicField(this,"traversals"),__publicField(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationList:[],sequence:[],annotation:[],contentResource:[],choice:[],range:[],service:[],layer:[],...et},this.options={convertPropsToArray:!0,mergeMemberProperties:!0,allowUndefinedReturn:!1,...nt}}static all(et){return new Traverse({collection:[et],manifest:[et],canvas:[et],annotationList:[et],sequence:[et],annotation:[et],contentResource:[et],choice:[et],range:[et],service:[et],layer:[et]})}traverseCollection(et){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCollectionItems(et))),this.traversals.collection)}traverseCollectionItems(et){if(this.options.mergeMemberProperties){const nt=[...(et.manifests||[]).map(rt=>typeof rt=="string"?{"@id":rt,"@type":"sc:Manifest"}:rt),...(et.collections||[]).map(rt=>typeof rt=="string"?{"@id":rt,"@type":"sc:Collection"}:rt),...et.members||[]];delete et.collections,delete et.manifests,et.members=nt}return et.manifests&&(et.manifests=et.manifests.map(nt=>this.traverseManifest(typeof nt=="string"?{"@id":nt,"@type":"sc:Manifest"}:nt))),et.collections&&(et.collections=et.collections.map(nt=>this.traverseCollection(typeof nt=="string"?{"@id":nt,"@type":"sc:Collection"}:nt))),et.members&&(et.members=et.members.map(nt=>typeof nt=="string"?nt:this.traverseUnknown(nt))),et}traverseManifest(et){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(et))),this.traversals.manifest)}traverseManifestItems(et){return et.sequences&&(et.sequences=et.sequences.map(nt=>this.traverseSequence(nt))),et.structures&&(et.structures=et.structures.map(nt=>this.traverseRange(nt))),et}traverseSequence(et){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseSequenceItems(et))),this.traversals.sequence)}traverseSequenceItems(et){return et.canvases&&(et.canvases=et.canvases.map(nt=>this.traverseCanvas(nt))),et}traverseCanvas(et){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(et))),this.traversals.canvas)}traverseCanvasItems(et){return et.images&&(et.images=et.images.map(nt=>this.traverseAnnotation(nt))),et.otherContent&&(et.otherContent=et.otherContent.map(nt=>this.traverseAnnotationList(nt))),et}traverseRange(et){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseRangeItems(et))),this.traversals.range)}traverseRangeItems(et){if(this.options.mergeMemberProperties){const nt=[...(et.ranges||[]).map(rt=>typeof rt=="string"?{"@id":rt,"@type":"sc:Range"}:rt),...(et.canvases||[]).map(rt=>typeof rt=="string"?{"@id":rt,"@type":"sc:Canvas"}:rt),...et.members||[]];delete et.ranges,delete et.canvases,et.members=nt.length?nt.map(rt=>this.traverseUnknown(rt)):void 0}return et}traverseAnnotationList(et){const nt=typeof et=="string"?{"@id":et,"@type":"sc:AnnotationList"}:et;return this.traverseType(this.traverseDescriptive(this.traverseAnnotationListItems(nt)),this.traversals.annotationList)}traverseAnnotationListItems(et){return et.resources&&(et.resources=et.resources.map(nt=>this.traverseAnnotation(nt))),et}traverseAnnotation(et){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationItems(et))),this.traversals.annotation)}traverseAnnotationItems(et){return et.resource&&(Array.isArray(et.resource)?et.resource=et.resource.map(nt=>this.traverseContentResource(nt)):et.resource=this.traverseContentResource(et.resource)),et.on,et}traverseLayer(et){return this.traverseType(this.traverseLinking(this.traverseLayerItems(et)),this.traversals.layer)}traverseLayerItems(et){return et.otherContent&&(et.otherContent=et.otherContent.map(nt=>this.traverseAnnotationList(nt))),et}traverseChoice(et){return this.traverseType(this.traverseChoiceItems(et),this.traversals.choice)}traverseChoiceItems(et){return et.default&&et.default!=="rdf:nil"&&(et.default=this.traverseContentResource(et.default)),et.item&&et.item!=="rdf:nil"&&(et.item=et.item.map(nt=>this.traverseContentResource(nt))),et}traverseService(et){return this.traverseType(this.traverseLinking(et),this.traversals.service)}traverseContentResource(et){return et["@type"]==="oa:Choice"?this.traverseChoice(et):this.traverseType(this.traverseDescriptive(this.traverseLinking(et)),this.traversals.contentResource)}traverseUnknown(et){if(!et["@type"]||typeof et=="string")return et;switch(identifyResource(et)){case"sc:Collection":return this.traverseCollection(et);case"sc:Manifest":return this.traverseManifest(et);case"sc:Canvas":return this.traverseCanvas(et);case"sc:Sequence":return this.traverseSequence(et);case"sc:Range":return this.traverseRange(et);case"oa:Annotation":return this.traverseAnnotation(et);case"sc:AnnotationList":return this.traverseAnnotationList(et);case"sc:Layer":return this.traverseLayer(et);case"Service":return this.traverseService(et);case"oa:Choice":return this.traverseChoice(et);case"ContentResource":return this.traverseContentResource(et)}return et.profile?this.traverseService(et):et}traverseImageResource(et){const nt=Array.isArray(et),rt=Array.isArray(et)?et:[et],it=[];for(const st of rt)typeof st=="string"?it.push(this.traverseContentResource({"@id":st,"@type":"dctypes:Image"})):it.push(this.traverseContentResource(st));return!nt&&!this.options.convertPropsToArray?it[0]:it}traverseDescriptive(et){return et.thumbnail&&(et.thumbnail=this.traverseImageResource(et.thumbnail)),et.logo&&(et.logo=this.traverseImageResource(et.logo)),et}traverseOneOrMoreServices(et){const nt=Array.isArray(et),rt=Array.isArray(et)?et:[et],it=[];for(const st of rt)it.push(this.traverseService(st));return!nt&&!this.options.convertPropsToArray?it[0]:it}traverseLinking(et){return et.related&&(et.related=this.traverseOneOrManyType(et.related,this.traversals.contentResource)),et.rendering&&(et.rendering=this.traverseOneOrManyType(et.rendering,this.traversals.contentResource)),et.service&&(et.service=this.traverseOneOrMoreServices(et.service)),et.seeAlso&&(et.seeAlso=this.traverseOneOrManyType(et.seeAlso,this.traversals.contentResource)),et.within&&(typeof et.within=="string"||(et.within=this.traverseOneOrManyType(et.within,this.traversals.contentResource))),et.startCanvas&&(typeof et.startCanvas=="string"?et.startCanvas=this.traverseType({"@id":et.startCanvas,"@type":"sc:Canvas"},this.traversals.canvas):et.startCanvas&&this.traverseType(et.startCanvas,this.traversals.canvas)),et.contentLayer&&(typeof et.contentLayer=="string"?et.contentLayer=this.traverseLayer({"@id":et.contentLayer,"@type":"sc:Layer"}):et.contentLayer=this.traverseLayer(et.contentLayer)),et}traverseOneOrManyType(et,nt){if(!Array.isArray(et))if(this.options.convertPropsToArray)et=[et];else return this.traverseType(et,nt);return et.map(rt=>this.traverseType(rt,nt))}traverseType(et,nt){return nt.reduce((rt,it)=>{const st=it(rt);return typeof st>"u"&&!this.options.allowUndefinedReturn?rt:st},et)}}const STANFORD_IIIF_IMAGE_COMPLIANCE_0="http://library.stanford.edu/iiif/image-api/compliance.html#level0",STANFORD_IIIF_IMAGE_COMPLIANCE_1="http://library.stanford.edu/iiif/image-api/compliance.html#level1",STANFORD_IIIF_IMAGE_COMPLIANCE_2="http://library.stanford.edu/iiif/image-api/compliance.html#level2",STANFORD_IIIF_IMAGE_CONFORMANCE_0="http://library.stanford.edu/iiif/image-api/conformance.html#level0",STANFORD_IIIF_IMAGE_CONFORMANCE_1="http://library.stanford.edu/iiif/image-api/conformance.html#level1",STANFORD_IIIF_IMAGE_CONFORMANCE_2="http://library.stanford.edu/iiif/image-api/conformance.html#level2",STANFORD_IIIF_1_IMAGE_COMPLIANCE_0="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",STANFORD_IIIF_1_IMAGE_COMPLIANCE_1="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",STANFORD_IIIF_1_IMAGE_COMPLIANCE_2="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",STANFORD_IIIF_1_IMAGE_CONFORMANCE_0="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",STANFORD_IIIF_1_IMAGE_CONFORMANCE_1="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",STANFORD_IIIF_1_IMAGE_CONFORMANCE_2="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",IIIF_1_IMAGE_LEVEL_0="http://iiif.io/api/image/1/level0.json",IIIF_1_IMAGE_LEVEL_0_PROFILE="http://iiif.io/api/image/1/profiles/level0.json",IIIF_1_IMAGE_LEVEL_1="http://iiif.io/api/image/1/level1.json",IIIF_1_IMAGE_LEVEL_1_PROFILE="http://iiif.io/api/image/1/profiles/level1.json",IIIF_1_IMAGE_LEVEL_2="http://iiif.io/api/image/1/level2.json",IIIF_1_IMAGE_LEVEL_2_PROFILE="http://iiif.io/api/image/1/profiles/level2.json",IIIF_2_IMAGE_LEVEL_0="http://iiif.io/api/image/2/level0.json",IIIF_2_IMAGE_LEVEL_0_PROFILE="http://iiif.io/api/image/2/profiles/level0.json",IIIF_2_IMAGE_LEVEL_1="http://iiif.io/api/image/2/level1.json",IIIF_2_IMAGE_LEVEL_1_PROFILE="http://iiif.io/api/image/2/profiles/level1.json",IIIF_2_IMAGE_LEVEL_2="http://iiif.io/api/image/2/level2.json",IIIF_2_IMAGE_LEVEL_2_PROFILE="http://iiif.io/api/image/2/profiles/level2.json",IIIF_3_IMAGE_LEVEL_0="level0",IIIF_3_IMAGE_LEVEL_1="level1",IIIF_3_IMAGE_LEVEL_2="level2",IIIF_2_IMAGE_LEVEL_0_NO_JSON="http://iiif.io/api/image/2/level0",IIIF_2_IMAGE_LEVEL_1_NO_JSON="http://iiif.io/api/image/2/level1",IIIF_2_IMAGE_LEVEL_2_NO_JSON="http://iiif.io/api/image/2/level2",level1Support=[IIIF_2_IMAGE_LEVEL_1_NO_JSON,IIIF_2_IMAGE_LEVEL_2_NO_JSON,STANFORD_IIIF_IMAGE_COMPLIANCE_1,STANFORD_IIIF_IMAGE_COMPLIANCE_2,STANFORD_IIIF_IMAGE_CONFORMANCE_1,STANFORD_IIIF_IMAGE_CONFORMANCE_2,STANFORD_IIIF_1_IMAGE_COMPLIANCE_1,STANFORD_IIIF_1_IMAGE_COMPLIANCE_2,STANFORD_IIIF_1_IMAGE_CONFORMANCE_1,STANFORD_IIIF_1_IMAGE_CONFORMANCE_2,IIIF_1_IMAGE_LEVEL_1,IIIF_1_IMAGE_LEVEL_1_PROFILE,IIIF_1_IMAGE_LEVEL_2,IIIF_1_IMAGE_LEVEL_2_PROFILE,IIIF_2_IMAGE_LEVEL_1,IIIF_2_IMAGE_LEVEL_1_PROFILE,IIIF_2_IMAGE_LEVEL_2,IIIF_2_IMAGE_LEVEL_2_PROFILE,IIIF_3_IMAGE_LEVEL_1,IIIF_3_IMAGE_LEVEL_2],imageServiceProfiles=[IIIF_2_IMAGE_LEVEL_0_NO_JSON,IIIF_2_IMAGE_LEVEL_1_NO_JSON,IIIF_2_IMAGE_LEVEL_2_NO_JSON,STANFORD_IIIF_IMAGE_COMPLIANCE_0,STANFORD_IIIF_IMAGE_COMPLIANCE_1,STANFORD_IIIF_IMAGE_COMPLIANCE_2,STANFORD_IIIF_IMAGE_CONFORMANCE_0,STANFORD_IIIF_IMAGE_CONFORMANCE_1,STANFORD_IIIF_IMAGE_CONFORMANCE_2,STANFORD_IIIF_1_IMAGE_COMPLIANCE_0,STANFORD_IIIF_1_IMAGE_COMPLIANCE_1,STANFORD_IIIF_1_IMAGE_COMPLIANCE_2,STANFORD_IIIF_1_IMAGE_CONFORMANCE_0,STANFORD_IIIF_1_IMAGE_CONFORMANCE_1,STANFORD_IIIF_1_IMAGE_CONFORMANCE_2,IIIF_1_IMAGE_LEVEL_0,IIIF_1_IMAGE_LEVEL_0_PROFILE,IIIF_1_IMAGE_LEVEL_1,IIIF_1_IMAGE_LEVEL_1_PROFILE,IIIF_1_IMAGE_LEVEL_2,IIIF_1_IMAGE_LEVEL_2_PROFILE,IIIF_2_IMAGE_LEVEL_0,IIIF_2_IMAGE_LEVEL_0_PROFILE,IIIF_2_IMAGE_LEVEL_1,IIIF_2_IMAGE_LEVEL_1_PROFILE,IIIF_2_IMAGE_LEVEL_2,IIIF_2_IMAGE_LEVEL_2_PROFILE,IIIF_3_IMAGE_LEVEL_0,IIIF_3_IMAGE_LEVEL_1,IIIF_3_IMAGE_LEVEL_2],configuration={attributionLabel:"Attribution",lang:"none",providerId:"http://example.org/provider",providerName:"Unknown"};function convertLanguageMapping(tt,et="none"){if(!tt)return{};const nt=Array.isArray(tt)?tt:[tt],rt={};for(const it of nt){if(typeof it=="string"){rt[et]=rt[et]?rt[et]:[],rt[et].push(it||"");continue}if(!it["@language"]){rt[et]=rt[et]?rt[et]:[],rt[et].push(it["@value"]||"");continue}const st=it["@language"];rt[st]=rt[st]?rt[st]:[],rt[st].push(it["@value"]||"")}return rt}function getProfile(tt){if(Array.isArray(tt))return getProfile(tt.find(et=>typeof et=="string"));if(imageServiceProfiles.indexOf(tt)!==-1)return"level2";if(level1Support.indexOf(tt)!==-1)return"level1";if(typeof tt=="string")return tt}function getTypeFromContext(tt){const et=Array.isArray(tt)?tt:[tt];for(const nt of et)switch(nt){case"http://iiif.io/api/image/2/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2":return"ImageService2";case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":return"ImageService1";case"http://iiif.io/api/annex/openannotation/context.json":return"ImageApiSelector"}}function getTypeFromProfile(tt){switch(tt){case"http://iiif.io/api/image/2/level0.json":case"http://iiif.io/api/image/2/level1.json":case"http://iiif.io/api/image/2/level2.json":return"ImageService2";case"http://iiif.io/api/auth/1/kiosk":case"http://iiif.io/api/auth/1/login":case"http://iiif.io/api/auth/1/clickthrough":case"http://iiif.io/api/auth/1/external":case"http://iiif.io/api/auth/0/kiosk":case"http://iiif.io/api/auth/0/login":case"http://iiif.io/api/auth/0/clickthrough":case"http://iiif.io/api/auth/0/external":return"AuthCookieService1";case"http://iiif.io/api/auth/1/token":case"http://iiif.io/api/auth/0/token":return"AuthTokenService1";case"http://iiif.io/api/auth/1/logout":case"http://iiif.io/api/auth/0/logout":return"AuthLogoutService1";case"http://iiif.io/api/search/1/search":case"http://iiif.io/api/search/0/search":return"SearchService1";case"http://iiif.io/api/search/1/autocomplete":case"http://iiif.io/api/search/0/autocomplete":return"AutoCompleteService1"}}function removePrefix(tt){for(const et of["sc","oa","dcterms","dctypes","iiif"])if(tt.startsWith(`${et}:`))return tt.slice(et.length+1);return tt}const knownTypes=["Collection","Manifest","Annotation","AnnotationPage","Range","Service"];function getNewType(tt){const et=tt["@id"]||tt.id;let nt=tt["@type"]||tt.type;const rt=tt.profile||void 0,it=tt["@context"]||void 0;if(rt){const st=getTypeFromProfile(rt);if(st)return st}if(it){const st=getTypeFromContext(it);if(st)return st}if(nt){if(Array.isArray(nt)){if(nt.indexOf("oa:CssStylesheet")!==-1)return"CssStylesheet";if(nt.indexOf("cnt:ContentAsText")!==-1)return"TextualBody";nt=nt[0]}for(const st of["sc","oa","dcterms","dctypes","iiif"])if(nt.startsWith(`${st}:`)){nt=nt.slice(st.length+1);break}switch(nt){case"Layer":return"AnnotationCollection";case"AnnotationList":return"AnnotationPage";case"cnt:ContentAsText":return"TextualBody"}}if(nt&&knownTypes.indexOf(nt)!==-1)return nt;if(tt.format){if(tt.format.startsWith("image/"))return"Image";if(tt.format.startsWith("text/")||tt.format==="application/pdf")return"Text";if(tt.format.startsWith("application/"))return"Dataset"}return et&&(et.endsWith(".jpg")||et.endsWith(".png")||et.endsWith(".jpeg"))?"Image":nt||"unknown"}const licenseRegex=/http(s)?:\/\/(creativecommons.org|rightsstatements.org)[^"'\\<\n]+/gm;function extractLicense(tt){const et=tt.match(licenseRegex);return et?et[0]:tt}function fixLicense(tt,et="Rights/License",nt="none"){let rt=null;const it=[],st=Array.isArray(tt)?tt:[tt];for(const ot of st){const lt=ot?extractLicense(ot):void 0;if(lt&&(lt.indexOf("creativecommons.org")!==-1||lt.indexOf("rightsstatements.org")!==-1)){lt.startsWith("https://")?rt=`http://${lt.slice(8)}`:rt=lt;continue}lt&&it.push({label:{[nt]:[et]},value:{[nt]:[lt]}})}return[rt,it]}const removeContexts=["http://iiif.io/api/presentation/2/context.json","http://iiif.io/api/image/2/context.json","http://iiif.io/api/image/1/context.json","http://library.stanford.edu/iiif/image-api/1.1/context.json","http://iiif.io/api/search/1/context.json","http://iiif.io/api/search/0/context.json","http://iiif.io/api/auth/1/context.json","http://iiif.io/api/auth/0/context.json","http://iiif.io/api/annex/openannotation/context.json"];function fixContext(tt){if(tt){const et=Array.isArray(tt)?tt:[tt],nt=[];for(const rt of et)rt==="http://iiif.io/api/presentation/2/context.json"&&nt.push("http://iiif.io/api/presentation/3/context.json"),removeContexts.indexOf(rt)===-1&&nt.push(rt);if(et.length)return nt.length===1?nt[0]:nt}}function convertMetadata(tt){return tt?tt.map(et=>({label:convertLanguageMapping(et.label),value:convertLanguageMapping(et.value)})):[]}function removeUndefinedProperties(tt){for(const et in tt)(typeof tt[et]>"u"||tt[et]===null)&&delete tt[et];return tt}let mintedIdCounter=0;function mintNewIdFromResource(tt,et){const nt=encodeURI(tt.id||tt["@id"]||"").trim();return nt&&et?`${nt}/${et}`:nt||(mintedIdCounter++,`http://example.org/${tt["@type"]}${et?`/${et}`:""}/${mintedIdCounter}`)}function technicalProperties$2(tt){const et=[...tt.behavior||[]];tt.viewingHint&&et.push(tt.viewingHint);let nt;return Array.isArray(tt.motivation)?nt=tt.motivation.map(removePrefix):tt.motivation&&(nt=removePrefix(tt.motivation)),{"@context":tt["@context"]?fixContext(tt["@context"]):void 0,id:(tt["@id"]||mintNewIdFromResource(tt)).trim(),type:getNewType(tt),behavior:et.length?et:void 0,height:tt.height?tt.height:void 0,width:tt.width?tt.width:void 0,motivation:nt,viewingDirection:tt.viewingDirection,profile:tt.profile,format:tt.format?tt.format:void 0,duration:void 0,timeMode:void 0}}function descriptiveProperties$2(tt){const[et,nt]=fixLicense(tt.license),rt=[...tt.metadata?convertMetadata(tt.metadata):[],...nt];return{rights:et,metadata:rt.length?rt:void 0,label:tt.label?convertLanguageMapping(tt.label):void 0,requiredStatement:tt.attribution?{label:convertLanguageMapping(configuration.attributionLabel),value:convertLanguageMapping(tt.attribution)}:void 0,navDate:tt.navDate,summary:tt.description?convertLanguageMapping(tt.description):void 0,thumbnail:tt.thumbnail}}function parseWithin(tt){if(!tt.within)return;const et=Array.isArray(tt.within)?tt.within:[tt.within],nt=[];for(const rt of et)if(typeof rt=="string"){if(rt)switch(tt["@type"]){case"sc:Manifest":nt.push({id:rt,type:"Collection"});break}}else rt["@id"]&&nt.push({id:rt["@id"],type:getNewType(rt)});return nt.length?nt:void 0}function linkingProperties$2(tt){const et=tt.related?Array.isArray(tt.related)?tt.related:[tt.related]:[],nt=tt.contentLayer;return{provider:tt.logo||et.length?[{id:configuration.providerId,type:"Agent",homepage:et.length?[et[0]]:void 0,logo:tt.logo?Array.isArray(tt.logo)?tt.logo:[tt.logo]:void 0,label:convertLanguageMapping(configuration.providerName)}]:void 0,partOf:parseWithin(tt),rendering:tt.rendering,seeAlso:tt.seeAlso,start:tt.startCanvas,service:tt.service?ensureArray$1(tt.service):void 0,supplementary:nt?[nt]:void 0}}function embeddedContentProperties(tt){return{chars:tt.chars,format:tt.format?tt.format:void 0,language:tt.language}}function upgradeCollection(tt){return removeUndefinedProperties({...technicalProperties$2(tt),...descriptiveProperties$2(tt),...linkingProperties$2(tt),items:tt.members})}function upgradeManifest(tt){const et=[],nt=[];for(const it of tt.sequences||[])it.canvases.length&&et.push(...it.canvases),it.behavior&&nt.push(...it.behavior);const rt=technicalProperties$2(tt);return nt.length&&(rt.behavior?rt.behavior.push(...nt):rt.behavior=nt),removeUndefinedProperties({...rt,...descriptiveProperties$2(tt),...linkingProperties$2(tt),items:et,structures:tt.structures})}function upgradeCanvas(tt){return removeUndefinedProperties({...technicalProperties$2(tt),...descriptiveProperties$2(tt),...linkingProperties$2(tt),annotations:tt.otherContent&&tt.otherContent.length?tt.otherContent:void 0,items:tt.images&&tt.images.length?[{id:mintNewIdFromResource(tt,"annotation-page"),type:"AnnotationPage",items:tt.images}]:void 0})}function upgradeAnnotationList(tt){return removeUndefinedProperties({...technicalProperties$2(tt),...descriptiveProperties$2(tt),...linkingProperties$2(tt),items:tt.resources&&tt.resources.length?tt.resources:void 0})}function upgradeSequence(tt){return!tt.canvases||tt.canvases.length===0?{canvases:[],behavior:[]}:{canvases:tt.canvases,behavior:tt.viewingHint?[tt.viewingHint]:[]}}function upgradeAnnotation(tt){function et(nt){if(Array.isArray(nt)){if(nt.length>1)return{type:"List",items:nt.map(et)};nt=nt[0]}if(typeof nt=="string")return encodeURI(nt).trim();if("@type"in nt){let rt;if(typeof nt.full=="string")rt=nt.full;else if(nt.full["@type"]==="dctypes:Image")rt={id:nt.full["@id"],type:"Image"};else if(nt.full["@type"]==="sc:Canvas")rt={id:nt.full["@id"],type:"Canvas"};else throw new Error(`Unsupported source type on annotation: ${nt.full["@type"]}`);return{type:"SpecificResource",source:rt,selector:upgradeSelector(nt.selector)}}else return encodeURI(nt["@id"]).trim()}return removeUndefinedProperties({...technicalProperties$2(tt),...descriptiveProperties$2(tt),...linkingProperties$2(tt),target:et(tt.on),body:Array.isArray(tt.resource)?tt.resource.map(upgradeContentResource):upgradeContentResource(tt.resource)})}function upgradeContentResource(tt){const et=tt;return removeUndefinedProperties({...technicalProperties$2(et),...descriptiveProperties$2(et),...linkingProperties$2(et),...embeddedContentProperties(et)})}function upgradeChoice(tt){const et=[];return tt.default&&tt.default!=="rdf:nil"&&et.push(tt.default),tt.item&&tt.item!=="rdf:nil"&&et.push(...tt.item),{...technicalProperties$2(tt),...descriptiveProperties$2(tt),items:et}}function upgradeRange(tt){return removeUndefinedProperties({...technicalProperties$2(tt),...descriptiveProperties$2(tt),...linkingProperties$2(tt),items:tt.members})}function upgradeService(tt){const{"@id":et,"@type":nt,"@context":rt,profile:it,...st}=tt,ot={};return et&&(ot["@id"]=et),ot["@type"]=getNewType(tt),ot["@type"]==="unknown"&&(rt&&rt.length&&(ot["@context"]=rt),ot["@type"]="Service"),it&&(ot.profile=getProfile(it)),removeUndefinedProperties({...ot,...st})}function upgradeLayer(tt){return removeUndefinedProperties({...technicalProperties$2(tt),...descriptiveProperties$2(tt),...linkingProperties$2(tt)})}const presentation2to3=new Traverse({collection:[upgradeCollection],manifest:[upgradeManifest],canvas:[upgradeCanvas],annotationList:[upgradeAnnotationList],sequence:[upgradeSequence],annotation:[upgradeAnnotation],contentResource:[upgradeContentResource],choice:[upgradeChoice],range:[upgradeRange],service:[upgradeService],layer:[upgradeLayer]});function convertPresentation2(tt){return tt&&tt["@context"]&&(tt["@context"]==="http://iiif.io/api/presentation/2/context.json"||tt["@context"].indexOf("http://iiif.io/api/presentation/2/context.json")!==-1||tt["@context"]==="http://www.shared-canvas.org/ns/context.json")||tt["@context"]==="http://iiif.io/api/image/2/context.json"?presentation2to3.traverseUnknown(tt):tt}function upgradeSelector(tt){if((Array.isArray(tt["@type"])&&tt["@type"].includes("oa:SvgSelector")||tt["@type"]=="oa:SvgSelector")&&("chars"in tt||"value"in tt))return{type:"SvgSelector",value:"chars"in tt?tt.chars:tt.value};if(tt["@type"]==="oa:FragmentSelector")return{type:"FragmentSelector",value:tt.value};if(tt["@type"]==="oa:Choice")return[upgradeSelector(tt.default),...(Array.isArray(tt.item)?tt.item:[tt.item]).map(upgradeSelector)];if(tt["@type"]=="iiif:ImageApiSelector")return{type:"ImageApiSelector",region:"region"in tt?tt.region:void 0,rotation:"rotation"in tt?tt.rotation:void 0};throw new Error(`Unsupported selector type: ${tt["@type"]}`)}function getDefaultEntities$1(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}function getResource(tt,et){if(typeof tt=="string")return{id:tt,type:et};if(!tt.id)throw new Error(`Invalid resource does not have an ID (${et})`);return tt}function mapToEntities(tt){return(et,nt)=>{const rt=tt[et]?tt[et]:{};return it=>{const st=getResource(it,nt||et);return st&&st.id&&et?(rt[st.id]=rt[st.id]?mergeEntities(rt[st.id],st):Object.assign({},st),{id:st.id,type:et==="ContentResource"?et:st.type}):st}}}function merge(tt,et){if(!et)return tt;if(Array.isArray(tt)){if(!Array.isArray(et))throw new Error("Cannot merge array with non-array");const nt=[...tt];for(const rt of et)if(rt!=null)if(Array.isArray(rt))nt.push(rt);else if(typeof rt=="object"&&rt.id&&rt.type){const it=nt.findIndex(st=>st.id===rt.id&&st.type===rt.type);it>=0&&(nt[it]=merge(nt[it],rt))}else tt.indexOf(rt)===-1&&nt.push(rt);return nt}else if(typeof tt=="object"){if(Array.isArray(et)||typeof et!="object")throw new Error("Cannot merge object with non-object");const nt={...tt};for(const[rt,it]of Object.entries(et)){const st=nt[rt];st===EMPTY||!st?nt[rt]=it:nt[rt]=merge(st,it)}return nt}else if(tt)return tt;return et}function mergeEntities(tt,et){if(typeof tt=="string")return tt;if(et.id!==tt.id||et.type!==tt.type)throw new Error("Can only merge entities with identical identifiers and type!");return merge({...tt},et)}function recordTypeInMapping(tt){return(et,nt)=>rt=>{const{id:it,type:st}=getResource(rt,nt||et);if(typeof it>"u")throw new Error("Found invalid entity without an ID.");return et==="ContentResource"?tt[it]=et:tt[it]=st,rt}}function hash$1(tt){const et=JSON.stringify(tt);let nt=5381,rt=et.length;for(;rt;)nt=nt*33^et.charCodeAt(--rt);const st=(nt>>>0).toString(16);return st.length%2?"0"+st:st}function addMissingIdToContentResource(tt){return et=>typeof et=="string"?{id:et,type:tt}:et.id?et.type?et:{type:tt,...et}:{id:`vault://${hash$1(et)}`,type:tt,...et}}function ensureDefaultFields(tt){return et=>({...tt,...et})}function ensureArray(tt){return Array.isArray(tt)?tt:[tt]}function ensureArrayOnAnnotation(tt){return tt.body&&(tt.body=ensureArray(tt.body)),tt.seeAlso&&(tt.seeAlso=ensureArray(tt.seeAlso)),tt.body&&(tt.body=ensureArray(tt.body)),tt.audience&&(tt.audience=ensureArray(tt.audience)),tt.accessibility&&(tt.accessibility=ensureArray(tt.accessibility)),tt.motivation&&(tt.motivation=ensureArray(tt.motivation)),tt}function normalize(tt){const et=convertPresentation2(tt),nt=getDefaultEntities$1(),rt={},it=mapToEntities(nt),st=recordTypeInMapping(rt),lt=new Traverse$1({collection:[ensureDefaultFields(emptyCollection),st("Collection"),it("Collection")],manifest:[ensureDefaultFields(emptyManifest),st("Manifest"),it("Manifest")],canvas:[ensureDefaultFields(emptyCanvas),st("Canvas"),it("Canvas")],annotationPage:[addMissingIdToContentResource("AnnotationPage"),ensureDefaultFields(emptyAnnotationPage),st("AnnotationPage"),it("AnnotationPage")],annotation:[addMissingIdToContentResource("Annotation"),ensureArrayOnAnnotation,st("Annotation"),it("Annotation")],contentResource:[addMissingIdToContentResource("ContentResource"),st("ContentResource"),it("ContentResource")],range:[ensureDefaultFields(emptyRange),st("Range","Canvas"),it("Range","Canvas")],agent:[ensureDefaultFields(emptyAgent),st("Agent"),it("Agent")]}).traverseUnknown(et);return{entities:nt,resource:lt,mapping:rt}}const UNSET="__$UNSET$__",UNWRAP="__$UNWRAP$__";function resolveIfExists$1(tt,et){const nt=tt.requests[et],rt=tt.mapping[et];if(!(!rt||nt&&nt.resourceUri&&!tt.entities[rt][nt.resourceUri]))return tt.entities[rt][nt?nt.resourceUri:et]}function serializedFieldsToObject(tt){const et={};for(const[nt,rt]of tt){if(nt===UNWRAP&&rt!==UNSET)return rt;rt!==UNSET&&typeof rt<"u"&&rt!==null&&(et[nt]=rt)}return et}function serialize(tt,et,nt){if(!et.type||!et.id)throw new Error("Unknown entity");if(!nt[et.type])throw new Error(`Serializer not found for ${et.type}`);function rt(it){const st=nt[it.type];if(!st)return UNSET;const ot=resolveIfExists$1(tt,it.id)||(it.id&&it.type?it:null);if(!ot)return UNSET;const lt=st(ot,tt,{isTopLevel:et.id===it.id});let ut=lt.next();for(;!ut.done;){const ct=ut.value;let dt=UNSET;if(ct)if(Array.isArray(ct)){const ft=[];for(const pt of ct)ft.push(rt(pt));dt=ft}else dt=rt(ct);ut=lt.next(dt)}return ut.value===UNSET?UNSET:serializedFieldsToObject(ut.value)}return rt(et)}function languageString2to3(tt){if(!tt)return;const et=Object.keys(tt);if(et.length!==0){if(et.length===1){const nt=et[0];if(!nt)return"";const rt=(tt[nt]||[]).join("");return nt==="@none"||nt==="none"||nt==="en"?rt:{"@language":nt,"@value":rt}}return et.map(nt=>({"@language":nt,"@value":(tt[nt]||[]).join("")}))}}function parseCanvasTarget(tt){return Array.isArray(tt)?tt.map(et=>parseCanvasTarget(et)):typeof tt=="string"?tt:tt.type&&tt.type==="Canvas"?tt.id:tt}function unNestArray(tt,et=!1){if(tt)return tt.length>1&&!et?tt:tt[0]||void 0}function convertService(tt){if(tt){if(typeof tt=="string")return{"@id":tt};if("@id"in tt){const et={...tt};return delete et["@type"],et}return{"@context":"http://iiif.io/api/image/2/context.json","@id":tt.id,profile:`http://iiif.io/api/image/2/profiles/${tt.profile}.json`}}}function technicalProperties$1(tt,et){return[["@id",tt.id],["@type",et],["format",tt.format],["height",tt.height],["width",tt.width],["viewingDirection",tt.viewingDirection!=="left-to-right"?tt.viewingDirection:void 0]]}function*descriptiveProperties$1(tt){const et=tt.provider?yield tt.provider[0]:void 0;return[["label",languageString2to3(tt.label)],["metadata",tt.metadata&&tt.metadata.length?tt.metadata.map(nt=>({label:languageString2to3(nt.label)||"",value:languageString2to3(nt.value)||""})):void 0],["description",languageString2to3(tt.summary)],["thumbnail",unNestArray(yield tt.thumbnail)],["navDate",tt.navDate],["logo",et?unNestArray(et.logo):void 0],["homepage",et?et.homepage:void 0],["attribution",tt.requiredStatement?languageString2to3(tt.requiredStatement.value):void 0]]}function*linkingProperties$1(tt){return[["seeAlso",unNestArray(yield tt.seeAlso)],["service",unNestArray((tt.service||[]).map(convertService))],["rendering",unNestArray(yield tt.rendering)],["startCanvas",tt.start?tt.start.id:void 0]]}const serializeConfigPresentation2={Manifest:function*(tt){return[...technicalProperties$1(tt,"sc:Manifest"),...yield*descriptiveProperties$1(tt),...yield*linkingProperties$1(tt),["sequences",[{"@id":`${tt.id}/sequence0`,"@type":"sc:Sequence",canvases:yield tt.items}]],["structures",yield tt.structures]]},Canvas:function*(tt){const nt=(yield tt.items)[0];return[...technicalProperties$1(tt,"sc:Canvas"),...yield*descriptiveProperties$1(tt),...yield*linkingProperties$1(tt),["images",nt?[nt.resources]:void 0],["annotations",tt.annotations&&tt.annotations.length?unNestArray(yield tt.annotations):void 0]]},AnnotationPage:function*(tt){return[...technicalProperties$1(tt,"sc:AnnotationList"),...yield*descriptiveProperties$1(tt),["resources",tt.items&&tt.items.length?unNestArray(yield tt.items):void 0]]},Annotation:function*(tt){return[["@id",tt.id],["@type","oa:Annotation"],["motivation","sc:painting"],["on",parseCanvasTarget(tt.target)],["resource",unNestArray(yield tt.body,!0)]]},ContentResource:function*(tt){switch(tt.type){case"Image":return[...technicalProperties$1(tt,"dctypes:Image"),...yield*descriptiveProperties$1(tt),...yield*linkingProperties$1(tt)];case"Text":case"Dataset":default:return[...technicalProperties$1(tt,void 0),...yield*descriptiveProperties$1(tt)]}},AnnotationCollection:function*(tt){return[["@id",tt.id],["@type","sc:Layer"],["label",languageString2to3(tt.label)]]},Collection:function*(tt){return[...technicalProperties$1(tt,"sc:Collection"),...yield*descriptiveProperties$1(tt),...yield*linkingProperties$1(tt),["members",yield*tt.items]]},Range:function*(tt){const et=[],nt=[];if(tt.items)for(const rt of tt.items){const it=yield rt;et.push({"@id":rt.id,"@type":rt.type,label:it?it.label:void 0,within:tt.id}),rt.type==="Canvas"&&nt.push(rt.id)}return[...technicalProperties$1(tt,"sc:Range"),...yield*descriptiveProperties$1(tt),...yield*linkingProperties$1(tt),["canvases",nt.length===et.length?nt:void 0],["members",nt.length!==et.length?et:void 0]]}};function technicalProperties(tt){var et;return[["id",(et=tt.id)!=null&&et.startsWith("vault://")?void 0:tt.id],["type",tt.type],["format",tt.format],["profile",tt.profile],["height",tt.height],["width",tt.width],["duration",tt.duration||void 0],["viewingDirection",tt.viewingDirection!=="left-to-right"?tt.viewingDirection:void 0],["behavior",tt.behavior&&tt.behavior.length?tt.behavior:void 0],["timeMode",tt.timeMode],["motivation",Array.isArray(tt.motivation)?tt.motivation[0]:tt.motivation]]}function filterEmpty(tt){if(!(!tt||tt.length===0))return tt}function service2compat(tt){if(tt&&tt.type&&tt.type==="ImageService2"){const{id:et,type:nt,profile:rt,...it}=tt,st=typeof rt=="string"?rt:Array.isArray(rt)?rt.find(ot=>typeof ot=="string"):"";return{"@id":et,"@type":nt,profile:st?st.startsWith("http")?st:`http://iiif.io/api/image/2/${st}.json`:"http://iiif.io/api/image/2/level0.json",...it}}return tt}function filterService2Compat(tt){if(!(!tt||tt.length===0))return tt.map(service2compat)}function*descriptiveProperties(tt){return[["label",tt.label],["metadata",filterEmpty(tt.metadata)],["summary",tt.summary],["requiredStatement",tt.requiredStatement],["rights",tt.rights],["navDate",tt.navDate],["language",tt.language],["thumbnail",filterEmpty(yield tt.thumbnail)],["placeholderCanvas",yield tt.placeholderCanvas],["accompanyingCanvas",yield tt.accompanyingCanvas],["provider",filterEmpty(yield tt.provider)]]}function*linkingProperties(tt){return[["seeAlso",filterEmpty(yield tt.seeAlso)],["service",filterService2Compat(tt.service)],["services",filterService2Compat(tt.services)],["rendering",filterEmpty(yield tt.rendering)],["supplementary",filterEmpty(yield tt.supplementary)],["homepage",filterEmpty(yield tt.homepage)],["logo",filterEmpty(yield tt.logo)],["partOf",filterEmpty(yield tt.partOf)],["start",tt.start]]}const serializeConfigPresentation3={Manifest:function*(tt,et,{isTopLevel:nt}){return nt?[["@context","http://iiif.io/api/presentation/3/context.json"],...technicalProperties(tt),...yield*descriptiveProperties(tt),...yield*linkingProperties(tt),["items",yield tt.items],["structures",filterEmpty(yield tt.structures)],["annotations",filterEmpty(yield tt.annotations)]]:[...technicalProperties(tt),...yield*descriptiveProperties(tt)]},Canvas:function*(tt){return[...technicalProperties(tt),...yield*descriptiveProperties(tt),...yield*linkingProperties(tt),["items",yield tt.items],["annotations",filterEmpty(yield tt.annotations)]]},Agent:function*(tt){return[["id",tt.id],["type","Agent"],["label",tt.label],...yield*linkingProperties(tt)]},AnnotationPage:function*(tt){return[...Object.entries(tt).map(([nt,rt])=>[nt,Array.isArray(rt)?filterEmpty(rt):rt]).filter(([nt,rt])=>nt!=="items"),...yield*linkingProperties(tt),["items",yield tt.items]]},Service:function*(tt){return[[UNWRAP,service2compat(tt)]]},Annotation:function*(tt){const et=Object.entries(tt).map(([rt,it])=>rt==="motivation"?[rt,Array.isArray(it)?it[0]:it]:[rt,Array.isArray(it)?filterEmpty(it):it]).filter(([rt])=>rt!=="body"),nt=yield tt.body;return[...et,["body",nt.length===1?nt[0]:nt]]},ContentResource:function*(tt){return[...technicalProperties(tt),...yield*descriptiveProperties(tt),...yield*linkingProperties(tt),["annotations",filterEmpty(yield tt.annotations)],["items",filterEmpty(yield tt.items)]]},AnnotationCollection:function*(tt){return[["id",tt.id],["type","AnnotationCollection"],["label",tt.label]]},Collection:function*(tt,et,{isTopLevel:nt}){return nt?[["@context","http://iiif.io/api/presentation/3/context.json"],...technicalProperties(tt),...yield*descriptiveProperties(tt),...yield*linkingProperties(tt),["items",filterEmpty(yield tt.items)]]:[...technicalProperties(tt),...yield*descriptiveProperties(tt)]},Range:function*(tt){const et=[];for(const nt of tt.items)nt.type==="Range"?et.push(yield nt):et.push(nt);return[...technicalProperties(tt),...yield*descriptiveProperties(tt),...yield*linkingProperties(tt),["items",et],["annotations",filterEmpty(yield tt.annotations)]]}};function n$1(tt){return tt==null}function t$1(tt){throw new Error("Argument "+tt+" is empty.")}function o$1(tt){return typeof tt=="string"||typeof tt=="symbol"}function u$2(tt){return!o$1(tt)}function a$2(tt){throw new Error("Argument "+tt+" is invalid, it should be an action type of type: string | symbol")}function s$2(tt,et){return n$1(tt)&&t$1(1),u$2(tt)&&a$2(1),Object.assign(function(){var nt=et!=null?et.apply(void 0,arguments):void 0;return Object.assign({type:tt},nt)},{getType:function(){return tt},toString:function(){return tt}})}function y$1(tt,et,nt){return n$1(tt)&&t$1(1),u$2(tt)&&a$2(1),function(){return s$2(tt,function(){var rt=arguments.length<=0?void 0:arguments[0],it=arguments.length<=1?void 0:arguments[1];return et==null&&nt==null||(rt=et!=null?et.apply(void 0,arguments):void 0,it=nt!=null?nt.apply(void 0,arguments):void 0),Object.assign({},rt!==void 0&&{payload:rt},{},it!==void 0&&{meta:it})})}}function _typeof(tt){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(et){return typeof et}:function(et){return et&&typeof Symbol=="function"&&et.constructor===Symbol&&et!==Symbol.prototype?"symbol":typeof et},_typeof(tt)}function toPrimitive(tt,et){if(_typeof(tt)!="object"||!tt)return tt;var nt=tt[Symbol.toPrimitive];if(nt!==void 0){var rt=nt.call(tt,et||"default");if(_typeof(rt)!="object")return rt;throw new TypeError("@@toPrimitive must return a primitive value.")}return(et==="string"?String:Number)(tt)}function toPropertyKey(tt){var et=toPrimitive(tt,"string");return _typeof(et)=="symbol"?et:String(et)}function _defineProperty$1(tt,et,nt){return et=toPropertyKey(et),et in tt?Object.defineProperty(tt,et,{value:nt,enumerable:!0,configurable:!0,writable:!0}):tt[et]=nt,tt}function ownKeys$1(tt,et){var nt=Object.keys(tt);if(Object.getOwnPropertySymbols){var rt=Object.getOwnPropertySymbols(tt);et&&(rt=rt.filter(function(it){return Object.getOwnPropertyDescriptor(tt,it).enumerable})),nt.push.apply(nt,rt)}return nt}function _objectSpread2$1(tt){for(var et=1;et<arguments.length;et++){var nt=arguments[et]!=null?arguments[et]:{};et%2?ownKeys$1(Object(nt),!0).forEach(function(rt){_defineProperty$1(tt,rt,nt[rt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(tt,Object.getOwnPropertyDescriptors(nt)):ownKeys$1(Object(nt)).forEach(function(rt){Object.defineProperty(tt,rt,Object.getOwnPropertyDescriptor(nt,rt))})}return tt}function formatProdErrorMessage(tt){return"Minified Redux error #"+tt+"; visit https://redux.js.org/Errors?code="+tt+" for the full message or use the non-minified dev environment for full errors. "}var $$observable=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),randomString=function(){return Math.random().toString(36).substring(7).split("").join(".")},ActionTypes={INIT:"@@redux/INIT"+randomString(),REPLACE:"@@redux/REPLACE"+randomString(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+randomString()}};function isPlainObject$3(tt){if(typeof tt!="object"||tt===null)return!1;for(var et=tt;Object.getPrototypeOf(et)!==null;)et=Object.getPrototypeOf(et);return Object.getPrototypeOf(tt)===et}function createStore$1(tt,et,nt){var rt;if(typeof et=="function"&&typeof nt=="function"||typeof nt=="function"&&typeof arguments[3]=="function")throw new Error(formatProdErrorMessage(0));if(typeof et=="function"&&typeof nt>"u"&&(nt=et,et=void 0),typeof nt<"u"){if(typeof nt!="function")throw new Error(formatProdErrorMessage(1));return nt(createStore$1)(tt,et)}if(typeof tt!="function")throw new Error(formatProdErrorMessage(2));var it=tt,st=et,ot=[],lt=ot,ut=!1;function ct(){lt===ot&&(lt=ot.slice())}function dt(){if(ut)throw new Error(formatProdErrorMessage(3));return st}function ft(Yr){if(typeof Yr!="function")throw new Error(formatProdErrorMessage(4));if(ut)throw new Error(formatProdErrorMessage(5));var mt=!0;return ct(),lt.push(Yr),function(){if(mt){if(ut)throw new Error(formatProdErrorMessage(6));mt=!1,ct();var Xr=lt.indexOf(Yr);lt.splice(Xr,1),ot=null}}}function pt(Yr){if(!isPlainObject$3(Yr))throw new Error(formatProdErrorMessage(7));if(typeof Yr.type>"u")throw new Error(formatProdErrorMessage(8));if(ut)throw new Error(formatProdErrorMessage(9));try{ut=!0,st=it(st,Yr)}finally{ut=!1}for(var mt=ot=lt,Kr=0;Kr<mt.length;Kr++){var Xr=mt[Kr];Xr()}return Yr}function gt(Yr){if(typeof Yr!="function")throw new Error(formatProdErrorMessage(10));it=Yr,pt({type:ActionTypes.REPLACE})}function _r(){var Yr,mt=ft;return Yr={subscribe:function(Xr){if(typeof Xr!="object"||Xr===null)throw new Error(formatProdErrorMessage(11));function Zr(){Xr.next&&Xr.next(dt())}Zr();var Qr=mt(Zr);return{unsubscribe:Qr}}},Yr[$$observable]=function(){return this},Yr}return pt({type:ActionTypes.INIT}),rt={dispatch:pt,subscribe:ft,getState:dt,replaceReducer:gt},rt[$$observable]=_r,rt}function assertReducerShape(tt){Object.keys(tt).forEach(function(et){var nt=tt[et],rt=nt(void 0,{type:ActionTypes.INIT});if(typeof rt>"u")throw new Error(formatProdErrorMessage(12));if(typeof nt(void 0,{type:ActionTypes.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(formatProdErrorMessage(13))})}function combineReducers(tt){for(var et=Object.keys(tt),nt={},rt=0;rt<et.length;rt++){var it=et[rt];typeof tt[it]=="function"&&(nt[it]=tt[it])}var st=Object.keys(nt),ot;try{assertReducerShape(nt)}catch(lt){ot=lt}return function(ut,ct){if(ut===void 0&&(ut={}),ot)throw ot;for(var dt=!1,ft={},pt=0;pt<st.length;pt++){var gt=st[pt],_r=nt[gt],Yr=ut[gt],mt=_r(Yr,ct);if(typeof mt>"u")throw ct&&ct.type,new Error(formatProdErrorMessage(14));ft[gt]=mt,dt=dt||mt!==Yr}return dt=dt||st.length!==Object.keys(ut).length,dt?ft:ut}}function compose(){for(var tt=arguments.length,et=new Array(tt),nt=0;nt<tt;nt++)et[nt]=arguments[nt];return et.length===0?function(rt){return rt}:et.length===1?et[0]:et.reduce(function(rt,it){return function(){return rt(it.apply(void 0,arguments))}})}function applyMiddleware(){for(var tt=arguments.length,et=new Array(tt),nt=0;nt<tt;nt++)et[nt]=arguments[nt];return function(rt){return function(){var it=rt.apply(void 0,arguments),st=function(){throw new Error(formatProdErrorMessage(15))},ot={getState:it.getState,dispatch:function(){return st.apply(void 0,arguments)}},lt=et.map(function(ut){return ut(ot)});return st=compose.apply(void 0,lt)(it.dispatch),_objectSpread2$1(_objectSpread2$1({},it),{},{dispatch:st})}}}const IMPORT_ENTITIES="@iiif/IMPORT_ENTITIES",MODIFY_ENTITY_FIELD="@iiif/MODIFY_ENTITY_FIELD",REORDER_ENTITY_FIELD="@iiif/REORDER_ENTITY_FIELD",ADD_REFERENCE="@iiif/ADD_REFERENCE",REMOVE_REFERENCE="@iiif/REMOVE_REFERENCE",importEntities=y$1(IMPORT_ENTITIES)(),modifyEntityField=y$1(MODIFY_ENTITY_FIELD)(),reorderEntityField=y$1(REORDER_ENTITY_FIELD)(),addReference=y$1(ADD_REFERENCE)(),removeReference=y$1(REMOVE_REFERENCE)(),entityActions={importEntities,modifyEntityField,reorderEntityField,addReference,removeReference},ADD_MAPPING="@iiif/ADD_MAPPING",ADD_MAPPINGS="@iiif/ADD_MAPPINGS",addMapping=y$1(ADD_MAPPING)(),addMappings=y$1(ADD_MAPPINGS)(),SET_META_VALUE="@iiif/SET_META_VALUE",SET_META_VALUE_DYNAMIC="@iiif/SET_META_VALUE_DYNAMIC",UNSET_META_VALUE="@iiif/UNSET_META_VALUE",setMetaValue=y$1(SET_META_VALUE)(),setMetaValueDynamic=y$1(SET_META_VALUE_DYNAMIC)(),unsetMetaValue=y$1(UNSET_META_VALUE)(),metaActions={setMetaValue,setMetaValueDynamic,unsetMetaValue},RESOURCE_ERROR="RESOURCE_ERROR",RESOURCE_LOADING="RESOURCE_LOADING",RESOURCE_READY="RESOURCE_READY",REQUEST_RESOURCE="@iiif/REQUEST_RESOURCE",REQUEST_ERROR="@iiif/REQUEST_ERROR",REQUEST_MISMATCH="@iiif/REQUEST_MISMATCH",REQUEST_COMPLETE="@iiif/REQUEST_COMPLETE",REQUEST_OFFLINE_RESOURCE="@iiif/REQUEST_OFFLINE_RESOURCE",requestResource=y$1(REQUEST_RESOURCE)(),requestError=y$1(REQUEST_ERROR)(),requestMismatch=y$1(REQUEST_MISMATCH)(),requestComplete=y$1(REQUEST_COMPLETE)();y$1(REQUEST_OFFLINE_RESOURCE)();const BATCH_ACTIONS="@iiif/BATCH",BATCH_IMPORT="@iiif/BATCH_IMPORT",batchActions=y$1(BATCH_ACTIONS)();y$1(BATCH_IMPORT)();const actionListFromResource=(tt,et)=>{const{entities:nt,resource:rt,mapping:it}=normalize(et);if(rt.id===void 0)return[requestError({id:tt,message:"ID is not defined in resource."})];const st=[importEntities({entities:nt}),addMappings({mapping:it})];return rt.id!==tt&&(st.push(addMapping({id:tt,type:rt.type})),st.push(requestMismatch({requestId:tt,actualId:rt.id}))),st.push(requestComplete({id:tt})),st},safeIsNaN=Number.isNaN||function(et){return typeof et=="number"&&et!==et};function isEqual(tt,et){return!!(tt===et||safeIsNaN(tt)&&safeIsNaN(et))}function areInputsEqual(tt,et){if(!Array.isArray(tt)||!Array.isArray(et))return tt===et;if(tt.length!==et.length)return!1;for(let nt=0;nt<tt.length;nt++)if(!isEqual(tt[nt],et[nt]))return!1;return!0}function resolveIfExists(tt,et){const nt=tt.iiif.requests[et],rt=tt.iiif.mapping[et];if(!(!rt||!tt.iiif.entities[rt][nt.resourceUri]))return tt.iiif.entities[rt][nt.resourceUri]}function createFetchHelper(tt,et,{waitTimeout:nt=30}={}){return async(rt,it)=>{const st=tt.getState(),ot=st.iiif.requests[rt];if(ot)switch(ot.loadingState){case RESOURCE_ERROR:break;case RESOURCE_LOADING:{let lt,ut=!1;try{const ct=await Promise.race([new Promise((dt,ft)=>{ut||(lt=tt.subscribe(()=>{const pt=tt.getState();if(pt.iiif.requests[rt].loadingState===RESOURCE_ERROR){ft();return}if(pt.iiif.requests[rt].loadingState===RESOURCE_READY){const gt=resolveIfExists(pt,rt);gt?dt(gt):ft()}}))}),new Promise((dt,ft)=>setTimeout(()=>{ut=!0,ft()},nt*60))]);if(lt&&lt(),ct)return ct}catch{lt&&lt();break}break}case RESOURCE_READY:{const lt=resolveIfExists(st,rt);if(lt)return lt;break}}tt.dispatch(requestResource({id:rt}));try{const lt=await et(rt,it);!lt.id&&!lt["@id"]&&(lt["@type"]&&(lt["@id"]=rt),lt.id=rt);const ut=actionListFromResource(rt,lt);return tt.dispatch(batchActions({actions:ut})),resolveIfExists(tt.getState(),rt)}catch(lt){throw tt.dispatch(requestError({id:rt,message:lt.toString()})),lt}}}function getDefaultEntities(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}const mappingReducer=(tt={},et)=>{switch(et.type){case ADD_MAPPING:return{...tt,[et.payload.id]:et.payload.type};case ADD_MAPPINGS:return{...tt,...et.payload.mapping};default:return tt}};function isReferenceList(tt,et,nt,rt){return!(!tt[nt]||!tt[nt][et]||!tt[nt][et][rt]||!Array.isArray(tt[nt][et][rt]))}function quickMerge(tt,et){const nt={},rt=[];for(const[it,st]of Object.entries(tt||{})){rt.push(it);const ot=(et||{})[it];if(!ot||ot.length===0){nt[it]=st;continue}nt[it]=ot}for(const[it,st]of Object.entries(et||{}))rt.indexOf(it)===-1&&(nt[it]=st);return nt}const entitiesReducer=(tt=getDefaultEntities(),et)=>{var nt;switch(et.type){case MODIFY_ENTITY_FIELD:{if(!tt[et.payload.type]||!tt[et.payload.type][et.payload.id])return tt;const rt=tt[et.payload.type][et.payload.id];return typeof rt=="string"?tt:{...tt,[et.payload.type]:{...tt[et.payload.type],[et.payload.id]:{...rt,[et.payload.key]:et.payload.value}}}}case REORDER_ENTITY_FIELD:{if(!isReferenceList(tt,et.payload.id,et.payload.type,et.payload.key))return tt;const rt=tt[et.payload.type][et.payload.id];if(typeof rt=="string")return tt;const it=Array.from(rt[et.payload.key]),[st]=it.splice(et.payload.startIndex,1);return it.splice(et.payload.endIndex,0,st),{...tt,[et.payload.type]:{...tt[et.payload.type],[et.payload.id]:{...rt,[et.payload.key]:it}}}}case IMPORT_ENTITIES:{const rt=Object.keys(et.payload.entities),it={...tt};for(const st of rt){const ot=et.payload.entities[st],lt={...tt[st]||{}};let ut=!1;const ct=Object.keys(ot||{})||[];if(ot&&ct){for(const dt of ct)ut=!0,lt[dt]=tt[st][dt]?quickMerge(tt[st][dt],ot[dt]):ot[dt];ut&&(it[st]=lt)}}return it}case ADD_REFERENCE:{if(!isReferenceList(tt,et.payload.id,et.payload.type,et.payload.key))return tt;const rt=tt[et.payload.type][et.payload.id],it=Array.from(rt[et.payload.key]);return it.splice(et.payload.index||it.length+1,0,et.payload.reference),{...tt,[et.payload.type]:{...tt[et.payload.type],[et.payload.id]:{...rt,[et.payload.key]:it}}}}case REMOVE_REFERENCE:{if(!isReferenceList(tt,et.payload.id,et.payload.type,et.payload.key))return tt;const rt=tt[et.payload.type][et.payload.id],it=Array.from(rt[et.payload.key]),st=et.payload.index||it.findIndex(ot=>ot&&ot.id===et.payload.reference.id);return st===-1||((nt=it[st])==null?void 0:nt.id)!==et.payload.reference.id?tt:(it.splice(st,1),{...tt,[et.payload.type]:{...tt[et.payload.type],[et.payload.id]:{...rt,[et.payload.key]:it}}})}default:return tt}},requestReducer=(tt={},et)=>{switch(et.type){case REQUEST_RESOURCE:case REQUEST_OFFLINE_RESOURCE:return{...tt,[et.payload.id]:{requestUri:et.payload.id,loadingState:RESOURCE_LOADING,uriMismatch:!1,resourceUri:et.payload.id}};case REQUEST_MISMATCH:return{...tt,[et.payload.requestId]:{...tt[et.payload.requestId]||{},uriMismatch:!0,resourceUri:et.payload.actualId},[et.payload.actualId]:{requestUri:et.payload.requestId,loadingState:tt[et.payload.requestId].loadingState,uriMismatch:!0,resourceUri:et.payload.actualId}};case REQUEST_ERROR:return{...tt,[et.payload.id]:{...tt[et.payload.id]||{},loadingState:RESOURCE_ERROR,error:et.payload.message}};case REQUEST_COMPLETE:return{...tt,[et.payload.id]:{...tt[et.payload.id]||{},loadingState:RESOURCE_READY,error:void 0}}}return tt},metaReducer=(tt={},et)=>{const{id:nt,updateValue:rt,value:it,meta:st,key:ot}=et&&et.payload||{};switch(et.type){case SET_META_VALUE:return{...tt,[nt]:{...tt[nt]||{},[st]:{...tt[nt]?tt[nt][st]||{}:{},[ot]:it}}};case SET_META_VALUE_DYNAMIC:return{...tt,[nt]:{...tt[nt]||{},[st]:{...tt[nt]?tt[nt][st]||{}:{},[ot]:tt[nt]&&tt[nt][st]?rt(tt[nt][st][ot]):rt(void 0)}}};case UNSET_META_VALUE:return tt[nt]&&tt[nt][st]&&tt[nt][st][ot]?{...tt,[nt]:{...tt[nt]||{},[st]:{...tt[nt]?tt[nt][st]||{}:{},[ot]:void 0}}}:tt;default:return tt}};function createBatchReducer(tt){return(et,nt)=>nt&&nt.type===BATCH_ACTIONS?nt.payload.actions.reduce(tt,et):nt&&nt.type===BATCH_IMPORT?nt.payload.state:tt(et,nt)}const reducers=combineReducers({mapping:mappingReducer,entities:entitiesReducer,requests:requestReducer,meta:metaReducer}),composeEnhancers=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||compose;function createStore(tt={}){const{enableDevtools:et=!0,iiifStoreName:nt="iiif",defaultState:rt={},extraMiddleware:it=[],customReducers:st={}}=tt,ot=combineReducers({[nt]:reducers,...st});return createStore$1(createBatchReducer(ot),rt,et?composeEnhancers(applyMiddleware(...it)):compose(applyMiddleware(...it)))}function mitt(tt){return{all:tt=tt||new Map,on:function(et,nt){var rt=tt.get(et);rt?rt.push(nt):tt.set(et,[nt])},off:function(et,nt){var rt=tt.get(et);rt&&(nt?rt.splice(rt.indexOf(nt)>>>0,1):tt.set(et,[]))},emit:function(et,nt){var rt=tt.get(et);rt&&rt.slice().map(function(it){it(nt)}),(rt=tt.get("*"))&&rt.slice().map(function(it){it(et,nt)})}}}class Vault{constructor(et,nt){eo(this,"options");eo(this,"store");eo(this,"emitter");eo(this,"isBatching",!1);eo(this,"batchQueue",[]);eo(this,"remoteFetcher");eo(this,"staticFetcher");eo(this,"defaultFetcher",et=>fetch(et).then(nt=>nt.json()));eo(this,"middleware",et=>nt=>rt=>{if(rt.type===BATCH_ACTIONS){for(const ot of rt.payload.actions)this.emitter.emit(ot.type,{realAction:ot,state:et.getState()});const st=nt(rt);for(const ot of rt.payload.actions)this.emitter.emit(`after:${rt.type}`,{action:rt,state:st});return st}this.emitter.emit(rt.type,{action:rt,state:et.getState()});const it=nt(rt);return this.emitter.emit(`after:${rt.type}`,{action:rt,state:it}),it});this.options=Object.assign({reducers:{},middleware:[],defaultState:{},customFetcher:this.defaultFetcher,enableDevtools:!0},et||{}),this.store=nt||createStore({customReducers:this.options.reducers,extraMiddleware:[...this.options.middleware,this.middleware],defaultState:this.options.defaultState,enableDevtools:this.options.enableDevtools}),this.emitter=mitt(),this.remoteFetcher=createFetchHelper(this.store,this.options.customFetcher),this.staticFetcher=createFetchHelper(this.store,(rt,it)=>it)}batch(et){this.isBatching=!0;try{et(this),this.store.dispatch(batchActions({actions:this.batchQueue}))}catch(nt){throw this.batchQueue=[],this.isBatching=!1,nt}this.batchQueue=[],this.isBatching=!1}async asyncBatch(et){this.isBatching=!0;try{await et(this),this.store.dispatch(batchActions({actions:this.batchQueue}))}catch(nt){throw this.batchQueue=[],this.isBatching=!1,nt}this.batchQueue=[],this.isBatching=!1}modifyEntityField(et,nt,rt){this.dispatch(entityActions.modifyEntityField({id:et.id,type:et.type,key:nt,value:rt}))}dispatch(et){this.isBatching?this.batchQueue.push(et):this.store.dispatch(et)}serialize(et,nt){return serialize(this.getState().iiif,et,nt)}toPresentation2(et){return this.serialize(et,serializeConfigPresentation2)}toPresentation3(et){return this.serialize(et,serializeConfigPresentation3)}hydrate(et,nt){return this.get(et,nt,{skipSelfReturn:!1})}get(et,nt,rt={}){typeof nt!="string"&&(rt=nt||{},nt=void 0);const{skipSelfReturn:it=!0}=rt||{};if(Array.isArray(et))return et.map(ct=>this.get(ct,rt));const st=this.getState();if(typeof et=="string"){const ct=nt||st.iiif.mapping[et];if(!ct)return it?null:{id:et,type:"unknown"};et={id:et,type:ct}}const ot=nt||et.type,lt=et.id,ut=st.iiif.entities[ot];if(!ut){const ct=st.iiif.requests[lt];return ct&&ct.resourceUri!==lt?this.get(ct.resourceUri,rt):it?null:et}return ut[et.id]||(it?null:et)}select(et){return et(this.getState())}getStore(){return this.store}getState(){return this.store.getState()}loadManifest(et,nt){const rt=typeof et=="string"?et:et.id;return this.load(rt,nt)}loadCollection(et,nt){const rt=typeof et=="string"?et:et.id;return this.load(rt,nt)}load(et,nt){const rt=typeof et=="string"?et:et.id;return nt?this.staticFetcher(rt,nt):this.remoteFetcher(rt)}areInputsEqual(et,nt){return areInputsEqual(et,nt)}subscribe(et,nt,rt){typeof rt>"u"&&(typeof nt>"u"||nt===!1||nt===!0)&&(rt=nt,nt=et,et=st=>st);let it=rt?null:et(this.store.getState());return rt||nt(it,this),this.store.subscribe(()=>{const st=this.store.getState(),ot=et(st);it!==ot&&!areInputsEqual(it,ot)&&nt(ot,this),it=ot})}async ensureLoaded(et){const nt=typeof et=="string"?et:et.id;this.requestStatus(nt)||await this.load(nt)}requestStatus(et){return this.select(nt=>nt.iiif.requests[et])}getResourceMeta(et,nt){const rt=this.getState().iiif.meta[et];if(rt)return nt?rt[nt]:rt}setMetaValue([et,nt,rt],it){this.dispatch(typeof it=="function"?metaActions.setMetaValueDynamic({id:et,meta:nt,key:rt,updateValue:it}):metaActions.setMetaValue({id:et,meta:nt,key:rt,value:it}))}}function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(tt){for(var et=1;et<arguments.length;et++){var nt=arguments[et];for(var rt in nt)Object.prototype.hasOwnProperty.call(nt,rt)&&(tt[rt]=nt[rt])}return tt},_extends$1.apply(this,arguments)}function $e42e1063c40fb3ef$export$b9ecd428b558ff10(tt,et,{checkForDefaultPrevented:nt=!0}={}){return function(it){if(tt==null||tt(it),nt===!1||!it.defaultPrevented)return et==null?void 0:et(it)}}function $c512c27ab02ef895$export$50c7b4e9d9f19c1(tt,et=[]){let nt=[];function rt(st,ot){const lt=G$3(ot),ut=nt.length;nt=[...nt,ot];function ct(ft){const{scope:pt,children:gt,..._r}=ft,Yr=(pt==null?void 0:pt[tt][ut])||lt,mt=q$2(()=>_r,Object.values(_r));return y$3(Yr.Provider,{value:mt},gt)}function dt(ft,pt){const gt=(pt==null?void 0:pt[tt][ut])||lt,_r=P$3(gt);if(_r)return _r;if(ot!==void 0)return ot;throw new Error(`\`${ft}\` must be used within \`${st}\``)}return ct.displayName=st+"Provider",[ct,dt]}const it=()=>{const st=nt.map(ot=>G$3(ot));return function(lt){const ut=(lt==null?void 0:lt[tt])||st;return q$2(()=>({[`__scope${tt}`]:{...lt,[tt]:ut}}),[lt,ut])}};return it.scopeName=tt,[rt,$c512c27ab02ef895$var$composeContextScopes(it,...et)]}function $c512c27ab02ef895$var$composeContextScopes(...tt){const et=tt[0];if(tt.length===1)return et;const nt=()=>{const rt=tt.map(it=>({useScope:it(),scopeName:it.scopeName}));return function(st){const ot=rt.reduce((lt,{useScope:ut,scopeName:ct})=>{const ft=ut(st)[`__scope${ct}`];return{...lt,...ft}},{});return q$2(()=>({[`__scope${et.scopeName}`]:ot}),[ot])}};return nt.scopeName=et.scopeName,nt}function $b1b2314f5f9a1d84$export$25bec8c6f54ee79a(tt){const et=F$2(tt);return _$1(()=>{et.current=tt}),q$2(()=>(...nt)=>{var rt;return(rt=et.current)===null||rt===void 0?void 0:rt.call(et,...nt)},[])}function $71cd76cc60e0454e$export$6f32135080cb4c3({prop:tt,defaultProp:et,onChange:nt=()=>{}}){const[rt,it]=$71cd76cc60e0454e$var$useUncontrolledState({defaultProp:et,onChange:nt}),st=tt!==void 0,ot=st?tt:rt,lt=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(nt),ut=x$3(ct=>{if(st){const ft=typeof ct=="function"?ct(tt):ct;ft!==tt&&lt(ft)}else it(ct)},[st,tt,it,lt]);return[ot,ut]}function $71cd76cc60e0454e$var$useUncontrolledState({defaultProp:tt,onChange:et}){const nt=p$3(tt),[rt]=nt,it=F$2(rt),st=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(et);return _$1(()=>{it.current!==rt&&(st(rt),it.current=rt)},[rt,it,st]),nt}const $9f79659886946c16$export$e5c5a5f917a5871c=globalThis!=null&&globalThis.document?A$3:()=>{};function $6ed0406888f73fc4$var$setRef(tt,et){typeof tt=="function"?tt(et):tt!=null&&(tt.current=et)}function $6ed0406888f73fc4$export$43e446d32b3d21af(...tt){return et=>tt.forEach(nt=>$6ed0406888f73fc4$var$setRef(nt,et))}function $6ed0406888f73fc4$export$c7b2cbe3552a0d05(...tt){return x$3($6ed0406888f73fc4$export$43e446d32b3d21af(...tt),tt)}var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs$1(tt){return tt&&tt.__esModule&&Object.prototype.hasOwnProperty.call(tt,"default")?tt.default:tt}function getAugmentedNamespace(tt){if(tt.__esModule)return tt;var et=tt.default;if(typeof et=="function"){var nt=function rt(){return this instanceof rt?Reflect.construct(et,arguments,this.constructor):et.apply(this,arguments)};nt.prototype=et.prototype}else nt={};return Object.defineProperty(nt,"__esModule",{value:!0}),Object.keys(tt).forEach(function(rt){var it=Object.getOwnPropertyDescriptor(tt,rt);Object.defineProperty(nt,rt,it.get?it:{enumerable:!0,get:function(){return tt[rt]}})}),nt}var reactDom={exports:{}},reactDom_production_min={};const require$$0=getAugmentedNamespace($2AODx$react);var scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(tt){function et(ms,ys){var Es=ms.length;ms.push(ys);e:for(;0<Es;){var Ts=Es-1>>>1,Ss=ms[Ts];if(0<it(Ss,ys))ms[Ts]=ys,ms[Es]=Ss,Es=Ts;else break e}}function nt(ms){return ms.length===0?null:ms[0]}function rt(ms){if(ms.length===0)return null;var ys=ms[0],Es=ms.pop();if(Es!==ys){ms[0]=Es;e:for(var Ts=0,Ss=ms.length,Ds=Ss>>>1;Ts<Ds;){var Cs=2*(Ts+1)-1,Is=ms[Cs],ks=Cs+1,_s=ms[ks];if(0>it(Is,Es))ks<Ss&&0>it(_s,Is)?(ms[Ts]=_s,ms[ks]=Es,Ts=ks):(ms[Ts]=Is,ms[Cs]=Es,Ts=Cs);else if(ks<Ss&&0>it(_s,Es))ms[Ts]=_s,ms[ks]=Es,Ts=ks;else break e}}return ys}function it(ms,ys){var Es=ms.sortIndex-ys.sortIndex;return Es!==0?Es:ms.id-ys.id}if(typeof performance=="object"&&typeof performance.now=="function"){var st=performance;tt.unstable_now=function(){return st.now()}}else{var ot=Date,lt=ot.now();tt.unstable_now=function(){return ot.now()-lt}}var ut=[],ct=[],dt=1,ft=null,pt=3,gt=!1,_r=!1,Yr=!1,mt=typeof setTimeout=="function"?setTimeout:null,Kr=typeof clearTimeout=="function"?clearTimeout:null,Xr=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Zr(ms){for(var ys=nt(ct);ys!==null;){if(ys.callback===null)rt(ct);else if(ys.startTime<=ms)rt(ct),ys.sortIndex=ys.expirationTime,et(ut,ys);else break;ys=nt(ct)}}function Qr(ms){if(Yr=!1,Zr(ms),!_r)if(nt(ut)!==null)_r=!0,gs(_i);else{var ys=nt(ct);ys!==null&&us(Qr,ys.startTime-ms)}}function _i(ms,ys){_r=!1,Yr&&(Yr=!1,Kr(ss),ss=-1),gt=!0;var Es=pt;try{for(Zr(ys),ft=nt(ut);ft!==null&&(!(ft.expirationTime>ys)||ms&&!is());){var Ts=ft.callback;if(typeof Ts=="function"){ft.callback=null,pt=ft.priorityLevel;var Ss=Ts(ft.expirationTime<=ys);ys=tt.unstable_now(),typeof Ss=="function"?ft.callback=Ss:ft===nt(ut)&&rt(ut),Zr(ys)}else rt(ut);ft=nt(ut)}if(ft!==null)var Ds=!0;else{var Cs=nt(ct);Cs!==null&&us(Qr,Cs.startTime-ys),Ds=!1}return Ds}finally{ft=null,pt=Es,gt=!1}}var rs=!1,ns=null,ss=-1,fs=5,os=-1;function is(){return!(tt.unstable_now()-os<fs)}function cs(){if(ns!==null){var ms=tt.unstable_now();os=ms;var ys=!0;try{ys=ns(!0,ms)}finally{ys?ps():(rs=!1,ns=null)}}else rs=!1}var ps;if(typeof Xr=="function")ps=function(){Xr(cs)};else if(typeof MessageChannel<"u"){var vs=new MessageChannel,ls=vs.port2;vs.port1.onmessage=cs,ps=function(){ls.postMessage(null)}}else ps=function(){mt(cs,0)};function gs(ms){ns=ms,rs||(rs=!0,ps())}function us(ms,ys){ss=mt(function(){ms(tt.unstable_now())},ys)}tt.unstable_IdlePriority=5,tt.unstable_ImmediatePriority=1,tt.unstable_LowPriority=4,tt.unstable_NormalPriority=3,tt.unstable_Profiling=null,tt.unstable_UserBlockingPriority=2,tt.unstable_cancelCallback=function(ms){ms.callback=null},tt.unstable_continueExecution=function(){_r||gt||(_r=!0,gs(_i))},tt.unstable_forceFrameRate=function(ms){0>ms||125<ms?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):fs=0<ms?Math.floor(1e3/ms):5},tt.unstable_getCurrentPriorityLevel=function(){return pt},tt.unstable_getFirstCallbackNode=function(){return nt(ut)},tt.unstable_next=function(ms){switch(pt){case 1:case 2:case 3:var ys=3;break;default:ys=pt}var Es=pt;pt=ys;try{return ms()}finally{pt=Es}},tt.unstable_pauseExecution=function(){},tt.unstable_requestPaint=function(){},tt.unstable_runWithPriority=function(ms,ys){switch(ms){case 1:case 2:case 3:case 4:case 5:break;default:ms=3}var Es=pt;pt=ms;try{return ys()}finally{pt=Es}},tt.unstable_scheduleCallback=function(ms,ys,Es){var Ts=tt.unstable_now();switch(typeof Es=="object"&&Es!==null?(Es=Es.delay,Es=typeof Es=="number"&&0<Es?Ts+Es:Ts):Es=Ts,ms){case 1:var Ss=-1;break;case 2:Ss=250;break;case 5:Ss=1073741823;break;case 4:Ss=1e4;break;default:Ss=5e3}return Ss=Es+Ss,ms={id:dt++,callback:ys,priorityLevel:ms,startTime:Es,expirationTime:Ss,sortIndex:-1},Es>Ts?(ms.sortIndex=Es,et(ct,ms),nt(ut)===null&&ms===nt(ct)&&(Yr?(Kr(ss),ss=-1):Yr=!0,us(Qr,Es-Ts))):(ms.sortIndex=Ss,et(ut,ms),_r||gt||(_r=!0,gs(_i))),ms},tt.unstable_shouldYield=is,tt.unstable_wrapCallback=function(ms){var ys=pt;return function(){var Es=pt;pt=ys;try{return ms.apply(this,arguments)}finally{pt=Es}}}})(scheduler_production_min),scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=require$$0,ca=schedulerExports;function p$2(tt){for(var et="https://reactjs.org/docs/error-decoder.html?invariant="+tt,nt=1;nt<arguments.length;nt++)et+="&args[]="+encodeURIComponent(arguments[nt]);return"Minified React error #"+tt+"; visit "+et+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(tt,et){ha(tt,et),ha(tt+"Capture",et)}function ha(tt,et){for(ea[tt]=et,tt=0;tt<et.length;tt++)da.add(et[tt])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(tt){return ja.call(ma,tt)?!0:ja.call(la,tt)?!1:ka.test(tt)?ma[tt]=!0:(la[tt]=!0,!1)}function pa(tt,et,nt,rt){if(nt!==null&&nt.type===0)return!1;switch(typeof et){case"function":case"symbol":return!0;case"boolean":return rt?!1:nt!==null?!nt.acceptsBooleans:(tt=tt.toLowerCase().slice(0,5),tt!=="data-"&&tt!=="aria-");default:return!1}}function qa(tt,et,nt,rt){if(et===null||typeof et>"u"||pa(tt,et,nt,rt))return!0;if(rt)return!1;if(nt!==null)switch(nt.type){case 3:return!et;case 4:return et===!1;case 5:return isNaN(et);case 6:return isNaN(et)||1>et}return!1}function v$1(tt,et,nt,rt,it,st,ot){this.acceptsBooleans=et===2||et===3||et===4,this.attributeName=rt,this.attributeNamespace=it,this.mustUseProperty=nt,this.propertyName=tt,this.type=et,this.sanitizeURL=st,this.removeEmptyString=ot}var z$2={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(tt){z$2[tt]=new v$1(tt,0,!1,tt,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(tt){var et=tt[0];z$2[et]=new v$1(et,1,!1,tt[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(tt){z$2[tt]=new v$1(tt,2,!1,tt.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(tt){z$2[tt]=new v$1(tt,2,!1,tt,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(tt){z$2[tt]=new v$1(tt,3,!1,tt.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(tt){z$2[tt]=new v$1(tt,3,!0,tt,null,!1,!1)}),["capture","download"].forEach(function(tt){z$2[tt]=new v$1(tt,4,!1,tt,null,!1,!1)}),["cols","rows","size","span"].forEach(function(tt){z$2[tt]=new v$1(tt,6,!1,tt,null,!1,!1)}),["rowSpan","start"].forEach(function(tt){z$2[tt]=new v$1(tt,5,!1,tt.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(tt){return tt[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(tt){var et=tt.replace(ra,sa);z$2[et]=new v$1(et,1,!1,tt,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(tt){var et=tt.replace(ra,sa);z$2[et]=new v$1(et,1,!1,tt,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(tt){var et=tt.replace(ra,sa);z$2[et]=new v$1(et,1,!1,tt,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(tt){z$2[tt]=new v$1(tt,1,!1,tt.toLowerCase(),null,!1,!1)}),z$2.xlinkHref=new v$1("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(tt){z$2[tt]=new v$1(tt,1,!1,tt.toLowerCase(),null,!0,!0)});function ta(tt,et,nt,rt){var it=z$2.hasOwnProperty(et)?z$2[et]:null;(it!==null?it.type!==0:rt||!(2<et.length)||et[0]!=="o"&&et[0]!=="O"||et[1]!=="n"&&et[1]!=="N")&&(qa(et,nt,it,rt)&&(nt=null),rt||it===null?oa(et)&&(nt===null?tt.removeAttribute(et):tt.setAttribute(et,""+nt)):it.mustUseProperty?tt[it.propertyName]=nt===null?it.type===3?!1:"":nt:(et=it.attributeName,rt=it.attributeNamespace,nt===null?tt.removeAttribute(et):(it=it.type,nt=it===3||it===4&&nt===!0?"":""+nt,rt?tt.setAttributeNS(rt,et,nt):tt.setAttribute(et,nt))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(tt){return tt===null||typeof tt!="object"?null:(tt=Ja&&tt[Ja]||tt["@@iterator"],typeof tt=="function"?tt:null)}var A$1=Object.assign,La;function Ma(tt){if(La===void 0)try{throw Error()}catch(nt){var et=nt.stack.trim().match(/\n( *(at )?)/);La=et&&et[1]||""}return`
`+La+tt}var Na=!1;function Oa(tt,et){if(!tt||Na)return"";Na=!0;var nt=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(et)if(et=function(){throw Error()},Object.defineProperty(et.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(et,[])}catch(ct){var rt=ct}Reflect.construct(tt,[],et)}else{try{et.call()}catch(ct){rt=ct}tt.call(et.prototype)}else{try{throw Error()}catch(ct){rt=ct}tt()}}catch(ct){if(ct&&rt&&typeof ct.stack=="string"){for(var it=ct.stack.split(`
`),st=rt.stack.split(`
`),ot=it.length-1,lt=st.length-1;1<=ot&&0<=lt&&it[ot]!==st[lt];)lt--;for(;1<=ot&&0<=lt;ot--,lt--)if(it[ot]!==st[lt]){if(ot!==1||lt!==1)do if(ot--,lt--,0>lt||it[ot]!==st[lt]){var ut=`
`+it[ot].replace(" at new "," at ");return tt.displayName&&ut.includes("<anonymous>")&&(ut=ut.replace("<anonymous>",tt.displayName)),ut}while(1<=ot&&0<=lt);break}}}finally{Na=!1,Error.prepareStackTrace=nt}return(tt=tt?tt.displayName||tt.name:"")?Ma(tt):""}function Pa(tt){switch(tt.tag){case 5:return Ma(tt.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return tt=Oa(tt.type,!1),tt;case 11:return tt=Oa(tt.type.render,!1),tt;case 1:return tt=Oa(tt.type,!0),tt;default:return""}}function Qa(tt){if(tt==null)return null;if(typeof tt=="function")return tt.displayName||tt.name||null;if(typeof tt=="string")return tt;switch(tt){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof tt=="object")switch(tt.$$typeof){case Ca:return(tt.displayName||"Context")+".Consumer";case Ba:return(tt._context.displayName||"Context")+".Provider";case Da:var et=tt.render;return tt=tt.displayName,tt||(tt=et.displayName||et.name||"",tt=tt!==""?"ForwardRef("+tt+")":"ForwardRef"),tt;case Ga:return et=tt.displayName||null,et!==null?et:Qa(tt.type)||"Memo";case Ha:et=tt._payload,tt=tt._init;try{return Qa(tt(et))}catch{}}return null}function Ra(tt){var et=tt.type;switch(tt.tag){case 24:return"Cache";case 9:return(et.displayName||"Context")+".Consumer";case 10:return(et._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return tt=et.render,tt=tt.displayName||tt.name||"",et.displayName||(tt!==""?"ForwardRef("+tt+")":"ForwardRef");case 7:return"Fragment";case 5:return et;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(et);case 8:return et===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof et=="function")return et.displayName||et.name||null;if(typeof et=="string")return et}return null}function Sa(tt){switch(typeof tt){case"boolean":case"number":case"string":case"undefined":return tt;case"object":return tt;default:return""}}function Ta(tt){var et=tt.type;return(tt=tt.nodeName)&&tt.toLowerCase()==="input"&&(et==="checkbox"||et==="radio")}function Ua(tt){var et=Ta(tt)?"checked":"value",nt=Object.getOwnPropertyDescriptor(tt.constructor.prototype,et),rt=""+tt[et];if(!tt.hasOwnProperty(et)&&typeof nt<"u"&&typeof nt.get=="function"&&typeof nt.set=="function"){var it=nt.get,st=nt.set;return Object.defineProperty(tt,et,{configurable:!0,get:function(){return it.call(this)},set:function(ot){rt=""+ot,st.call(this,ot)}}),Object.defineProperty(tt,et,{enumerable:nt.enumerable}),{getValue:function(){return rt},setValue:function(ot){rt=""+ot},stopTracking:function(){tt._valueTracker=null,delete tt[et]}}}}function Va(tt){tt._valueTracker||(tt._valueTracker=Ua(tt))}function Wa(tt){if(!tt)return!1;var et=tt._valueTracker;if(!et)return!0;var nt=et.getValue(),rt="";return tt&&(rt=Ta(tt)?tt.checked?"true":"false":tt.value),tt=rt,tt!==nt?(et.setValue(tt),!0):!1}function Xa(tt){if(tt=tt||(typeof document<"u"?document:void 0),typeof tt>"u")return null;try{return tt.activeElement||tt.body}catch{return tt.body}}function Ya(tt,et){var nt=et.checked;return A$1({},et,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:nt??tt._wrapperState.initialChecked})}function Za(tt,et){var nt=et.defaultValue==null?"":et.defaultValue,rt=et.checked!=null?et.checked:et.defaultChecked;nt=Sa(et.value!=null?et.value:nt),tt._wrapperState={initialChecked:rt,initialValue:nt,controlled:et.type==="checkbox"||et.type==="radio"?et.checked!=null:et.value!=null}}function ab(tt,et){et=et.checked,et!=null&&ta(tt,"checked",et,!1)}function bb(tt,et){ab(tt,et);var nt=Sa(et.value),rt=et.type;if(nt!=null)rt==="number"?(nt===0&&tt.value===""||tt.value!=nt)&&(tt.value=""+nt):tt.value!==""+nt&&(tt.value=""+nt);else if(rt==="submit"||rt==="reset"){tt.removeAttribute("value");return}et.hasOwnProperty("value")?cb(tt,et.type,nt):et.hasOwnProperty("defaultValue")&&cb(tt,et.type,Sa(et.defaultValue)),et.checked==null&&et.defaultChecked!=null&&(tt.defaultChecked=!!et.defaultChecked)}function db(tt,et,nt){if(et.hasOwnProperty("value")||et.hasOwnProperty("defaultValue")){var rt=et.type;if(!(rt!=="submit"&&rt!=="reset"||et.value!==void 0&&et.value!==null))return;et=""+tt._wrapperState.initialValue,nt||et===tt.value||(tt.value=et),tt.defaultValue=et}nt=tt.name,nt!==""&&(tt.name=""),tt.defaultChecked=!!tt._wrapperState.initialChecked,nt!==""&&(tt.name=nt)}function cb(tt,et,nt){(et!=="number"||Xa(tt.ownerDocument)!==tt)&&(nt==null?tt.defaultValue=""+tt._wrapperState.initialValue:tt.defaultValue!==""+nt&&(tt.defaultValue=""+nt))}var eb=Array.isArray;function fb(tt,et,nt,rt){if(tt=tt.options,et){et={};for(var it=0;it<nt.length;it++)et["$"+nt[it]]=!0;for(nt=0;nt<tt.length;nt++)it=et.hasOwnProperty("$"+tt[nt].value),tt[nt].selected!==it&&(tt[nt].selected=it),it&&rt&&(tt[nt].defaultSelected=!0)}else{for(nt=""+Sa(nt),et=null,it=0;it<tt.length;it++){if(tt[it].value===nt){tt[it].selected=!0,rt&&(tt[it].defaultSelected=!0);return}et!==null||tt[it].disabled||(et=tt[it])}et!==null&&(et.selected=!0)}}function gb(tt,et){if(et.dangerouslySetInnerHTML!=null)throw Error(p$2(91));return A$1({},et,{value:void 0,defaultValue:void 0,children:""+tt._wrapperState.initialValue})}function hb(tt,et){var nt=et.value;if(nt==null){if(nt=et.children,et=et.defaultValue,nt!=null){if(et!=null)throw Error(p$2(92));if(eb(nt)){if(1<nt.length)throw Error(p$2(93));nt=nt[0]}et=nt}et==null&&(et=""),nt=et}tt._wrapperState={initialValue:Sa(nt)}}function ib(tt,et){var nt=Sa(et.value),rt=Sa(et.defaultValue);nt!=null&&(nt=""+nt,nt!==tt.value&&(tt.value=nt),et.defaultValue==null&&tt.defaultValue!==nt&&(tt.defaultValue=nt)),rt!=null&&(tt.defaultValue=""+rt)}function jb(tt){var et=tt.textContent;et===tt._wrapperState.initialValue&&et!==""&&et!==null&&(tt.value=et)}function kb(tt){switch(tt){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(tt,et){return tt==null||tt==="http://www.w3.org/1999/xhtml"?kb(et):tt==="http://www.w3.org/2000/svg"&&et==="foreignObject"?"http://www.w3.org/1999/xhtml":tt}var mb,nb=function(tt){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(et,nt,rt,it){MSApp.execUnsafeLocalFunction(function(){return tt(et,nt,rt,it)})}:tt}(function(tt,et){if(tt.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in tt)tt.innerHTML=et;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+et.valueOf().toString()+"</svg>",et=mb.firstChild;tt.firstChild;)tt.removeChild(tt.firstChild);for(;et.firstChild;)tt.appendChild(et.firstChild)}});function ob(tt,et){if(et){var nt=tt.firstChild;if(nt&&nt===tt.lastChild&&nt.nodeType===3){nt.nodeValue=et;return}}tt.textContent=et}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(tt){qb.forEach(function(et){et=et+tt.charAt(0).toUpperCase()+tt.substring(1),pb[et]=pb[tt]})});function rb(tt,et,nt){return et==null||typeof et=="boolean"||et===""?"":nt||typeof et!="number"||et===0||pb.hasOwnProperty(tt)&&pb[tt]?(""+et).trim():et+"px"}function sb(tt,et){tt=tt.style;for(var nt in et)if(et.hasOwnProperty(nt)){var rt=nt.indexOf("--")===0,it=rb(nt,et[nt],rt);nt==="float"&&(nt="cssFloat"),rt?tt.setProperty(nt,it):tt[nt]=it}}var tb=A$1({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(tt,et){if(et){if(tb[tt]&&(et.children!=null||et.dangerouslySetInnerHTML!=null))throw Error(p$2(137,tt));if(et.dangerouslySetInnerHTML!=null){if(et.children!=null)throw Error(p$2(60));if(typeof et.dangerouslySetInnerHTML!="object"||!("__html"in et.dangerouslySetInnerHTML))throw Error(p$2(61))}if(et.style!=null&&typeof et.style!="object")throw Error(p$2(62))}}function vb(tt,et){if(tt.indexOf("-")===-1)return typeof et.is=="string";switch(tt){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(tt){return tt=tt.target||tt.srcElement||window,tt.correspondingUseElement&&(tt=tt.correspondingUseElement),tt.nodeType===3?tt.parentNode:tt}var yb=null,zb=null,Ab=null;function Bb(tt){if(tt=Cb(tt)){if(typeof yb!="function")throw Error(p$2(280));var et=tt.stateNode;et&&(et=Db(et),yb(tt.stateNode,tt.type,et))}}function Eb(tt){zb?Ab?Ab.push(tt):Ab=[tt]:zb=tt}function Fb(){if(zb){var tt=zb,et=Ab;if(Ab=zb=null,Bb(tt),et)for(tt=0;tt<et.length;tt++)Bb(et[tt])}}function Gb(tt,et){return tt(et)}function Hb(){}var Ib=!1;function Jb(tt,et,nt){if(Ib)return tt(et,nt);Ib=!0;try{return Gb(tt,et,nt)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(tt,et){var nt=tt.stateNode;if(nt===null)return null;var rt=Db(nt);if(rt===null)return null;nt=rt[et];e:switch(et){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(rt=!rt.disabled)||(tt=tt.type,rt=!(tt==="button"||tt==="input"||tt==="select"||tt==="textarea")),tt=!rt;break e;default:tt=!1}if(tt)return null;if(nt&&typeof nt!="function")throw Error(p$2(231,et,typeof nt));return nt}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(tt,et,nt,rt,it,st,ot,lt,ut){var ct=Array.prototype.slice.call(arguments,3);try{et.apply(nt,ct)}catch(dt){this.onError(dt)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(tt){Ob=!0,Pb=tt}};function Tb(tt,et,nt,rt,it,st,ot,lt,ut){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(tt,et,nt,rt,it,st,ot,lt,ut){if(Tb.apply(this,arguments),Ob){if(Ob){var ct=Pb;Ob=!1,Pb=null}else throw Error(p$2(198));Qb||(Qb=!0,Rb=ct)}}function Vb(tt){var et=tt,nt=tt;if(tt.alternate)for(;et.return;)et=et.return;else{tt=et;do et=tt,et.flags&4098&&(nt=et.return),tt=et.return;while(tt)}return et.tag===3?nt:null}function Wb(tt){if(tt.tag===13){var et=tt.memoizedState;if(et===null&&(tt=tt.alternate,tt!==null&&(et=tt.memoizedState)),et!==null)return et.dehydrated}return null}function Xb(tt){if(Vb(tt)!==tt)throw Error(p$2(188))}function Yb(tt){var et=tt.alternate;if(!et){if(et=Vb(tt),et===null)throw Error(p$2(188));return et!==tt?null:tt}for(var nt=tt,rt=et;;){var it=nt.return;if(it===null)break;var st=it.alternate;if(st===null){if(rt=it.return,rt!==null){nt=rt;continue}break}if(it.child===st.child){for(st=it.child;st;){if(st===nt)return Xb(it),tt;if(st===rt)return Xb(it),et;st=st.sibling}throw Error(p$2(188))}if(nt.return!==rt.return)nt=it,rt=st;else{for(var ot=!1,lt=it.child;lt;){if(lt===nt){ot=!0,nt=it,rt=st;break}if(lt===rt){ot=!0,rt=it,nt=st;break}lt=lt.sibling}if(!ot){for(lt=st.child;lt;){if(lt===nt){ot=!0,nt=st,rt=it;break}if(lt===rt){ot=!0,rt=st,nt=it;break}lt=lt.sibling}if(!ot)throw Error(p$2(189))}}if(nt.alternate!==rt)throw Error(p$2(190))}if(nt.tag!==3)throw Error(p$2(188));return nt.stateNode.current===nt?tt:et}function Zb(tt){return tt=Yb(tt),tt!==null?$b(tt):null}function $b(tt){if(tt.tag===5||tt.tag===6)return tt;for(tt=tt.child;tt!==null;){var et=$b(tt);if(et!==null)return et;tt=tt.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B$1=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(tt){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,tt,void 0,(tt.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(tt){return tt>>>=0,tt===0?32:31-(pc(tt)/qc|0)|0}var rc=64,sc=4194304;function tc(tt){switch(tt&-tt){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return tt&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return tt&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return tt}}function uc(tt,et){var nt=tt.pendingLanes;if(nt===0)return 0;var rt=0,it=tt.suspendedLanes,st=tt.pingedLanes,ot=nt&268435455;if(ot!==0){var lt=ot&~it;lt!==0?rt=tc(lt):(st&=ot,st!==0&&(rt=tc(st)))}else ot=nt&~it,ot!==0?rt=tc(ot):st!==0&&(rt=tc(st));if(rt===0)return 0;if(et!==0&&et!==rt&&!(et&it)&&(it=rt&-rt,st=et&-et,it>=st||it===16&&(st&4194240)!==0))return et;if(rt&4&&(rt|=nt&16),et=tt.entangledLanes,et!==0)for(tt=tt.entanglements,et&=rt;0<et;)nt=31-oc(et),it=1<<nt,rt|=tt[nt],et&=~it;return rt}function vc(tt,et){switch(tt){case 1:case 2:case 4:return et+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return et+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(tt,et){for(var nt=tt.suspendedLanes,rt=tt.pingedLanes,it=tt.expirationTimes,st=tt.pendingLanes;0<st;){var ot=31-oc(st),lt=1<<ot,ut=it[ot];ut===-1?(!(lt&nt)||lt&rt)&&(it[ot]=vc(lt,et)):ut<=et&&(tt.expiredLanes|=lt),st&=~lt}}function xc(tt){return tt=tt.pendingLanes&-1073741825,tt!==0?tt:tt&1073741824?1073741824:0}function yc(){var tt=rc;return rc<<=1,!(rc&4194240)&&(rc=64),tt}function zc(tt){for(var et=[],nt=0;31>nt;nt++)et.push(tt);return et}function Ac(tt,et,nt){tt.pendingLanes|=et,et!==536870912&&(tt.suspendedLanes=0,tt.pingedLanes=0),tt=tt.eventTimes,et=31-oc(et),tt[et]=nt}function Bc(tt,et){var nt=tt.pendingLanes&~et;tt.pendingLanes=et,tt.suspendedLanes=0,tt.pingedLanes=0,tt.expiredLanes&=et,tt.mutableReadLanes&=et,tt.entangledLanes&=et,et=tt.entanglements;var rt=tt.eventTimes;for(tt=tt.expirationTimes;0<nt;){var it=31-oc(nt),st=1<<it;et[it]=0,rt[it]=-1,tt[it]=-1,nt&=~st}}function Cc(tt,et){var nt=tt.entangledLanes|=et;for(tt=tt.entanglements;nt;){var rt=31-oc(nt),it=1<<rt;it&et|tt[rt]&et&&(tt[rt]|=et),nt&=~it}}var C$1=0;function Dc(tt){return tt&=-tt,1<tt?4<tt?tt&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(tt,et){switch(tt){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(et.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(et.pointerId)}}function Tc(tt,et,nt,rt,it,st){return tt===null||tt.nativeEvent!==st?(tt={blockedOn:et,domEventName:nt,eventSystemFlags:rt,nativeEvent:st,targetContainers:[it]},et!==null&&(et=Cb(et),et!==null&&Fc(et)),tt):(tt.eventSystemFlags|=rt,et=tt.targetContainers,it!==null&&et.indexOf(it)===-1&&et.push(it),tt)}function Uc(tt,et,nt,rt,it){switch(et){case"focusin":return Lc=Tc(Lc,tt,et,nt,rt,it),!0;case"dragenter":return Mc=Tc(Mc,tt,et,nt,rt,it),!0;case"mouseover":return Nc=Tc(Nc,tt,et,nt,rt,it),!0;case"pointerover":var st=it.pointerId;return Oc.set(st,Tc(Oc.get(st)||null,tt,et,nt,rt,it)),!0;case"gotpointercapture":return st=it.pointerId,Pc.set(st,Tc(Pc.get(st)||null,tt,et,nt,rt,it)),!0}return!1}function Vc(tt){var et=Wc(tt.target);if(et!==null){var nt=Vb(et);if(nt!==null){if(et=nt.tag,et===13){if(et=Wb(nt),et!==null){tt.blockedOn=et,Ic(tt.priority,function(){Gc(nt)});return}}else if(et===3&&nt.stateNode.current.memoizedState.isDehydrated){tt.blockedOn=nt.tag===3?nt.stateNode.containerInfo:null;return}}}tt.blockedOn=null}function Xc(tt){if(tt.blockedOn!==null)return!1;for(var et=tt.targetContainers;0<et.length;){var nt=Yc(tt.domEventName,tt.eventSystemFlags,et[0],tt.nativeEvent);if(nt===null){nt=tt.nativeEvent;var rt=new nt.constructor(nt.type,nt);wb=rt,nt.target.dispatchEvent(rt),wb=null}else return et=Cb(nt),et!==null&&Fc(et),tt.blockedOn=nt,!1;et.shift()}return!0}function Zc(tt,et,nt){Xc(tt)&&nt.delete(et)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(tt,et){tt.blockedOn===et&&(tt.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(tt){function et(it){return ad(it,tt)}if(0<Kc.length){ad(Kc[0],tt);for(var nt=1;nt<Kc.length;nt++){var rt=Kc[nt];rt.blockedOn===tt&&(rt.blockedOn=null)}}for(Lc!==null&&ad(Lc,tt),Mc!==null&&ad(Mc,tt),Nc!==null&&ad(Nc,tt),Oc.forEach(et),Pc.forEach(et),nt=0;nt<Qc.length;nt++)rt=Qc[nt],rt.blockedOn===tt&&(rt.blockedOn=null);for(;0<Qc.length&&(nt=Qc[0],nt.blockedOn===null);)Vc(nt),nt.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(tt,et,nt,rt){var it=C$1,st=cd.transition;cd.transition=null;try{C$1=1,fd(tt,et,nt,rt)}finally{C$1=it,cd.transition=st}}function gd(tt,et,nt,rt){var it=C$1,st=cd.transition;cd.transition=null;try{C$1=4,fd(tt,et,nt,rt)}finally{C$1=it,cd.transition=st}}function fd(tt,et,nt,rt){if(dd){var it=Yc(tt,et,nt,rt);if(it===null)hd(tt,et,rt,id,nt),Sc(tt,rt);else if(Uc(it,tt,et,nt,rt))rt.stopPropagation();else if(Sc(tt,rt),et&4&&-1<Rc.indexOf(tt)){for(;it!==null;){var st=Cb(it);if(st!==null&&Ec(st),st=Yc(tt,et,nt,rt),st===null&&hd(tt,et,rt,id,nt),st===it)break;it=st}it!==null&&rt.stopPropagation()}else hd(tt,et,rt,null,nt)}}var id=null;function Yc(tt,et,nt,rt){if(id=null,tt=xb(rt),tt=Wc(tt),tt!==null)if(et=Vb(tt),et===null)tt=null;else if(nt=et.tag,nt===13){if(tt=Wb(et),tt!==null)return tt;tt=null}else if(nt===3){if(et.stateNode.current.memoizedState.isDehydrated)return et.tag===3?et.stateNode.containerInfo:null;tt=null}else et!==tt&&(tt=null);return id=tt,null}function jd(tt){switch(tt){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var tt,et=ld,nt=et.length,rt,it="value"in kd?kd.value:kd.textContent,st=it.length;for(tt=0;tt<nt&&et[tt]===it[tt];tt++);var ot=nt-tt;for(rt=1;rt<=ot&&et[nt-rt]===it[st-rt];rt++);return md=it.slice(tt,1<rt?1-rt:void 0)}function od(tt){var et=tt.keyCode;return"charCode"in tt?(tt=tt.charCode,tt===0&&et===13&&(tt=13)):tt=et,tt===10&&(tt=13),32<=tt||tt===13?tt:0}function pd(){return!0}function qd(){return!1}function rd(tt){function et(nt,rt,it,st,ot){this._reactName=nt,this._targetInst=it,this.type=rt,this.nativeEvent=st,this.target=ot,this.currentTarget=null;for(var lt in tt)tt.hasOwnProperty(lt)&&(nt=tt[lt],this[lt]=nt?nt(st):st[lt]);return this.isDefaultPrevented=(st.defaultPrevented!=null?st.defaultPrevented:st.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A$1(et.prototype,{preventDefault:function(){this.defaultPrevented=!0;var nt=this.nativeEvent;nt&&(nt.preventDefault?nt.preventDefault():typeof nt.returnValue!="unknown"&&(nt.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var nt=this.nativeEvent;nt&&(nt.stopPropagation?nt.stopPropagation():typeof nt.cancelBubble!="unknown"&&(nt.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),et}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(tt){return tt.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A$1({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A$1({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(tt){return tt.relatedTarget===void 0?tt.fromElement===tt.srcElement?tt.toElement:tt.fromElement:tt.relatedTarget},movementX:function(tt){return"movementX"in tt?tt.movementX:(tt!==yd&&(yd&&tt.type==="mousemove"?(wd=tt.screenX-yd.screenX,xd=tt.screenY-yd.screenY):xd=wd=0,yd=tt),wd)},movementY:function(tt){return"movementY"in tt?tt.movementY:xd}}),Bd=rd(Ad),Cd=A$1({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A$1({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A$1({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A$1({},sd,{clipboardData:function(tt){return"clipboardData"in tt?tt.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A$1({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(tt){var et=this.nativeEvent;return et.getModifierState?et.getModifierState(tt):(tt=Od[tt])?!!et[tt]:!1}function zd(){return Pd}var Qd=A$1({},ud,{key:function(tt){if(tt.key){var et=Md[tt.key]||tt.key;if(et!=="Unidentified")return et}return tt.type==="keypress"?(tt=od(tt),tt===13?"Enter":String.fromCharCode(tt)):tt.type==="keydown"||tt.type==="keyup"?Nd[tt.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(tt){return tt.type==="keypress"?od(tt):0},keyCode:function(tt){return tt.type==="keydown"||tt.type==="keyup"?tt.keyCode:0},which:function(tt){return tt.type==="keypress"?od(tt):tt.type==="keydown"||tt.type==="keyup"?tt.keyCode:0}}),Rd=rd(Qd),Sd=A$1({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A$1({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A$1({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A$1({},Ad,{deltaX:function(tt){return"deltaX"in tt?tt.deltaX:"wheelDeltaX"in tt?-tt.wheelDeltaX:0},deltaY:function(tt){return"deltaY"in tt?tt.deltaY:"wheelDeltaY"in tt?-tt.wheelDeltaY:"wheelDelta"in tt?-tt.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce$1=ia&&"TextEvent"in window&&!be,de$1=ia&&(!ae||be&&8<be&&11>=be),ee=" ",fe$1=!1;function ge$1(tt,et){switch(tt){case"keyup":return $d.indexOf(et.keyCode)!==-1;case"keydown":return et.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he$1(tt){return tt=tt.detail,typeof tt=="object"&&"data"in tt?tt.data:null}var ie=!1;function je$1(tt,et){switch(tt){case"compositionend":return he$1(et);case"keypress":return et.which!==32?null:(fe$1=!0,ee);case"textInput":return tt=et.data,tt===ee&&fe$1?null:tt;default:return null}}function ke$1(tt,et){if(ie)return tt==="compositionend"||!ae&&ge$1(tt,et)?(tt=nd(),md=ld=kd=null,ie=!1,tt):null;switch(tt){case"paste":return null;case"keypress":if(!(et.ctrlKey||et.altKey||et.metaKey)||et.ctrlKey&&et.altKey){if(et.char&&1<et.char.length)return et.char;if(et.which)return String.fromCharCode(et.which)}return null;case"compositionend":return de$1&&et.locale!=="ko"?null:et.data;default:return null}}var le$1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me$1(tt){var et=tt&&tt.nodeName&&tt.nodeName.toLowerCase();return et==="input"?!!le$1[tt.type]:et==="textarea"}function ne$1(tt,et,nt,rt){Eb(rt),et=oe$1(et,"onChange"),0<et.length&&(nt=new td("onChange","change",null,nt,rt),tt.push({event:nt,listeners:et}))}var pe$1=null,qe$1=null;function re$1(tt){se$1(tt,0)}function te$1(tt){var et=ue$1(tt);if(Wa(et))return tt}function ve(tt,et){if(tt==="change")return et}var we$1=!1;if(ia){var xe$1;if(ia){var ye="oninput"in document;if(!ye){var ze$1=document.createElement("div");ze$1.setAttribute("oninput","return;"),ye=typeof ze$1.oninput=="function"}xe$1=ye}else xe$1=!1;we$1=xe$1&&(!document.documentMode||9<document.documentMode)}function Ae$1(){pe$1&&(pe$1.detachEvent("onpropertychange",Be$1),qe$1=pe$1=null)}function Be$1(tt){if(tt.propertyName==="value"&&te$1(qe$1)){var et=[];ne$1(et,qe$1,tt,xb(tt)),Jb(re$1,et)}}function Ce$1(tt,et,nt){tt==="focusin"?(Ae$1(),pe$1=et,qe$1=nt,pe$1.attachEvent("onpropertychange",Be$1)):tt==="focusout"&&Ae$1()}function De$1(tt){if(tt==="selectionchange"||tt==="keyup"||tt==="keydown")return te$1(qe$1)}function Ee$1(tt,et){if(tt==="click")return te$1(et)}function Fe$1(tt,et){if(tt==="input"||tt==="change")return te$1(et)}function Ge$1(tt,et){return tt===et&&(tt!==0||1/tt===1/et)||tt!==tt&&et!==et}var He$1=typeof Object.is=="function"?Object.is:Ge$1;function Ie$1(tt,et){if(He$1(tt,et))return!0;if(typeof tt!="object"||tt===null||typeof et!="object"||et===null)return!1;var nt=Object.keys(tt),rt=Object.keys(et);if(nt.length!==rt.length)return!1;for(rt=0;rt<nt.length;rt++){var it=nt[rt];if(!ja.call(et,it)||!He$1(tt[it],et[it]))return!1}return!0}function Je(tt){for(;tt&&tt.firstChild;)tt=tt.firstChild;return tt}function Ke(tt,et){var nt=Je(tt);tt=0;for(var rt;nt;){if(nt.nodeType===3){if(rt=tt+nt.textContent.length,tt<=et&&rt>=et)return{node:nt,offset:et-tt};tt=rt}e:{for(;nt;){if(nt.nextSibling){nt=nt.nextSibling;break e}nt=nt.parentNode}nt=void 0}nt=Je(nt)}}function Le$1(tt,et){return tt&&et?tt===et?!0:tt&&tt.nodeType===3?!1:et&&et.nodeType===3?Le$1(tt,et.parentNode):"contains"in tt?tt.contains(et):tt.compareDocumentPosition?!!(tt.compareDocumentPosition(et)&16):!1:!1}function Me$1(){for(var tt=window,et=Xa();et instanceof tt.HTMLIFrameElement;){try{var nt=typeof et.contentWindow.location.href=="string"}catch{nt=!1}if(nt)tt=et.contentWindow;else break;et=Xa(tt.document)}return et}function Ne$1(tt){var et=tt&&tt.nodeName&&tt.nodeName.toLowerCase();return et&&(et==="input"&&(tt.type==="text"||tt.type==="search"||tt.type==="tel"||tt.type==="url"||tt.type==="password")||et==="textarea"||tt.contentEditable==="true")}function Oe$1(tt){var et=Me$1(),nt=tt.focusedElem,rt=tt.selectionRange;if(et!==nt&&nt&&nt.ownerDocument&&Le$1(nt.ownerDocument.documentElement,nt)){if(rt!==null&&Ne$1(nt)){if(et=rt.start,tt=rt.end,tt===void 0&&(tt=et),"selectionStart"in nt)nt.selectionStart=et,nt.selectionEnd=Math.min(tt,nt.value.length);else if(tt=(et=nt.ownerDocument||document)&&et.defaultView||window,tt.getSelection){tt=tt.getSelection();var it=nt.textContent.length,st=Math.min(rt.start,it);rt=rt.end===void 0?st:Math.min(rt.end,it),!tt.extend&&st>rt&&(it=rt,rt=st,st=it),it=Ke(nt,st);var ot=Ke(nt,rt);it&&ot&&(tt.rangeCount!==1||tt.anchorNode!==it.node||tt.anchorOffset!==it.offset||tt.focusNode!==ot.node||tt.focusOffset!==ot.offset)&&(et=et.createRange(),et.setStart(it.node,it.offset),tt.removeAllRanges(),st>rt?(tt.addRange(et),tt.extend(ot.node,ot.offset)):(et.setEnd(ot.node,ot.offset),tt.addRange(et)))}}for(et=[],tt=nt;tt=tt.parentNode;)tt.nodeType===1&&et.push({element:tt,left:tt.scrollLeft,top:tt.scrollTop});for(typeof nt.focus=="function"&&nt.focus(),nt=0;nt<et.length;nt++)tt=et[nt],tt.element.scrollLeft=tt.left,tt.element.scrollTop=tt.top}}var Pe$1=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re$1=null,Se$1=null,Te$1=!1;function Ue$1(tt,et,nt){var rt=nt.window===nt?nt.document:nt.nodeType===9?nt:nt.ownerDocument;Te$1||Qe==null||Qe!==Xa(rt)||(rt=Qe,"selectionStart"in rt&&Ne$1(rt)?rt={start:rt.selectionStart,end:rt.selectionEnd}:(rt=(rt.ownerDocument&&rt.ownerDocument.defaultView||window).getSelection(),rt={anchorNode:rt.anchorNode,anchorOffset:rt.anchorOffset,focusNode:rt.focusNode,focusOffset:rt.focusOffset}),Se$1&&Ie$1(Se$1,rt)||(Se$1=rt,rt=oe$1(Re$1,"onSelect"),0<rt.length&&(et=new td("onSelect","select",null,et,nt),tt.push({event:et,listeners:rt}),et.target=Qe)))}function Ve$1(tt,et){var nt={};return nt[tt.toLowerCase()]=et.toLowerCase(),nt["Webkit"+tt]="webkit"+et,nt["Moz"+tt]="moz"+et,nt}var We$1={animationend:Ve$1("Animation","AnimationEnd"),animationiteration:Ve$1("Animation","AnimationIteration"),animationstart:Ve$1("Animation","AnimationStart"),transitionend:Ve$1("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We$1.animationend.animation,delete We$1.animationiteration.animation,delete We$1.animationstart.animation),"TransitionEvent"in window||delete We$1.transitionend.transition);function Ze$1(tt){if(Xe[tt])return Xe[tt];if(!We$1[tt])return tt;var et=We$1[tt],nt;for(nt in et)if(et.hasOwnProperty(nt)&&nt in Ye)return Xe[tt]=et[nt];return tt}var $e$1=Ze$1("animationend"),af=Ze$1("animationiteration"),bf=Ze$1("animationstart"),cf=Ze$1("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(tt,et){df.set(tt,et),fa(et,[tt])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e$1,"onAnimationEnd"),ff(af,"onAnimationIteration"),ff(bf,"onAnimationStart"),ff("dblclick","onDoubleClick"),ff("focusin","onFocus"),ff("focusout","onBlur"),ff(cf,"onTransitionEnd"),ha("onMouseEnter",["mouseout","mouseover"]),ha("onMouseLeave",["mouseout","mouseover"]),ha("onPointerEnter",["pointerout","pointerover"]),ha("onPointerLeave",["pointerout","pointerover"]),fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),fa("onBeforeInput",["compositionend","keypress","textInput","paste"]),fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(tt,et,nt){var rt=tt.type||"unknown-event";tt.currentTarget=nt,Ub(rt,et,void 0,tt),tt.currentTarget=null}function se$1(tt,et){et=(et&4)!==0;for(var nt=0;nt<tt.length;nt++){var rt=tt[nt],it=rt.event;rt=rt.listeners;e:{var st=void 0;if(et)for(var ot=rt.length-1;0<=ot;ot--){var lt=rt[ot],ut=lt.instance,ct=lt.currentTarget;if(lt=lt.listener,ut!==st&&it.isPropagationStopped())break e;nf(it,lt,ct),st=ut}else for(ot=0;ot<rt.length;ot++){if(lt=rt[ot],ut=lt.instance,ct=lt.currentTarget,lt=lt.listener,ut!==st&&it.isPropagationStopped())break e;nf(it,lt,ct),st=ut}}}if(Qb)throw tt=Rb,Qb=!1,Rb=null,tt}function D$2(tt,et){var nt=et[of];nt===void 0&&(nt=et[of]=new Set);var rt=tt+"__bubble";nt.has(rt)||(pf(et,tt,2,!1),nt.add(rt))}function qf(tt,et,nt){var rt=0;et&&(rt|=4),pf(nt,tt,rt,et)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(tt){if(!tt[rf]){tt[rf]=!0,da.forEach(function(nt){nt!=="selectionchange"&&(mf.has(nt)||qf(nt,!1,tt),qf(nt,!0,tt))});var et=tt.nodeType===9?tt:tt.ownerDocument;et===null||et[rf]||(et[rf]=!0,qf("selectionchange",!1,et))}}function pf(tt,et,nt,rt){switch(jd(et)){case 1:var it=ed;break;case 4:it=gd;break;default:it=fd}nt=it.bind(null,et,nt,tt),it=void 0,!Lb||et!=="touchstart"&&et!=="touchmove"&&et!=="wheel"||(it=!0),rt?it!==void 0?tt.addEventListener(et,nt,{capture:!0,passive:it}):tt.addEventListener(et,nt,!0):it!==void 0?tt.addEventListener(et,nt,{passive:it}):tt.addEventListener(et,nt,!1)}function hd(tt,et,nt,rt,it){var st=rt;if(!(et&1)&&!(et&2)&&rt!==null)e:for(;;){if(rt===null)return;var ot=rt.tag;if(ot===3||ot===4){var lt=rt.stateNode.containerInfo;if(lt===it||lt.nodeType===8&&lt.parentNode===it)break;if(ot===4)for(ot=rt.return;ot!==null;){var ut=ot.tag;if((ut===3||ut===4)&&(ut=ot.stateNode.containerInfo,ut===it||ut.nodeType===8&&ut.parentNode===it))return;ot=ot.return}for(;lt!==null;){if(ot=Wc(lt),ot===null)return;if(ut=ot.tag,ut===5||ut===6){rt=st=ot;continue e}lt=lt.parentNode}}rt=rt.return}Jb(function(){var ct=st,dt=xb(nt),ft=[];e:{var pt=df.get(tt);if(pt!==void 0){var gt=td,_r=tt;switch(tt){case"keypress":if(od(nt)===0)break e;case"keydown":case"keyup":gt=Rd;break;case"focusin":_r="focus",gt=Fd;break;case"focusout":_r="blur",gt=Fd;break;case"beforeblur":case"afterblur":gt=Fd;break;case"click":if(nt.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":gt=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":gt=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":gt=Vd;break;case $e$1:case af:case bf:gt=Hd;break;case cf:gt=Xd;break;case"scroll":gt=vd;break;case"wheel":gt=Zd;break;case"copy":case"cut":case"paste":gt=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":gt=Td}var Yr=(et&4)!==0,mt=!Yr&&tt==="scroll",Kr=Yr?pt!==null?pt+"Capture":null:pt;Yr=[];for(var Xr=ct,Zr;Xr!==null;){Zr=Xr;var Qr=Zr.stateNode;if(Zr.tag===5&&Qr!==null&&(Zr=Qr,Kr!==null&&(Qr=Kb(Xr,Kr),Qr!=null&&Yr.push(tf(Xr,Qr,Zr)))),mt)break;Xr=Xr.return}0<Yr.length&&(pt=new gt(pt,_r,null,nt,dt),ft.push({event:pt,listeners:Yr}))}}if(!(et&7)){e:{if(pt=tt==="mouseover"||tt==="pointerover",gt=tt==="mouseout"||tt==="pointerout",pt&&nt!==wb&&(_r=nt.relatedTarget||nt.fromElement)&&(Wc(_r)||_r[uf]))break e;if((gt||pt)&&(pt=dt.window===dt?dt:(pt=dt.ownerDocument)?pt.defaultView||pt.parentWindow:window,gt?(_r=nt.relatedTarget||nt.toElement,gt=ct,_r=_r?Wc(_r):null,_r!==null&&(mt=Vb(_r),_r!==mt||_r.tag!==5&&_r.tag!==6)&&(_r=null)):(gt=null,_r=ct),gt!==_r)){if(Yr=Bd,Qr="onMouseLeave",Kr="onMouseEnter",Xr="mouse",(tt==="pointerout"||tt==="pointerover")&&(Yr=Td,Qr="onPointerLeave",Kr="onPointerEnter",Xr="pointer"),mt=gt==null?pt:ue$1(gt),Zr=_r==null?pt:ue$1(_r),pt=new Yr(Qr,Xr+"leave",gt,nt,dt),pt.target=mt,pt.relatedTarget=Zr,Qr=null,Wc(dt)===ct&&(Yr=new Yr(Kr,Xr+"enter",_r,nt,dt),Yr.target=Zr,Yr.relatedTarget=mt,Qr=Yr),mt=Qr,gt&&_r)t:{for(Yr=gt,Kr=_r,Xr=0,Zr=Yr;Zr;Zr=vf(Zr))Xr++;for(Zr=0,Qr=Kr;Qr;Qr=vf(Qr))Zr++;for(;0<Xr-Zr;)Yr=vf(Yr),Xr--;for(;0<Zr-Xr;)Kr=vf(Kr),Zr--;for(;Xr--;){if(Yr===Kr||Kr!==null&&Yr===Kr.alternate)break t;Yr=vf(Yr),Kr=vf(Kr)}Yr=null}else Yr=null;gt!==null&&wf(ft,pt,gt,Yr,!1),_r!==null&&mt!==null&&wf(ft,mt,_r,Yr,!0)}}e:{if(pt=ct?ue$1(ct):window,gt=pt.nodeName&&pt.nodeName.toLowerCase(),gt==="select"||gt==="input"&&pt.type==="file")var _i=ve;else if(me$1(pt))if(we$1)_i=Fe$1;else{_i=De$1;var rs=Ce$1}else(gt=pt.nodeName)&&gt.toLowerCase()==="input"&&(pt.type==="checkbox"||pt.type==="radio")&&(_i=Ee$1);if(_i&&(_i=_i(tt,ct))){ne$1(ft,_i,nt,dt);break e}rs&&rs(tt,pt,ct),tt==="focusout"&&(rs=pt._wrapperState)&&rs.controlled&&pt.type==="number"&&cb(pt,"number",pt.value)}switch(rs=ct?ue$1(ct):window,tt){case"focusin":(me$1(rs)||rs.contentEditable==="true")&&(Qe=rs,Re$1=ct,Se$1=null);break;case"focusout":Se$1=Re$1=Qe=null;break;case"mousedown":Te$1=!0;break;case"contextmenu":case"mouseup":case"dragend":Te$1=!1,Ue$1(ft,nt,dt);break;case"selectionchange":if(Pe$1)break;case"keydown":case"keyup":Ue$1(ft,nt,dt)}var ns;if(ae)e:{switch(tt){case"compositionstart":var ss="onCompositionStart";break e;case"compositionend":ss="onCompositionEnd";break e;case"compositionupdate":ss="onCompositionUpdate";break e}ss=void 0}else ie?ge$1(tt,nt)&&(ss="onCompositionEnd"):tt==="keydown"&&nt.keyCode===229&&(ss="onCompositionStart");ss&&(de$1&&nt.locale!=="ko"&&(ie||ss!=="onCompositionStart"?ss==="onCompositionEnd"&&ie&&(ns=nd()):(kd=dt,ld="value"in kd?kd.value:kd.textContent,ie=!0)),rs=oe$1(ct,ss),0<rs.length&&(ss=new Ld(ss,tt,null,nt,dt),ft.push({event:ss,listeners:rs}),ns?ss.data=ns:(ns=he$1(nt),ns!==null&&(ss.data=ns)))),(ns=ce$1?je$1(tt,nt):ke$1(tt,nt))&&(ct=oe$1(ct,"onBeforeInput"),0<ct.length&&(dt=new Ld("onBeforeInput","beforeinput",null,nt,dt),ft.push({event:dt,listeners:ct}),dt.data=ns))}se$1(ft,et)})}function tf(tt,et,nt){return{instance:tt,listener:et,currentTarget:nt}}function oe$1(tt,et){for(var nt=et+"Capture",rt=[];tt!==null;){var it=tt,st=it.stateNode;it.tag===5&&st!==null&&(it=st,st=Kb(tt,nt),st!=null&&rt.unshift(tf(tt,st,it)),st=Kb(tt,et),st!=null&&rt.push(tf(tt,st,it))),tt=tt.return}return rt}function vf(tt){if(tt===null)return null;do tt=tt.return;while(tt&&tt.tag!==5);return tt||null}function wf(tt,et,nt,rt,it){for(var st=et._reactName,ot=[];nt!==null&&nt!==rt;){var lt=nt,ut=lt.alternate,ct=lt.stateNode;if(ut!==null&&ut===rt)break;lt.tag===5&&ct!==null&&(lt=ct,it?(ut=Kb(nt,st),ut!=null&&ot.unshift(tf(nt,ut,lt))):it||(ut=Kb(nt,st),ut!=null&&ot.push(tf(nt,ut,lt)))),nt=nt.return}ot.length!==0&&tt.push({event:et,listeners:ot})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(tt){return(typeof tt=="string"?tt:""+tt).replace(xf,`
`).replace(yf,"")}function Af(tt,et,nt){if(et=zf(et),zf(tt)!==et&&nt)throw Error(p$2(425))}function Bf(){}var Cf=null,Df=null;function Ef(tt,et){return tt==="textarea"||tt==="noscript"||typeof et.children=="string"||typeof et.children=="number"||typeof et.dangerouslySetInnerHTML=="object"&&et.dangerouslySetInnerHTML!==null&&et.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(tt){return Hf.resolve(null).then(tt).catch(If)}:Ff;function If(tt){setTimeout(function(){throw tt})}function Kf(tt,et){var nt=et,rt=0;do{var it=nt.nextSibling;if(tt.removeChild(nt),it&&it.nodeType===8)if(nt=it.data,nt==="/$"){if(rt===0){tt.removeChild(it),bd(et);return}rt--}else nt!=="$"&&nt!=="$?"&&nt!=="$!"||rt++;nt=it}while(nt);bd(et)}function Lf(tt){for(;tt!=null;tt=tt.nextSibling){var et=tt.nodeType;if(et===1||et===3)break;if(et===8){if(et=tt.data,et==="$"||et==="$!"||et==="$?")break;if(et==="/$")return null}}return tt}function Mf(tt){tt=tt.previousSibling;for(var et=0;tt;){if(tt.nodeType===8){var nt=tt.data;if(nt==="$"||nt==="$!"||nt==="$?"){if(et===0)return tt;et--}else nt==="/$"&&et++}tt=tt.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(tt){var et=tt[Of];if(et)return et;for(var nt=tt.parentNode;nt;){if(et=nt[uf]||nt[Of]){if(nt=et.alternate,et.child!==null||nt!==null&&nt.child!==null)for(tt=Mf(tt);tt!==null;){if(nt=tt[Of])return nt;tt=Mf(tt)}return et}tt=nt,nt=tt.parentNode}return null}function Cb(tt){return tt=tt[Of]||tt[uf],!tt||tt.tag!==5&&tt.tag!==6&&tt.tag!==13&&tt.tag!==3?null:tt}function ue$1(tt){if(tt.tag===5||tt.tag===6)return tt.stateNode;throw Error(p$2(33))}function Db(tt){return tt[Pf]||null}var Sf=[],Tf=-1;function Uf(tt){return{current:tt}}function E$1(tt){0>Tf||(tt.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G$1(tt,et){Tf++,Sf[Tf]=tt.current,tt.current=et}var Vf={},H$1=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(tt,et){var nt=tt.type.contextTypes;if(!nt)return Vf;var rt=tt.stateNode;if(rt&&rt.__reactInternalMemoizedUnmaskedChildContext===et)return rt.__reactInternalMemoizedMaskedChildContext;var it={},st;for(st in nt)it[st]=et[st];return rt&&(tt=tt.stateNode,tt.__reactInternalMemoizedUnmaskedChildContext=et,tt.__reactInternalMemoizedMaskedChildContext=it),it}function Zf(tt){return tt=tt.childContextTypes,tt!=null}function $f(){E$1(Wf),E$1(H$1)}function ag(tt,et,nt){if(H$1.current!==Vf)throw Error(p$2(168));G$1(H$1,et),G$1(Wf,nt)}function bg(tt,et,nt){var rt=tt.stateNode;if(et=et.childContextTypes,typeof rt.getChildContext!="function")return nt;rt=rt.getChildContext();for(var it in rt)if(!(it in et))throw Error(p$2(108,Ra(tt)||"Unknown",it));return A$1({},nt,rt)}function cg(tt){return tt=(tt=tt.stateNode)&&tt.__reactInternalMemoizedMergedChildContext||Vf,Xf=H$1.current,G$1(H$1,tt),G$1(Wf,Wf.current),!0}function dg(tt,et,nt){var rt=tt.stateNode;if(!rt)throw Error(p$2(169));nt?(tt=bg(tt,et,Xf),rt.__reactInternalMemoizedMergedChildContext=tt,E$1(Wf),E$1(H$1),G$1(H$1,tt)):E$1(Wf),G$1(Wf,nt)}var eg=null,fg=!1,gg=!1;function hg(tt){eg===null?eg=[tt]:eg.push(tt)}function ig(tt){fg=!0,hg(tt)}function jg(){if(!gg&&eg!==null){gg=!0;var tt=0,et=C$1;try{var nt=eg;for(C$1=1;tt<nt.length;tt++){var rt=nt[tt];do rt=rt(!0);while(rt!==null)}eg=null,fg=!1}catch(it){throw eg!==null&&(eg=eg.slice(tt+1)),ac(fc,jg),it}finally{C$1=et,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(tt,et){kg[lg++]=ng,kg[lg++]=mg,mg=tt,ng=et}function ug(tt,et,nt){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=tt;var rt=rg;tt=sg;var it=32-oc(rt)-1;rt&=~(1<<it),nt+=1;var st=32-oc(et)+it;if(30<st){var ot=it-it%5;st=(rt&(1<<ot)-1).toString(32),rt>>=ot,it-=ot,rg=1<<32-oc(et)+it|nt<<it|rt,sg=st+tt}else rg=1<<st|nt<<it|rt,sg=tt}function vg(tt){tt.return!==null&&(tg(tt,1),ug(tt,1,0))}function wg(tt){for(;tt===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;tt===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I$1=!1,zg=null;function Ag(tt,et){var nt=Bg(5,null,null,0);nt.elementType="DELETED",nt.stateNode=et,nt.return=tt,et=tt.deletions,et===null?(tt.deletions=[nt],tt.flags|=16):et.push(nt)}function Cg(tt,et){switch(tt.tag){case 5:var nt=tt.type;return et=et.nodeType!==1||nt.toLowerCase()!==et.nodeName.toLowerCase()?null:et,et!==null?(tt.stateNode=et,xg=tt,yg=Lf(et.firstChild),!0):!1;case 6:return et=tt.pendingProps===""||et.nodeType!==3?null:et,et!==null?(tt.stateNode=et,xg=tt,yg=null,!0):!1;case 13:return et=et.nodeType!==8?null:et,et!==null?(nt=qg!==null?{id:rg,overflow:sg}:null,tt.memoizedState={dehydrated:et,treeContext:nt,retryLane:1073741824},nt=Bg(18,null,null,0),nt.stateNode=et,nt.return=tt,tt.child=nt,xg=tt,yg=null,!0):!1;default:return!1}}function Dg(tt){return(tt.mode&1)!==0&&(tt.flags&128)===0}function Eg(tt){if(I$1){var et=yg;if(et){var nt=et;if(!Cg(tt,et)){if(Dg(tt))throw Error(p$2(418));et=Lf(nt.nextSibling);var rt=xg;et&&Cg(tt,et)?Ag(rt,nt):(tt.flags=tt.flags&-4097|2,I$1=!1,xg=tt)}}else{if(Dg(tt))throw Error(p$2(418));tt.flags=tt.flags&-4097|2,I$1=!1,xg=tt}}}function Fg(tt){for(tt=tt.return;tt!==null&&tt.tag!==5&&tt.tag!==3&&tt.tag!==13;)tt=tt.return;xg=tt}function Gg(tt){if(tt!==xg)return!1;if(!I$1)return Fg(tt),I$1=!0,!1;var et;if((et=tt.tag!==3)&&!(et=tt.tag!==5)&&(et=tt.type,et=et!=="head"&&et!=="body"&&!Ef(tt.type,tt.memoizedProps)),et&&(et=yg)){if(Dg(tt))throw Hg(),Error(p$2(418));for(;et;)Ag(tt,et),et=Lf(et.nextSibling)}if(Fg(tt),tt.tag===13){if(tt=tt.memoizedState,tt=tt!==null?tt.dehydrated:null,!tt)throw Error(p$2(317));e:{for(tt=tt.nextSibling,et=0;tt;){if(tt.nodeType===8){var nt=tt.data;if(nt==="/$"){if(et===0){yg=Lf(tt.nextSibling);break e}et--}else nt!=="$"&&nt!=="$!"&&nt!=="$?"||et++}tt=tt.nextSibling}yg=null}}else yg=xg?Lf(tt.stateNode.nextSibling):null;return!0}function Hg(){for(var tt=yg;tt;)tt=Lf(tt.nextSibling)}function Ig(){yg=xg=null,I$1=!1}function Jg(tt){zg===null?zg=[tt]:zg.push(tt)}var Kg=ua.ReactCurrentBatchConfig;function Lg(tt,et){if(tt&&tt.defaultProps){et=A$1({},et),tt=tt.defaultProps;for(var nt in tt)et[nt]===void 0&&(et[nt]=tt[nt]);return et}return et}var Mg=Uf(null),Ng=null,Og=null,Pg=null;function Qg(){Pg=Og=Ng=null}function Rg(tt){var et=Mg.current;E$1(Mg),tt._currentValue=et}function Sg(tt,et,nt){for(;tt!==null;){var rt=tt.alternate;if((tt.childLanes&et)!==et?(tt.childLanes|=et,rt!==null&&(rt.childLanes|=et)):rt!==null&&(rt.childLanes&et)!==et&&(rt.childLanes|=et),tt===nt)break;tt=tt.return}}function Tg(tt,et){Ng=tt,Pg=Og=null,tt=tt.dependencies,tt!==null&&tt.firstContext!==null&&(tt.lanes&et&&(Ug=!0),tt.firstContext=null)}function Vg(tt){var et=tt._currentValue;if(Pg!==tt)if(tt={context:tt,memoizedValue:et,next:null},Og===null){if(Ng===null)throw Error(p$2(308));Og=tt,Ng.dependencies={lanes:0,firstContext:tt}}else Og=Og.next=tt;return et}var Wg=null;function Xg(tt){Wg===null?Wg=[tt]:Wg.push(tt)}function Yg(tt,et,nt,rt){var it=et.interleaved;return it===null?(nt.next=nt,Xg(et)):(nt.next=it.next,it.next=nt),et.interleaved=nt,Zg(tt,rt)}function Zg(tt,et){tt.lanes|=et;var nt=tt.alternate;for(nt!==null&&(nt.lanes|=et),nt=tt,tt=tt.return;tt!==null;)tt.childLanes|=et,nt=tt.alternate,nt!==null&&(nt.childLanes|=et),nt=tt,tt=tt.return;return nt.tag===3?nt.stateNode:null}var $g=!1;function ah(tt){tt.updateQueue={baseState:tt.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bh(tt,et){tt=tt.updateQueue,et.updateQueue===tt&&(et.updateQueue={baseState:tt.baseState,firstBaseUpdate:tt.firstBaseUpdate,lastBaseUpdate:tt.lastBaseUpdate,shared:tt.shared,effects:tt.effects})}function ch(tt,et){return{eventTime:tt,lane:et,tag:0,payload:null,callback:null,next:null}}function dh(tt,et,nt){var rt=tt.updateQueue;if(rt===null)return null;if(rt=rt.shared,K$2&2){var it=rt.pending;return it===null?et.next=et:(et.next=it.next,it.next=et),rt.pending=et,Zg(tt,nt)}return it=rt.interleaved,it===null?(et.next=et,Xg(rt)):(et.next=it.next,it.next=et),rt.interleaved=et,Zg(tt,nt)}function eh(tt,et,nt){if(et=et.updateQueue,et!==null&&(et=et.shared,(nt&4194240)!==0)){var rt=et.lanes;rt&=tt.pendingLanes,nt|=rt,et.lanes=nt,Cc(tt,nt)}}function fh(tt,et){var nt=tt.updateQueue,rt=tt.alternate;if(rt!==null&&(rt=rt.updateQueue,nt===rt)){var it=null,st=null;if(nt=nt.firstBaseUpdate,nt!==null){do{var ot={eventTime:nt.eventTime,lane:nt.lane,tag:nt.tag,payload:nt.payload,callback:nt.callback,next:null};st===null?it=st=ot:st=st.next=ot,nt=nt.next}while(nt!==null);st===null?it=st=et:st=st.next=et}else it=st=et;nt={baseState:rt.baseState,firstBaseUpdate:it,lastBaseUpdate:st,shared:rt.shared,effects:rt.effects},tt.updateQueue=nt;return}tt=nt.lastBaseUpdate,tt===null?nt.firstBaseUpdate=et:tt.next=et,nt.lastBaseUpdate=et}function gh(tt,et,nt,rt){var it=tt.updateQueue;$g=!1;var st=it.firstBaseUpdate,ot=it.lastBaseUpdate,lt=it.shared.pending;if(lt!==null){it.shared.pending=null;var ut=lt,ct=ut.next;ut.next=null,ot===null?st=ct:ot.next=ct,ot=ut;var dt=tt.alternate;dt!==null&&(dt=dt.updateQueue,lt=dt.lastBaseUpdate,lt!==ot&&(lt===null?dt.firstBaseUpdate=ct:lt.next=ct,dt.lastBaseUpdate=ut))}if(st!==null){var ft=it.baseState;ot=0,dt=ct=ut=null,lt=st;do{var pt=lt.lane,gt=lt.eventTime;if((rt&pt)===pt){dt!==null&&(dt=dt.next={eventTime:gt,lane:0,tag:lt.tag,payload:lt.payload,callback:lt.callback,next:null});e:{var _r=tt,Yr=lt;switch(pt=et,gt=nt,Yr.tag){case 1:if(_r=Yr.payload,typeof _r=="function"){ft=_r.call(gt,ft,pt);break e}ft=_r;break e;case 3:_r.flags=_r.flags&-65537|128;case 0:if(_r=Yr.payload,pt=typeof _r=="function"?_r.call(gt,ft,pt):_r,pt==null)break e;ft=A$1({},ft,pt);break e;case 2:$g=!0}}lt.callback!==null&&lt.lane!==0&&(tt.flags|=64,pt=it.effects,pt===null?it.effects=[lt]:pt.push(lt))}else gt={eventTime:gt,lane:pt,tag:lt.tag,payload:lt.payload,callback:lt.callback,next:null},dt===null?(ct=dt=gt,ut=ft):dt=dt.next=gt,ot|=pt;if(lt=lt.next,lt===null){if(lt=it.shared.pending,lt===null)break;pt=lt,lt=pt.next,pt.next=null,it.lastBaseUpdate=pt,it.shared.pending=null}}while(!0);if(dt===null&&(ut=ft),it.baseState=ut,it.firstBaseUpdate=ct,it.lastBaseUpdate=dt,et=it.shared.interleaved,et!==null){it=et;do ot|=it.lane,it=it.next;while(it!==et)}else st===null&&(it.shared.lanes=0);hh|=ot,tt.lanes=ot,tt.memoizedState=ft}}function ih(tt,et,nt){if(tt=et.effects,et.effects=null,tt!==null)for(et=0;et<tt.length;et++){var rt=tt[et],it=rt.callback;if(it!==null){if(rt.callback=null,rt=nt,typeof it!="function")throw Error(p$2(191,it));it.call(rt)}}}var jh=new aa.Component().refs;function kh(tt,et,nt,rt){et=tt.memoizedState,nt=nt(rt,et),nt=nt==null?et:A$1({},et,nt),tt.memoizedState=nt,tt.lanes===0&&(tt.updateQueue.baseState=nt)}var nh={isMounted:function(tt){return(tt=tt._reactInternals)?Vb(tt)===tt:!1},enqueueSetState:function(tt,et,nt){tt=tt._reactInternals;var rt=L$2(),it=lh(tt),st=ch(rt,it);st.payload=et,nt!=null&&(st.callback=nt),et=dh(tt,st,it),et!==null&&(mh(et,tt,it,rt),eh(et,tt,it))},enqueueReplaceState:function(tt,et,nt){tt=tt._reactInternals;var rt=L$2(),it=lh(tt),st=ch(rt,it);st.tag=1,st.payload=et,nt!=null&&(st.callback=nt),et=dh(tt,st,it),et!==null&&(mh(et,tt,it,rt),eh(et,tt,it))},enqueueForceUpdate:function(tt,et){tt=tt._reactInternals;var nt=L$2(),rt=lh(tt),it=ch(nt,rt);it.tag=2,et!=null&&(it.callback=et),et=dh(tt,it,rt),et!==null&&(mh(et,tt,rt,nt),eh(et,tt,rt))}};function oh(tt,et,nt,rt,it,st,ot){return tt=tt.stateNode,typeof tt.shouldComponentUpdate=="function"?tt.shouldComponentUpdate(rt,st,ot):et.prototype&&et.prototype.isPureReactComponent?!Ie$1(nt,rt)||!Ie$1(it,st):!0}function ph(tt,et,nt){var rt=!1,it=Vf,st=et.contextType;return typeof st=="object"&&st!==null?st=Vg(st):(it=Zf(et)?Xf:H$1.current,rt=et.contextTypes,st=(rt=rt!=null)?Yf(tt,it):Vf),et=new et(nt,st),tt.memoizedState=et.state!==null&&et.state!==void 0?et.state:null,et.updater=nh,tt.stateNode=et,et._reactInternals=tt,rt&&(tt=tt.stateNode,tt.__reactInternalMemoizedUnmaskedChildContext=it,tt.__reactInternalMemoizedMaskedChildContext=st),et}function qh(tt,et,nt,rt){tt=et.state,typeof et.componentWillReceiveProps=="function"&&et.componentWillReceiveProps(nt,rt),typeof et.UNSAFE_componentWillReceiveProps=="function"&&et.UNSAFE_componentWillReceiveProps(nt,rt),et.state!==tt&&nh.enqueueReplaceState(et,et.state,null)}function rh(tt,et,nt,rt){var it=tt.stateNode;it.props=nt,it.state=tt.memoizedState,it.refs=jh,ah(tt);var st=et.contextType;typeof st=="object"&&st!==null?it.context=Vg(st):(st=Zf(et)?Xf:H$1.current,it.context=Yf(tt,st)),it.state=tt.memoizedState,st=et.getDerivedStateFromProps,typeof st=="function"&&(kh(tt,et,st,nt),it.state=tt.memoizedState),typeof et.getDerivedStateFromProps=="function"||typeof it.getSnapshotBeforeUpdate=="function"||typeof it.UNSAFE_componentWillMount!="function"&&typeof it.componentWillMount!="function"||(et=it.state,typeof it.componentWillMount=="function"&&it.componentWillMount(),typeof it.UNSAFE_componentWillMount=="function"&&it.UNSAFE_componentWillMount(),et!==it.state&&nh.enqueueReplaceState(it,it.state,null),gh(tt,nt,it,rt),it.state=tt.memoizedState),typeof it.componentDidMount=="function"&&(tt.flags|=4194308)}function sh(tt,et,nt){if(tt=nt.ref,tt!==null&&typeof tt!="function"&&typeof tt!="object"){if(nt._owner){if(nt=nt._owner,nt){if(nt.tag!==1)throw Error(p$2(309));var rt=nt.stateNode}if(!rt)throw Error(p$2(147,tt));var it=rt,st=""+tt;return et!==null&&et.ref!==null&&typeof et.ref=="function"&&et.ref._stringRef===st?et.ref:(et=function(ot){var lt=it.refs;lt===jh&&(lt=it.refs={}),ot===null?delete lt[st]:lt[st]=ot},et._stringRef=st,et)}if(typeof tt!="string")throw Error(p$2(284));if(!nt._owner)throw Error(p$2(290,tt))}return tt}function th(tt,et){throw tt=Object.prototype.toString.call(et),Error(p$2(31,tt==="[object Object]"?"object with keys {"+Object.keys(et).join(", ")+"}":tt))}function uh(tt){var et=tt._init;return et(tt._payload)}function vh(tt){function et(Kr,Xr){if(tt){var Zr=Kr.deletions;Zr===null?(Kr.deletions=[Xr],Kr.flags|=16):Zr.push(Xr)}}function nt(Kr,Xr){if(!tt)return null;for(;Xr!==null;)et(Kr,Xr),Xr=Xr.sibling;return null}function rt(Kr,Xr){for(Kr=new Map;Xr!==null;)Xr.key!==null?Kr.set(Xr.key,Xr):Kr.set(Xr.index,Xr),Xr=Xr.sibling;return Kr}function it(Kr,Xr){return Kr=wh(Kr,Xr),Kr.index=0,Kr.sibling=null,Kr}function st(Kr,Xr,Zr){return Kr.index=Zr,tt?(Zr=Kr.alternate,Zr!==null?(Zr=Zr.index,Zr<Xr?(Kr.flags|=2,Xr):Zr):(Kr.flags|=2,Xr)):(Kr.flags|=1048576,Xr)}function ot(Kr){return tt&&Kr.alternate===null&&(Kr.flags|=2),Kr}function lt(Kr,Xr,Zr,Qr){return Xr===null||Xr.tag!==6?(Xr=xh(Zr,Kr.mode,Qr),Xr.return=Kr,Xr):(Xr=it(Xr,Zr),Xr.return=Kr,Xr)}function ut(Kr,Xr,Zr,Qr){var _i=Zr.type;return _i===ya?dt(Kr,Xr,Zr.props.children,Qr,Zr.key):Xr!==null&&(Xr.elementType===_i||typeof _i=="object"&&_i!==null&&_i.$$typeof===Ha&&uh(_i)===Xr.type)?(Qr=it(Xr,Zr.props),Qr.ref=sh(Kr,Xr,Zr),Qr.return=Kr,Qr):(Qr=yh(Zr.type,Zr.key,Zr.props,null,Kr.mode,Qr),Qr.ref=sh(Kr,Xr,Zr),Qr.return=Kr,Qr)}function ct(Kr,Xr,Zr,Qr){return Xr===null||Xr.tag!==4||Xr.stateNode.containerInfo!==Zr.containerInfo||Xr.stateNode.implementation!==Zr.implementation?(Xr=zh(Zr,Kr.mode,Qr),Xr.return=Kr,Xr):(Xr=it(Xr,Zr.children||[]),Xr.return=Kr,Xr)}function dt(Kr,Xr,Zr,Qr,_i){return Xr===null||Xr.tag!==7?(Xr=Ah(Zr,Kr.mode,Qr,_i),Xr.return=Kr,Xr):(Xr=it(Xr,Zr),Xr.return=Kr,Xr)}function ft(Kr,Xr,Zr){if(typeof Xr=="string"&&Xr!==""||typeof Xr=="number")return Xr=xh(""+Xr,Kr.mode,Zr),Xr.return=Kr,Xr;if(typeof Xr=="object"&&Xr!==null){switch(Xr.$$typeof){case va:return Zr=yh(Xr.type,Xr.key,Xr.props,null,Kr.mode,Zr),Zr.ref=sh(Kr,null,Xr),Zr.return=Kr,Zr;case wa:return Xr=zh(Xr,Kr.mode,Zr),Xr.return=Kr,Xr;case Ha:var Qr=Xr._init;return ft(Kr,Qr(Xr._payload),Zr)}if(eb(Xr)||Ka(Xr))return Xr=Ah(Xr,Kr.mode,Zr,null),Xr.return=Kr,Xr;th(Kr,Xr)}return null}function pt(Kr,Xr,Zr,Qr){var _i=Xr!==null?Xr.key:null;if(typeof Zr=="string"&&Zr!==""||typeof Zr=="number")return _i!==null?null:lt(Kr,Xr,""+Zr,Qr);if(typeof Zr=="object"&&Zr!==null){switch(Zr.$$typeof){case va:return Zr.key===_i?ut(Kr,Xr,Zr,Qr):null;case wa:return Zr.key===_i?ct(Kr,Xr,Zr,Qr):null;case Ha:return _i=Zr._init,pt(Kr,Xr,_i(Zr._payload),Qr)}if(eb(Zr)||Ka(Zr))return _i!==null?null:dt(Kr,Xr,Zr,Qr,null);th(Kr,Zr)}return null}function gt(Kr,Xr,Zr,Qr,_i){if(typeof Qr=="string"&&Qr!==""||typeof Qr=="number")return Kr=Kr.get(Zr)||null,lt(Xr,Kr,""+Qr,_i);if(typeof Qr=="object"&&Qr!==null){switch(Qr.$$typeof){case va:return Kr=Kr.get(Qr.key===null?Zr:Qr.key)||null,ut(Xr,Kr,Qr,_i);case wa:return Kr=Kr.get(Qr.key===null?Zr:Qr.key)||null,ct(Xr,Kr,Qr,_i);case Ha:var rs=Qr._init;return gt(Kr,Xr,Zr,rs(Qr._payload),_i)}if(eb(Qr)||Ka(Qr))return Kr=Kr.get(Zr)||null,dt(Xr,Kr,Qr,_i,null);th(Xr,Qr)}return null}function _r(Kr,Xr,Zr,Qr){for(var _i=null,rs=null,ns=Xr,ss=Xr=0,fs=null;ns!==null&&ss<Zr.length;ss++){ns.index>ss?(fs=ns,ns=null):fs=ns.sibling;var os=pt(Kr,ns,Zr[ss],Qr);if(os===null){ns===null&&(ns=fs);break}tt&&ns&&os.alternate===null&&et(Kr,ns),Xr=st(os,Xr,ss),rs===null?_i=os:rs.sibling=os,rs=os,ns=fs}if(ss===Zr.length)return nt(Kr,ns),I$1&&tg(Kr,ss),_i;if(ns===null){for(;ss<Zr.length;ss++)ns=ft(Kr,Zr[ss],Qr),ns!==null&&(Xr=st(ns,Xr,ss),rs===null?_i=ns:rs.sibling=ns,rs=ns);return I$1&&tg(Kr,ss),_i}for(ns=rt(Kr,ns);ss<Zr.length;ss++)fs=gt(ns,Kr,ss,Zr[ss],Qr),fs!==null&&(tt&&fs.alternate!==null&&ns.delete(fs.key===null?ss:fs.key),Xr=st(fs,Xr,ss),rs===null?_i=fs:rs.sibling=fs,rs=fs);return tt&&ns.forEach(function(is){return et(Kr,is)}),I$1&&tg(Kr,ss),_i}function Yr(Kr,Xr,Zr,Qr){var _i=Ka(Zr);if(typeof _i!="function")throw Error(p$2(150));if(Zr=_i.call(Zr),Zr==null)throw Error(p$2(151));for(var rs=_i=null,ns=Xr,ss=Xr=0,fs=null,os=Zr.next();ns!==null&&!os.done;ss++,os=Zr.next()){ns.index>ss?(fs=ns,ns=null):fs=ns.sibling;var is=pt(Kr,ns,os.value,Qr);if(is===null){ns===null&&(ns=fs);break}tt&&ns&&is.alternate===null&&et(Kr,ns),Xr=st(is,Xr,ss),rs===null?_i=is:rs.sibling=is,rs=is,ns=fs}if(os.done)return nt(Kr,ns),I$1&&tg(Kr,ss),_i;if(ns===null){for(;!os.done;ss++,os=Zr.next())os=ft(Kr,os.value,Qr),os!==null&&(Xr=st(os,Xr,ss),rs===null?_i=os:rs.sibling=os,rs=os);return I$1&&tg(Kr,ss),_i}for(ns=rt(Kr,ns);!os.done;ss++,os=Zr.next())os=gt(ns,Kr,ss,os.value,Qr),os!==null&&(tt&&os.alternate!==null&&ns.delete(os.key===null?ss:os.key),Xr=st(os,Xr,ss),rs===null?_i=os:rs.sibling=os,rs=os);return tt&&ns.forEach(function(cs){return et(Kr,cs)}),I$1&&tg(Kr,ss),_i}function mt(Kr,Xr,Zr,Qr){if(typeof Zr=="object"&&Zr!==null&&Zr.type===ya&&Zr.key===null&&(Zr=Zr.props.children),typeof Zr=="object"&&Zr!==null){switch(Zr.$$typeof){case va:e:{for(var _i=Zr.key,rs=Xr;rs!==null;){if(rs.key===_i){if(_i=Zr.type,_i===ya){if(rs.tag===7){nt(Kr,rs.sibling),Xr=it(rs,Zr.props.children),Xr.return=Kr,Kr=Xr;break e}}else if(rs.elementType===_i||typeof _i=="object"&&_i!==null&&_i.$$typeof===Ha&&uh(_i)===rs.type){nt(Kr,rs.sibling),Xr=it(rs,Zr.props),Xr.ref=sh(Kr,rs,Zr),Xr.return=Kr,Kr=Xr;break e}nt(Kr,rs);break}else et(Kr,rs);rs=rs.sibling}Zr.type===ya?(Xr=Ah(Zr.props.children,Kr.mode,Qr,Zr.key),Xr.return=Kr,Kr=Xr):(Qr=yh(Zr.type,Zr.key,Zr.props,null,Kr.mode,Qr),Qr.ref=sh(Kr,Xr,Zr),Qr.return=Kr,Kr=Qr)}return ot(Kr);case wa:e:{for(rs=Zr.key;Xr!==null;){if(Xr.key===rs)if(Xr.tag===4&&Xr.stateNode.containerInfo===Zr.containerInfo&&Xr.stateNode.implementation===Zr.implementation){nt(Kr,Xr.sibling),Xr=it(Xr,Zr.children||[]),Xr.return=Kr,Kr=Xr;break e}else{nt(Kr,Xr);break}else et(Kr,Xr);Xr=Xr.sibling}Xr=zh(Zr,Kr.mode,Qr),Xr.return=Kr,Kr=Xr}return ot(Kr);case Ha:return rs=Zr._init,mt(Kr,Xr,rs(Zr._payload),Qr)}if(eb(Zr))return _r(Kr,Xr,Zr,Qr);if(Ka(Zr))return Yr(Kr,Xr,Zr,Qr);th(Kr,Zr)}return typeof Zr=="string"&&Zr!==""||typeof Zr=="number"?(Zr=""+Zr,Xr!==null&&Xr.tag===6?(nt(Kr,Xr.sibling),Xr=it(Xr,Zr),Xr.return=Kr,Kr=Xr):(nt(Kr,Xr),Xr=xh(Zr,Kr.mode,Qr),Xr.return=Kr,Kr=Xr),ot(Kr)):nt(Kr,Xr)}return mt}var Bh=vh(!0),Ch=vh(!1),Dh={},Eh=Uf(Dh),Fh=Uf(Dh),Gh=Uf(Dh);function Hh(tt){if(tt===Dh)throw Error(p$2(174));return tt}function Ih(tt,et){switch(G$1(Gh,et),G$1(Fh,tt),G$1(Eh,Dh),tt=et.nodeType,tt){case 9:case 11:et=(et=et.documentElement)?et.namespaceURI:lb(null,"");break;default:tt=tt===8?et.parentNode:et,et=tt.namespaceURI||null,tt=tt.tagName,et=lb(et,tt)}E$1(Eh),G$1(Eh,et)}function Jh(){E$1(Eh),E$1(Fh),E$1(Gh)}function Kh(tt){Hh(Gh.current);var et=Hh(Eh.current),nt=lb(et,tt.type);et!==nt&&(G$1(Fh,tt),G$1(Eh,nt))}function Lh(tt){Fh.current===tt&&(E$1(Eh),E$1(Fh))}var M$1=Uf(0);function Mh(tt){for(var et=tt;et!==null;){if(et.tag===13){var nt=et.memoizedState;if(nt!==null&&(nt=nt.dehydrated,nt===null||nt.data==="$?"||nt.data==="$!"))return et}else if(et.tag===19&&et.memoizedProps.revealOrder!==void 0){if(et.flags&128)return et}else if(et.child!==null){et.child.return=et,et=et.child;continue}if(et===tt)break;for(;et.sibling===null;){if(et.return===null||et.return===tt)return null;et=et.return}et.sibling.return=et.return,et=et.sibling}return null}var Nh=[];function Oh(){for(var tt=0;tt<Nh.length;tt++)Nh[tt]._workInProgressVersionPrimary=null;Nh.length=0}var Ph=ua.ReactCurrentDispatcher,Qh=ua.ReactCurrentBatchConfig,Rh=0,N$2=null,O$2=null,P$1=null,Sh=!1,Th=!1,Uh=0,Vh=0;function Q$2(){throw Error(p$2(321))}function Wh(tt,et){if(et===null)return!1;for(var nt=0;nt<et.length&&nt<tt.length;nt++)if(!He$1(tt[nt],et[nt]))return!1;return!0}function Xh(tt,et,nt,rt,it,st){if(Rh=st,N$2=et,et.memoizedState=null,et.updateQueue=null,et.lanes=0,Ph.current=tt===null||tt.memoizedState===null?Yh:Zh,tt=nt(rt,it),Th){st=0;do{if(Th=!1,Uh=0,25<=st)throw Error(p$2(301));st+=1,P$1=O$2=null,et.updateQueue=null,Ph.current=$h,tt=nt(rt,it)}while(Th)}if(Ph.current=ai,et=O$2!==null&&O$2.next!==null,Rh=0,P$1=O$2=N$2=null,Sh=!1,et)throw Error(p$2(300));return tt}function bi(){var tt=Uh!==0;return Uh=0,tt}function ci(){var tt={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return P$1===null?N$2.memoizedState=P$1=tt:P$1=P$1.next=tt,P$1}function di(){if(O$2===null){var tt=N$2.alternate;tt=tt!==null?tt.memoizedState:null}else tt=O$2.next;var et=P$1===null?N$2.memoizedState:P$1.next;if(et!==null)P$1=et,O$2=tt;else{if(tt===null)throw Error(p$2(310));O$2=tt,tt={memoizedState:O$2.memoizedState,baseState:O$2.baseState,baseQueue:O$2.baseQueue,queue:O$2.queue,next:null},P$1===null?N$2.memoizedState=P$1=tt:P$1=P$1.next=tt}return P$1}function ei(tt,et){return typeof et=="function"?et(tt):et}function fi(tt){var et=di(),nt=et.queue;if(nt===null)throw Error(p$2(311));nt.lastRenderedReducer=tt;var rt=O$2,it=rt.baseQueue,st=nt.pending;if(st!==null){if(it!==null){var ot=it.next;it.next=st.next,st.next=ot}rt.baseQueue=it=st,nt.pending=null}if(it!==null){st=it.next,rt=rt.baseState;var lt=ot=null,ut=null,ct=st;do{var dt=ct.lane;if((Rh&dt)===dt)ut!==null&&(ut=ut.next={lane:0,action:ct.action,hasEagerState:ct.hasEagerState,eagerState:ct.eagerState,next:null}),rt=ct.hasEagerState?ct.eagerState:tt(rt,ct.action);else{var ft={lane:dt,action:ct.action,hasEagerState:ct.hasEagerState,eagerState:ct.eagerState,next:null};ut===null?(lt=ut=ft,ot=rt):ut=ut.next=ft,N$2.lanes|=dt,hh|=dt}ct=ct.next}while(ct!==null&&ct!==st);ut===null?ot=rt:ut.next=lt,He$1(rt,et.memoizedState)||(Ug=!0),et.memoizedState=rt,et.baseState=ot,et.baseQueue=ut,nt.lastRenderedState=rt}if(tt=nt.interleaved,tt!==null){it=tt;do st=it.lane,N$2.lanes|=st,hh|=st,it=it.next;while(it!==tt)}else it===null&&(nt.lanes=0);return[et.memoizedState,nt.dispatch]}function gi(tt){var et=di(),nt=et.queue;if(nt===null)throw Error(p$2(311));nt.lastRenderedReducer=tt;var rt=nt.dispatch,it=nt.pending,st=et.memoizedState;if(it!==null){nt.pending=null;var ot=it=it.next;do st=tt(st,ot.action),ot=ot.next;while(ot!==it);He$1(st,et.memoizedState)||(Ug=!0),et.memoizedState=st,et.baseQueue===null&&(et.baseState=st),nt.lastRenderedState=st}return[st,rt]}function hi(){}function ii(tt,et){var nt=N$2,rt=di(),it=et(),st=!He$1(rt.memoizedState,it);if(st&&(rt.memoizedState=it,Ug=!0),rt=rt.queue,ji(ki.bind(null,nt,rt,tt),[tt]),rt.getSnapshot!==et||st||P$1!==null&&P$1.memoizedState.tag&1){if(nt.flags|=2048,li(9,mi.bind(null,nt,rt,it,et),void 0,null),R$2===null)throw Error(p$2(349));Rh&30||ni(nt,et,it)}return it}function ni(tt,et,nt){tt.flags|=16384,tt={getSnapshot:et,value:nt},et=N$2.updateQueue,et===null?(et={lastEffect:null,stores:null},N$2.updateQueue=et,et.stores=[tt]):(nt=et.stores,nt===null?et.stores=[tt]:nt.push(tt))}function mi(tt,et,nt,rt){et.value=nt,et.getSnapshot=rt,oi(et)&&pi(tt)}function ki(tt,et,nt){return nt(function(){oi(et)&&pi(tt)})}function oi(tt){var et=tt.getSnapshot;tt=tt.value;try{var nt=et();return!He$1(tt,nt)}catch{return!0}}function pi(tt){var et=Zg(tt,1);et!==null&&mh(et,tt,1,-1)}function qi(tt){var et=ci();return typeof tt=="function"&&(tt=tt()),et.memoizedState=et.baseState=tt,tt={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ei,lastRenderedState:tt},et.queue=tt,tt=tt.dispatch=ri.bind(null,N$2,tt),[et.memoizedState,tt]}function li(tt,et,nt,rt){return tt={tag:tt,create:et,destroy:nt,deps:rt,next:null},et=N$2.updateQueue,et===null?(et={lastEffect:null,stores:null},N$2.updateQueue=et,et.lastEffect=tt.next=tt):(nt=et.lastEffect,nt===null?et.lastEffect=tt.next=tt:(rt=nt.next,nt.next=tt,tt.next=rt,et.lastEffect=tt)),tt}function si(){return di().memoizedState}function ti(tt,et,nt,rt){var it=ci();N$2.flags|=tt,it.memoizedState=li(1|et,nt,void 0,rt===void 0?null:rt)}function ui(tt,et,nt,rt){var it=di();rt=rt===void 0?null:rt;var st=void 0;if(O$2!==null){var ot=O$2.memoizedState;if(st=ot.destroy,rt!==null&&Wh(rt,ot.deps)){it.memoizedState=li(et,nt,st,rt);return}}N$2.flags|=tt,it.memoizedState=li(1|et,nt,st,rt)}function vi(tt,et){return ti(8390656,8,tt,et)}function ji(tt,et){return ui(2048,8,tt,et)}function wi(tt,et){return ui(4,2,tt,et)}function xi(tt,et){return ui(4,4,tt,et)}function yi(tt,et){if(typeof et=="function")return tt=tt(),et(tt),function(){et(null)};if(et!=null)return tt=tt(),et.current=tt,function(){et.current=null}}function zi(tt,et,nt){return nt=nt!=null?nt.concat([tt]):null,ui(4,4,yi.bind(null,et,tt),nt)}function Ai(){}function Bi(tt,et){var nt=di();et=et===void 0?null:et;var rt=nt.memoizedState;return rt!==null&&et!==null&&Wh(et,rt[1])?rt[0]:(nt.memoizedState=[tt,et],tt)}function Ci(tt,et){var nt=di();et=et===void 0?null:et;var rt=nt.memoizedState;return rt!==null&&et!==null&&Wh(et,rt[1])?rt[0]:(tt=tt(),nt.memoizedState=[tt,et],tt)}function Di(tt,et,nt){return Rh&21?(He$1(nt,et)||(nt=yc(),N$2.lanes|=nt,hh|=nt,tt.baseState=!0),et):(tt.baseState&&(tt.baseState=!1,Ug=!0),tt.memoizedState=nt)}function Ei(tt,et){var nt=C$1;C$1=nt!==0&&4>nt?nt:4,tt(!0);var rt=Qh.transition;Qh.transition={};try{tt(!1),et()}finally{C$1=nt,Qh.transition=rt}}function Fi(){return di().memoizedState}function Gi(tt,et,nt){var rt=lh(tt);if(nt={lane:rt,action:nt,hasEagerState:!1,eagerState:null,next:null},Hi(tt))Ii(et,nt);else if(nt=Yg(tt,et,nt,rt),nt!==null){var it=L$2();mh(nt,tt,rt,it),Ji(nt,et,rt)}}function ri(tt,et,nt){var rt=lh(tt),it={lane:rt,action:nt,hasEagerState:!1,eagerState:null,next:null};if(Hi(tt))Ii(et,it);else{var st=tt.alternate;if(tt.lanes===0&&(st===null||st.lanes===0)&&(st=et.lastRenderedReducer,st!==null))try{var ot=et.lastRenderedState,lt=st(ot,nt);if(it.hasEagerState=!0,it.eagerState=lt,He$1(lt,ot)){var ut=et.interleaved;ut===null?(it.next=it,Xg(et)):(it.next=ut.next,ut.next=it),et.interleaved=it;return}}catch{}finally{}nt=Yg(tt,et,it,rt),nt!==null&&(it=L$2(),mh(nt,tt,rt,it),Ji(nt,et,rt))}}function Hi(tt){var et=tt.alternate;return tt===N$2||et!==null&&et===N$2}function Ii(tt,et){Th=Sh=!0;var nt=tt.pending;nt===null?et.next=et:(et.next=nt.next,nt.next=et),tt.pending=et}function Ji(tt,et,nt){if(nt&4194240){var rt=et.lanes;rt&=tt.pendingLanes,nt|=rt,et.lanes=nt,Cc(tt,nt)}}var ai={readContext:Vg,useCallback:Q$2,useContext:Q$2,useEffect:Q$2,useImperativeHandle:Q$2,useInsertionEffect:Q$2,useLayoutEffect:Q$2,useMemo:Q$2,useReducer:Q$2,useRef:Q$2,useState:Q$2,useDebugValue:Q$2,useDeferredValue:Q$2,useTransition:Q$2,useMutableSource:Q$2,useSyncExternalStore:Q$2,useId:Q$2,unstable_isNewReconciler:!1},Yh={readContext:Vg,useCallback:function(tt,et){return ci().memoizedState=[tt,et===void 0?null:et],tt},useContext:Vg,useEffect:vi,useImperativeHandle:function(tt,et,nt){return nt=nt!=null?nt.concat([tt]):null,ti(4194308,4,yi.bind(null,et,tt),nt)},useLayoutEffect:function(tt,et){return ti(4194308,4,tt,et)},useInsertionEffect:function(tt,et){return ti(4,2,tt,et)},useMemo:function(tt,et){var nt=ci();return et=et===void 0?null:et,tt=tt(),nt.memoizedState=[tt,et],tt},useReducer:function(tt,et,nt){var rt=ci();return et=nt!==void 0?nt(et):et,rt.memoizedState=rt.baseState=et,tt={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:tt,lastRenderedState:et},rt.queue=tt,tt=tt.dispatch=Gi.bind(null,N$2,tt),[rt.memoizedState,tt]},useRef:function(tt){var et=ci();return tt={current:tt},et.memoizedState=tt},useState:qi,useDebugValue:Ai,useDeferredValue:function(tt){return ci().memoizedState=tt},useTransition:function(){var tt=qi(!1),et=tt[0];return tt=Ei.bind(null,tt[1]),ci().memoizedState=tt,[et,tt]},useMutableSource:function(){},useSyncExternalStore:function(tt,et,nt){var rt=N$2,it=ci();if(I$1){if(nt===void 0)throw Error(p$2(407));nt=nt()}else{if(nt=et(),R$2===null)throw Error(p$2(349));Rh&30||ni(rt,et,nt)}it.memoizedState=nt;var st={value:nt,getSnapshot:et};return it.queue=st,vi(ki.bind(null,rt,st,tt),[tt]),rt.flags|=2048,li(9,mi.bind(null,rt,st,nt,et),void 0,null),nt},useId:function(){var tt=ci(),et=R$2.identifierPrefix;if(I$1){var nt=sg,rt=rg;nt=(rt&~(1<<32-oc(rt)-1)).toString(32)+nt,et=":"+et+"R"+nt,nt=Uh++,0<nt&&(et+="H"+nt.toString(32)),et+=":"}else nt=Vh++,et=":"+et+"r"+nt.toString(32)+":";return tt.memoizedState=et},unstable_isNewReconciler:!1},Zh={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:fi,useRef:si,useState:function(){return fi(ei)},useDebugValue:Ai,useDeferredValue:function(tt){var et=di();return Di(et,O$2.memoizedState,tt)},useTransition:function(){var tt=fi(ei)[0],et=di().memoizedState;return[tt,et]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1},$h={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:gi,useRef:si,useState:function(){return gi(ei)},useDebugValue:Ai,useDeferredValue:function(tt){var et=di();return O$2===null?et.memoizedState=tt:Di(et,O$2.memoizedState,tt)},useTransition:function(){var tt=gi(ei)[0],et=di().memoizedState;return[tt,et]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1};function Ki(tt,et){try{var nt="",rt=et;do nt+=Pa(rt),rt=rt.return;while(rt);var it=nt}catch(st){it=`
Error generating stack: `+st.message+`
`+st.stack}return{value:tt,source:et,stack:it,digest:null}}function Li(tt,et,nt){return{value:tt,source:null,stack:nt??null,digest:et??null}}function Mi(tt,et){try{console.error(et.value)}catch(nt){setTimeout(function(){throw nt})}}var Ni=typeof WeakMap=="function"?WeakMap:Map;function Oi(tt,et,nt){nt=ch(-1,nt),nt.tag=3,nt.payload={element:null};var rt=et.value;return nt.callback=function(){Pi||(Pi=!0,Qi=rt),Mi(tt,et)},nt}function Ri(tt,et,nt){nt=ch(-1,nt),nt.tag=3;var rt=tt.type.getDerivedStateFromError;if(typeof rt=="function"){var it=et.value;nt.payload=function(){return rt(it)},nt.callback=function(){Mi(tt,et)}}var st=tt.stateNode;return st!==null&&typeof st.componentDidCatch=="function"&&(nt.callback=function(){Mi(tt,et),typeof rt!="function"&&(Si===null?Si=new Set([this]):Si.add(this));var ot=et.stack;this.componentDidCatch(et.value,{componentStack:ot!==null?ot:""})}),nt}function Ti(tt,et,nt){var rt=tt.pingCache;if(rt===null){rt=tt.pingCache=new Ni;var it=new Set;rt.set(et,it)}else it=rt.get(et),it===void 0&&(it=new Set,rt.set(et,it));it.has(nt)||(it.add(nt),tt=Ui.bind(null,tt,et,nt),et.then(tt,tt))}function Vi(tt){do{var et;if((et=tt.tag===13)&&(et=tt.memoizedState,et=et!==null?et.dehydrated!==null:!0),et)return tt;tt=tt.return}while(tt!==null);return null}function Wi(tt,et,nt,rt,it){return tt.mode&1?(tt.flags|=65536,tt.lanes=it,tt):(tt===et?tt.flags|=65536:(tt.flags|=128,nt.flags|=131072,nt.flags&=-52805,nt.tag===1&&(nt.alternate===null?nt.tag=17:(et=ch(-1,1),et.tag=2,dh(nt,et,1))),nt.lanes|=1),tt)}var Xi=ua.ReactCurrentOwner,Ug=!1;function Yi(tt,et,nt,rt){et.child=tt===null?Ch(et,null,nt,rt):Bh(et,tt.child,nt,rt)}function Zi(tt,et,nt,rt,it){nt=nt.render;var st=et.ref;return Tg(et,it),rt=Xh(tt,et,nt,rt,st,it),nt=bi(),tt!==null&&!Ug?(et.updateQueue=tt.updateQueue,et.flags&=-2053,tt.lanes&=~it,$i(tt,et,it)):(I$1&&nt&&vg(et),et.flags|=1,Yi(tt,et,rt,it),et.child)}function aj(tt,et,nt,rt,it){if(tt===null){var st=nt.type;return typeof st=="function"&&!bj(st)&&st.defaultProps===void 0&&nt.compare===null&&nt.defaultProps===void 0?(et.tag=15,et.type=st,cj(tt,et,st,rt,it)):(tt=yh(nt.type,null,rt,et,et.mode,it),tt.ref=et.ref,tt.return=et,et.child=tt)}if(st=tt.child,!(tt.lanes&it)){var ot=st.memoizedProps;if(nt=nt.compare,nt=nt!==null?nt:Ie$1,nt(ot,rt)&&tt.ref===et.ref)return $i(tt,et,it)}return et.flags|=1,tt=wh(st,rt),tt.ref=et.ref,tt.return=et,et.child=tt}function cj(tt,et,nt,rt,it){if(tt!==null){var st=tt.memoizedProps;if(Ie$1(st,rt)&&tt.ref===et.ref)if(Ug=!1,et.pendingProps=rt=st,(tt.lanes&it)!==0)tt.flags&131072&&(Ug=!0);else return et.lanes=tt.lanes,$i(tt,et,it)}return dj(tt,et,nt,rt,it)}function ej(tt,et,nt){var rt=et.pendingProps,it=rt.children,st=tt!==null?tt.memoizedState:null;if(rt.mode==="hidden")if(!(et.mode&1))et.memoizedState={baseLanes:0,cachePool:null,transitions:null},G$1(fj,gj),gj|=nt;else{if(!(nt&1073741824))return tt=st!==null?st.baseLanes|nt:nt,et.lanes=et.childLanes=1073741824,et.memoizedState={baseLanes:tt,cachePool:null,transitions:null},et.updateQueue=null,G$1(fj,gj),gj|=tt,null;et.memoizedState={baseLanes:0,cachePool:null,transitions:null},rt=st!==null?st.baseLanes:nt,G$1(fj,gj),gj|=rt}else st!==null?(rt=st.baseLanes|nt,et.memoizedState=null):rt=nt,G$1(fj,gj),gj|=rt;return Yi(tt,et,it,nt),et.child}function hj(tt,et){var nt=et.ref;(tt===null&&nt!==null||tt!==null&&tt.ref!==nt)&&(et.flags|=512,et.flags|=2097152)}function dj(tt,et,nt,rt,it){var st=Zf(nt)?Xf:H$1.current;return st=Yf(et,st),Tg(et,it),nt=Xh(tt,et,nt,rt,st,it),rt=bi(),tt!==null&&!Ug?(et.updateQueue=tt.updateQueue,et.flags&=-2053,tt.lanes&=~it,$i(tt,et,it)):(I$1&&rt&&vg(et),et.flags|=1,Yi(tt,et,nt,it),et.child)}function ij(tt,et,nt,rt,it){if(Zf(nt)){var st=!0;cg(et)}else st=!1;if(Tg(et,it),et.stateNode===null)jj(tt,et),ph(et,nt,rt),rh(et,nt,rt,it),rt=!0;else if(tt===null){var ot=et.stateNode,lt=et.memoizedProps;ot.props=lt;var ut=ot.context,ct=nt.contextType;typeof ct=="object"&&ct!==null?ct=Vg(ct):(ct=Zf(nt)?Xf:H$1.current,ct=Yf(et,ct));var dt=nt.getDerivedStateFromProps,ft=typeof dt=="function"||typeof ot.getSnapshotBeforeUpdate=="function";ft||typeof ot.UNSAFE_componentWillReceiveProps!="function"&&typeof ot.componentWillReceiveProps!="function"||(lt!==rt||ut!==ct)&&qh(et,ot,rt,ct),$g=!1;var pt=et.memoizedState;ot.state=pt,gh(et,rt,ot,it),ut=et.memoizedState,lt!==rt||pt!==ut||Wf.current||$g?(typeof dt=="function"&&(kh(et,nt,dt,rt),ut=et.memoizedState),(lt=$g||oh(et,nt,lt,rt,pt,ut,ct))?(ft||typeof ot.UNSAFE_componentWillMount!="function"&&typeof ot.componentWillMount!="function"||(typeof ot.componentWillMount=="function"&&ot.componentWillMount(),typeof ot.UNSAFE_componentWillMount=="function"&&ot.UNSAFE_componentWillMount()),typeof ot.componentDidMount=="function"&&(et.flags|=4194308)):(typeof ot.componentDidMount=="function"&&(et.flags|=4194308),et.memoizedProps=rt,et.memoizedState=ut),ot.props=rt,ot.state=ut,ot.context=ct,rt=lt):(typeof ot.componentDidMount=="function"&&(et.flags|=4194308),rt=!1)}else{ot=et.stateNode,bh(tt,et),lt=et.memoizedProps,ct=et.type===et.elementType?lt:Lg(et.type,lt),ot.props=ct,ft=et.pendingProps,pt=ot.context,ut=nt.contextType,typeof ut=="object"&&ut!==null?ut=Vg(ut):(ut=Zf(nt)?Xf:H$1.current,ut=Yf(et,ut));var gt=nt.getDerivedStateFromProps;(dt=typeof gt=="function"||typeof ot.getSnapshotBeforeUpdate=="function")||typeof ot.UNSAFE_componentWillReceiveProps!="function"&&typeof ot.componentWillReceiveProps!="function"||(lt!==ft||pt!==ut)&&qh(et,ot,rt,ut),$g=!1,pt=et.memoizedState,ot.state=pt,gh(et,rt,ot,it);var _r=et.memoizedState;lt!==ft||pt!==_r||Wf.current||$g?(typeof gt=="function"&&(kh(et,nt,gt,rt),_r=et.memoizedState),(ct=$g||oh(et,nt,ct,rt,pt,_r,ut)||!1)?(dt||typeof ot.UNSAFE_componentWillUpdate!="function"&&typeof ot.componentWillUpdate!="function"||(typeof ot.componentWillUpdate=="function"&&ot.componentWillUpdate(rt,_r,ut),typeof ot.UNSAFE_componentWillUpdate=="function"&&ot.UNSAFE_componentWillUpdate(rt,_r,ut)),typeof ot.componentDidUpdate=="function"&&(et.flags|=4),typeof ot.getSnapshotBeforeUpdate=="function"&&(et.flags|=1024)):(typeof ot.componentDidUpdate!="function"||lt===tt.memoizedProps&&pt===tt.memoizedState||(et.flags|=4),typeof ot.getSnapshotBeforeUpdate!="function"||lt===tt.memoizedProps&&pt===tt.memoizedState||(et.flags|=1024),et.memoizedProps=rt,et.memoizedState=_r),ot.props=rt,ot.state=_r,ot.context=ut,rt=ct):(typeof ot.componentDidUpdate!="function"||lt===tt.memoizedProps&&pt===tt.memoizedState||(et.flags|=4),typeof ot.getSnapshotBeforeUpdate!="function"||lt===tt.memoizedProps&&pt===tt.memoizedState||(et.flags|=1024),rt=!1)}return kj(tt,et,nt,rt,st,it)}function kj(tt,et,nt,rt,it,st){hj(tt,et);var ot=(et.flags&128)!==0;if(!rt&&!ot)return it&&dg(et,nt,!1),$i(tt,et,st);rt=et.stateNode,Xi.current=et;var lt=ot&&typeof nt.getDerivedStateFromError!="function"?null:rt.render();return et.flags|=1,tt!==null&&ot?(et.child=Bh(et,tt.child,null,st),et.child=Bh(et,null,lt,st)):Yi(tt,et,lt,st),et.memoizedState=rt.state,it&&dg(et,nt,!0),et.child}function lj(tt){var et=tt.stateNode;et.pendingContext?ag(tt,et.pendingContext,et.pendingContext!==et.context):et.context&&ag(tt,et.context,!1),Ih(tt,et.containerInfo)}function mj(tt,et,nt,rt,it){return Ig(),Jg(it),et.flags|=256,Yi(tt,et,nt,rt),et.child}var nj={dehydrated:null,treeContext:null,retryLane:0};function oj(tt){return{baseLanes:tt,cachePool:null,transitions:null}}function pj(tt,et,nt){var rt=et.pendingProps,it=M$1.current,st=!1,ot=(et.flags&128)!==0,lt;if((lt=ot)||(lt=tt!==null&&tt.memoizedState===null?!1:(it&2)!==0),lt?(st=!0,et.flags&=-129):(tt===null||tt.memoizedState!==null)&&(it|=1),G$1(M$1,it&1),tt===null)return Eg(et),tt=et.memoizedState,tt!==null&&(tt=tt.dehydrated,tt!==null)?(et.mode&1?tt.data==="$!"?et.lanes=8:et.lanes=1073741824:et.lanes=1,null):(ot=rt.children,tt=rt.fallback,st?(rt=et.mode,st=et.child,ot={mode:"hidden",children:ot},!(rt&1)&&st!==null?(st.childLanes=0,st.pendingProps=ot):st=qj(ot,rt,0,null),tt=Ah(tt,rt,nt,null),st.return=et,tt.return=et,st.sibling=tt,et.child=st,et.child.memoizedState=oj(nt),et.memoizedState=nj,tt):rj(et,ot));if(it=tt.memoizedState,it!==null&&(lt=it.dehydrated,lt!==null))return sj(tt,et,ot,rt,lt,it,nt);if(st){st=rt.fallback,ot=et.mode,it=tt.child,lt=it.sibling;var ut={mode:"hidden",children:rt.children};return!(ot&1)&&et.child!==it?(rt=et.child,rt.childLanes=0,rt.pendingProps=ut,et.deletions=null):(rt=wh(it,ut),rt.subtreeFlags=it.subtreeFlags&14680064),lt!==null?st=wh(lt,st):(st=Ah(st,ot,nt,null),st.flags|=2),st.return=et,rt.return=et,rt.sibling=st,et.child=rt,rt=st,st=et.child,ot=tt.child.memoizedState,ot=ot===null?oj(nt):{baseLanes:ot.baseLanes|nt,cachePool:null,transitions:ot.transitions},st.memoizedState=ot,st.childLanes=tt.childLanes&~nt,et.memoizedState=nj,rt}return st=tt.child,tt=st.sibling,rt=wh(st,{mode:"visible",children:rt.children}),!(et.mode&1)&&(rt.lanes=nt),rt.return=et,rt.sibling=null,tt!==null&&(nt=et.deletions,nt===null?(et.deletions=[tt],et.flags|=16):nt.push(tt)),et.child=rt,et.memoizedState=null,rt}function rj(tt,et){return et=qj({mode:"visible",children:et},tt.mode,0,null),et.return=tt,tt.child=et}function tj(tt,et,nt,rt){return rt!==null&&Jg(rt),Bh(et,tt.child,null,nt),tt=rj(et,et.pendingProps.children),tt.flags|=2,et.memoizedState=null,tt}function sj(tt,et,nt,rt,it,st,ot){if(nt)return et.flags&256?(et.flags&=-257,rt=Li(Error(p$2(422))),tj(tt,et,ot,rt)):et.memoizedState!==null?(et.child=tt.child,et.flags|=128,null):(st=rt.fallback,it=et.mode,rt=qj({mode:"visible",children:rt.children},it,0,null),st=Ah(st,it,ot,null),st.flags|=2,rt.return=et,st.return=et,rt.sibling=st,et.child=rt,et.mode&1&&Bh(et,tt.child,null,ot),et.child.memoizedState=oj(ot),et.memoizedState=nj,st);if(!(et.mode&1))return tj(tt,et,ot,null);if(it.data==="$!"){if(rt=it.nextSibling&&it.nextSibling.dataset,rt)var lt=rt.dgst;return rt=lt,st=Error(p$2(419)),rt=Li(st,rt,void 0),tj(tt,et,ot,rt)}if(lt=(ot&tt.childLanes)!==0,Ug||lt){if(rt=R$2,rt!==null){switch(ot&-ot){case 4:it=2;break;case 16:it=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:it=32;break;case 536870912:it=268435456;break;default:it=0}it=it&(rt.suspendedLanes|ot)?0:it,it!==0&&it!==st.retryLane&&(st.retryLane=it,Zg(tt,it),mh(rt,tt,it,-1))}return uj(),rt=Li(Error(p$2(421))),tj(tt,et,ot,rt)}return it.data==="$?"?(et.flags|=128,et.child=tt.child,et=vj.bind(null,tt),it._reactRetry=et,null):(tt=st.treeContext,yg=Lf(it.nextSibling),xg=et,I$1=!0,zg=null,tt!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=tt.id,sg=tt.overflow,qg=et),et=rj(et,rt.children),et.flags|=4096,et)}function wj(tt,et,nt){tt.lanes|=et;var rt=tt.alternate;rt!==null&&(rt.lanes|=et),Sg(tt.return,et,nt)}function xj(tt,et,nt,rt,it){var st=tt.memoizedState;st===null?tt.memoizedState={isBackwards:et,rendering:null,renderingStartTime:0,last:rt,tail:nt,tailMode:it}:(st.isBackwards=et,st.rendering=null,st.renderingStartTime=0,st.last=rt,st.tail=nt,st.tailMode=it)}function yj(tt,et,nt){var rt=et.pendingProps,it=rt.revealOrder,st=rt.tail;if(Yi(tt,et,rt.children,nt),rt=M$1.current,rt&2)rt=rt&1|2,et.flags|=128;else{if(tt!==null&&tt.flags&128)e:for(tt=et.child;tt!==null;){if(tt.tag===13)tt.memoizedState!==null&&wj(tt,nt,et);else if(tt.tag===19)wj(tt,nt,et);else if(tt.child!==null){tt.child.return=tt,tt=tt.child;continue}if(tt===et)break e;for(;tt.sibling===null;){if(tt.return===null||tt.return===et)break e;tt=tt.return}tt.sibling.return=tt.return,tt=tt.sibling}rt&=1}if(G$1(M$1,rt),!(et.mode&1))et.memoizedState=null;else switch(it){case"forwards":for(nt=et.child,it=null;nt!==null;)tt=nt.alternate,tt!==null&&Mh(tt)===null&&(it=nt),nt=nt.sibling;nt=it,nt===null?(it=et.child,et.child=null):(it=nt.sibling,nt.sibling=null),xj(et,!1,it,nt,st);break;case"backwards":for(nt=null,it=et.child,et.child=null;it!==null;){if(tt=it.alternate,tt!==null&&Mh(tt)===null){et.child=it;break}tt=it.sibling,it.sibling=nt,nt=it,it=tt}xj(et,!0,nt,null,st);break;case"together":xj(et,!1,null,null,void 0);break;default:et.memoizedState=null}return et.child}function jj(tt,et){!(et.mode&1)&&tt!==null&&(tt.alternate=null,et.alternate=null,et.flags|=2)}function $i(tt,et,nt){if(tt!==null&&(et.dependencies=tt.dependencies),hh|=et.lanes,!(nt&et.childLanes))return null;if(tt!==null&&et.child!==tt.child)throw Error(p$2(153));if(et.child!==null){for(tt=et.child,nt=wh(tt,tt.pendingProps),et.child=nt,nt.return=et;tt.sibling!==null;)tt=tt.sibling,nt=nt.sibling=wh(tt,tt.pendingProps),nt.return=et;nt.sibling=null}return et.child}function zj(tt,et,nt){switch(et.tag){case 3:lj(et),Ig();break;case 5:Kh(et);break;case 1:Zf(et.type)&&cg(et);break;case 4:Ih(et,et.stateNode.containerInfo);break;case 10:var rt=et.type._context,it=et.memoizedProps.value;G$1(Mg,rt._currentValue),rt._currentValue=it;break;case 13:if(rt=et.memoizedState,rt!==null)return rt.dehydrated!==null?(G$1(M$1,M$1.current&1),et.flags|=128,null):nt&et.child.childLanes?pj(tt,et,nt):(G$1(M$1,M$1.current&1),tt=$i(tt,et,nt),tt!==null?tt.sibling:null);G$1(M$1,M$1.current&1);break;case 19:if(rt=(nt&et.childLanes)!==0,tt.flags&128){if(rt)return yj(tt,et,nt);et.flags|=128}if(it=et.memoizedState,it!==null&&(it.rendering=null,it.tail=null,it.lastEffect=null),G$1(M$1,M$1.current),rt)break;return null;case 22:case 23:return et.lanes=0,ej(tt,et,nt)}return $i(tt,et,nt)}var Aj,Bj,Cj,Dj;Aj=function(tt,et){for(var nt=et.child;nt!==null;){if(nt.tag===5||nt.tag===6)tt.appendChild(nt.stateNode);else if(nt.tag!==4&&nt.child!==null){nt.child.return=nt,nt=nt.child;continue}if(nt===et)break;for(;nt.sibling===null;){if(nt.return===null||nt.return===et)return;nt=nt.return}nt.sibling.return=nt.return,nt=nt.sibling}},Bj=function(){},Cj=function(tt,et,nt,rt){var it=tt.memoizedProps;if(it!==rt){tt=et.stateNode,Hh(Eh.current);var st=null;switch(nt){case"input":it=Ya(tt,it),rt=Ya(tt,rt),st=[];break;case"select":it=A$1({},it,{value:void 0}),rt=A$1({},rt,{value:void 0}),st=[];break;case"textarea":it=gb(tt,it),rt=gb(tt,rt),st=[];break;default:typeof it.onClick!="function"&&typeof rt.onClick=="function"&&(tt.onclick=Bf)}ub(nt,rt);var ot;nt=null;for(ct in it)if(!rt.hasOwnProperty(ct)&&it.hasOwnProperty(ct)&&it[ct]!=null)if(ct==="style"){var lt=it[ct];for(ot in lt)lt.hasOwnProperty(ot)&&(nt||(nt={}),nt[ot]="")}else ct!=="dangerouslySetInnerHTML"&&ct!=="children"&&ct!=="suppressContentEditableWarning"&&ct!=="suppressHydrationWarning"&&ct!=="autoFocus"&&(ea.hasOwnProperty(ct)?st||(st=[]):(st=st||[]).push(ct,null));for(ct in rt){var ut=rt[ct];if(lt=it!=null?it[ct]:void 0,rt.hasOwnProperty(ct)&&ut!==lt&&(ut!=null||lt!=null))if(ct==="style")if(lt){for(ot in lt)!lt.hasOwnProperty(ot)||ut&&ut.hasOwnProperty(ot)||(nt||(nt={}),nt[ot]="");for(ot in ut)ut.hasOwnProperty(ot)&&lt[ot]!==ut[ot]&&(nt||(nt={}),nt[ot]=ut[ot])}else nt||(st||(st=[]),st.push(ct,nt)),nt=ut;else ct==="dangerouslySetInnerHTML"?(ut=ut?ut.__html:void 0,lt=lt?lt.__html:void 0,ut!=null&&lt!==ut&&(st=st||[]).push(ct,ut)):ct==="children"?typeof ut!="string"&&typeof ut!="number"||(st=st||[]).push(ct,""+ut):ct!=="suppressContentEditableWarning"&&ct!=="suppressHydrationWarning"&&(ea.hasOwnProperty(ct)?(ut!=null&&ct==="onScroll"&&D$2("scroll",tt),st||lt===ut||(st=[])):(st=st||[]).push(ct,ut))}nt&&(st=st||[]).push("style",nt);var ct=st;(et.updateQueue=ct)&&(et.flags|=4)}},Dj=function(tt,et,nt,rt){nt!==rt&&(et.flags|=4)};function Ej(tt,et){if(!I$1)switch(tt.tailMode){case"hidden":et=tt.tail;for(var nt=null;et!==null;)et.alternate!==null&&(nt=et),et=et.sibling;nt===null?tt.tail=null:nt.sibling=null;break;case"collapsed":nt=tt.tail;for(var rt=null;nt!==null;)nt.alternate!==null&&(rt=nt),nt=nt.sibling;rt===null?et||tt.tail===null?tt.tail=null:tt.tail.sibling=null:rt.sibling=null}}function S$2(tt){var et=tt.alternate!==null&&tt.alternate.child===tt.child,nt=0,rt=0;if(et)for(var it=tt.child;it!==null;)nt|=it.lanes|it.childLanes,rt|=it.subtreeFlags&14680064,rt|=it.flags&14680064,it.return=tt,it=it.sibling;else for(it=tt.child;it!==null;)nt|=it.lanes|it.childLanes,rt|=it.subtreeFlags,rt|=it.flags,it.return=tt,it=it.sibling;return tt.subtreeFlags|=rt,tt.childLanes=nt,et}function Fj(tt,et,nt){var rt=et.pendingProps;switch(wg(et),et.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S$2(et),null;case 1:return Zf(et.type)&&$f(),S$2(et),null;case 3:return rt=et.stateNode,Jh(),E$1(Wf),E$1(H$1),Oh(),rt.pendingContext&&(rt.context=rt.pendingContext,rt.pendingContext=null),(tt===null||tt.child===null)&&(Gg(et)?et.flags|=4:tt===null||tt.memoizedState.isDehydrated&&!(et.flags&256)||(et.flags|=1024,zg!==null&&(Gj(zg),zg=null))),Bj(tt,et),S$2(et),null;case 5:Lh(et);var it=Hh(Gh.current);if(nt=et.type,tt!==null&&et.stateNode!=null)Cj(tt,et,nt,rt,it),tt.ref!==et.ref&&(et.flags|=512,et.flags|=2097152);else{if(!rt){if(et.stateNode===null)throw Error(p$2(166));return S$2(et),null}if(tt=Hh(Eh.current),Gg(et)){rt=et.stateNode,nt=et.type;var st=et.memoizedProps;switch(rt[Of]=et,rt[Pf]=st,tt=(et.mode&1)!==0,nt){case"dialog":D$2("cancel",rt),D$2("close",rt);break;case"iframe":case"object":case"embed":D$2("load",rt);break;case"video":case"audio":for(it=0;it<lf.length;it++)D$2(lf[it],rt);break;case"source":D$2("error",rt);break;case"img":case"image":case"link":D$2("error",rt),D$2("load",rt);break;case"details":D$2("toggle",rt);break;case"input":Za(rt,st),D$2("invalid",rt);break;case"select":rt._wrapperState={wasMultiple:!!st.multiple},D$2("invalid",rt);break;case"textarea":hb(rt,st),D$2("invalid",rt)}ub(nt,st),it=null;for(var ot in st)if(st.hasOwnProperty(ot)){var lt=st[ot];ot==="children"?typeof lt=="string"?rt.textContent!==lt&&(st.suppressHydrationWarning!==!0&&Af(rt.textContent,lt,tt),it=["children",lt]):typeof lt=="number"&&rt.textContent!==""+lt&&(st.suppressHydrationWarning!==!0&&Af(rt.textContent,lt,tt),it=["children",""+lt]):ea.hasOwnProperty(ot)&&lt!=null&&ot==="onScroll"&&D$2("scroll",rt)}switch(nt){case"input":Va(rt),db(rt,st,!0);break;case"textarea":Va(rt),jb(rt);break;case"select":case"option":break;default:typeof st.onClick=="function"&&(rt.onclick=Bf)}rt=it,et.updateQueue=rt,rt!==null&&(et.flags|=4)}else{ot=it.nodeType===9?it:it.ownerDocument,tt==="http://www.w3.org/1999/xhtml"&&(tt=kb(nt)),tt==="http://www.w3.org/1999/xhtml"?nt==="script"?(tt=ot.createElement("div"),tt.innerHTML="<script><\/script>",tt=tt.removeChild(tt.firstChild)):typeof rt.is=="string"?tt=ot.createElement(nt,{is:rt.is}):(tt=ot.createElement(nt),nt==="select"&&(ot=tt,rt.multiple?ot.multiple=!0:rt.size&&(ot.size=rt.size))):tt=ot.createElementNS(tt,nt),tt[Of]=et,tt[Pf]=rt,Aj(tt,et,!1,!1),et.stateNode=tt;e:{switch(ot=vb(nt,rt),nt){case"dialog":D$2("cancel",tt),D$2("close",tt),it=rt;break;case"iframe":case"object":case"embed":D$2("load",tt),it=rt;break;case"video":case"audio":for(it=0;it<lf.length;it++)D$2(lf[it],tt);it=rt;break;case"source":D$2("error",tt),it=rt;break;case"img":case"image":case"link":D$2("error",tt),D$2("load",tt),it=rt;break;case"details":D$2("toggle",tt),it=rt;break;case"input":Za(tt,rt),it=Ya(tt,rt),D$2("invalid",tt);break;case"option":it=rt;break;case"select":tt._wrapperState={wasMultiple:!!rt.multiple},it=A$1({},rt,{value:void 0}),D$2("invalid",tt);break;case"textarea":hb(tt,rt),it=gb(tt,rt),D$2("invalid",tt);break;default:it=rt}ub(nt,it),lt=it;for(st in lt)if(lt.hasOwnProperty(st)){var ut=lt[st];st==="style"?sb(tt,ut):st==="dangerouslySetInnerHTML"?(ut=ut?ut.__html:void 0,ut!=null&&nb(tt,ut)):st==="children"?typeof ut=="string"?(nt!=="textarea"||ut!=="")&&ob(tt,ut):typeof ut=="number"&&ob(tt,""+ut):st!=="suppressContentEditableWarning"&&st!=="suppressHydrationWarning"&&st!=="autoFocus"&&(ea.hasOwnProperty(st)?ut!=null&&st==="onScroll"&&D$2("scroll",tt):ut!=null&&ta(tt,st,ut,ot))}switch(nt){case"input":Va(tt),db(tt,rt,!1);break;case"textarea":Va(tt),jb(tt);break;case"option":rt.value!=null&&tt.setAttribute("value",""+Sa(rt.value));break;case"select":tt.multiple=!!rt.multiple,st=rt.value,st!=null?fb(tt,!!rt.multiple,st,!1):rt.defaultValue!=null&&fb(tt,!!rt.multiple,rt.defaultValue,!0);break;default:typeof it.onClick=="function"&&(tt.onclick=Bf)}switch(nt){case"button":case"input":case"select":case"textarea":rt=!!rt.autoFocus;break e;case"img":rt=!0;break e;default:rt=!1}}rt&&(et.flags|=4)}et.ref!==null&&(et.flags|=512,et.flags|=2097152)}return S$2(et),null;case 6:if(tt&&et.stateNode!=null)Dj(tt,et,tt.memoizedProps,rt);else{if(typeof rt!="string"&&et.stateNode===null)throw Error(p$2(166));if(nt=Hh(Gh.current),Hh(Eh.current),Gg(et)){if(rt=et.stateNode,nt=et.memoizedProps,rt[Of]=et,(st=rt.nodeValue!==nt)&&(tt=xg,tt!==null))switch(tt.tag){case 3:Af(rt.nodeValue,nt,(tt.mode&1)!==0);break;case 5:tt.memoizedProps.suppressHydrationWarning!==!0&&Af(rt.nodeValue,nt,(tt.mode&1)!==0)}st&&(et.flags|=4)}else rt=(nt.nodeType===9?nt:nt.ownerDocument).createTextNode(rt),rt[Of]=et,et.stateNode=rt}return S$2(et),null;case 13:if(E$1(M$1),rt=et.memoizedState,tt===null||tt.memoizedState!==null&&tt.memoizedState.dehydrated!==null){if(I$1&&yg!==null&&et.mode&1&&!(et.flags&128))Hg(),Ig(),et.flags|=98560,st=!1;else if(st=Gg(et),rt!==null&&rt.dehydrated!==null){if(tt===null){if(!st)throw Error(p$2(318));if(st=et.memoizedState,st=st!==null?st.dehydrated:null,!st)throw Error(p$2(317));st[Of]=et}else Ig(),!(et.flags&128)&&(et.memoizedState=null),et.flags|=4;S$2(et),st=!1}else zg!==null&&(Gj(zg),zg=null),st=!0;if(!st)return et.flags&65536?et:null}return et.flags&128?(et.lanes=nt,et):(rt=rt!==null,rt!==(tt!==null&&tt.memoizedState!==null)&&rt&&(et.child.flags|=8192,et.mode&1&&(tt===null||M$1.current&1?T$2===0&&(T$2=3):uj())),et.updateQueue!==null&&(et.flags|=4),S$2(et),null);case 4:return Jh(),Bj(tt,et),tt===null&&sf(et.stateNode.containerInfo),S$2(et),null;case 10:return Rg(et.type._context),S$2(et),null;case 17:return Zf(et.type)&&$f(),S$2(et),null;case 19:if(E$1(M$1),st=et.memoizedState,st===null)return S$2(et),null;if(rt=(et.flags&128)!==0,ot=st.rendering,ot===null)if(rt)Ej(st,!1);else{if(T$2!==0||tt!==null&&tt.flags&128)for(tt=et.child;tt!==null;){if(ot=Mh(tt),ot!==null){for(et.flags|=128,Ej(st,!1),rt=ot.updateQueue,rt!==null&&(et.updateQueue=rt,et.flags|=4),et.subtreeFlags=0,rt=nt,nt=et.child;nt!==null;)st=nt,tt=rt,st.flags&=14680066,ot=st.alternate,ot===null?(st.childLanes=0,st.lanes=tt,st.child=null,st.subtreeFlags=0,st.memoizedProps=null,st.memoizedState=null,st.updateQueue=null,st.dependencies=null,st.stateNode=null):(st.childLanes=ot.childLanes,st.lanes=ot.lanes,st.child=ot.child,st.subtreeFlags=0,st.deletions=null,st.memoizedProps=ot.memoizedProps,st.memoizedState=ot.memoizedState,st.updateQueue=ot.updateQueue,st.type=ot.type,tt=ot.dependencies,st.dependencies=tt===null?null:{lanes:tt.lanes,firstContext:tt.firstContext}),nt=nt.sibling;return G$1(M$1,M$1.current&1|2),et.child}tt=tt.sibling}st.tail!==null&&B$1()>Hj&&(et.flags|=128,rt=!0,Ej(st,!1),et.lanes=4194304)}else{if(!rt)if(tt=Mh(ot),tt!==null){if(et.flags|=128,rt=!0,nt=tt.updateQueue,nt!==null&&(et.updateQueue=nt,et.flags|=4),Ej(st,!0),st.tail===null&&st.tailMode==="hidden"&&!ot.alternate&&!I$1)return S$2(et),null}else 2*B$1()-st.renderingStartTime>Hj&&nt!==1073741824&&(et.flags|=128,rt=!0,Ej(st,!1),et.lanes=4194304);st.isBackwards?(ot.sibling=et.child,et.child=ot):(nt=st.last,nt!==null?nt.sibling=ot:et.child=ot,st.last=ot)}return st.tail!==null?(et=st.tail,st.rendering=et,st.tail=et.sibling,st.renderingStartTime=B$1(),et.sibling=null,nt=M$1.current,G$1(M$1,rt?nt&1|2:nt&1),et):(S$2(et),null);case 22:case 23:return Ij(),rt=et.memoizedState!==null,tt!==null&&tt.memoizedState!==null!==rt&&(et.flags|=8192),rt&&et.mode&1?gj&1073741824&&(S$2(et),et.subtreeFlags&6&&(et.flags|=8192)):S$2(et),null;case 24:return null;case 25:return null}throw Error(p$2(156,et.tag))}function Jj(tt,et){switch(wg(et),et.tag){case 1:return Zf(et.type)&&$f(),tt=et.flags,tt&65536?(et.flags=tt&-65537|128,et):null;case 3:return Jh(),E$1(Wf),E$1(H$1),Oh(),tt=et.flags,tt&65536&&!(tt&128)?(et.flags=tt&-65537|128,et):null;case 5:return Lh(et),null;case 13:if(E$1(M$1),tt=et.memoizedState,tt!==null&&tt.dehydrated!==null){if(et.alternate===null)throw Error(p$2(340));Ig()}return tt=et.flags,tt&65536?(et.flags=tt&-65537|128,et):null;case 19:return E$1(M$1),null;case 4:return Jh(),null;case 10:return Rg(et.type._context),null;case 22:case 23:return Ij(),null;case 24:return null;default:return null}}var Kj=!1,U$1=!1,Lj=typeof WeakSet=="function"?WeakSet:Set,V$1=null;function Mj(tt,et){var nt=tt.ref;if(nt!==null)if(typeof nt=="function")try{nt(null)}catch(rt){W$2(tt,et,rt)}else nt.current=null}function Nj(tt,et,nt){try{nt()}catch(rt){W$2(tt,et,rt)}}var Oj=!1;function Pj(tt,et){if(Cf=dd,tt=Me$1(),Ne$1(tt)){if("selectionStart"in tt)var nt={start:tt.selectionStart,end:tt.selectionEnd};else e:{nt=(nt=tt.ownerDocument)&&nt.defaultView||window;var rt=nt.getSelection&&nt.getSelection();if(rt&&rt.rangeCount!==0){nt=rt.anchorNode;var it=rt.anchorOffset,st=rt.focusNode;rt=rt.focusOffset;try{nt.nodeType,st.nodeType}catch{nt=null;break e}var ot=0,lt=-1,ut=-1,ct=0,dt=0,ft=tt,pt=null;t:for(;;){for(var gt;ft!==nt||it!==0&&ft.nodeType!==3||(lt=ot+it),ft!==st||rt!==0&&ft.nodeType!==3||(ut=ot+rt),ft.nodeType===3&&(ot+=ft.nodeValue.length),(gt=ft.firstChild)!==null;)pt=ft,ft=gt;for(;;){if(ft===tt)break t;if(pt===nt&&++ct===it&&(lt=ot),pt===st&&++dt===rt&&(ut=ot),(gt=ft.nextSibling)!==null)break;ft=pt,pt=ft.parentNode}ft=gt}nt=lt===-1||ut===-1?null:{start:lt,end:ut}}else nt=null}nt=nt||{start:0,end:0}}else nt=null;for(Df={focusedElem:tt,selectionRange:nt},dd=!1,V$1=et;V$1!==null;)if(et=V$1,tt=et.child,(et.subtreeFlags&1028)!==0&&tt!==null)tt.return=et,V$1=tt;else for(;V$1!==null;){et=V$1;try{var _r=et.alternate;if(et.flags&1024)switch(et.tag){case 0:case 11:case 15:break;case 1:if(_r!==null){var Yr=_r.memoizedProps,mt=_r.memoizedState,Kr=et.stateNode,Xr=Kr.getSnapshotBeforeUpdate(et.elementType===et.type?Yr:Lg(et.type,Yr),mt);Kr.__reactInternalSnapshotBeforeUpdate=Xr}break;case 3:var Zr=et.stateNode.containerInfo;Zr.nodeType===1?Zr.textContent="":Zr.nodeType===9&&Zr.documentElement&&Zr.removeChild(Zr.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p$2(163))}}catch(Qr){W$2(et,et.return,Qr)}if(tt=et.sibling,tt!==null){tt.return=et.return,V$1=tt;break}V$1=et.return}return _r=Oj,Oj=!1,_r}function Qj(tt,et,nt){var rt=et.updateQueue;if(rt=rt!==null?rt.lastEffect:null,rt!==null){var it=rt=rt.next;do{if((it.tag&tt)===tt){var st=it.destroy;it.destroy=void 0,st!==void 0&&Nj(et,nt,st)}it=it.next}while(it!==rt)}}function Rj(tt,et){if(et=et.updateQueue,et=et!==null?et.lastEffect:null,et!==null){var nt=et=et.next;do{if((nt.tag&tt)===tt){var rt=nt.create;nt.destroy=rt()}nt=nt.next}while(nt!==et)}}function Sj(tt){var et=tt.ref;if(et!==null){var nt=tt.stateNode;switch(tt.tag){case 5:tt=nt;break;default:tt=nt}typeof et=="function"?et(tt):et.current=tt}}function Tj(tt){var et=tt.alternate;et!==null&&(tt.alternate=null,Tj(et)),tt.child=null,tt.deletions=null,tt.sibling=null,tt.tag===5&&(et=tt.stateNode,et!==null&&(delete et[Of],delete et[Pf],delete et[of],delete et[Qf],delete et[Rf])),tt.stateNode=null,tt.return=null,tt.dependencies=null,tt.memoizedProps=null,tt.memoizedState=null,tt.pendingProps=null,tt.stateNode=null,tt.updateQueue=null}function Uj(tt){return tt.tag===5||tt.tag===3||tt.tag===4}function Vj(tt){e:for(;;){for(;tt.sibling===null;){if(tt.return===null||Uj(tt.return))return null;tt=tt.return}for(tt.sibling.return=tt.return,tt=tt.sibling;tt.tag!==5&&tt.tag!==6&&tt.tag!==18;){if(tt.flags&2||tt.child===null||tt.tag===4)continue e;tt.child.return=tt,tt=tt.child}if(!(tt.flags&2))return tt.stateNode}}function Wj(tt,et,nt){var rt=tt.tag;if(rt===5||rt===6)tt=tt.stateNode,et?nt.nodeType===8?nt.parentNode.insertBefore(tt,et):nt.insertBefore(tt,et):(nt.nodeType===8?(et=nt.parentNode,et.insertBefore(tt,nt)):(et=nt,et.appendChild(tt)),nt=nt._reactRootContainer,nt!=null||et.onclick!==null||(et.onclick=Bf));else if(rt!==4&&(tt=tt.child,tt!==null))for(Wj(tt,et,nt),tt=tt.sibling;tt!==null;)Wj(tt,et,nt),tt=tt.sibling}function Xj(tt,et,nt){var rt=tt.tag;if(rt===5||rt===6)tt=tt.stateNode,et?nt.insertBefore(tt,et):nt.appendChild(tt);else if(rt!==4&&(tt=tt.child,tt!==null))for(Xj(tt,et,nt),tt=tt.sibling;tt!==null;)Xj(tt,et,nt),tt=tt.sibling}var X$2=null,Yj=!1;function Zj(tt,et,nt){for(nt=nt.child;nt!==null;)ak(tt,et,nt),nt=nt.sibling}function ak(tt,et,nt){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,nt)}catch{}switch(nt.tag){case 5:U$1||Mj(nt,et);case 6:var rt=X$2,it=Yj;X$2=null,Zj(tt,et,nt),X$2=rt,Yj=it,X$2!==null&&(Yj?(tt=X$2,nt=nt.stateNode,tt.nodeType===8?tt.parentNode.removeChild(nt):tt.removeChild(nt)):X$2.removeChild(nt.stateNode));break;case 18:X$2!==null&&(Yj?(tt=X$2,nt=nt.stateNode,tt.nodeType===8?Kf(tt.parentNode,nt):tt.nodeType===1&&Kf(tt,nt),bd(tt)):Kf(X$2,nt.stateNode));break;case 4:rt=X$2,it=Yj,X$2=nt.stateNode.containerInfo,Yj=!0,Zj(tt,et,nt),X$2=rt,Yj=it;break;case 0:case 11:case 14:case 15:if(!U$1&&(rt=nt.updateQueue,rt!==null&&(rt=rt.lastEffect,rt!==null))){it=rt=rt.next;do{var st=it,ot=st.destroy;st=st.tag,ot!==void 0&&(st&2||st&4)&&Nj(nt,et,ot),it=it.next}while(it!==rt)}Zj(tt,et,nt);break;case 1:if(!U$1&&(Mj(nt,et),rt=nt.stateNode,typeof rt.componentWillUnmount=="function"))try{rt.props=nt.memoizedProps,rt.state=nt.memoizedState,rt.componentWillUnmount()}catch(lt){W$2(nt,et,lt)}Zj(tt,et,nt);break;case 21:Zj(tt,et,nt);break;case 22:nt.mode&1?(U$1=(rt=U$1)||nt.memoizedState!==null,Zj(tt,et,nt),U$1=rt):Zj(tt,et,nt);break;default:Zj(tt,et,nt)}}function bk(tt){var et=tt.updateQueue;if(et!==null){tt.updateQueue=null;var nt=tt.stateNode;nt===null&&(nt=tt.stateNode=new Lj),et.forEach(function(rt){var it=ck.bind(null,tt,rt);nt.has(rt)||(nt.add(rt),rt.then(it,it))})}}function dk(tt,et){var nt=et.deletions;if(nt!==null)for(var rt=0;rt<nt.length;rt++){var it=nt[rt];try{var st=tt,ot=et,lt=ot;e:for(;lt!==null;){switch(lt.tag){case 5:X$2=lt.stateNode,Yj=!1;break e;case 3:X$2=lt.stateNode.containerInfo,Yj=!0;break e;case 4:X$2=lt.stateNode.containerInfo,Yj=!0;break e}lt=lt.return}if(X$2===null)throw Error(p$2(160));ak(st,ot,it),X$2=null,Yj=!1;var ut=it.alternate;ut!==null&&(ut.return=null),it.return=null}catch(ct){W$2(it,et,ct)}}if(et.subtreeFlags&12854)for(et=et.child;et!==null;)ek(et,tt),et=et.sibling}function ek(tt,et){var nt=tt.alternate,rt=tt.flags;switch(tt.tag){case 0:case 11:case 14:case 15:if(dk(et,tt),fk(tt),rt&4){try{Qj(3,tt,tt.return),Rj(3,tt)}catch(Yr){W$2(tt,tt.return,Yr)}try{Qj(5,tt,tt.return)}catch(Yr){W$2(tt,tt.return,Yr)}}break;case 1:dk(et,tt),fk(tt),rt&512&&nt!==null&&Mj(nt,nt.return);break;case 5:if(dk(et,tt),fk(tt),rt&512&&nt!==null&&Mj(nt,nt.return),tt.flags&32){var it=tt.stateNode;try{ob(it,"")}catch(Yr){W$2(tt,tt.return,Yr)}}if(rt&4&&(it=tt.stateNode,it!=null)){var st=tt.memoizedProps,ot=nt!==null?nt.memoizedProps:st,lt=tt.type,ut=tt.updateQueue;if(tt.updateQueue=null,ut!==null)try{lt==="input"&&st.type==="radio"&&st.name!=null&&ab(it,st),vb(lt,ot);var ct=vb(lt,st);for(ot=0;ot<ut.length;ot+=2){var dt=ut[ot],ft=ut[ot+1];dt==="style"?sb(it,ft):dt==="dangerouslySetInnerHTML"?nb(it,ft):dt==="children"?ob(it,ft):ta(it,dt,ft,ct)}switch(lt){case"input":bb(it,st);break;case"textarea":ib(it,st);break;case"select":var pt=it._wrapperState.wasMultiple;it._wrapperState.wasMultiple=!!st.multiple;var gt=st.value;gt!=null?fb(it,!!st.multiple,gt,!1):pt!==!!st.multiple&&(st.defaultValue!=null?fb(it,!!st.multiple,st.defaultValue,!0):fb(it,!!st.multiple,st.multiple?[]:"",!1))}it[Pf]=st}catch(Yr){W$2(tt,tt.return,Yr)}}break;case 6:if(dk(et,tt),fk(tt),rt&4){if(tt.stateNode===null)throw Error(p$2(162));it=tt.stateNode,st=tt.memoizedProps;try{it.nodeValue=st}catch(Yr){W$2(tt,tt.return,Yr)}}break;case 3:if(dk(et,tt),fk(tt),rt&4&&nt!==null&&nt.memoizedState.isDehydrated)try{bd(et.containerInfo)}catch(Yr){W$2(tt,tt.return,Yr)}break;case 4:dk(et,tt),fk(tt);break;case 13:dk(et,tt),fk(tt),it=tt.child,it.flags&8192&&(st=it.memoizedState!==null,it.stateNode.isHidden=st,!st||it.alternate!==null&&it.alternate.memoizedState!==null||(gk=B$1())),rt&4&&bk(tt);break;case 22:if(dt=nt!==null&&nt.memoizedState!==null,tt.mode&1?(U$1=(ct=U$1)||dt,dk(et,tt),U$1=ct):dk(et,tt),fk(tt),rt&8192){if(ct=tt.memoizedState!==null,(tt.stateNode.isHidden=ct)&&!dt&&tt.mode&1)for(V$1=tt,dt=tt.child;dt!==null;){for(ft=V$1=dt;V$1!==null;){switch(pt=V$1,gt=pt.child,pt.tag){case 0:case 11:case 14:case 15:Qj(4,pt,pt.return);break;case 1:Mj(pt,pt.return);var _r=pt.stateNode;if(typeof _r.componentWillUnmount=="function"){rt=pt,nt=pt.return;try{et=rt,_r.props=et.memoizedProps,_r.state=et.memoizedState,_r.componentWillUnmount()}catch(Yr){W$2(rt,nt,Yr)}}break;case 5:Mj(pt,pt.return);break;case 22:if(pt.memoizedState!==null){hk(ft);continue}}gt!==null?(gt.return=pt,V$1=gt):hk(ft)}dt=dt.sibling}e:for(dt=null,ft=tt;;){if(ft.tag===5){if(dt===null){dt=ft;try{it=ft.stateNode,ct?(st=it.style,typeof st.setProperty=="function"?st.setProperty("display","none","important"):st.display="none"):(lt=ft.stateNode,ut=ft.memoizedProps.style,ot=ut!=null&&ut.hasOwnProperty("display")?ut.display:null,lt.style.display=rb("display",ot))}catch(Yr){W$2(tt,tt.return,Yr)}}}else if(ft.tag===6){if(dt===null)try{ft.stateNode.nodeValue=ct?"":ft.memoizedProps}catch(Yr){W$2(tt,tt.return,Yr)}}else if((ft.tag!==22&&ft.tag!==23||ft.memoizedState===null||ft===tt)&&ft.child!==null){ft.child.return=ft,ft=ft.child;continue}if(ft===tt)break e;for(;ft.sibling===null;){if(ft.return===null||ft.return===tt)break e;dt===ft&&(dt=null),ft=ft.return}dt===ft&&(dt=null),ft.sibling.return=ft.return,ft=ft.sibling}}break;case 19:dk(et,tt),fk(tt),rt&4&&bk(tt);break;case 21:break;default:dk(et,tt),fk(tt)}}function fk(tt){var et=tt.flags;if(et&2){try{e:{for(var nt=tt.return;nt!==null;){if(Uj(nt)){var rt=nt;break e}nt=nt.return}throw Error(p$2(160))}switch(rt.tag){case 5:var it=rt.stateNode;rt.flags&32&&(ob(it,""),rt.flags&=-33);var st=Vj(tt);Xj(tt,st,it);break;case 3:case 4:var ot=rt.stateNode.containerInfo,lt=Vj(tt);Wj(tt,lt,ot);break;default:throw Error(p$2(161))}}catch(ut){W$2(tt,tt.return,ut)}tt.flags&=-3}et&4096&&(tt.flags&=-4097)}function ik(tt,et,nt){V$1=tt,jk(tt)}function jk(tt,et,nt){for(var rt=(tt.mode&1)!==0;V$1!==null;){var it=V$1,st=it.child;if(it.tag===22&&rt){var ot=it.memoizedState!==null||Kj;if(!ot){var lt=it.alternate,ut=lt!==null&&lt.memoizedState!==null||U$1;lt=Kj;var ct=U$1;if(Kj=ot,(U$1=ut)&&!ct)for(V$1=it;V$1!==null;)ot=V$1,ut=ot.child,ot.tag===22&&ot.memoizedState!==null?kk(it):ut!==null?(ut.return=ot,V$1=ut):kk(it);for(;st!==null;)V$1=st,jk(st),st=st.sibling;V$1=it,Kj=lt,U$1=ct}lk(tt)}else it.subtreeFlags&8772&&st!==null?(st.return=it,V$1=st):lk(tt)}}function lk(tt){for(;V$1!==null;){var et=V$1;if(et.flags&8772){var nt=et.alternate;try{if(et.flags&8772)switch(et.tag){case 0:case 11:case 15:U$1||Rj(5,et);break;case 1:var rt=et.stateNode;if(et.flags&4&&!U$1)if(nt===null)rt.componentDidMount();else{var it=et.elementType===et.type?nt.memoizedProps:Lg(et.type,nt.memoizedProps);rt.componentDidUpdate(it,nt.memoizedState,rt.__reactInternalSnapshotBeforeUpdate)}var st=et.updateQueue;st!==null&&ih(et,st,rt);break;case 3:var ot=et.updateQueue;if(ot!==null){if(nt=null,et.child!==null)switch(et.child.tag){case 5:nt=et.child.stateNode;break;case 1:nt=et.child.stateNode}ih(et,ot,nt)}break;case 5:var lt=et.stateNode;if(nt===null&&et.flags&4){nt=lt;var ut=et.memoizedProps;switch(et.type){case"button":case"input":case"select":case"textarea":ut.autoFocus&&nt.focus();break;case"img":ut.src&&(nt.src=ut.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(et.memoizedState===null){var ct=et.alternate;if(ct!==null){var dt=ct.memoizedState;if(dt!==null){var ft=dt.dehydrated;ft!==null&&bd(ft)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p$2(163))}U$1||et.flags&512&&Sj(et)}catch(pt){W$2(et,et.return,pt)}}if(et===tt){V$1=null;break}if(nt=et.sibling,nt!==null){nt.return=et.return,V$1=nt;break}V$1=et.return}}function hk(tt){for(;V$1!==null;){var et=V$1;if(et===tt){V$1=null;break}var nt=et.sibling;if(nt!==null){nt.return=et.return,V$1=nt;break}V$1=et.return}}function kk(tt){for(;V$1!==null;){var et=V$1;try{switch(et.tag){case 0:case 11:case 15:var nt=et.return;try{Rj(4,et)}catch(ut){W$2(et,nt,ut)}break;case 1:var rt=et.stateNode;if(typeof rt.componentDidMount=="function"){var it=et.return;try{rt.componentDidMount()}catch(ut){W$2(et,it,ut)}}var st=et.return;try{Sj(et)}catch(ut){W$2(et,st,ut)}break;case 5:var ot=et.return;try{Sj(et)}catch(ut){W$2(et,ot,ut)}}}catch(ut){W$2(et,et.return,ut)}if(et===tt){V$1=null;break}var lt=et.sibling;if(lt!==null){lt.return=et.return,V$1=lt;break}V$1=et.return}}var mk=Math.ceil,nk=ua.ReactCurrentDispatcher,ok=ua.ReactCurrentOwner,pk=ua.ReactCurrentBatchConfig,K$2=0,R$2=null,Y$2=null,Z=0,gj=0,fj=Uf(0),T$2=0,qk=null,hh=0,rk=0,sk=0,tk=null,uk=null,gk=0,Hj=1/0,vk=null,Pi=!1,Qi=null,Si=null,wk=!1,xk=null,yk=0,zk=0,Ak=null,Bk=-1,Ck=0;function L$2(){return K$2&6?B$1():Bk!==-1?Bk:Bk=B$1()}function lh(tt){return tt.mode&1?K$2&2&&Z!==0?Z&-Z:Kg.transition!==null?(Ck===0&&(Ck=yc()),Ck):(tt=C$1,tt!==0||(tt=window.event,tt=tt===void 0?16:jd(tt.type)),tt):1}function mh(tt,et,nt,rt){if(50<zk)throw zk=0,Ak=null,Error(p$2(185));Ac(tt,nt,rt),(!(K$2&2)||tt!==R$2)&&(tt===R$2&&(!(K$2&2)&&(rk|=nt),T$2===4&&Dk(tt,Z)),Ek(tt,rt),nt===1&&K$2===0&&!(et.mode&1)&&(Hj=B$1()+500,fg&&jg()))}function Ek(tt,et){var nt=tt.callbackNode;wc(tt,et);var rt=uc(tt,tt===R$2?Z:0);if(rt===0)nt!==null&&bc(nt),tt.callbackNode=null,tt.callbackPriority=0;else if(et=rt&-rt,tt.callbackPriority!==et){if(nt!=null&&bc(nt),et===1)tt.tag===0?ig(Fk.bind(null,tt)):hg(Fk.bind(null,tt)),Jf(function(){!(K$2&6)&&jg()}),nt=null;else{switch(Dc(rt)){case 1:nt=fc;break;case 4:nt=gc;break;case 16:nt=hc;break;case 536870912:nt=jc;break;default:nt=hc}nt=Gk(nt,Hk.bind(null,tt))}tt.callbackPriority=et,tt.callbackNode=nt}}function Hk(tt,et){if(Bk=-1,Ck=0,K$2&6)throw Error(p$2(327));var nt=tt.callbackNode;if(Ik()&&tt.callbackNode!==nt)return null;var rt=uc(tt,tt===R$2?Z:0);if(rt===0)return null;if(rt&30||rt&tt.expiredLanes||et)et=Jk(tt,rt);else{et=rt;var it=K$2;K$2|=2;var st=Kk();(R$2!==tt||Z!==et)&&(vk=null,Hj=B$1()+500,Lk(tt,et));do try{Mk();break}catch(lt){Nk(tt,lt)}while(!0);Qg(),nk.current=st,K$2=it,Y$2!==null?et=0:(R$2=null,Z=0,et=T$2)}if(et!==0){if(et===2&&(it=xc(tt),it!==0&&(rt=it,et=Ok(tt,it))),et===1)throw nt=qk,Lk(tt,0),Dk(tt,rt),Ek(tt,B$1()),nt;if(et===6)Dk(tt,rt);else{if(it=tt.current.alternate,!(rt&30)&&!Pk(it)&&(et=Jk(tt,rt),et===2&&(st=xc(tt),st!==0&&(rt=st,et=Ok(tt,st))),et===1))throw nt=qk,Lk(tt,0),Dk(tt,rt),Ek(tt,B$1()),nt;switch(tt.finishedWork=it,tt.finishedLanes=rt,et){case 0:case 1:throw Error(p$2(345));case 2:Qk(tt,uk,vk);break;case 3:if(Dk(tt,rt),(rt&130023424)===rt&&(et=gk+500-B$1(),10<et)){if(uc(tt,0)!==0)break;if(it=tt.suspendedLanes,(it&rt)!==rt){L$2(),tt.pingedLanes|=tt.suspendedLanes&it;break}tt.timeoutHandle=Ff(Qk.bind(null,tt,uk,vk),et);break}Qk(tt,uk,vk);break;case 4:if(Dk(tt,rt),(rt&4194240)===rt)break;for(et=tt.eventTimes,it=-1;0<rt;){var ot=31-oc(rt);st=1<<ot,ot=et[ot],ot>it&&(it=ot),rt&=~st}if(rt=it,rt=B$1()-rt,rt=(120>rt?120:480>rt?480:1080>rt?1080:1920>rt?1920:3e3>rt?3e3:4320>rt?4320:1960*mk(rt/1960))-rt,10<rt){tt.timeoutHandle=Ff(Qk.bind(null,tt,uk,vk),rt);break}Qk(tt,uk,vk);break;case 5:Qk(tt,uk,vk);break;default:throw Error(p$2(329))}}}return Ek(tt,B$1()),tt.callbackNode===nt?Hk.bind(null,tt):null}function Ok(tt,et){var nt=tk;return tt.current.memoizedState.isDehydrated&&(Lk(tt,et).flags|=256),tt=Jk(tt,et),tt!==2&&(et=uk,uk=nt,et!==null&&Gj(et)),tt}function Gj(tt){uk===null?uk=tt:uk.push.apply(uk,tt)}function Pk(tt){for(var et=tt;;){if(et.flags&16384){var nt=et.updateQueue;if(nt!==null&&(nt=nt.stores,nt!==null))for(var rt=0;rt<nt.length;rt++){var it=nt[rt],st=it.getSnapshot;it=it.value;try{if(!He$1(st(),it))return!1}catch{return!1}}}if(nt=et.child,et.subtreeFlags&16384&&nt!==null)nt.return=et,et=nt;else{if(et===tt)break;for(;et.sibling===null;){if(et.return===null||et.return===tt)return!0;et=et.return}et.sibling.return=et.return,et=et.sibling}}return!0}function Dk(tt,et){for(et&=~sk,et&=~rk,tt.suspendedLanes|=et,tt.pingedLanes&=~et,tt=tt.expirationTimes;0<et;){var nt=31-oc(et),rt=1<<nt;tt[nt]=-1,et&=~rt}}function Fk(tt){if(K$2&6)throw Error(p$2(327));Ik();var et=uc(tt,0);if(!(et&1))return Ek(tt,B$1()),null;var nt=Jk(tt,et);if(tt.tag!==0&&nt===2){var rt=xc(tt);rt!==0&&(et=rt,nt=Ok(tt,rt))}if(nt===1)throw nt=qk,Lk(tt,0),Dk(tt,et),Ek(tt,B$1()),nt;if(nt===6)throw Error(p$2(345));return tt.finishedWork=tt.current.alternate,tt.finishedLanes=et,Qk(tt,uk,vk),Ek(tt,B$1()),null}function Rk(tt,et){var nt=K$2;K$2|=1;try{return tt(et)}finally{K$2=nt,K$2===0&&(Hj=B$1()+500,fg&&jg())}}function Sk(tt){xk!==null&&xk.tag===0&&!(K$2&6)&&Ik();var et=K$2;K$2|=1;var nt=pk.transition,rt=C$1;try{if(pk.transition=null,C$1=1,tt)return tt()}finally{C$1=rt,pk.transition=nt,K$2=et,!(K$2&6)&&jg()}}function Ij(){gj=fj.current,E$1(fj)}function Lk(tt,et){tt.finishedWork=null,tt.finishedLanes=0;var nt=tt.timeoutHandle;if(nt!==-1&&(tt.timeoutHandle=-1,Gf(nt)),Y$2!==null)for(nt=Y$2.return;nt!==null;){var rt=nt;switch(wg(rt),rt.tag){case 1:rt=rt.type.childContextTypes,rt!=null&&$f();break;case 3:Jh(),E$1(Wf),E$1(H$1),Oh();break;case 5:Lh(rt);break;case 4:Jh();break;case 13:E$1(M$1);break;case 19:E$1(M$1);break;case 10:Rg(rt.type._context);break;case 22:case 23:Ij()}nt=nt.return}if(R$2=tt,Y$2=tt=wh(tt.current,null),Z=gj=et,T$2=0,qk=null,sk=rk=hh=0,uk=tk=null,Wg!==null){for(et=0;et<Wg.length;et++)if(nt=Wg[et],rt=nt.interleaved,rt!==null){nt.interleaved=null;var it=rt.next,st=nt.pending;if(st!==null){var ot=st.next;st.next=it,rt.next=ot}nt.pending=rt}Wg=null}return tt}function Nk(tt,et){do{var nt=Y$2;try{if(Qg(),Ph.current=ai,Sh){for(var rt=N$2.memoizedState;rt!==null;){var it=rt.queue;it!==null&&(it.pending=null),rt=rt.next}Sh=!1}if(Rh=0,P$1=O$2=N$2=null,Th=!1,Uh=0,ok.current=null,nt===null||nt.return===null){T$2=1,qk=et,Y$2=null;break}e:{var st=tt,ot=nt.return,lt=nt,ut=et;if(et=Z,lt.flags|=32768,ut!==null&&typeof ut=="object"&&typeof ut.then=="function"){var ct=ut,dt=lt,ft=dt.tag;if(!(dt.mode&1)&&(ft===0||ft===11||ft===15)){var pt=dt.alternate;pt?(dt.updateQueue=pt.updateQueue,dt.memoizedState=pt.memoizedState,dt.lanes=pt.lanes):(dt.updateQueue=null,dt.memoizedState=null)}var gt=Vi(ot);if(gt!==null){gt.flags&=-257,Wi(gt,ot,lt,st,et),gt.mode&1&&Ti(st,ct,et),et=gt,ut=ct;var _r=et.updateQueue;if(_r===null){var Yr=new Set;Yr.add(ut),et.updateQueue=Yr}else _r.add(ut);break e}else{if(!(et&1)){Ti(st,ct,et),uj();break e}ut=Error(p$2(426))}}else if(I$1&&lt.mode&1){var mt=Vi(ot);if(mt!==null){!(mt.flags&65536)&&(mt.flags|=256),Wi(mt,ot,lt,st,et),Jg(Ki(ut,lt));break e}}st=ut=Ki(ut,lt),T$2!==4&&(T$2=2),tk===null?tk=[st]:tk.push(st),st=ot;do{switch(st.tag){case 3:st.flags|=65536,et&=-et,st.lanes|=et;var Kr=Oi(st,ut,et);fh(st,Kr);break e;case 1:lt=ut;var Xr=st.type,Zr=st.stateNode;if(!(st.flags&128)&&(typeof Xr.getDerivedStateFromError=="function"||Zr!==null&&typeof Zr.componentDidCatch=="function"&&(Si===null||!Si.has(Zr)))){st.flags|=65536,et&=-et,st.lanes|=et;var Qr=Ri(st,lt,et);fh(st,Qr);break e}}st=st.return}while(st!==null)}Tk(nt)}catch(_i){et=_i,Y$2===nt&&nt!==null&&(Y$2=nt=nt.return);continue}break}while(!0)}function Kk(){var tt=nk.current;return nk.current=ai,tt===null?ai:tt}function uj(){(T$2===0||T$2===3||T$2===2)&&(T$2=4),R$2===null||!(hh&268435455)&&!(rk&268435455)||Dk(R$2,Z)}function Jk(tt,et){var nt=K$2;K$2|=2;var rt=Kk();(R$2!==tt||Z!==et)&&(vk=null,Lk(tt,et));do try{Uk();break}catch(it){Nk(tt,it)}while(!0);if(Qg(),K$2=nt,nk.current=rt,Y$2!==null)throw Error(p$2(261));return R$2=null,Z=0,T$2}function Uk(){for(;Y$2!==null;)Vk(Y$2)}function Mk(){for(;Y$2!==null&&!cc();)Vk(Y$2)}function Vk(tt){var et=Wk(tt.alternate,tt,gj);tt.memoizedProps=tt.pendingProps,et===null?Tk(tt):Y$2=et,ok.current=null}function Tk(tt){var et=tt;do{var nt=et.alternate;if(tt=et.return,et.flags&32768){if(nt=Jj(nt,et),nt!==null){nt.flags&=32767,Y$2=nt;return}if(tt!==null)tt.flags|=32768,tt.subtreeFlags=0,tt.deletions=null;else{T$2=6,Y$2=null;return}}else if(nt=Fj(nt,et,gj),nt!==null){Y$2=nt;return}if(et=et.sibling,et!==null){Y$2=et;return}Y$2=et=tt}while(et!==null);T$2===0&&(T$2=5)}function Qk(tt,et,nt){var rt=C$1,it=pk.transition;try{pk.transition=null,C$1=1,Xk(tt,et,nt,rt)}finally{pk.transition=it,C$1=rt}return null}function Xk(tt,et,nt,rt){do Ik();while(xk!==null);if(K$2&6)throw Error(p$2(327));nt=tt.finishedWork;var it=tt.finishedLanes;if(nt===null)return null;if(tt.finishedWork=null,tt.finishedLanes=0,nt===tt.current)throw Error(p$2(177));tt.callbackNode=null,tt.callbackPriority=0;var st=nt.lanes|nt.childLanes;if(Bc(tt,st),tt===R$2&&(Y$2=R$2=null,Z=0),!(nt.subtreeFlags&2064)&&!(nt.flags&2064)||wk||(wk=!0,Gk(hc,function(){return Ik(),null})),st=(nt.flags&15990)!==0,nt.subtreeFlags&15990||st){st=pk.transition,pk.transition=null;var ot=C$1;C$1=1;var lt=K$2;K$2|=4,ok.current=null,Pj(tt,nt),ek(nt,tt),Oe$1(Df),dd=!!Cf,Df=Cf=null,tt.current=nt,ik(nt),dc(),K$2=lt,C$1=ot,pk.transition=st}else tt.current=nt;if(wk&&(wk=!1,xk=tt,yk=it),st=tt.pendingLanes,st===0&&(Si=null),mc(nt.stateNode),Ek(tt,B$1()),et!==null)for(rt=tt.onRecoverableError,nt=0;nt<et.length;nt++)it=et[nt],rt(it.value,{componentStack:it.stack,digest:it.digest});if(Pi)throw Pi=!1,tt=Qi,Qi=null,tt;return yk&1&&tt.tag!==0&&Ik(),st=tt.pendingLanes,st&1?tt===Ak?zk++:(zk=0,Ak=tt):zk=0,jg(),null}function Ik(){if(xk!==null){var tt=Dc(yk),et=pk.transition,nt=C$1;try{if(pk.transition=null,C$1=16>tt?16:tt,xk===null)var rt=!1;else{if(tt=xk,xk=null,yk=0,K$2&6)throw Error(p$2(331));var it=K$2;for(K$2|=4,V$1=tt.current;V$1!==null;){var st=V$1,ot=st.child;if(V$1.flags&16){var lt=st.deletions;if(lt!==null){for(var ut=0;ut<lt.length;ut++){var ct=lt[ut];for(V$1=ct;V$1!==null;){var dt=V$1;switch(dt.tag){case 0:case 11:case 15:Qj(8,dt,st)}var ft=dt.child;if(ft!==null)ft.return=dt,V$1=ft;else for(;V$1!==null;){dt=V$1;var pt=dt.sibling,gt=dt.return;if(Tj(dt),dt===ct){V$1=null;break}if(pt!==null){pt.return=gt,V$1=pt;break}V$1=gt}}}var _r=st.alternate;if(_r!==null){var Yr=_r.child;if(Yr!==null){_r.child=null;do{var mt=Yr.sibling;Yr.sibling=null,Yr=mt}while(Yr!==null)}}V$1=st}}if(st.subtreeFlags&2064&&ot!==null)ot.return=st,V$1=ot;else e:for(;V$1!==null;){if(st=V$1,st.flags&2048)switch(st.tag){case 0:case 11:case 15:Qj(9,st,st.return)}var Kr=st.sibling;if(Kr!==null){Kr.return=st.return,V$1=Kr;break e}V$1=st.return}}var Xr=tt.current;for(V$1=Xr;V$1!==null;){ot=V$1;var Zr=ot.child;if(ot.subtreeFlags&2064&&Zr!==null)Zr.return=ot,V$1=Zr;else e:for(ot=Xr;V$1!==null;){if(lt=V$1,lt.flags&2048)try{switch(lt.tag){case 0:case 11:case 15:Rj(9,lt)}}catch(_i){W$2(lt,lt.return,_i)}if(lt===ot){V$1=null;break e}var Qr=lt.sibling;if(Qr!==null){Qr.return=lt.return,V$1=Qr;break e}V$1=lt.return}}if(K$2=it,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,tt)}catch{}rt=!0}return rt}finally{C$1=nt,pk.transition=et}}return!1}function Yk(tt,et,nt){et=Ki(nt,et),et=Oi(tt,et,1),tt=dh(tt,et,1),et=L$2(),tt!==null&&(Ac(tt,1,et),Ek(tt,et))}function W$2(tt,et,nt){if(tt.tag===3)Yk(tt,tt,nt);else for(;et!==null;){if(et.tag===3){Yk(et,tt,nt);break}else if(et.tag===1){var rt=et.stateNode;if(typeof et.type.getDerivedStateFromError=="function"||typeof rt.componentDidCatch=="function"&&(Si===null||!Si.has(rt))){tt=Ki(nt,tt),tt=Ri(et,tt,1),et=dh(et,tt,1),tt=L$2(),et!==null&&(Ac(et,1,tt),Ek(et,tt));break}}et=et.return}}function Ui(tt,et,nt){var rt=tt.pingCache;rt!==null&&rt.delete(et),et=L$2(),tt.pingedLanes|=tt.suspendedLanes&nt,R$2===tt&&(Z&nt)===nt&&(T$2===4||T$2===3&&(Z&130023424)===Z&&500>B$1()-gk?Lk(tt,0):sk|=nt),Ek(tt,et)}function Zk(tt,et){et===0&&(tt.mode&1?(et=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):et=1);var nt=L$2();tt=Zg(tt,et),tt!==null&&(Ac(tt,et,nt),Ek(tt,nt))}function vj(tt){var et=tt.memoizedState,nt=0;et!==null&&(nt=et.retryLane),Zk(tt,nt)}function ck(tt,et){var nt=0;switch(tt.tag){case 13:var rt=tt.stateNode,it=tt.memoizedState;it!==null&&(nt=it.retryLane);break;case 19:rt=tt.stateNode;break;default:throw Error(p$2(314))}rt!==null&&rt.delete(et),Zk(tt,nt)}var Wk;Wk=function(tt,et,nt){if(tt!==null)if(tt.memoizedProps!==et.pendingProps||Wf.current)Ug=!0;else{if(!(tt.lanes&nt)&&!(et.flags&128))return Ug=!1,zj(tt,et,nt);Ug=!!(tt.flags&131072)}else Ug=!1,I$1&&et.flags&1048576&&ug(et,ng,et.index);switch(et.lanes=0,et.tag){case 2:var rt=et.type;jj(tt,et),tt=et.pendingProps;var it=Yf(et,H$1.current);Tg(et,nt),it=Xh(null,et,rt,tt,it,nt);var st=bi();return et.flags|=1,typeof it=="object"&&it!==null&&typeof it.render=="function"&&it.$$typeof===void 0?(et.tag=1,et.memoizedState=null,et.updateQueue=null,Zf(rt)?(st=!0,cg(et)):st=!1,et.memoizedState=it.state!==null&&it.state!==void 0?it.state:null,ah(et),it.updater=nh,et.stateNode=it,it._reactInternals=et,rh(et,rt,tt,nt),et=kj(null,et,rt,!0,st,nt)):(et.tag=0,I$1&&st&&vg(et),Yi(null,et,it,nt),et=et.child),et;case 16:rt=et.elementType;e:{switch(jj(tt,et),tt=et.pendingProps,it=rt._init,rt=it(rt._payload),et.type=rt,it=et.tag=$k(rt),tt=Lg(rt,tt),it){case 0:et=dj(null,et,rt,tt,nt);break e;case 1:et=ij(null,et,rt,tt,nt);break e;case 11:et=Zi(null,et,rt,tt,nt);break e;case 14:et=aj(null,et,rt,Lg(rt.type,tt),nt);break e}throw Error(p$2(306,rt,""))}return et;case 0:return rt=et.type,it=et.pendingProps,it=et.elementType===rt?it:Lg(rt,it),dj(tt,et,rt,it,nt);case 1:return rt=et.type,it=et.pendingProps,it=et.elementType===rt?it:Lg(rt,it),ij(tt,et,rt,it,nt);case 3:e:{if(lj(et),tt===null)throw Error(p$2(387));rt=et.pendingProps,st=et.memoizedState,it=st.element,bh(tt,et),gh(et,rt,null,nt);var ot=et.memoizedState;if(rt=ot.element,st.isDehydrated)if(st={element:rt,isDehydrated:!1,cache:ot.cache,pendingSuspenseBoundaries:ot.pendingSuspenseBoundaries,transitions:ot.transitions},et.updateQueue.baseState=st,et.memoizedState=st,et.flags&256){it=Ki(Error(p$2(423)),et),et=mj(tt,et,rt,nt,it);break e}else if(rt!==it){it=Ki(Error(p$2(424)),et),et=mj(tt,et,rt,nt,it);break e}else for(yg=Lf(et.stateNode.containerInfo.firstChild),xg=et,I$1=!0,zg=null,nt=Ch(et,null,rt,nt),et.child=nt;nt;)nt.flags=nt.flags&-3|4096,nt=nt.sibling;else{if(Ig(),rt===it){et=$i(tt,et,nt);break e}Yi(tt,et,rt,nt)}et=et.child}return et;case 5:return Kh(et),tt===null&&Eg(et),rt=et.type,it=et.pendingProps,st=tt!==null?tt.memoizedProps:null,ot=it.children,Ef(rt,it)?ot=null:st!==null&&Ef(rt,st)&&(et.flags|=32),hj(tt,et),Yi(tt,et,ot,nt),et.child;case 6:return tt===null&&Eg(et),null;case 13:return pj(tt,et,nt);case 4:return Ih(et,et.stateNode.containerInfo),rt=et.pendingProps,tt===null?et.child=Bh(et,null,rt,nt):Yi(tt,et,rt,nt),et.child;case 11:return rt=et.type,it=et.pendingProps,it=et.elementType===rt?it:Lg(rt,it),Zi(tt,et,rt,it,nt);case 7:return Yi(tt,et,et.pendingProps,nt),et.child;case 8:return Yi(tt,et,et.pendingProps.children,nt),et.child;case 12:return Yi(tt,et,et.pendingProps.children,nt),et.child;case 10:e:{if(rt=et.type._context,it=et.pendingProps,st=et.memoizedProps,ot=it.value,G$1(Mg,rt._currentValue),rt._currentValue=ot,st!==null)if(He$1(st.value,ot)){if(st.children===it.children&&!Wf.current){et=$i(tt,et,nt);break e}}else for(st=et.child,st!==null&&(st.return=et);st!==null;){var lt=st.dependencies;if(lt!==null){ot=st.child;for(var ut=lt.firstContext;ut!==null;){if(ut.context===rt){if(st.tag===1){ut=ch(-1,nt&-nt),ut.tag=2;var ct=st.updateQueue;if(ct!==null){ct=ct.shared;var dt=ct.pending;dt===null?ut.next=ut:(ut.next=dt.next,dt.next=ut),ct.pending=ut}}st.lanes|=nt,ut=st.alternate,ut!==null&&(ut.lanes|=nt),Sg(st.return,nt,et),lt.lanes|=nt;break}ut=ut.next}}else if(st.tag===10)ot=st.type===et.type?null:st.child;else if(st.tag===18){if(ot=st.return,ot===null)throw Error(p$2(341));ot.lanes|=nt,lt=ot.alternate,lt!==null&&(lt.lanes|=nt),Sg(ot,nt,et),ot=st.sibling}else ot=st.child;if(ot!==null)ot.return=st;else for(ot=st;ot!==null;){if(ot===et){ot=null;break}if(st=ot.sibling,st!==null){st.return=ot.return,ot=st;break}ot=ot.return}st=ot}Yi(tt,et,it.children,nt),et=et.child}return et;case 9:return it=et.type,rt=et.pendingProps.children,Tg(et,nt),it=Vg(it),rt=rt(it),et.flags|=1,Yi(tt,et,rt,nt),et.child;case 14:return rt=et.type,it=Lg(rt,et.pendingProps),it=Lg(rt.type,it),aj(tt,et,rt,it,nt);case 15:return cj(tt,et,et.type,et.pendingProps,nt);case 17:return rt=et.type,it=et.pendingProps,it=et.elementType===rt?it:Lg(rt,it),jj(tt,et),et.tag=1,Zf(rt)?(tt=!0,cg(et)):tt=!1,Tg(et,nt),ph(et,rt,it),rh(et,rt,it,nt),kj(null,et,rt,!0,tt,nt);case 19:return yj(tt,et,nt);case 22:return ej(tt,et,nt)}throw Error(p$2(156,et.tag))};function Gk(tt,et){return ac(tt,et)}function al(tt,et,nt,rt){this.tag=tt,this.key=nt,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=et,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=rt,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(tt,et,nt,rt){return new al(tt,et,nt,rt)}function bj(tt){return tt=tt.prototype,!(!tt||!tt.isReactComponent)}function $k(tt){if(typeof tt=="function")return bj(tt)?1:0;if(tt!=null){if(tt=tt.$$typeof,tt===Da)return 11;if(tt===Ga)return 14}return 2}function wh(tt,et){var nt=tt.alternate;return nt===null?(nt=Bg(tt.tag,et,tt.key,tt.mode),nt.elementType=tt.elementType,nt.type=tt.type,nt.stateNode=tt.stateNode,nt.alternate=tt,tt.alternate=nt):(nt.pendingProps=et,nt.type=tt.type,nt.flags=0,nt.subtreeFlags=0,nt.deletions=null),nt.flags=tt.flags&14680064,nt.childLanes=tt.childLanes,nt.lanes=tt.lanes,nt.child=tt.child,nt.memoizedProps=tt.memoizedProps,nt.memoizedState=tt.memoizedState,nt.updateQueue=tt.updateQueue,et=tt.dependencies,nt.dependencies=et===null?null:{lanes:et.lanes,firstContext:et.firstContext},nt.sibling=tt.sibling,nt.index=tt.index,nt.ref=tt.ref,nt}function yh(tt,et,nt,rt,it,st){var ot=2;if(rt=tt,typeof tt=="function")bj(tt)&&(ot=1);else if(typeof tt=="string")ot=5;else e:switch(tt){case ya:return Ah(nt.children,it,st,et);case za:ot=8,it|=8;break;case Aa:return tt=Bg(12,nt,et,it|2),tt.elementType=Aa,tt.lanes=st,tt;case Ea:return tt=Bg(13,nt,et,it),tt.elementType=Ea,tt.lanes=st,tt;case Fa:return tt=Bg(19,nt,et,it),tt.elementType=Fa,tt.lanes=st,tt;case Ia:return qj(nt,it,st,et);default:if(typeof tt=="object"&&tt!==null)switch(tt.$$typeof){case Ba:ot=10;break e;case Ca:ot=9;break e;case Da:ot=11;break e;case Ga:ot=14;break e;case Ha:ot=16,rt=null;break e}throw Error(p$2(130,tt==null?tt:typeof tt,""))}return et=Bg(ot,nt,et,it),et.elementType=tt,et.type=rt,et.lanes=st,et}function Ah(tt,et,nt,rt){return tt=Bg(7,tt,rt,et),tt.lanes=nt,tt}function qj(tt,et,nt,rt){return tt=Bg(22,tt,rt,et),tt.elementType=Ia,tt.lanes=nt,tt.stateNode={isHidden:!1},tt}function xh(tt,et,nt){return tt=Bg(6,tt,null,et),tt.lanes=nt,tt}function zh(tt,et,nt){return et=Bg(4,tt.children!==null?tt.children:[],tt.key,et),et.lanes=nt,et.stateNode={containerInfo:tt.containerInfo,pendingChildren:null,implementation:tt.implementation},et}function bl(tt,et,nt,rt,it){this.tag=et,this.containerInfo=tt,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=rt,this.onRecoverableError=it,this.mutableSourceEagerHydrationData=null}function cl(tt,et,nt,rt,it,st,ot,lt,ut){return tt=new bl(tt,et,nt,lt,ut),et===1?(et=1,st===!0&&(et|=8)):et=0,st=Bg(3,null,null,et),tt.current=st,st.stateNode=tt,st.memoizedState={element:rt,isDehydrated:nt,cache:null,transitions:null,pendingSuspenseBoundaries:null},ah(st),tt}function dl(tt,et,nt){var rt=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:rt==null?null:""+rt,children:tt,containerInfo:et,implementation:nt}}function el(tt){if(!tt)return Vf;tt=tt._reactInternals;e:{if(Vb(tt)!==tt||tt.tag!==1)throw Error(p$2(170));var et=tt;do{switch(et.tag){case 3:et=et.stateNode.context;break e;case 1:if(Zf(et.type)){et=et.stateNode.__reactInternalMemoizedMergedChildContext;break e}}et=et.return}while(et!==null);throw Error(p$2(171))}if(tt.tag===1){var nt=tt.type;if(Zf(nt))return bg(tt,nt,et)}return et}function fl(tt,et,nt,rt,it,st,ot,lt,ut){return tt=cl(nt,rt,!0,tt,it,st,ot,lt,ut),tt.context=el(null),nt=tt.current,rt=L$2(),it=lh(nt),st=ch(rt,it),st.callback=et??null,dh(nt,st,it),tt.current.lanes=it,Ac(tt,it,rt),Ek(tt,rt),tt}function gl(tt,et,nt,rt){var it=et.current,st=L$2(),ot=lh(it);return nt=el(nt),et.context===null?et.context=nt:et.pendingContext=nt,et=ch(st,ot),et.payload={element:tt},rt=rt===void 0?null:rt,rt!==null&&(et.callback=rt),tt=dh(it,et,ot),tt!==null&&(mh(tt,it,ot,st),eh(tt,it,ot)),ot}function hl(tt){if(tt=tt.current,!tt.child)return null;switch(tt.child.tag){case 5:return tt.child.stateNode;default:return tt.child.stateNode}}function il(tt,et){if(tt=tt.memoizedState,tt!==null&&tt.dehydrated!==null){var nt=tt.retryLane;tt.retryLane=nt!==0&&nt<et?nt:et}}function jl(tt,et){il(tt,et),(tt=tt.alternate)&&il(tt,et)}function kl(){return null}var ll=typeof reportError=="function"?reportError:function(tt){console.error(tt)};function ml(tt){this._internalRoot=tt}nl.prototype.render=ml.prototype.render=function(tt){var et=this._internalRoot;if(et===null)throw Error(p$2(409));gl(tt,et,null,null)},nl.prototype.unmount=ml.prototype.unmount=function(){var tt=this._internalRoot;if(tt!==null){this._internalRoot=null;var et=tt.containerInfo;Sk(function(){gl(null,tt,null,null)}),et[uf]=null}};function nl(tt){this._internalRoot=tt}nl.prototype.unstable_scheduleHydration=function(tt){if(tt){var et=Hc();tt={blockedOn:null,target:tt,priority:et};for(var nt=0;nt<Qc.length&&et!==0&&et<Qc[nt].priority;nt++);Qc.splice(nt,0,tt),nt===0&&Vc(tt)}};function ol(tt){return!(!tt||tt.nodeType!==1&&tt.nodeType!==9&&tt.nodeType!==11)}function pl(tt){return!(!tt||tt.nodeType!==1&&tt.nodeType!==9&&tt.nodeType!==11&&(tt.nodeType!==8||tt.nodeValue!==" react-mount-point-unstable "))}function ql(){}function rl(tt,et,nt,rt,it){if(it){if(typeof rt=="function"){var st=rt;rt=function(){var ct=hl(ot);st.call(ct)}}var ot=fl(et,rt,tt,0,null,!1,!1,"",ql);return tt._reactRootContainer=ot,tt[uf]=ot.current,sf(tt.nodeType===8?tt.parentNode:tt),Sk(),ot}for(;it=tt.lastChild;)tt.removeChild(it);if(typeof rt=="function"){var lt=rt;rt=function(){var ct=hl(ut);lt.call(ct)}}var ut=cl(tt,0,!1,null,null,!1,!1,"",ql);return tt._reactRootContainer=ut,tt[uf]=ut.current,sf(tt.nodeType===8?tt.parentNode:tt),Sk(function(){gl(et,ut,nt,rt)}),ut}function sl(tt,et,nt,rt,it){var st=nt._reactRootContainer;if(st){var ot=st;if(typeof it=="function"){var lt=it;it=function(){var ut=hl(ot);lt.call(ut)}}gl(et,ot,tt,it)}else ot=rl(nt,et,tt,it,rt);return hl(ot)}Ec=function(tt){switch(tt.tag){case 3:var et=tt.stateNode;if(et.current.memoizedState.isDehydrated){var nt=tc(et.pendingLanes);nt!==0&&(Cc(et,nt|1),Ek(et,B$1()),!(K$2&6)&&(Hj=B$1()+500,jg()))}break;case 13:Sk(function(){var rt=Zg(tt,1);if(rt!==null){var it=L$2();mh(rt,tt,1,it)}}),jl(tt,1)}},Fc=function(tt){if(tt.tag===13){var et=Zg(tt,134217728);if(et!==null){var nt=L$2();mh(et,tt,134217728,nt)}jl(tt,134217728)}},Gc=function(tt){if(tt.tag===13){var et=lh(tt),nt=Zg(tt,et);if(nt!==null){var rt=L$2();mh(nt,tt,et,rt)}jl(tt,et)}},Hc=function(){return C$1},Ic=function(tt,et){var nt=C$1;try{return C$1=tt,et()}finally{C$1=nt}},yb=function(tt,et,nt){switch(et){case"input":if(bb(tt,nt),et=nt.name,nt.type==="radio"&&et!=null){for(nt=tt;nt.parentNode;)nt=nt.parentNode;for(nt=nt.querySelectorAll("input[name="+JSON.stringify(""+et)+'][type="radio"]'),et=0;et<nt.length;et++){var rt=nt[et];if(rt!==tt&&rt.form===tt.form){var it=Db(rt);if(!it)throw Error(p$2(90));Wa(rt),bb(rt,it)}}}break;case"textarea":ib(tt,nt);break;case"select":et=nt.value,et!=null&&fb(tt,!!nt.multiple,et,!1)}},Gb=Rk,Hb=Sk;var tl={usingClientEntryPoint:!1,Events:[Cb,ue$1,Db,Eb,Fb,Rk]},ul={findFiberByHostInstance:Wc,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},vl={bundleType:ul.bundleType,version:ul.version,rendererPackageName:ul.rendererPackageName,rendererConfig:ul.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(tt){return tt=Zb(tt),tt===null?null:tt.stateNode},findFiberByHostInstance:ul.findFiberByHostInstance||kl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wl.isDisabled&&wl.supportsFiber)try{kc=wl.inject(vl),lc=wl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl,reactDom_production_min.createPortal=function(tt,et){var nt=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ol(et))throw Error(p$2(200));return dl(tt,et,null,nt)},reactDom_production_min.createRoot=function(tt,et){if(!ol(tt))throw Error(p$2(299));var nt=!1,rt="",it=ll;return et!=null&&(et.unstable_strictMode===!0&&(nt=!0),et.identifierPrefix!==void 0&&(rt=et.identifierPrefix),et.onRecoverableError!==void 0&&(it=et.onRecoverableError)),et=cl(tt,1,!1,null,null,nt,!1,rt,it),tt[uf]=et.current,sf(tt.nodeType===8?tt.parentNode:tt),new ml(et)},reactDom_production_min.findDOMNode=function(tt){if(tt==null)return null;if(tt.nodeType===1)return tt;var et=tt._reactInternals;if(et===void 0)throw typeof tt.render=="function"?Error(p$2(188)):(tt=Object.keys(tt).join(","),Error(p$2(268,tt)));return tt=Zb(et),tt=tt===null?null:tt.stateNode,tt},reactDom_production_min.flushSync=function(tt){return Sk(tt)},reactDom_production_min.hydrate=function(tt,et,nt){if(!pl(et))throw Error(p$2(200));return sl(null,tt,et,!0,nt)},reactDom_production_min.hydrateRoot=function(tt,et,nt){if(!ol(tt))throw Error(p$2(405));var rt=nt!=null&&nt.hydratedSources||null,it=!1,st="",ot=ll;if(nt!=null&&(nt.unstable_strictMode===!0&&(it=!0),nt.identifierPrefix!==void 0&&(st=nt.identifierPrefix),nt.onRecoverableError!==void 0&&(ot=nt.onRecoverableError)),et=fl(et,null,tt,1,nt??null,it,!1,st,ot),tt[uf]=et.current,sf(tt),rt)for(tt=0;tt<rt.length;tt++)nt=rt[tt],it=nt._getVersion,it=it(nt._source),et.mutableSourceEagerHydrationData==null?et.mutableSourceEagerHydrationData=[nt,it]:et.mutableSourceEagerHydrationData.push(nt,it);return new nl(et)},reactDom_production_min.render=function(tt,et,nt){if(!pl(et))throw Error(p$2(200));return sl(null,tt,et,!1,nt)},reactDom_production_min.unmountComponentAtNode=function(tt){if(!pl(tt))throw Error(p$2(40));return tt._reactRootContainer?(Sk(function(){sl(null,null,tt,!1,function(){tt._reactRootContainer=null,tt[uf]=null})}),!0):!1},reactDom_production_min.unstable_batchedUpdates=Rk,reactDom_production_min.unstable_renderSubtreeIntoContainer=function(tt,et,nt,rt){if(!pl(nt))throw Error(p$2(200));if(tt==null||tt._reactInternals===void 0)throw Error(p$2(38));return sl(tt,et,nt,!1,rt)},reactDom_production_min.version="18.2.0-next-9e3b772b8-20220608";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(tt){console.error(tt)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports;const $7SXl2$reactdom=getDefaultExportFromCjs$1(reactDomExports),$5e63c961fc1ce211$export$8c6ed5c666ac1360=N$3((tt,et)=>{const{children:nt,...rt}=tt,it=A$2.toArray(nt),st=it.find($5e63c961fc1ce211$var$isSlottable);if(st){const ot=st.props.children,lt=it.map(ut=>ut===st?A$2.count(ot)>1?A$2.only(null):fn$1(ot)?ot.props.children:null:ut);return y$3($5e63c961fc1ce211$var$SlotClone,_extends$1({},rt,{ref:et}),fn$1(ot)?sn$1(ot,void 0,lt):null)}return y$3($5e63c961fc1ce211$var$SlotClone,_extends$1({},rt,{ref:et}),nt)});$5e63c961fc1ce211$export$8c6ed5c666ac1360.displayName="Slot";const $5e63c961fc1ce211$var$SlotClone=N$3((tt,et)=>{const{children:nt,...rt}=tt;return fn$1(nt)?sn$1(nt,{...$5e63c961fc1ce211$var$mergeProps(rt,nt.props),ref:et?$6ed0406888f73fc4$export$43e446d32b3d21af(et,nt.ref):nt.ref}):A$2.count(nt)>1?A$2.only(null):null});$5e63c961fc1ce211$var$SlotClone.displayName="SlotClone";const $5e63c961fc1ce211$export$d9f1ccf0bdb05d45=({children:tt})=>y$3(g$3,null,tt);function $5e63c961fc1ce211$var$isSlottable(tt){return fn$1(tt)&&tt.type===$5e63c961fc1ce211$export$d9f1ccf0bdb05d45}function $5e63c961fc1ce211$var$mergeProps(tt,et){const nt={...et};for(const rt in et){const it=tt[rt],st=et[rt];/^on[A-Z]/.test(rt)?it&&st?nt[rt]=(...lt)=>{st(...lt),it(...lt)}:it&&(nt[rt]=it):rt==="style"?nt[rt]={...it,...st}:rt==="className"&&(nt[rt]=[it,st].filter(Boolean).join(" "))}return{...tt,...nt}}const $8927f6f2acc4f386$var$NODES=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],$8927f6f2acc4f386$export$250ffa63cdc0d034=$8927f6f2acc4f386$var$NODES.reduce((tt,et)=>{const nt=N$3((rt,it)=>{const{asChild:st,...ot}=rt,lt=st?$5e63c961fc1ce211$export$8c6ed5c666ac1360:et;return _$1(()=>{window[Symbol.for("radix-ui")]=!0},[]),y$3(lt,_extends$1({},ot,{ref:it}))});return nt.displayName=`Primitive.${et}`,{...tt,[et]:nt}},{});function $8927f6f2acc4f386$export$6d1a0317bde7de7f(tt,et){tt&&reactDomExports.flushSync(()=>tt.dispatchEvent(et))}function $fe963b355347cc68$export$3e6543de14f8614f(tt,et){return y$2((nt,rt)=>{const it=et[nt][rt];return it??nt},tt)}const $921a889cee6df7e8$export$99c2b779aa4e8b8b=tt=>{const{present:et,children:nt}=tt,rt=$921a889cee6df7e8$var$usePresence(et),it=typeof nt=="function"?nt({present:rt.isPresent}):A$2.only(nt),st=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(rt.ref,it.ref);return typeof nt=="function"||rt.isPresent?sn$1(it,{ref:st}):null};$921a889cee6df7e8$export$99c2b779aa4e8b8b.displayName="Presence";function $921a889cee6df7e8$var$usePresence(tt){const[et,nt]=p$3(),rt=F$2({}),it=F$2(tt),st=F$2("none"),ot=tt?"mounted":"unmounted",[lt,ut]=$fe963b355347cc68$export$3e6543de14f8614f(ot,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return _$1(()=>{const ct=$921a889cee6df7e8$var$getAnimationName(rt.current);st.current=lt==="mounted"?ct:"none"},[lt]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{const ct=rt.current,dt=it.current;if(dt!==tt){const pt=st.current,gt=$921a889cee6df7e8$var$getAnimationName(ct);tt?ut("MOUNT"):gt==="none"||(ct==null?void 0:ct.display)==="none"?ut("UNMOUNT"):ut(dt&&pt!==gt?"ANIMATION_OUT":"UNMOUNT"),it.current=tt}},[tt,ut]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(et){const ct=ft=>{const gt=$921a889cee6df7e8$var$getAnimationName(rt.current).includes(ft.animationName);ft.target===et&&gt&&reactDomExports.flushSync(()=>ut("ANIMATION_END"))},dt=ft=>{ft.target===et&&(st.current=$921a889cee6df7e8$var$getAnimationName(rt.current))};return et.addEventListener("animationstart",dt),et.addEventListener("animationcancel",ct),et.addEventListener("animationend",ct),()=>{et.removeEventListener("animationstart",dt),et.removeEventListener("animationcancel",ct),et.removeEventListener("animationend",ct)}}else ut("ANIMATION_END")},[et,ut]),{isPresent:["mounted","unmountSuspended"].includes(lt),ref:x$3(ct=>{ct&&(rt.current=getComputedStyle(ct)),nt(ct)},[])}}function $921a889cee6df7e8$var$getAnimationName(tt){return(tt==null?void 0:tt.animationName)||"none"}const $1746a345f3d73bb7$var$useReactId=$2AODx$react.useId||(()=>{});let $1746a345f3d73bb7$var$count=0;function $1746a345f3d73bb7$export$f680877a34711e37(tt){const[et,nt]=p$3($1746a345f3d73bb7$var$useReactId());return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{tt||nt(rt=>rt??String($1746a345f3d73bb7$var$count++))},[tt]),tt||(et?`radix-${et}`:"")}const $409067139f391064$var$COLLAPSIBLE_NAME="Collapsible",[$409067139f391064$var$createCollapsibleContext,$409067139f391064$export$952b32dcbe73087a]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($409067139f391064$var$COLLAPSIBLE_NAME),[$409067139f391064$var$CollapsibleProvider,$409067139f391064$var$useCollapsibleContext]=$409067139f391064$var$createCollapsibleContext($409067139f391064$var$COLLAPSIBLE_NAME),$409067139f391064$export$6eb0f7ddcda6131f=N$3((tt,et)=>{const{__scopeCollapsible:nt,open:rt,defaultOpen:it,disabled:st,onOpenChange:ot,...lt}=tt,[ut=!1,ct]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:rt,defaultProp:it,onChange:ot});return y$3($409067139f391064$var$CollapsibleProvider,{scope:nt,disabled:st,contentId:$1746a345f3d73bb7$export$f680877a34711e37(),open:ut,onOpenToggle:x$3(()=>ct(dt=>!dt),[ct])},y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-state":$409067139f391064$var$getState(ut),"data-disabled":st?"":void 0},lt,{ref:et})))}),$409067139f391064$var$TRIGGER_NAME="CollapsibleTrigger",$409067139f391064$export$c135dce7b15bbbdc=N$3((tt,et)=>{const{__scopeCollapsible:nt,...rt}=tt,it=$409067139f391064$var$useCollapsibleContext($409067139f391064$var$TRIGGER_NAME,nt);return y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button","aria-controls":it.contentId,"aria-expanded":it.open||!1,"data-state":$409067139f391064$var$getState(it.open),"data-disabled":it.disabled?"":void 0,disabled:it.disabled},rt,{ref:et,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onClick,it.onOpenToggle)}))}),$409067139f391064$var$CONTENT_NAME="CollapsibleContent",$409067139f391064$export$aadde00976f34151=N$3((tt,et)=>{const{forceMount:nt,...rt}=tt,it=$409067139f391064$var$useCollapsibleContext($409067139f391064$var$CONTENT_NAME,tt.__scopeCollapsible);return y$3($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:nt||it.open},({present:st})=>y$3($409067139f391064$var$CollapsibleContentImpl,_extends$1({},rt,{ref:et,present:st})))}),$409067139f391064$var$CollapsibleContentImpl=N$3((tt,et)=>{const{__scopeCollapsible:nt,present:rt,children:it,...st}=tt,ot=$409067139f391064$var$useCollapsibleContext($409067139f391064$var$CONTENT_NAME,nt),[lt,ut]=p$3(rt),ct=F$2(null),dt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,ct),ft=F$2(0),pt=ft.current,gt=F$2(0),_r=gt.current,Yr=ot.open||lt,mt=F$2(Yr),Kr=F$2();return _$1(()=>{const Xr=requestAnimationFrame(()=>mt.current=!1);return()=>cancelAnimationFrame(Xr)},[]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{const Xr=ct.current;if(Xr){Kr.current=Kr.current||{transitionDuration:Xr.style.transitionDuration,animationName:Xr.style.animationName},Xr.style.transitionDuration="0s",Xr.style.animationName="none";const Zr=Xr.getBoundingClientRect();ft.current=Zr.height,gt.current=Zr.width,mt.current||(Xr.style.transitionDuration=Kr.current.transitionDuration,Xr.style.animationName=Kr.current.animationName),ut(rt)}},[ot.open,rt]),y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-state":$409067139f391064$var$getState(ot.open),"data-disabled":ot.disabled?"":void 0,id:ot.contentId,hidden:!Yr},st,{ref:dt,style:{"--radix-collapsible-content-height":pt?`${pt}px`:void 0,"--radix-collapsible-content-width":_r?`${_r}px`:void 0,...tt.style}}),Yr&&it)});function $409067139f391064$var$getState(tt){return tt?"open":"closed"}const $409067139f391064$export$be92b6f5f03c0fe9=$409067139f391064$export$6eb0f7ddcda6131f,$409067139f391064$export$41fb9f06171c75f4=$409067139f391064$export$c135dce7b15bbbdc,$409067139f391064$export$7c6e2c02157bb7d2=$409067139f391064$export$aadde00976f34151,ErrorBoundaryContext=G$3(null),initialState={didCatch:!1,error:null};class ErrorBoundary extends b$2{constructor(et){super(et),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=initialState}static getDerivedStateFromError(et){return{didCatch:!0,error:et}}resetErrorBoundary(){const{error:et}=this.state;if(et!==null){for(var nt,rt,it=arguments.length,st=new Array(it),ot=0;ot<it;ot++)st[ot]=arguments[ot];(nt=(rt=this.props).onReset)===null||nt===void 0||nt.call(rt,{args:st,reason:"imperative-api"}),this.setState(initialState)}}componentDidCatch(et,nt){var rt,it;(rt=(it=this.props).onError)===null||rt===void 0||rt.call(it,et,nt)}componentDidUpdate(et,nt){const{didCatch:rt}=this.state,{resetKeys:it}=this.props;if(rt&&nt.error!==null&&hasArrayChanged(et.resetKeys,it)){var st,ot;(st=(ot=this.props).onReset)===null||st===void 0||st.call(ot,{next:it,prev:et.resetKeys,reason:"keys"}),this.setState(initialState)}}render(){const{children:et,fallbackRender:nt,FallbackComponent:rt,fallback:it}=this.props,{didCatch:st,error:ot}=this.state;let lt=et;if(st){const ut={error:ot,resetErrorBoundary:this.resetErrorBoundary};if(typeof nt=="function")lt=nt(ut);else if(rt)lt=y$3(rt,ut);else if(it===null||fn$1(it))lt=it;else throw ot}return y$3(ErrorBoundaryContext.Provider,{value:{didCatch:st,error:ot,resetErrorBoundary:this.resetErrorBoundary}},lt)}}function hasArrayChanged(){let tt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],et=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return tt.length!==et.length||tt.some((nt,rt)=>!Object.is(nt,et[rt]))}var e="colors",t="sizes",r$1="space",n={gap:r$1,gridGap:r$1,columnGap:r$1,gridColumnGap:r$1,rowGap:r$1,gridRowGap:r$1,inset:r$1,insetBlock:r$1,insetBlockEnd:r$1,insetBlockStart:r$1,insetInline:r$1,insetInlineEnd:r$1,insetInlineStart:r$1,margin:r$1,marginTop:r$1,marginRight:r$1,marginBottom:r$1,marginLeft:r$1,marginBlock:r$1,marginBlockEnd:r$1,marginBlockStart:r$1,marginInline:r$1,marginInlineEnd:r$1,marginInlineStart:r$1,padding:r$1,paddingTop:r$1,paddingRight:r$1,paddingBottom:r$1,paddingLeft:r$1,paddingBlock:r$1,paddingBlockEnd:r$1,paddingBlockStart:r$1,paddingInline:r$1,paddingInlineEnd:r$1,paddingInlineStart:r$1,top:r$1,right:r$1,bottom:r$1,left:r$1,scrollMargin:r$1,scrollMarginTop:r$1,scrollMarginRight:r$1,scrollMarginBottom:r$1,scrollMarginLeft:r$1,scrollMarginX:r$1,scrollMarginY:r$1,scrollMarginBlock:r$1,scrollMarginBlockEnd:r$1,scrollMarginBlockStart:r$1,scrollMarginInline:r$1,scrollMarginInlineEnd:r$1,scrollMarginInlineStart:r$1,scrollPadding:r$1,scrollPaddingTop:r$1,scrollPaddingRight:r$1,scrollPaddingBottom:r$1,scrollPaddingLeft:r$1,scrollPaddingX:r$1,scrollPaddingY:r$1,scrollPaddingBlock:r$1,scrollPaddingBlockEnd:r$1,scrollPaddingBlockStart:r$1,scrollPaddingInline:r$1,scrollPaddingInlineEnd:r$1,scrollPaddingInlineStart:r$1,fontSize:"fontSizes",background:e,backgroundColor:e,backgroundImage:e,borderImage:e,border:e,borderBlock:e,borderBlockEnd:e,borderBlockStart:e,borderBottom:e,borderBottomColor:e,borderColor:e,borderInline:e,borderInlineEnd:e,borderInlineStart:e,borderLeft:e,borderLeftColor:e,borderRight:e,borderRightColor:e,borderTop:e,borderTopColor:e,caretColor:e,color:e,columnRuleColor:e,fill:e,outline:e,outlineColor:e,stroke:e,textDecorationColor:e,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:t,minBlockSize:t,maxBlockSize:t,inlineSize:t,minInlineSize:t,maxInlineSize:t,width:t,minWidth:t,maxWidth:t,height:t,minHeight:t,maxHeight:t,flexBasis:t,gridTemplateColumns:t,gridTemplateRows:t,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},i$1=(tt,et)=>typeof et=="function"?{"()":Function.prototype.toString.call(et)}:et,o=()=>{const tt=Object.create(null);return(et,nt,...rt)=>{const it=(st=>JSON.stringify(st,i$1))(et);return it in tt?tt[it]:tt[it]=nt(et,...rt)}},l$1=Symbol.for("sxs.internal"),s$1=(tt,et)=>Object.defineProperties(tt,Object.getOwnPropertyDescriptors(et)),a$1=tt=>{for(const et in tt)return!0;return!1},{hasOwnProperty:c$1}=Object.prototype,d=tt=>tt.includes("-")?tt:tt.replace(/[A-Z]/g,et=>"-"+et.toLowerCase()),g=/\s+(?![^()]*\))/,p$1=tt=>et=>tt(...typeof et=="string"?String(et).split(g):[et]),u$1={appearance:tt=>({WebkitAppearance:tt,appearance:tt}),backfaceVisibility:tt=>({WebkitBackfaceVisibility:tt,backfaceVisibility:tt}),backdropFilter:tt=>({WebkitBackdropFilter:tt,backdropFilter:tt}),backgroundClip:tt=>({WebkitBackgroundClip:tt,backgroundClip:tt}),boxDecorationBreak:tt=>({WebkitBoxDecorationBreak:tt,boxDecorationBreak:tt}),clipPath:tt=>({WebkitClipPath:tt,clipPath:tt}),content:tt=>({content:tt.includes('"')||tt.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(tt)?tt:`"${tt}"`}),hyphens:tt=>({WebkitHyphens:tt,hyphens:tt}),maskImage:tt=>({WebkitMaskImage:tt,maskImage:tt}),maskSize:tt=>({WebkitMaskSize:tt,maskSize:tt}),tabSize:tt=>({MozTabSize:tt,tabSize:tt}),textSizeAdjust:tt=>({WebkitTextSizeAdjust:tt,textSizeAdjust:tt}),userSelect:tt=>({WebkitUserSelect:tt,userSelect:tt}),marginBlock:p$1((tt,et)=>({marginBlockStart:tt,marginBlockEnd:et||tt})),marginInline:p$1((tt,et)=>({marginInlineStart:tt,marginInlineEnd:et||tt})),maxSize:p$1((tt,et)=>({maxBlockSize:tt,maxInlineSize:et||tt})),minSize:p$1((tt,et)=>({minBlockSize:tt,minInlineSize:et||tt})),paddingBlock:p$1((tt,et)=>({paddingBlockStart:tt,paddingBlockEnd:et||tt})),paddingInline:p$1((tt,et)=>({paddingInlineStart:tt,paddingInlineEnd:et||tt}))},h=/([\d.]+)([^]*)/,f=(tt,et)=>tt.length?tt.reduce((nt,rt)=>(nt.push(...et.map(it=>it.includes("&")?it.replace(/&/g,/[ +>|~]/.test(rt)&&/&.*&/.test(it)?`:is(${rt})`:rt):rt+" "+it)),nt),[]):et,m$1=(tt,et)=>tt in b&&typeof et=="string"?et.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(nt,rt,it,st)=>rt+(it==="stretch"?`-moz-available${st};${d(tt)}:${rt}-webkit-fill-available`:`-moz-fit-content${st};${d(tt)}:${rt}fit-content`)+st):String(et),b={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},S$1=tt=>tt?tt+"-":"",k$1=(tt,et,nt)=>tt.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(rt,it,st,ot,lt)=>ot=="$"==!!st?rt:(it||ot=="--"?"calc(":"")+"var(--"+(ot==="$"?S$1(et)+(lt.includes("$")?"":S$1(nt))+lt.replace(/\$/g,"-"):lt)+")"+(it||ot=="--"?"*"+(it||"")+(st||"1")+")":"")),y=/\s*,\s*(?![^()]*\))/,B=Object.prototype.toString,$=(tt,et,nt,rt,it)=>{let st,ot,lt;const ut=(ct,dt,ft)=>{let pt,gt;const _r=Yr=>{for(pt in Yr){const Xr=pt.charCodeAt(0)===64,Zr=Xr&&Array.isArray(Yr[pt])?Yr[pt]:[Yr[pt]];for(gt of Zr){const Qr=/[A-Z]/.test(Kr=pt)?Kr:Kr.replace(/-[^]/g,rs=>rs[1].toUpperCase()),_i=typeof gt=="object"&&gt&&gt.toString===B&&(!rt.utils[Qr]||!dt.length);if(Qr in rt.utils&&!_i){const rs=rt.utils[Qr];if(rs!==ot){ot=rs,_r(rs(gt)),ot=null;continue}}else if(Qr in u$1){const rs=u$1[Qr];if(rs!==lt){lt=rs,_r(rs(gt)),lt=null;continue}}if(Xr&&(mt=pt.slice(1)in rt.media?"@media "+rt.media[pt.slice(1)]:pt,pt=mt.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(rs,ns,ss,fs,os,is)=>{const cs=h.test(ns),ps=.0625*(cs?-1:1),[vs,ls]=cs?[fs,ns]:[ns,fs];return"("+(ss[0]==="="?"":ss[0]===">"===cs?"max-":"min-")+vs+":"+(ss[0]!=="="&&ss.length===1?ls.replace(h,(gs,us,ms)=>Number(us)+ps*(ss===">"?1:-1)+ms):ls)+(os?") and ("+(os[0]===">"?"min-":"max-")+vs+":"+(os.length===1?is.replace(h,(gs,us,ms)=>Number(us)+ps*(os===">"?-1:1)+ms):is):"")+")"})),_i){const rs=Xr?ft.concat(pt):[...ft],ns=Xr?[...dt]:f(dt,pt.split(y));st!==void 0&&it(x$1(...st)),st=void 0,ut(gt,ns,rs)}else st===void 0&&(st=[[],dt,ft]),pt=Xr||pt.charCodeAt(0)!==36?pt:`--${S$1(rt.prefix)}${pt.slice(1).replace(/\$/g,"-")}`,gt=_i?gt:typeof gt=="number"?gt&&Qr in I?String(gt)+"px":String(gt):k$1(m$1(Qr,gt??""),rt.prefix,rt.themeMap[Qr]),st[0].push(`${Xr?`${pt} `:`${d(pt)}:`}${gt}`)}}var mt,Kr};_r(ct),st!==void 0&&it(x$1(...st)),st=void 0};ut(tt,et,nt)},x$1=(tt,et,nt)=>`${nt.map(rt=>`${rt}{`).join("")}${et.length?`${et.join(",")}{`:""}${tt.join(";")}${et.length?"}":""}${Array(nt.length?nt.length+1:0).join("}")}`,I={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},R$1=tt=>String.fromCharCode(tt+(tt>25?39:97)),z$1=tt=>(et=>{let nt,rt="";for(nt=Math.abs(et);nt>52;nt=nt/52|0)rt=R$1(nt%52)+rt;return R$1(nt%52)+rt})(((et,nt)=>{let rt=nt.length;for(;rt;)et=33*et^nt.charCodeAt(--rt);return et})(5381,JSON.stringify(tt))>>>0),W$1=["themed","global","styled","onevar","resonevar","allvar","inline"],j$1=tt=>{if(tt.href&&!tt.href.startsWith(location.origin))return!1;try{return!!tt.cssRules}catch{return!1}},E=tt=>{let et;const nt=()=>{const{cssRules:it}=et.sheet;return[].map.call(it,(st,ot)=>{const{cssText:lt}=st;let ut="";if(lt.startsWith("--sxs"))return"";if(it[ot-1]&&(ut=it[ot-1].cssText).startsWith("--sxs")){if(!st.cssRules.length)return"";for(const ct in et.rules)if(et.rules[ct].group===st)return`--sxs{--sxs:${[...et.rules[ct].cache].join(" ")}}${lt}`;return st.cssRules.length?`${ut}${lt}`:""}return lt}).join("")},rt=()=>{if(et){const{rules:lt,sheet:ut}=et;if(!ut.deleteRule){for(;Object(Object(ut.cssRules)[0]).type===3;)ut.cssRules.splice(0,1);ut.cssRules=[]}for(const ct in lt)delete lt[ct]}const it=Object(tt).styleSheets||[];for(const lt of it)if(j$1(lt)){for(let ut=0,ct=lt.cssRules;ct[ut];++ut){const dt=Object(ct[ut]);if(dt.type!==1)continue;const ft=Object(ct[ut+1]);if(ft.type!==4)continue;++ut;const{cssText:pt}=dt;if(!pt.startsWith("--sxs"))continue;const gt=pt.slice(14,-3).trim().split(/\s+/),_r=W$1[gt[0]];_r&&(et||(et={sheet:lt,reset:rt,rules:{},toString:nt}),et.rules[_r]={group:ft,index:ut,cache:new Set(gt)})}if(et)break}if(!et){const lt=(ut,ct)=>({type:ct,cssRules:[],insertRule(dt,ft){this.cssRules.splice(ft,0,lt(dt,{import:3,undefined:1}[(dt.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return ut==="@media{}"?`@media{${[].map.call(this.cssRules,dt=>dt.cssText).join("")}}`:ut}});et={sheet:tt?(tt.head||tt).appendChild(document.createElement("style")).sheet:lt("","text/css"),rules:{},reset:rt,toString:nt}}const{sheet:st,rules:ot}=et;for(let lt=W$1.length-1;lt>=0;--lt){const ut=W$1[lt];if(!ot[ut]){const ct=W$1[lt+1],dt=ot[ct]?ot[ct].index:st.cssRules.length;st.insertRule("@media{}",dt),st.insertRule(`--sxs{--sxs:${lt}}`,dt),ot[ut]={group:st.cssRules[dt+1],index:dt,cache:new Set([lt])}}v(ot[ut])}};return rt(),et},v=tt=>{const et=tt.group;let nt=et.cssRules.length;tt.apply=rt=>{try{et.insertRule(rt,nt),++nt}catch{}}},T$1=Symbol(),w=o(),M=(tt,et)=>w(tt,()=>(...nt)=>{let rt={type:null,composers:new Set};for(const it of nt)if(it!=null)if(it[l$1]){rt.type==null&&(rt.type=it[l$1].type);for(const st of it[l$1].composers)rt.composers.add(st)}else it.constructor!==Object||it.$$typeof?rt.type==null&&(rt.type=it):rt.composers.add(C(it,tt));return rt.type==null&&(rt.type="span"),rt.composers.size||rt.composers.add(["PJLV",{},[],[],{},[]]),P(tt,rt,et)}),C=({variants:tt,compoundVariants:et,defaultVariants:nt,...rt},it)=>{const st=`${S$1(it.prefix)}c-${z$1(rt)}`,ot=[],lt=[],ut=Object.create(null),ct=[];for(const pt in nt)ut[pt]=String(nt[pt]);if(typeof tt=="object"&&tt)for(const pt in tt){dt=ut,ft=pt,c$1.call(dt,ft)||(ut[pt]="undefined");const gt=tt[pt];for(const _r in gt){const Yr={[pt]:String(_r)};String(_r)==="undefined"&&ct.push(pt);const mt=gt[_r],Kr=[Yr,mt,!a$1(mt)];ot.push(Kr)}}var dt,ft;if(typeof et=="object"&&et)for(const pt of et){let{css:gt,..._r}=pt;gt=typeof gt=="object"&&gt||{};for(const mt in _r)_r[mt]=String(_r[mt]);const Yr=[_r,gt,!a$1(gt)];lt.push(Yr)}return[st,rt,ot,lt,ut,ct]},P=(tt,et,nt)=>{const[rt,it,st,ot]=L$1(et.composers),lt=typeof et.type=="function"||et.type.$$typeof?(ft=>{function pt(){for(let gt=0;gt<pt[T$1].length;gt++){const[_r,Yr]=pt[T$1][gt];ft.rules[_r].apply(Yr)}return pt[T$1]=[],null}return pt[T$1]=[],pt.rules={},W$1.forEach(gt=>pt.rules[gt]={apply:_r=>pt[T$1].push([gt,_r])}),pt})(nt):null,ut=(lt||nt).rules,ct=`.${rt}${it.length>1?`:where(.${it.slice(1).join(".")})`:""}`,dt=ft=>{ft=typeof ft=="object"&&ft||A;const{css:pt,...gt}=ft,_r={};for(const Kr in st)if(delete gt[Kr],Kr in ft){let Xr=ft[Kr];typeof Xr=="object"&&Xr?_r[Kr]={"@initial":st[Kr],...Xr}:(Xr=String(Xr),_r[Kr]=Xr!=="undefined"||ot.has(Kr)?Xr:st[Kr])}else _r[Kr]=st[Kr];const Yr=new Set([...it]);for(const[Kr,Xr,Zr,Qr]of et.composers){nt.rules.styled.cache.has(Kr)||(nt.rules.styled.cache.add(Kr),$(Xr,[`.${Kr}`],[],tt,ns=>{ut.styled.apply(ns)}));const _i=O$1(Zr,_r,tt.media),rs=O$1(Qr,_r,tt.media,!0);for(const ns of _i)if(ns!==void 0)for(const[ss,fs,os]of ns){const is=`${Kr}-${z$1(fs)}-${ss}`;Yr.add(is);const cs=(os?nt.rules.resonevar:nt.rules.onevar).cache,ps=os?ut.resonevar:ut.onevar;cs.has(is)||(cs.add(is),$(fs,[`.${is}`],[],tt,vs=>{ps.apply(vs)}))}for(const ns of rs)if(ns!==void 0)for(const[ss,fs]of ns){const os=`${Kr}-${z$1(fs)}-${ss}`;Yr.add(os),nt.rules.allvar.cache.has(os)||(nt.rules.allvar.cache.add(os),$(fs,[`.${os}`],[],tt,is=>{ut.allvar.apply(is)}))}}if(typeof pt=="object"&&pt){const Kr=`${rt}-i${z$1(pt)}-css`;Yr.add(Kr),nt.rules.inline.cache.has(Kr)||(nt.rules.inline.cache.add(Kr),$(pt,[`.${Kr}`],[],tt,Xr=>{ut.inline.apply(Xr)}))}for(const Kr of String(ft.className||"").trim().split(/\s+/))Kr&&Yr.add(Kr);const mt=gt.className=[...Yr].join(" ");return{type:et.type,className:mt,selector:ct,props:gt,toString:()=>mt,deferredInjector:lt}};return s$1(dt,{className:rt,selector:ct,[l$1]:et,toString:()=>(nt.rules.styled.cache.has(rt)||dt(),rt)})},L$1=tt=>{let et="";const nt=[],rt={},it=[];for(const[st,,,,ot,lt]of tt){et===""&&(et=st),nt.push(st),it.push(...lt);for(const ut in ot){const ct=ot[ut];(rt[ut]===void 0||ct!=="undefined"||lt.includes(ct))&&(rt[ut]=ct)}}return[et,nt,rt,new Set(it)]},O$1=(tt,et,nt,rt)=>{const it=[];e:for(let[st,ot,lt]of tt){if(lt)continue;let ut,ct=0,dt=!1;for(ut in st){const ft=st[ut];let pt=et[ut];if(pt!==ft){if(typeof pt!="object"||!pt)continue e;{let gt,_r,Yr=0;for(const mt in pt){if(ft===String(pt[mt])){if(mt!=="@initial"){const Kr=mt.slice(1);(_r=_r||[]).push(Kr in nt?nt[Kr]:mt.replace(/^@media ?/,"")),dt=!0}ct+=Yr,gt=!0}++Yr}if(_r&&_r.length&&(ot={["@media "+_r.join(", ")]:ot}),!gt)continue e}}}(it[ct]=it[ct]||[]).push([rt?"cv":`${ut}-${st[ut]}`,ot,dt])}return it},A={},N$1=o(),D$1=(tt,et)=>N$1(tt,()=>(...nt)=>{const rt=()=>{for(let it of nt){it=typeof it=="object"&&it||{};let st=z$1(it);if(!et.rules.global.cache.has(st)){if(et.rules.global.cache.add(st),"@import"in it){let ot=[].indexOf.call(et.sheet.cssRules,et.rules.themed.group)-1;for(let lt of[].concat(it["@import"]))lt=lt.includes('"')||lt.includes("'")?lt:`"${lt}"`,et.sheet.insertRule(`@import ${lt};`,ot++);delete it["@import"]}$(it,[],[],tt,ot=>{et.rules.global.apply(ot)})}}return""};return s$1(rt,{toString:rt})}),H=o(),V=(tt,et)=>H(tt,()=>nt=>{const rt=`${S$1(tt.prefix)}k-${z$1(nt)}`,it=()=>{if(!et.rules.global.cache.has(rt)){et.rules.global.cache.add(rt);const st=[];$(nt,[],[],tt,lt=>st.push(lt));const ot=`@keyframes ${rt}{${st.join("")}}`;et.rules.global.apply(ot)}return rt};return s$1(it,{get name(){return it()},toString:it})}),G=class{constructor(tt,et,nt,rt){this.token=tt==null?"":String(tt),this.value=et==null?"":String(et),this.scale=nt==null?"":String(nt),this.prefix=rt==null?"":String(rt)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+S$1(this.prefix)+S$1(this.scale)+this.token}toString(){return this.computedValue}},F=o(),J$1=(tt,et)=>F(tt,()=>(nt,rt)=>{rt=typeof nt=="object"&&nt||Object(rt);const it=`.${nt=(nt=typeof nt=="string"?nt:"")||`${S$1(tt.prefix)}t-${z$1(rt)}`}`,st={},ot=[];for(const ut in rt){st[ut]={};for(const ct in rt[ut]){const dt=`--${S$1(tt.prefix)}${ut}-${ct}`,ft=k$1(String(rt[ut][ct]),tt.prefix,ut);st[ut][ct]=new G(ct,ft,ut,tt.prefix),ot.push(`${dt}:${ft}`)}}const lt=()=>{if(ot.length&&!et.rules.themed.cache.has(nt)){et.rules.themed.cache.add(nt);const ut=`${rt===tt.theme?":root,":""}.${nt}{${ot.join(";")}}`;et.rules.themed.apply(ut)}return nt};return{...st,get className(){return lt()},selector:it,toString:lt}}),U=o(),X$1,Y$1=o(),q=tt=>{const et=(nt=>{let rt=!1;const it=U(nt,st=>{rt=!0;const ot="prefix"in(st=typeof st=="object"&&st||{})?String(st.prefix):"",lt=typeof st.media=="object"&&st.media||{},ut=typeof st.root=="object"?st.root||null:globalThis.document||null,ct=typeof st.theme=="object"&&st.theme||{},dt={prefix:ot,media:lt,theme:ct,themeMap:typeof st.themeMap=="object"&&st.themeMap||{...n},utils:typeof st.utils=="object"&&st.utils||{}},ft=E(ut),pt={css:M(dt,ft),globalCss:D$1(dt,ft),keyframes:V(dt,ft),createTheme:J$1(dt,ft),reset(){ft.reset(),pt.theme.toString()},theme:{},sheet:ft,config:dt,prefix:ot,getCssText:ft.toString,toString:ft.toString};return String(pt.theme=pt.createTheme(ct)),pt});return rt||it.reset(),it})(tt);return et.styled=(({config:nt,sheet:rt})=>Y$1(nt,()=>{const it=M(nt,rt);return(...st)=>{const ot=it(...st),lt=ot[l$1].type,ut=wn$1.forwardRef((ct,dt)=>{const ft=ct&&ct.as||lt,{props:pt,deferredInjector:gt}=ot(ct);return delete pt.as,pt.ref=dt,gt?wn$1.createElement(wn$1.Fragment,null,wn$1.createElement(ft,pt),wn$1.createElement(gt,null)):wn$1.createElement(ft,pt)});return ut.className=ot.className,ut.displayName=`Styled.${lt.displayName||lt.name||lt}`,ut.selector=ot.selector,ut.toString=()=>ot.selector,ut[l$1]=ot[l$1],ut}}))(et),et},K$1=()=>X$1||(X$1=q()),Q$1=(...tt)=>K$1().createTheme(...tt);function $e02a7d9cb1dc128c$export$c74125a8e3af6bb2(tt){const et=tt+"CollectionProvider",[nt,rt]=$c512c27ab02ef895$export$50c7b4e9d9f19c1(et),[it,st]=nt(et,{collectionRef:{current:null},itemMap:new Map}),ot=gt=>{const{scope:_r,children:Yr}=gt,mt=wn$1.useRef(null),Kr=wn$1.useRef(new Map).current;return wn$1.createElement(it,{scope:_r,itemMap:Kr,collectionRef:mt},Yr)},lt=tt+"CollectionSlot",ut=wn$1.forwardRef((gt,_r)=>{const{scope:Yr,children:mt}=gt,Kr=st(lt,Yr),Xr=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_r,Kr.collectionRef);return wn$1.createElement($5e63c961fc1ce211$export$8c6ed5c666ac1360,{ref:Xr},mt)}),ct=tt+"CollectionItemSlot",dt="data-radix-collection-item",ft=wn$1.forwardRef((gt,_r)=>{const{scope:Yr,children:mt,...Kr}=gt,Xr=wn$1.useRef(null),Zr=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(_r,Xr),Qr=st(ct,Yr);return wn$1.useEffect(()=>(Qr.itemMap.set(Xr,{ref:Xr,...Kr}),()=>void Qr.itemMap.delete(Xr))),wn$1.createElement($5e63c961fc1ce211$export$8c6ed5c666ac1360,{[dt]:"",ref:Zr},mt)});function pt(gt){const _r=st(tt+"CollectionConsumer",gt);return wn$1.useCallback(()=>{const mt=_r.collectionRef.current;if(!mt)return[];const Kr=Array.from(mt.querySelectorAll(`[${dt}]`));return Array.from(_r.itemMap.values()).sort((Qr,_i)=>Kr.indexOf(Qr.ref.current)-Kr.indexOf(_i.ref.current))},[_r.collectionRef,_r.itemMap])}return[{Provider:ot,Slot:ut,ItemSlot:ft},pt,rt]}const $f631663db3294ace$var$DirectionContext=G$3(void 0);function $f631663db3294ace$export$b39126d51d94e6f3(tt){const et=P$3($f631663db3294ace$var$DirectionContext);return tt||et||"ltr"}const $d7bdfb9eb0fdf311$var$ENTRY_FOCUS="rovingFocusGroup.onEntryFocus",$d7bdfb9eb0fdf311$var$EVENT_OPTIONS={bubbles:!1,cancelable:!0},$d7bdfb9eb0fdf311$var$GROUP_NAME="RovingFocusGroup",[$d7bdfb9eb0fdf311$var$Collection,$d7bdfb9eb0fdf311$var$useCollection,$d7bdfb9eb0fdf311$var$createCollectionScope]=$e02a7d9cb1dc128c$export$c74125a8e3af6bb2($d7bdfb9eb0fdf311$var$GROUP_NAME),[$d7bdfb9eb0fdf311$var$createRovingFocusGroupContext,$d7bdfb9eb0fdf311$export$c7109489551a4f4]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($d7bdfb9eb0fdf311$var$GROUP_NAME,[$d7bdfb9eb0fdf311$var$createCollectionScope]),[$d7bdfb9eb0fdf311$var$RovingFocusProvider,$d7bdfb9eb0fdf311$var$useRovingFocusContext]=$d7bdfb9eb0fdf311$var$createRovingFocusGroupContext($d7bdfb9eb0fdf311$var$GROUP_NAME),$d7bdfb9eb0fdf311$export$8699f7c8af148338=N$3((tt,et)=>y$3($d7bdfb9eb0fdf311$var$Collection.Provider,{scope:tt.__scopeRovingFocusGroup},y$3($d7bdfb9eb0fdf311$var$Collection.Slot,{scope:tt.__scopeRovingFocusGroup},y$3($d7bdfb9eb0fdf311$var$RovingFocusGroupImpl,_extends$1({},tt,{ref:et}))))),$d7bdfb9eb0fdf311$var$RovingFocusGroupImpl=N$3((tt,et)=>{const{__scopeRovingFocusGroup:nt,orientation:rt,loop:it=!1,dir:st,currentTabStopId:ot,defaultCurrentTabStopId:lt,onCurrentTabStopIdChange:ut,onEntryFocus:ct,...dt}=tt,ft=F$2(null),pt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,ft),gt=$f631663db3294ace$export$b39126d51d94e6f3(st),[_r=null,Yr]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:ot,defaultProp:lt,onChange:ut}),[mt,Kr]=p$3(!1),Xr=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(ct),Zr=$d7bdfb9eb0fdf311$var$useCollection(nt),Qr=F$2(!1),[_i,rs]=p$3(0);return _$1(()=>{const ns=ft.current;if(ns)return ns.addEventListener($d7bdfb9eb0fdf311$var$ENTRY_FOCUS,Xr),()=>ns.removeEventListener($d7bdfb9eb0fdf311$var$ENTRY_FOCUS,Xr)},[Xr]),y$3($d7bdfb9eb0fdf311$var$RovingFocusProvider,{scope:nt,orientation:rt,dir:gt,loop:it,currentTabStopId:_r,onItemFocus:x$3(ns=>Yr(ns),[Yr]),onItemShiftTab:x$3(()=>Kr(!0),[]),onFocusableItemAdd:x$3(()=>rs(ns=>ns+1),[]),onFocusableItemRemove:x$3(()=>rs(ns=>ns-1),[])},y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({tabIndex:mt||_i===0?-1:0,"data-orientation":rt},dt,{ref:pt,style:{outline:"none",...tt.style},onMouseDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onMouseDown,()=>{Qr.current=!0}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onFocus,ns=>{const ss=!Qr.current;if(ns.target===ns.currentTarget&&ss&&!mt){const fs=new CustomEvent($d7bdfb9eb0fdf311$var$ENTRY_FOCUS,$d7bdfb9eb0fdf311$var$EVENT_OPTIONS);if(ns.currentTarget.dispatchEvent(fs),!fs.defaultPrevented){const os=Zr().filter(ls=>ls.focusable),is=os.find(ls=>ls.active),cs=os.find(ls=>ls.id===_r),vs=[is,cs,...os].filter(Boolean).map(ls=>ls.ref.current);$d7bdfb9eb0fdf311$var$focusFirst(vs)}}Qr.current=!1}),onBlur:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onBlur,()=>Kr(!1))})))}),$d7bdfb9eb0fdf311$var$ITEM_NAME="RovingFocusGroupItem",$d7bdfb9eb0fdf311$export$ab9df7c53fe8454=N$3((tt,et)=>{const{__scopeRovingFocusGroup:nt,focusable:rt=!0,active:it=!1,tabStopId:st,...ot}=tt,lt=$1746a345f3d73bb7$export$f680877a34711e37(),ut=st||lt,ct=$d7bdfb9eb0fdf311$var$useRovingFocusContext($d7bdfb9eb0fdf311$var$ITEM_NAME,nt),dt=ct.currentTabStopId===ut,ft=$d7bdfb9eb0fdf311$var$useCollection(nt),{onFocusableItemAdd:pt,onFocusableItemRemove:gt}=ct;return _$1(()=>{if(rt)return pt(),()=>gt()},[rt,pt,gt]),y$3($d7bdfb9eb0fdf311$var$Collection.ItemSlot,{scope:nt,id:ut,focusable:rt,active:it},y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({tabIndex:dt?0:-1,"data-orientation":ct.orientation},ot,{ref:et,onMouseDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onMouseDown,_r=>{rt?ct.onItemFocus(ut):_r.preventDefault()}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onFocus,()=>ct.onItemFocus(ut)),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onKeyDown,_r=>{if(_r.key==="Tab"&&_r.shiftKey){ct.onItemShiftTab();return}if(_r.target!==_r.currentTarget)return;const Yr=$d7bdfb9eb0fdf311$var$getFocusIntent(_r,ct.orientation,ct.dir);if(Yr!==void 0){_r.preventDefault();let Kr=ft().filter(Xr=>Xr.focusable).map(Xr=>Xr.ref.current);if(Yr==="last")Kr.reverse();else if(Yr==="prev"||Yr==="next"){Yr==="prev"&&Kr.reverse();const Xr=Kr.indexOf(_r.currentTarget);Kr=ct.loop?$d7bdfb9eb0fdf311$var$wrapArray(Kr,Xr+1):Kr.slice(Xr+1)}setTimeout(()=>$d7bdfb9eb0fdf311$var$focusFirst(Kr))}})})))}),$d7bdfb9eb0fdf311$var$MAP_KEY_TO_FOCUS_INTENT={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function $d7bdfb9eb0fdf311$var$getDirectionAwareKey(tt,et){return et!=="rtl"?tt:tt==="ArrowLeft"?"ArrowRight":tt==="ArrowRight"?"ArrowLeft":tt}function $d7bdfb9eb0fdf311$var$getFocusIntent(tt,et,nt){const rt=$d7bdfb9eb0fdf311$var$getDirectionAwareKey(tt.key,nt);if(!(et==="vertical"&&["ArrowLeft","ArrowRight"].includes(rt))&&!(et==="horizontal"&&["ArrowUp","ArrowDown"].includes(rt)))return $d7bdfb9eb0fdf311$var$MAP_KEY_TO_FOCUS_INTENT[rt]}function $d7bdfb9eb0fdf311$var$focusFirst(tt){const et=document.activeElement;for(const nt of tt)if(nt===et||(nt.focus(),document.activeElement!==et))return}function $d7bdfb9eb0fdf311$var$wrapArray(tt,et){return tt.map((nt,rt)=>tt[(et+rt)%tt.length])}const $d7bdfb9eb0fdf311$export$be92b6f5f03c0fe9=$d7bdfb9eb0fdf311$export$8699f7c8af148338,$d7bdfb9eb0fdf311$export$6d08773d2e66f8f2=$d7bdfb9eb0fdf311$export$ab9df7c53fe8454,$69cb30bb0017df05$var$TABS_NAME="Tabs",[$69cb30bb0017df05$var$createTabsContext,$69cb30bb0017df05$export$355f5bd209d7b13a]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($69cb30bb0017df05$var$TABS_NAME,[$d7bdfb9eb0fdf311$export$c7109489551a4f4]),$69cb30bb0017df05$var$useRovingFocusGroupScope=$d7bdfb9eb0fdf311$export$c7109489551a4f4(),[$69cb30bb0017df05$var$TabsProvider,$69cb30bb0017df05$var$useTabsContext]=$69cb30bb0017df05$var$createTabsContext($69cb30bb0017df05$var$TABS_NAME),$69cb30bb0017df05$export$b2539bed5023c21c=N$3((tt,et)=>{const{__scopeTabs:nt,value:rt,onValueChange:it,defaultValue:st,orientation:ot="horizontal",dir:lt,activationMode:ut="automatic",...ct}=tt,dt=$f631663db3294ace$export$b39126d51d94e6f3(lt),[ft,pt]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:rt,onChange:it,defaultProp:st});return y$3($69cb30bb0017df05$var$TabsProvider,{scope:nt,baseId:$1746a345f3d73bb7$export$f680877a34711e37(),value:ft,onValueChange:pt,orientation:ot,dir:dt,activationMode:ut},y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({dir:dt,"data-orientation":ot},ct,{ref:et})))}),$69cb30bb0017df05$var$TAB_LIST_NAME="TabsList",$69cb30bb0017df05$export$9712d22edc0d78c1=N$3((tt,et)=>{const{__scopeTabs:nt,loop:rt=!0,...it}=tt,st=$69cb30bb0017df05$var$useTabsContext($69cb30bb0017df05$var$TAB_LIST_NAME,nt),ot=$69cb30bb0017df05$var$useRovingFocusGroupScope(nt);return y$3($d7bdfb9eb0fdf311$export$be92b6f5f03c0fe9,_extends$1({asChild:!0},ot,{orientation:st.orientation,dir:st.dir,loop:rt}),y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"tablist","aria-orientation":st.orientation},it,{ref:et})))}),$69cb30bb0017df05$var$TRIGGER_NAME="TabsTrigger",$69cb30bb0017df05$export$8114b9fdfdf9f3ba=N$3((tt,et)=>{const{__scopeTabs:nt,value:rt,disabled:it=!1,...st}=tt,ot=$69cb30bb0017df05$var$useTabsContext($69cb30bb0017df05$var$TRIGGER_NAME,nt),lt=$69cb30bb0017df05$var$useRovingFocusGroupScope(nt),ut=$69cb30bb0017df05$var$makeTriggerId(ot.baseId,rt),ct=$69cb30bb0017df05$var$makeContentId(ot.baseId,rt),dt=rt===ot.value;return y$3($d7bdfb9eb0fdf311$export$6d08773d2e66f8f2,_extends$1({asChild:!0},lt,{focusable:!it,active:dt}),y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"tab","aria-selected":dt,"aria-controls":ct,"data-state":dt?"active":"inactive","data-disabled":it?"":void 0,disabled:it,id:ut},st,{ref:et,onMouseDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onMouseDown,ft=>{!it&&ft.button===0&&ft.ctrlKey===!1?ot.onValueChange(rt):ft.preventDefault()}),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onKeyDown,ft=>{[" ","Enter"].includes(ft.key)&&ot.onValueChange(rt)}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onFocus,()=>{const ft=ot.activationMode!=="manual";!dt&&!it&&ft&&ot.onValueChange(rt)})})))}),$69cb30bb0017df05$var$CONTENT_NAME="TabsContent",$69cb30bb0017df05$export$bd905d70e8fd2ebb=N$3((tt,et)=>{const{__scopeTabs:nt,value:rt,forceMount:it,children:st,...ot}=tt,lt=$69cb30bb0017df05$var$useTabsContext($69cb30bb0017df05$var$CONTENT_NAME,nt),ut=$69cb30bb0017df05$var$makeTriggerId(lt.baseId,rt),ct=$69cb30bb0017df05$var$makeContentId(lt.baseId,rt),dt=rt===lt.value,ft=F$2(dt);return _$1(()=>{const pt=requestAnimationFrame(()=>ft.current=!1);return()=>cancelAnimationFrame(pt)},[]),y$3($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:it||dt},({present:pt})=>y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-state":dt?"active":"inactive","data-orientation":lt.orientation,role:"tabpanel","aria-labelledby":ut,hidden:!pt,id:ct,tabIndex:0},ot,{ref:et,style:{...tt.style,animationDuration:ft.current?"0s":void 0}}),pt&&st))});function $69cb30bb0017df05$var$makeTriggerId(tt,et){return`${tt}-trigger-${et}`}function $69cb30bb0017df05$var$makeContentId(tt,et){return`${tt}-content-${et}`}const $69cb30bb0017df05$export$be92b6f5f03c0fe9=$69cb30bb0017df05$export$b2539bed5023c21c,$69cb30bb0017df05$export$54c2e3dc7acea9f5=$69cb30bb0017df05$export$9712d22edc0d78c1,$69cb30bb0017df05$export$41fb9f06171c75f4=$69cb30bb0017df05$export$8114b9fdfdf9f3ba,$69cb30bb0017df05$export$7c6e2c02157bb7d2=$69cb30bb0017df05$export$bd905d70e8fd2ebb;var lib$5={},Parser$3={},Tokenizer={},decode={},decodeDataHtml={};Object.defineProperty(decodeDataHtml,"__esModule",{value:!0}),decodeDataHtml.default=new Uint16Array('<\0\0\0\0\0\0EMabcfglmnoprstu\\bfmsligP&cutereve;iyx}rc;r;ravepha;acr;d;gpon;f;plyFunction;ingcsr;ign;ildemlaceforsucrkslash;;ed;y;crtause;noullis;a;r;pf;eve;cmpeq;HOacdefhilorsucy;PYcpyute;;italDifferentialD;leys;aeioron;dilrc;nint;ot;dnilla;terDot;i;rcleDMPTot;inus;lus;imes;ocskwiseContourIntegral;eCurlyDQoubleQuote;uote;lnpuon;e;gitruent;nt;ourIntegral;fr;oduct;nterClockwiseContourIntegral;oss;cr;p;Cap;DJSZacefios;otrahd;cy;cy;cy;grsger;r;hv;ayron;;l;ta;r;afcmriticalADGTcute;o;bleAcute;rave;ilde;ond;ferentialD;\0\0\0\0f;;DEot;qual;bleCDLRUVontourIntegrao\0\0nArrow;eoftARTrrow;ightArrow;engLReftARrrow;ightArrow;ightArrow;ightATrrow;ee;p\0\0rrow;ownArrow;erticalBar;nABLRTarrow;BUar;pArrow;reve;eft\0\0ightVector;eeVector;ector;Bar;ight\0eeVector;ector;Bar;ee;Arrow;ctr;rok;NTacdfglmopqstuxG;Hcuteaiyron;rc;ot;r;raveement;apcr;ty\0\0mallSquare;erySmallSquare;gpon;f;silon;uail;Tilde;librium;cir;m;a;mlipsts;onentialE;cfiosy;r;lled\0\0mallSquare;erySmallSquare;\0\0\0f;All;riertrf;cJTabcdfgorstcy;>mma;d;reve;eiydil;rc;;ot;r;;pf;eaterEFGLSTqual;Less;ullEqual;reater;ess;lantEqual;ilde;cr;;AacfiosuRDcy;ctek;;irc;r;lbertSpace;\0f;izontalLine;ctrok;mpownHumqual;EJOacdfgmnostucy;lig;cy;cuteiyrc;ot;r;rave;apcgr;inaryI;lie\0;egrral;section;isibleCTomma;imes;gpton;f;a;cr;ilde;\0cy;lcfosuiyrc;;r;pf;\0r;rcy;kcy;HJacfoscy;cy;ppa;eydil;;r;pf;cr;JTaceflmostcy;<cmnprute;bda;g;lacetrf;r;aeyron;dil;;fstACDFRTUVarnrgleBracket;row;BRar;ightArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ightAVrrow;ector;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;ightsEFGLSTqualGreater;ullEqual;reater;ess;lantEqual;ilde;r;;eftarrow;idot;npwgLRlreftARrrow;ightArrow;ightArrow;eftarightightf;erLReftArrow;ightArrow;cht;rok;;acefiosup;y;dliumSpace;lintrf;r;nusPlus;pf;c;Jacefostucy;cute;aeyron;dil;;gswativeMTVediumSpace;hicneryThitedGLreaterGreateessLesLine;r;Bnptreak;BreakingSpace;f;;CDEGHLNPRSTVoungruent;pCap;oubleVerticalBar;lqxement;ual;Tilde;ists;reater;EFGLSTqual;ullEqual;reater;ess;lantEqual;ilde;umpownHump;qual;efstTriangle;BEar;qual;s;EGLSTqual;reater;ess;lantEqual;ilde;estedGLreaterGreater;essLess;recedes;ESqual;lantEqual;eiverseElement;ghtTriangle;BEar;qual;quuareSubpset;Equal;erset;Equal;bcpset;Equal;ceeds;ESTqual;lantEqual;ilde;erset;Equal;ilde;EFTqual;ullEqual;ilde;erticalBar;cr;ilde;Eacdfgmoprstuvlig;cuteiyrc;blac;r;raveaeicr;ga;cron;pf;enCurlyDQoubleQuote;uote;;clr;ashidees;mlerBParr;acek;et;arenthesis;acfhilorsrtialD;y;r;i;;usMinus;ipncareplanf;;eiocedes;ESTqual;lantEqual;ilde;me;dpuct;ortion;al;cir;;UfosOT"r;pf;cr;BEacefhiorsuarr;Gcnrute;g;r;tl;aeyron;dil;;;verseEUlqement;uilibrium;pEquilibrium;ro;ghtACDFTUVanrgleBracket;row;BLar;eftArrow;eiling;o\0bleBracket;n\0eeVector;ector;Bar;loor;ere;AVrrow;ector;iangle;BEar;qual;pDTVownVector;eeVector;ector;Bar;ector;Bar;puf;ndImplies;ightarrow;chr;;leDelayed;HOacfhimoqstuCcHcy;y;FTcy;cute;;aeiyron;dil;rc;;r;ortDLRUownArroweftArrowightArrowpArrow;gma;allCircle;pf;\0\0t;are;ISUntersection;ubpset;Equal;erset;Equal;nion;cr;ar;bcmp;set;Equal;cheeds;ESTqual;lantEqual;ilde;Th;;esrset;Equal;etHRSacfhiorsORNADE;Hccy;y;bu;;aeyron;dil;;r;ei\0efore;a;cnkSpace;Space;lde;EFTqual;ullEqual;ilde;pf;ipleDot;ctr;rok;\0\0\0\0\0\0\0cruter;ocir;r\0y;ve;iyrc;blac;r;raveacr;dierBParr;acek;et;arenthesis;on;Plus;gpon;f;ADETadpsrrow;BDar;ownArrow;ownArrow;quilibrium;ee;Arrow;ownerLReftArrow;ightArrow;i;lon;ing;cr;ilde;mlDbcdefosvash;ar;y;ash;l;er;btyar;;icalBLSTar;ine;eparator;ilde;ThinSpace;r;pf;cr;dash;cefosirc;dge;r;pf;cr;fiosr;;pf;cr;AIUacfosucy;cy;cy;cuteiyrc;;r;pf;cr;ml;Hacdefoscy;cute;ayron;;ot;\0oWidta;r;pf;cr;\0\0\0\0\0\0\0cutereve;;Ediuy;;rcte;lig;r;raveepfpsym;ha;apcclr;g;\0\0;adsvnd;;lope;;;elmrsz;esd;a;;;;;;;;t;vb;d;pth;arr;gpon;f;;Eaeiop;cir;;d;s;rox;eingctyr;;mp;eildemlcioninnt;Nabcdefiklnoprsuot;crkcepsong;psilon;rime;im;eq;ee;ed;gerk;tbrk;oy;quo;cmprtaus;eptyv;snoahw;;een;r;gcostuvwaiurc;pdptot;lus;imes;\0\0cup;ar;riangleduown;p;plus;earow;akocnklstozenge;riangle;dlrown;eft;ight;k;\0\0;;4;ck;eo;q=uiv;t;ptwxf;;tomtie;DHUVbdhmptuvLRlr;;;;;DUdu;;;;LRlr;;;;;HLRhlr;;;;;;ox;LRlr;;;;;DUdu;;;;inus;lus;imes;LRlr;;;;;HLRhlr;;;;;;evbarceior;mi;m;el;bh;sub;l;etp;Ee;;q\0\0\0\0\0\0\0\0\0\0cprute;;abcdsnd;rcup;aup;p;ot;;eot;aeiu\0s;on;dilrc;ps;sm;ot;dmnilptyv;t;err;ceiy;ck;mark;r;Ecefms;;elq;e\0\0rrowlreft;ight;RSacd;st;irc;ash;nint;id;cir;ubs;uit\0on;e;q\0\0a;t;;flemxente\0;dot;nfry;o;sr;aorr;ss;cur;bp;e;;e;dot;delprvwarrlr;;\0\0r;c;arr;p;;bcdosrcap;aup;p;ot;r;;alrvrr;m;yevwq\0\0reuee;edge;enearrowlreftightecioninnt;lcty;AHabcdefhijlorstuwzrar;glrsger;eth;h;varow;aayron;;;aogrr;tseq;glmta;ptyv;irsht;;arlraegsvm;osnd;suit;amma;in;;iode;ontimes;ncy;c\0\0rn;op;lptuwlar;f;;empsq;dot;inus;lus;quare;blebarwedgnadhownarrowarpoonlrefighkaro\0\0rn;op;cotry;;l;rok;drot;i;fahraangle;ciy;grarr;DacdefglmnopqrstuxDoocsuteter;aioyron;r;clon;;ot;Drot;;;rsave;dot;;ilsnters;;;dot;apscr;ty;svetp1;;;gs;p;gpon;f;alsr;sl;us;i;lvon;csuviorc\0\0antgltressaeils;st;v;DD;parsl;Daot;rr;cdir;oah;mrlo;cipl;seoctationential\0\0\0\0\0\0\0llingdotsey;male;ilrlig;\0\0g;ig;;lig;lig;fjaltt;ig;ns;of;\0f;ak;v;artint;aocs\0\0;;;;\0;;\0\0;;5;\0;;8;l;wn;cr;Eabcdefgijlnorstv;l;cmpute;ma;d;reve;iyrc;;ot;;lqs;qslan;cdlc;ot;o;l;;es;r;;gmel;cy;;Eaj;;;Eaes;p;prox;q;qim;pf;cir;m;el;;>;cdlqrci;r;ot;Par;uest;adels\0pror;qlqlesienrtneqq;Aabcefkosyrilmrrsfildrcy;;cwir;;ar;irc;alrrts;uitlip;con;r;sewarow;arow;amoprrr;tht;klreftarrow;ightarrow;f;bar;cltr;asrok;bpull;hen\0\0\0\0\0\0cute;iyrc;cxy;clfr;rave;inoinnt;t;fin;ta;lig;aopcgtr;elpinarh;f;ed;;cfotare;in;tie;do;celpal;grerarhk;rod;cgpty;on;f;a;uestcir;n;Edsv;ot;;v;;ilde;\0cy;lcfmosuiyrc;;r;ath;pf;\0r;rcy;kcy;acfghjosppa;v;eydil;;r;reen;cy;cy;pf;cr;ABEHabcdefghjlmnoprstuvartrail;arr;;g;ar;\0\0\0\0\0\0\0\0\0ute;mptyv;rabda;g;dl;;uor;bfhlpst;fs;s;p;l;im;l;;aeil;;s;abrrr;rk;akcek;;es;ldu;;aeuyron;diil;;cqrsa;uo;rduhar;shar;h;;fgqstahlrtrrow;taarpoonduownpeftarrows;ightahsrrow;sarpoonquigarrohreetimes;;qslan;cdgsc;ot;o;r;;es;adegspproot;qgqgtiilrsht;;;E;rdu;l;lk;cy;;achtrorneard;ri;iodot;ust;acheEaes;p;prox;q;qim;abnoptwznrg;r;rglmreftarightapsto;ightparrowlrefight;aflr;;us;imes;st;;efngear;lt;achmtrornear;d;;ri;achiqtquo;r;m;eg;;buo;r;rok;<;cdhilqrci;r;remes;arr;uest;Piar;;efrdushar;har;enrtneqq;DacdefhilnopsuDot;clprret;;ese;sto;dluowefker;oymma;;ash;asuredangler;o;cdnro;acdsir;otus;bd;u;p;dpels;f;ctr;pos;lmtimap;GLRVabcdefghijlmoprstuvwgt;;veltftarrrow;ightarrow;;;vightarrow;Ddash;ash;bcnptlaute;g;;Eiop;d;s;rour;al;s\0pmp;eaeouy\0;on;dil;ng;dot;p;;ash;;Aadqsxrr;rhrk;;oot;uieiar;ist;sr;Eest;qs;qslani;rAaprrr;ar;;sv;d;cy;AEadestr;rr;r;;fqstarrroightarro;qslan;si;ri;eiptf;;inn;Edv;ot;;;i;v;;aorr;astllel;;lint;;ceu;c;eAaitrrr;cw;;ghtarrowri;echimpqu;ceru;ort\0\0arm;e;qsubpbcp;Ees;et;eq;qc;e;Ees;et;eq;qgilrldeianglelreft;eight;e;m;esro;p;DHadgilrsash;arr;p;ash;et;;>nfin;Aetrr;;;r<ie;Atrr;rie;im;Aanrr;rhrk;;oear;\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0csuteiyr;c;abioslac;v;old;lig;crir;;\0\0\0n;ave;bmar;acitrirr;oss;n;aeicr;ga;cdnron;;pf;aelr;rp;;adiosvr;efmr;ofgof;r;lope;;cloashl;idees;as;mlbar;\0\0\0\0\0\0\0\0\0r;ast;lle\0\0m;;y;rcimptnt;od;il;enk;r;imo;v;mane;;tvchfork;aunckk;h;s;abcdemstcir;ir;ou;;nim;wo;ipuntint;f;nd;Eaceinosu;p;u;c;acenspprourlyeaespprox;qq;im;ime;sEasdfpalslar;ine;urf;;trel;cir;;ncsp;fiopsur;pf;rime;cr;aeoteirnionnt;st;eABHabcdefhilmnoprstuxartrail;arar;cdenqrteu;te;imptyv;g;del;;uor;abcfhlpstwp;;fs;;s;l;im;l;;aiil;o;nalabrrrk;akcek;;es;ldu;;aeuyron;diil;;clqsa;dhar;uo;rh;acgl;ipsnart;ilrsht;;aordu;l;;v;gnshtahlrstrrow;taarpoonduowpeftahrrowarpoonightarrows;quigarrohreetimes;g;ingdotseahmra;oust;achemid;abptnrg;r;raflr;;us;imes;apr;gt;olint;arachqquo;r;buo;rhirremes;i;efltri;luhar;;\0\0\0\0\0\0\0cute;qu;Eaceinpsy;\0;on;u;dil;rc;Eas;p;im;olint;i;ot;be;Aacmstxrr;rhr;oti;war;minnut;r;oacoyrp;hycy;;rt\0\0iaragmma;fv;;deglnprot;;q;E;;E;e;lus;arr;araeitlslsetmhp;parsl;dle;;e;s;flptcy;;b;ar;f;adres;uitcsuaup;s;p;s;ubp;eset;e;eset;e;afrarcemtr;tmiararr;fanighteppsilohsbcmnp;Edemnprs;ot;;dot;ult;Ee;;lus;arr;eiut;enq;qeq;qm;bp;;c;acenspprourlyeaespproqg;123;Edehlmnps;ost;ub;;dot;soul;b;arr;ult;Ee;;lus;eiut;enq;qeq;qm;bp;;Aanrr;rhr;owar;lig\0\0\0\0\0\0\0\0\0\0\0\0get;;raeyron;dil;;lrec;r;eiko\0e4fa;svym;cnkaspproimsasrnes;bd;ar;;eps;bcfot;ir;;ork;rime;aipdadempstngle;dlqrowneft;e;ight;eot;inus;lus;b;ime;ezium;chtry;;cy;rok;ioxheadlreftarroightarrowAHabcdfghlmoprstuwrar;cruter\0y;ve;iyrc;abhrlac;airsht;;raverlrlk;ct\0\0rn;erop;ri;alcr;gpon;f;adhlsuownarpoonlrefighi;hlonparrows;cit\0\0rn;erop;ng;ri;cr;dirot;lde;i;famrlangle;ABDacdeflnoprszrar;v;asnrgrt;eknprstappothinhirop;hiugmbpsetneq;q;setneq;q;hretianglelreftighty;ashelr;bear;q;lip;btar;trsubppf;rotrcur;bpnEenEeigzag;cefoprsirc;dibgar;e;q;erp;r;pf;;eatcr;\0\0\0\0\0\0\0trr;Aarr;Aarrais;dptfl;imAarrcqr;ptracefiosucuyte;iyrc;;nr;cy;pf;cr;cmy;lacdefhioswcute;ayron;;ot;ettra;r;cy;grarr;pf;cr;jn;j;'.split("").map(function(tt){return tt.charCodeAt(0)}));var decodeDataXml={};Object.defineProperty(decodeDataXml,"__esModule",{value:!0}),decodeDataXml.default=new Uint16Array("aglq	\x1B\0\0p;os;t;t;uot;".split("").map(function(tt){return tt.charCodeAt(0)}));var decode_codepoint={};(function(tt){var et;Object.defineProperty(tt,"__esModule",{value:!0}),tt.replaceCodePoint=tt.fromCodePoint=void 0;var nt=new Map([[0,65533],[128,8364],[130,8218],[131,402],[132,8222],[133,8230],[134,8224],[135,8225],[136,710],[137,8240],[138,352],[139,8249],[140,338],[142,381],[145,8216],[146,8217],[147,8220],[148,8221],[149,8226],[150,8211],[151,8212],[152,732],[153,8482],[154,353],[155,8250],[156,339],[158,382],[159,376]]);tt.fromCodePoint=(et=String.fromCodePoint)!==null&&et!==void 0?et:function(st){var ot="";return st>65535&&(st-=65536,ot+=String.fromCharCode(st>>>10&1023|55296),st=56320|st&1023),ot+=String.fromCharCode(st),ot};function rt(st){var ot;return st>=55296&&st<=57343||st>1114111?65533:(ot=nt.get(st))!==null&&ot!==void 0?ot:st}tt.replaceCodePoint=rt;function it(st){return(0,tt.fromCodePoint)(rt(st))}tt.default=it})(decode_codepoint),function(tt){var et=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(is,cs,ps,vs){vs===void 0&&(vs=ps);var ls=Object.getOwnPropertyDescriptor(cs,ps);(!ls||("get"in ls?!cs.__esModule:ls.writable||ls.configurable))&&(ls={enumerable:!0,get:function(){return cs[ps]}}),Object.defineProperty(is,vs,ls)}:function(is,cs,ps,vs){vs===void 0&&(vs=ps),is[vs]=cs[ps]}),nt=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(is,cs){Object.defineProperty(is,"default",{enumerable:!0,value:cs})}:function(is,cs){is.default=cs}),rt=commonjsGlobal&&commonjsGlobal.__importStar||function(is){if(is&&is.__esModule)return is;var cs={};if(is!=null)for(var ps in is)ps!=="default"&&Object.prototype.hasOwnProperty.call(is,ps)&&et(cs,is,ps);return nt(cs,is),cs},it=commonjsGlobal&&commonjsGlobal.__importDefault||function(is){return is&&is.__esModule?is:{default:is}};Object.defineProperty(tt,"__esModule",{value:!0}),tt.decodeXML=tt.decodeHTMLStrict=tt.decodeHTMLAttribute=tt.decodeHTML=tt.determineBranch=tt.EntityDecoder=tt.DecodingMode=tt.BinTrieFlags=tt.fromCodePoint=tt.replaceCodePoint=tt.decodeCodePoint=tt.xmlDecodeTree=tt.htmlDecodeTree=void 0;var st=it(decodeDataHtml);tt.htmlDecodeTree=st.default;var ot=it(decodeDataXml);tt.xmlDecodeTree=ot.default;var lt=rt(decode_codepoint);tt.decodeCodePoint=lt.default;var ut=decode_codepoint;Object.defineProperty(tt,"replaceCodePoint",{enumerable:!0,get:function(){return ut.replaceCodePoint}}),Object.defineProperty(tt,"fromCodePoint",{enumerable:!0,get:function(){return ut.fromCodePoint}});var ct;(function(is){is[is.NUM=35]="NUM",is[is.SEMI=59]="SEMI",is[is.EQUALS=61]="EQUALS",is[is.ZERO=48]="ZERO",is[is.NINE=57]="NINE",is[is.LOWER_A=97]="LOWER_A",is[is.LOWER_F=102]="LOWER_F",is[is.LOWER_X=120]="LOWER_X",is[is.LOWER_Z=122]="LOWER_Z",is[is.UPPER_A=65]="UPPER_A",is[is.UPPER_F=70]="UPPER_F",is[is.UPPER_Z=90]="UPPER_Z"})(ct||(ct={}));var dt=32,ft;(function(is){is[is.VALUE_LENGTH=49152]="VALUE_LENGTH",is[is.BRANCH_LENGTH=16256]="BRANCH_LENGTH",is[is.JUMP_TABLE=127]="JUMP_TABLE"})(ft=tt.BinTrieFlags||(tt.BinTrieFlags={}));function pt(is){return is>=ct.ZERO&&is<=ct.NINE}function gt(is){return is>=ct.UPPER_A&&is<=ct.UPPER_F||is>=ct.LOWER_A&&is<=ct.LOWER_F}function _r(is){return is>=ct.UPPER_A&&is<=ct.UPPER_Z||is>=ct.LOWER_A&&is<=ct.LOWER_Z||pt(is)}function Yr(is){return is===ct.EQUALS||_r(is)}var mt;(function(is){is[is.EntityStart=0]="EntityStart",is[is.NumericStart=1]="NumericStart",is[is.NumericDecimal=2]="NumericDecimal",is[is.NumericHex=3]="NumericHex",is[is.NamedEntity=4]="NamedEntity"})(mt||(mt={}));var Kr;(function(is){is[is.Legacy=0]="Legacy",is[is.Strict=1]="Strict",is[is.Attribute=2]="Attribute"})(Kr=tt.DecodingMode||(tt.DecodingMode={}));var Xr=function(){function is(cs,ps,vs){this.decodeTree=cs,this.emitCodePoint=ps,this.errors=vs,this.state=mt.EntityStart,this.consumed=1,this.result=0,this.treeIndex=0,this.excess=1,this.decodeMode=Kr.Strict}return is.prototype.startEntity=function(cs){this.decodeMode=cs,this.state=mt.EntityStart,this.result=0,this.treeIndex=0,this.excess=1,this.consumed=1},is.prototype.write=function(cs,ps){switch(this.state){case mt.EntityStart:return cs.charCodeAt(ps)===ct.NUM?(this.state=mt.NumericStart,this.consumed+=1,this.stateNumericStart(cs,ps+1)):(this.state=mt.NamedEntity,this.stateNamedEntity(cs,ps));case mt.NumericStart:return this.stateNumericStart(cs,ps);case mt.NumericDecimal:return this.stateNumericDecimal(cs,ps);case mt.NumericHex:return this.stateNumericHex(cs,ps);case mt.NamedEntity:return this.stateNamedEntity(cs,ps)}},is.prototype.stateNumericStart=function(cs,ps){return ps>=cs.length?-1:(cs.charCodeAt(ps)|dt)===ct.LOWER_X?(this.state=mt.NumericHex,this.consumed+=1,this.stateNumericHex(cs,ps+1)):(this.state=mt.NumericDecimal,this.stateNumericDecimal(cs,ps))},is.prototype.addToNumericResult=function(cs,ps,vs,ls){if(ps!==vs){var gs=vs-ps;this.result=this.result*Math.pow(ls,gs)+parseInt(cs.substr(ps,gs),ls),this.consumed+=gs}},is.prototype.stateNumericHex=function(cs,ps){for(var vs=ps;ps<cs.length;){var ls=cs.charCodeAt(ps);if(pt(ls)||gt(ls))ps+=1;else return this.addToNumericResult(cs,vs,ps,16),this.emitNumericEntity(ls,3)}return this.addToNumericResult(cs,vs,ps,16),-1},is.prototype.stateNumericDecimal=function(cs,ps){for(var vs=ps;ps<cs.length;){var ls=cs.charCodeAt(ps);if(pt(ls))ps+=1;else return this.addToNumericResult(cs,vs,ps,10),this.emitNumericEntity(ls,2)}return this.addToNumericResult(cs,vs,ps,10),-1},is.prototype.emitNumericEntity=function(cs,ps){var vs;if(this.consumed<=ps)return(vs=this.errors)===null||vs===void 0||vs.absenceOfDigitsInNumericCharacterReference(this.consumed),0;if(cs===ct.SEMI)this.consumed+=1;else if(this.decodeMode===Kr.Strict)return 0;return this.emitCodePoint((0,lt.replaceCodePoint)(this.result),this.consumed),this.errors&&(cs!==ct.SEMI&&this.errors.missingSemicolonAfterCharacterReference(),this.errors.validateNumericCharacterReference(this.result)),this.consumed},is.prototype.stateNamedEntity=function(cs,ps){for(var vs=this.decodeTree,ls=vs[this.treeIndex],gs=(ls&ft.VALUE_LENGTH)>>14;ps<cs.length;ps++,this.excess++){var us=cs.charCodeAt(ps);if(this.treeIndex=Qr(vs,ls,this.treeIndex+Math.max(1,gs),us),this.treeIndex<0)return this.result===0||this.decodeMode===Kr.Attribute&&(gs===0||Yr(us))?0:this.emitNotTerminatedNamedEntity();if(ls=vs[this.treeIndex],gs=(ls&ft.VALUE_LENGTH)>>14,gs!==0){if(us===ct.SEMI)return this.emitNamedEntityData(this.treeIndex,gs,this.consumed+this.excess);this.decodeMode!==Kr.Strict&&(this.result=this.treeIndex,this.consumed+=this.excess,this.excess=0)}}return-1},is.prototype.emitNotTerminatedNamedEntity=function(){var cs,ps=this,vs=ps.result,ls=ps.decodeTree,gs=(ls[vs]&ft.VALUE_LENGTH)>>14;return this.emitNamedEntityData(vs,gs,this.consumed),(cs=this.errors)===null||cs===void 0||cs.missingSemicolonAfterCharacterReference(),this.consumed},is.prototype.emitNamedEntityData=function(cs,ps,vs){var ls=this.decodeTree;return this.emitCodePoint(ps===1?ls[cs]&~ft.VALUE_LENGTH:ls[cs+1],vs),ps===3&&this.emitCodePoint(ls[cs+2],vs),vs},is.prototype.end=function(){var cs;switch(this.state){case mt.NamedEntity:return this.result!==0&&(this.decodeMode!==Kr.Attribute||this.result===this.treeIndex)?this.emitNotTerminatedNamedEntity():0;case mt.NumericDecimal:return this.emitNumericEntity(0,2);case mt.NumericHex:return this.emitNumericEntity(0,3);case mt.NumericStart:return(cs=this.errors)===null||cs===void 0||cs.absenceOfDigitsInNumericCharacterReference(this.consumed),0;case mt.EntityStart:return 0}},is}();tt.EntityDecoder=Xr;function Zr(is){var cs="",ps=new Xr(is,function(vs){return cs+=(0,lt.fromCodePoint)(vs)});return function(ls,gs){for(var us=0,ms=0;(ms=ls.indexOf("&",ms))>=0;){cs+=ls.slice(us,ms),ps.startEntity(gs);var ys=ps.write(ls,ms+1);if(ys<0){us=ms+ps.end();break}us=ms+ys,ms=ys===0?us+1:us}var Es=cs+ls.slice(us);return cs="",Es}}function Qr(is,cs,ps,vs){var ls=(cs&ft.BRANCH_LENGTH)>>7,gs=cs&ft.JUMP_TABLE;if(ls===0)return gs!==0&&vs===gs?ps:-1;if(gs){var us=vs-gs;return us<0||us>=ls?-1:is[ps+us]-1}for(var ms=ps,ys=ms+ls-1;ms<=ys;){var Es=ms+ys>>>1,Ts=is[Es];if(Ts<vs)ms=Es+1;else if(Ts>vs)ys=Es-1;else return is[Es+ls]}return-1}tt.determineBranch=Qr;var _i=Zr(st.default),rs=Zr(ot.default);function ns(is,cs){return cs===void 0&&(cs=Kr.Legacy),_i(is,cs)}tt.decodeHTML=ns;function ss(is){return _i(is,Kr.Attribute)}tt.decodeHTMLAttribute=ss;function fs(is){return _i(is,Kr.Strict)}tt.decodeHTMLStrict=fs;function os(is){return rs(is,Kr.Strict)}tt.decodeXML=os}(decode),function(tt){Object.defineProperty(tt,"__esModule",{value:!0}),tt.QuoteType=void 0;var et=decode,nt;(function(pt){pt[pt.Tab=9]="Tab",pt[pt.NewLine=10]="NewLine",pt[pt.FormFeed=12]="FormFeed",pt[pt.CarriageReturn=13]="CarriageReturn",pt[pt.Space=32]="Space",pt[pt.ExclamationMark=33]="ExclamationMark",pt[pt.Number=35]="Number",pt[pt.Amp=38]="Amp",pt[pt.SingleQuote=39]="SingleQuote",pt[pt.DoubleQuote=34]="DoubleQuote",pt[pt.Dash=45]="Dash",pt[pt.Slash=47]="Slash",pt[pt.Zero=48]="Zero",pt[pt.Nine=57]="Nine",pt[pt.Semi=59]="Semi",pt[pt.Lt=60]="Lt",pt[pt.Eq=61]="Eq",pt[pt.Gt=62]="Gt",pt[pt.Questionmark=63]="Questionmark",pt[pt.UpperA=65]="UpperA",pt[pt.LowerA=97]="LowerA",pt[pt.UpperF=70]="UpperF",pt[pt.LowerF=102]="LowerF",pt[pt.UpperZ=90]="UpperZ",pt[pt.LowerZ=122]="LowerZ",pt[pt.LowerX=120]="LowerX",pt[pt.OpeningSquareBracket=91]="OpeningSquareBracket"})(nt||(nt={}));var rt;(function(pt){pt[pt.Text=1]="Text",pt[pt.BeforeTagName=2]="BeforeTagName",pt[pt.InTagName=3]="InTagName",pt[pt.InSelfClosingTag=4]="InSelfClosingTag",pt[pt.BeforeClosingTagName=5]="BeforeClosingTagName",pt[pt.InClosingTagName=6]="InClosingTagName",pt[pt.AfterClosingTagName=7]="AfterClosingTagName",pt[pt.BeforeAttributeName=8]="BeforeAttributeName",pt[pt.InAttributeName=9]="InAttributeName",pt[pt.AfterAttributeName=10]="AfterAttributeName",pt[pt.BeforeAttributeValue=11]="BeforeAttributeValue",pt[pt.InAttributeValueDq=12]="InAttributeValueDq",pt[pt.InAttributeValueSq=13]="InAttributeValueSq",pt[pt.InAttributeValueNq=14]="InAttributeValueNq",pt[pt.BeforeDeclaration=15]="BeforeDeclaration",pt[pt.InDeclaration=16]="InDeclaration",pt[pt.InProcessingInstruction=17]="InProcessingInstruction",pt[pt.BeforeComment=18]="BeforeComment",pt[pt.CDATASequence=19]="CDATASequence",pt[pt.InSpecialComment=20]="InSpecialComment",pt[pt.InCommentLike=21]="InCommentLike",pt[pt.BeforeSpecialS=22]="BeforeSpecialS",pt[pt.SpecialStartSequence=23]="SpecialStartSequence",pt[pt.InSpecialTag=24]="InSpecialTag",pt[pt.BeforeEntity=25]="BeforeEntity",pt[pt.BeforeNumericEntity=26]="BeforeNumericEntity",pt[pt.InNamedEntity=27]="InNamedEntity",pt[pt.InNumericEntity=28]="InNumericEntity",pt[pt.InHexEntity=29]="InHexEntity"})(rt||(rt={}));function it(pt){return pt===nt.Space||pt===nt.NewLine||pt===nt.Tab||pt===nt.FormFeed||pt===nt.CarriageReturn}function st(pt){return pt===nt.Slash||pt===nt.Gt||it(pt)}function ot(pt){return pt>=nt.Zero&&pt<=nt.Nine}function lt(pt){return pt>=nt.LowerA&&pt<=nt.LowerZ||pt>=nt.UpperA&&pt<=nt.UpperZ}function ut(pt){return pt>=nt.UpperA&&pt<=nt.UpperF||pt>=nt.LowerA&&pt<=nt.LowerF}var ct;(function(pt){pt[pt.NoValue=0]="NoValue",pt[pt.Unquoted=1]="Unquoted",pt[pt.Single=2]="Single",pt[pt.Double=3]="Double"})(ct=tt.QuoteType||(tt.QuoteType={}));var dt={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101])},ft=function(){function pt(gt,_r){var Yr=gt.xmlMode,mt=Yr===void 0?!1:Yr,Kr=gt.decodeEntities,Xr=Kr===void 0?!0:Kr;this.cbs=_r,this.state=rt.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=rt.Text,this.isSpecial=!1,this.running=!0,this.offset=0,this.currentSequence=void 0,this.sequenceIndex=0,this.trieIndex=0,this.trieCurrent=0,this.entityResult=0,this.entityExcess=0,this.xmlMode=mt,this.decodeEntities=Xr,this.entityTrie=mt?et.xmlDecodeTree:et.htmlDecodeTree}return pt.prototype.reset=function(){this.state=rt.Text,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=rt.Text,this.currentSequence=void 0,this.running=!0,this.offset=0},pt.prototype.write=function(gt){this.offset+=this.buffer.length,this.buffer=gt,this.parse()},pt.prototype.end=function(){this.running&&this.finish()},pt.prototype.pause=function(){this.running=!1},pt.prototype.resume=function(){this.running=!0,this.index<this.buffer.length+this.offset&&this.parse()},pt.prototype.getIndex=function(){return this.index},pt.prototype.getSectionStart=function(){return this.sectionStart},pt.prototype.stateText=function(gt){gt===nt.Lt||!this.decodeEntities&&this.fastForwardTo(nt.Lt)?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=rt.BeforeTagName,this.sectionStart=this.index):this.decodeEntities&&gt===nt.Amp&&(this.state=rt.BeforeEntity)},pt.prototype.stateSpecialStartSequence=function(gt){var _r=this.sequenceIndex===this.currentSequence.length,Yr=_r?st(gt):(gt|32)===this.currentSequence[this.sequenceIndex];if(!Yr)this.isSpecial=!1;else if(!_r){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=rt.InTagName,this.stateInTagName(gt)},pt.prototype.stateInSpecialTag=function(gt){if(this.sequenceIndex===this.currentSequence.length){if(gt===nt.Gt||it(gt)){var _r=this.index-this.currentSequence.length;if(this.sectionStart<_r){var Yr=this.index;this.index=_r,this.cbs.ontext(this.sectionStart,_r),this.index=Yr}this.isSpecial=!1,this.sectionStart=_r+2,this.stateInClosingTagName(gt);return}this.sequenceIndex=0}(gt|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===dt.TitleEnd?this.decodeEntities&&gt===nt.Amp&&(this.state=rt.BeforeEntity):this.fastForwardTo(nt.Lt)&&(this.sequenceIndex=1):this.sequenceIndex=+(gt===nt.Lt)},pt.prototype.stateCDATASequence=function(gt){gt===dt.Cdata[this.sequenceIndex]?++this.sequenceIndex===dt.Cdata.length&&(this.state=rt.InCommentLike,this.currentSequence=dt.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=rt.InDeclaration,this.stateInDeclaration(gt))},pt.prototype.fastForwardTo=function(gt){for(;++this.index<this.buffer.length+this.offset;)if(this.buffer.charCodeAt(this.index-this.offset)===gt)return!0;return this.index=this.buffer.length+this.offset-1,!1},pt.prototype.stateInCommentLike=function(gt){gt===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===dt.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index,2):this.cbs.oncomment(this.sectionStart,this.index,2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=rt.Text):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):gt!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)},pt.prototype.isTagStartChar=function(gt){return this.xmlMode?!st(gt):lt(gt)},pt.prototype.startSpecial=function(gt,_r){this.isSpecial=!0,this.currentSequence=gt,this.sequenceIndex=_r,this.state=rt.SpecialStartSequence},pt.prototype.stateBeforeTagName=function(gt){if(gt===nt.ExclamationMark)this.state=rt.BeforeDeclaration,this.sectionStart=this.index+1;else if(gt===nt.Questionmark)this.state=rt.InProcessingInstruction,this.sectionStart=this.index+1;else if(this.isTagStartChar(gt)){var _r=gt|32;this.sectionStart=this.index,!this.xmlMode&&_r===dt.TitleEnd[2]?this.startSpecial(dt.TitleEnd,3):this.state=!this.xmlMode&&_r===dt.ScriptEnd[2]?rt.BeforeSpecialS:rt.InTagName}else gt===nt.Slash?this.state=rt.BeforeClosingTagName:(this.state=rt.Text,this.stateText(gt))},pt.prototype.stateInTagName=function(gt){st(gt)&&(this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=rt.BeforeAttributeName,this.stateBeforeAttributeName(gt))},pt.prototype.stateBeforeClosingTagName=function(gt){it(gt)||(gt===nt.Gt?this.state=rt.Text:(this.state=this.isTagStartChar(gt)?rt.InClosingTagName:rt.InSpecialComment,this.sectionStart=this.index))},pt.prototype.stateInClosingTagName=function(gt){(gt===nt.Gt||it(gt))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=rt.AfterClosingTagName,this.stateAfterClosingTagName(gt))},pt.prototype.stateAfterClosingTagName=function(gt){(gt===nt.Gt||this.fastForwardTo(nt.Gt))&&(this.state=rt.Text,this.baseState=rt.Text,this.sectionStart=this.index+1)},pt.prototype.stateBeforeAttributeName=function(gt){gt===nt.Gt?(this.cbs.onopentagend(this.index),this.isSpecial?(this.state=rt.InSpecialTag,this.sequenceIndex=0):this.state=rt.Text,this.baseState=this.state,this.sectionStart=this.index+1):gt===nt.Slash?this.state=rt.InSelfClosingTag:it(gt)||(this.state=rt.InAttributeName,this.sectionStart=this.index)},pt.prototype.stateInSelfClosingTag=function(gt){gt===nt.Gt?(this.cbs.onselfclosingtag(this.index),this.state=rt.Text,this.baseState=rt.Text,this.sectionStart=this.index+1,this.isSpecial=!1):it(gt)||(this.state=rt.BeforeAttributeName,this.stateBeforeAttributeName(gt))},pt.prototype.stateInAttributeName=function(gt){(gt===nt.Eq||st(gt))&&(this.cbs.onattribname(this.sectionStart,this.index),this.sectionStart=-1,this.state=rt.AfterAttributeName,this.stateAfterAttributeName(gt))},pt.prototype.stateAfterAttributeName=function(gt){gt===nt.Eq?this.state=rt.BeforeAttributeValue:gt===nt.Slash||gt===nt.Gt?(this.cbs.onattribend(ct.NoValue,this.index),this.state=rt.BeforeAttributeName,this.stateBeforeAttributeName(gt)):it(gt)||(this.cbs.onattribend(ct.NoValue,this.index),this.state=rt.InAttributeName,this.sectionStart=this.index)},pt.prototype.stateBeforeAttributeValue=function(gt){gt===nt.DoubleQuote?(this.state=rt.InAttributeValueDq,this.sectionStart=this.index+1):gt===nt.SingleQuote?(this.state=rt.InAttributeValueSq,this.sectionStart=this.index+1):it(gt)||(this.sectionStart=this.index,this.state=rt.InAttributeValueNq,this.stateInAttributeValueNoQuotes(gt))},pt.prototype.handleInAttributeValue=function(gt,_r){gt===_r||!this.decodeEntities&&this.fastForwardTo(_r)?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(_r===nt.DoubleQuote?ct.Double:ct.Single,this.index),this.state=rt.BeforeAttributeName):this.decodeEntities&&gt===nt.Amp&&(this.baseState=this.state,this.state=rt.BeforeEntity)},pt.prototype.stateInAttributeValueDoubleQuotes=function(gt){this.handleInAttributeValue(gt,nt.DoubleQuote)},pt.prototype.stateInAttributeValueSingleQuotes=function(gt){this.handleInAttributeValue(gt,nt.SingleQuote)},pt.prototype.stateInAttributeValueNoQuotes=function(gt){it(gt)||gt===nt.Gt?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(ct.Unquoted,this.index),this.state=rt.BeforeAttributeName,this.stateBeforeAttributeName(gt)):this.decodeEntities&&gt===nt.Amp&&(this.baseState=this.state,this.state=rt.BeforeEntity)},pt.prototype.stateBeforeDeclaration=function(gt){gt===nt.OpeningSquareBracket?(this.state=rt.CDATASequence,this.sequenceIndex=0):this.state=gt===nt.Dash?rt.BeforeComment:rt.InDeclaration},pt.prototype.stateInDeclaration=function(gt){(gt===nt.Gt||this.fastForwardTo(nt.Gt))&&(this.cbs.ondeclaration(this.sectionStart,this.index),this.state=rt.Text,this.sectionStart=this.index+1)},pt.prototype.stateInProcessingInstruction=function(gt){(gt===nt.Gt||this.fastForwardTo(nt.Gt))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=rt.Text,this.sectionStart=this.index+1)},pt.prototype.stateBeforeComment=function(gt){gt===nt.Dash?(this.state=rt.InCommentLike,this.currentSequence=dt.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=rt.InDeclaration},pt.prototype.stateInSpecialComment=function(gt){(gt===nt.Gt||this.fastForwardTo(nt.Gt))&&(this.cbs.oncomment(this.sectionStart,this.index,0),this.state=rt.Text,this.sectionStart=this.index+1)},pt.prototype.stateBeforeSpecialS=function(gt){var _r=gt|32;_r===dt.ScriptEnd[3]?this.startSpecial(dt.ScriptEnd,4):_r===dt.StyleEnd[3]?this.startSpecial(dt.StyleEnd,4):(this.state=rt.InTagName,this.stateInTagName(gt))},pt.prototype.stateBeforeEntity=function(gt){this.entityExcess=1,this.entityResult=0,gt===nt.Number?this.state=rt.BeforeNumericEntity:gt===nt.Amp||(this.trieIndex=0,this.trieCurrent=this.entityTrie[0],this.state=rt.InNamedEntity,this.stateInNamedEntity(gt))},pt.prototype.stateInNamedEntity=function(gt){if(this.entityExcess+=1,this.trieIndex=(0,et.determineBranch)(this.entityTrie,this.trieCurrent,this.trieIndex+1,gt),this.trieIndex<0){this.emitNamedEntity(),this.index--;return}this.trieCurrent=this.entityTrie[this.trieIndex];var _r=this.trieCurrent&et.BinTrieFlags.VALUE_LENGTH;if(_r){var Yr=(_r>>14)-1;if(!this.allowLegacyEntity()&&gt!==nt.Semi)this.trieIndex+=Yr;else{var mt=this.index-this.entityExcess+1;mt>this.sectionStart&&this.emitPartial(this.sectionStart,mt),this.entityResult=this.trieIndex,this.trieIndex+=Yr,this.entityExcess=0,this.sectionStart=this.index+1,Yr===0&&this.emitNamedEntity()}}},pt.prototype.emitNamedEntity=function(){if(this.state=this.baseState,this.entityResult!==0){var gt=(this.entityTrie[this.entityResult]&et.BinTrieFlags.VALUE_LENGTH)>>14;switch(gt){case 1:{this.emitCodePoint(this.entityTrie[this.entityResult]&~et.BinTrieFlags.VALUE_LENGTH);break}case 2:{this.emitCodePoint(this.entityTrie[this.entityResult+1]);break}case 3:this.emitCodePoint(this.entityTrie[this.entityResult+1]),this.emitCodePoint(this.entityTrie[this.entityResult+2])}}},pt.prototype.stateBeforeNumericEntity=function(gt){(gt|32)===nt.LowerX?(this.entityExcess++,this.state=rt.InHexEntity):(this.state=rt.InNumericEntity,this.stateInNumericEntity(gt))},pt.prototype.emitNumericEntity=function(gt){var _r=this.index-this.entityExcess-1,Yr=_r+2+ +(this.state===rt.InHexEntity);Yr!==this.index&&(_r>this.sectionStart&&this.emitPartial(this.sectionStart,_r),this.sectionStart=this.index+Number(gt),this.emitCodePoint((0,et.replaceCodePoint)(this.entityResult))),this.state=this.baseState},pt.prototype.stateInNumericEntity=function(gt){gt===nt.Semi?this.emitNumericEntity(!0):ot(gt)?(this.entityResult=this.entityResult*10+(gt-nt.Zero),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},pt.prototype.stateInHexEntity=function(gt){gt===nt.Semi?this.emitNumericEntity(!0):ot(gt)?(this.entityResult=this.entityResult*16+(gt-nt.Zero),this.entityExcess++):ut(gt)?(this.entityResult=this.entityResult*16+((gt|32)-nt.LowerA+10),this.entityExcess++):(this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state=this.baseState,this.index--)},pt.prototype.allowLegacyEntity=function(){return!this.xmlMode&&(this.baseState===rt.Text||this.baseState===rt.InSpecialTag)},pt.prototype.cleanup=function(){this.running&&this.sectionStart!==this.index&&(this.state===rt.Text||this.state===rt.InSpecialTag&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===rt.InAttributeValueDq||this.state===rt.InAttributeValueSq||this.state===rt.InAttributeValueNq)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))},pt.prototype.shouldContinue=function(){return this.index<this.buffer.length+this.offset&&this.running},pt.prototype.parse=function(){for(;this.shouldContinue();){var gt=this.buffer.charCodeAt(this.index-this.offset);switch(this.state){case rt.Text:{this.stateText(gt);break}case rt.SpecialStartSequence:{this.stateSpecialStartSequence(gt);break}case rt.InSpecialTag:{this.stateInSpecialTag(gt);break}case rt.CDATASequence:{this.stateCDATASequence(gt);break}case rt.InAttributeValueDq:{this.stateInAttributeValueDoubleQuotes(gt);break}case rt.InAttributeName:{this.stateInAttributeName(gt);break}case rt.InCommentLike:{this.stateInCommentLike(gt);break}case rt.InSpecialComment:{this.stateInSpecialComment(gt);break}case rt.BeforeAttributeName:{this.stateBeforeAttributeName(gt);break}case rt.InTagName:{this.stateInTagName(gt);break}case rt.InClosingTagName:{this.stateInClosingTagName(gt);break}case rt.BeforeTagName:{this.stateBeforeTagName(gt);break}case rt.AfterAttributeName:{this.stateAfterAttributeName(gt);break}case rt.InAttributeValueSq:{this.stateInAttributeValueSingleQuotes(gt);break}case rt.BeforeAttributeValue:{this.stateBeforeAttributeValue(gt);break}case rt.BeforeClosingTagName:{this.stateBeforeClosingTagName(gt);break}case rt.AfterClosingTagName:{this.stateAfterClosingTagName(gt);break}case rt.BeforeSpecialS:{this.stateBeforeSpecialS(gt);break}case rt.InAttributeValueNq:{this.stateInAttributeValueNoQuotes(gt);break}case rt.InSelfClosingTag:{this.stateInSelfClosingTag(gt);break}case rt.InDeclaration:{this.stateInDeclaration(gt);break}case rt.BeforeDeclaration:{this.stateBeforeDeclaration(gt);break}case rt.BeforeComment:{this.stateBeforeComment(gt);break}case rt.InProcessingInstruction:{this.stateInProcessingInstruction(gt);break}case rt.InNamedEntity:{this.stateInNamedEntity(gt);break}case rt.BeforeEntity:{this.stateBeforeEntity(gt);break}case rt.InHexEntity:{this.stateInHexEntity(gt);break}case rt.InNumericEntity:{this.stateInNumericEntity(gt);break}default:this.stateBeforeNumericEntity(gt)}this.index++}this.cleanup()},pt.prototype.finish=function(){this.state===rt.InNamedEntity&&this.emitNamedEntity(),this.sectionStart<this.index&&this.handleTrailingData(),this.cbs.onend()},pt.prototype.handleTrailingData=function(){var gt=this.buffer.length+this.offset;this.state===rt.InCommentLike?this.currentSequence===dt.CdataEnd?this.cbs.oncdata(this.sectionStart,gt,0):this.cbs.oncomment(this.sectionStart,gt,0):this.state===rt.InNumericEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===rt.InHexEntity&&this.allowLegacyEntity()?this.emitNumericEntity(!1):this.state===rt.InTagName||this.state===rt.BeforeAttributeName||this.state===rt.BeforeAttributeValue||this.state===rt.AfterAttributeName||this.state===rt.InAttributeName||this.state===rt.InAttributeValueSq||this.state===rt.InAttributeValueDq||this.state===rt.InAttributeValueNq||this.state===rt.InClosingTagName||this.cbs.ontext(this.sectionStart,gt)},pt.prototype.emitPartial=function(gt,_r){this.baseState!==rt.Text&&this.baseState!==rt.InSpecialTag?this.cbs.onattribdata(gt,_r):this.cbs.ontext(gt,_r)},pt.prototype.emitCodePoint=function(gt){this.baseState!==rt.Text&&this.baseState!==rt.InSpecialTag?this.cbs.onattribentity(gt):this.cbs.ontextentity(gt)},pt}();tt.default=ft}(Tokenizer);var __createBinding$1=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(tt,et,nt,rt){rt===void 0&&(rt=nt);var it=Object.getOwnPropertyDescriptor(et,nt);(!it||("get"in it?!et.__esModule:it.writable||it.configurable))&&(it={enumerable:!0,get:function(){return et[nt]}}),Object.defineProperty(tt,rt,it)}:function(tt,et,nt,rt){rt===void 0&&(rt=nt),tt[rt]=et[nt]}),__setModuleDefault$1=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(tt,et){Object.defineProperty(tt,"default",{enumerable:!0,value:et})}:function(tt,et){tt.default=et}),__importStar$1=commonjsGlobal&&commonjsGlobal.__importStar||function(tt){if(tt&&tt.__esModule)return tt;var et={};if(tt!=null)for(var nt in tt)nt!=="default"&&Object.prototype.hasOwnProperty.call(tt,nt)&&__createBinding$1(et,tt,nt);return __setModuleDefault$1(et,tt),et};Object.defineProperty(Parser$3,"__esModule",{value:!0}),Parser$3.Parser=void 0;var Tokenizer_js_1=__importStar$1(Tokenizer),decode_js_1=decode,formTags=new Set(["input","option","optgroup","select","button","datalist","textarea"]),pTag=new Set(["p"]),tableSectionTags=new Set(["thead","tbody"]),ddtTags=new Set(["dd","dt"]),rtpTags=new Set(["rt","rp"]),openImpliesClose=new Map([["tr",new Set(["tr","th","td"])],["th",new Set(["th"])],["td",new Set(["thead","th","td"])],["body",new Set(["head","link","script"])],["li",new Set(["li"])],["p",pTag],["h1",pTag],["h2",pTag],["h3",pTag],["h4",pTag],["h5",pTag],["h6",pTag],["select",formTags],["input",formTags],["output",formTags],["button",formTags],["datalist",formTags],["textarea",formTags],["option",new Set(["option"])],["optgroup",new Set(["optgroup","option"])],["dd",ddtTags],["dt",ddtTags],["address",pTag],["article",pTag],["aside",pTag],["blockquote",pTag],["details",pTag],["div",pTag],["dl",pTag],["fieldset",pTag],["figcaption",pTag],["figure",pTag],["footer",pTag],["form",pTag],["header",pTag],["hr",pTag],["main",pTag],["nav",pTag],["ol",pTag],["pre",pTag],["section",pTag],["table",pTag],["ul",pTag],["rt",rtpTags],["rp",rtpTags],["tbody",tableSectionTags],["tfoot",tableSectionTags]]),voidElements=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]),foreignContextElements=new Set(["math","svg"]),htmlIntegrationElements=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignobject","desc","title"]),reNameEnd=/\s|\//,Parser$2=function(){function tt(et,nt){nt===void 0&&(nt={});var rt,it,st,ot,lt;this.options=nt,this.startIndex=0,this.endIndex=0,this.openTagStart=0,this.tagname="",this.attribname="",this.attribvalue="",this.attribs=null,this.stack=[],this.foreignContext=[],this.buffers=[],this.bufferOffset=0,this.writeIndex=0,this.ended=!1,this.cbs=et??{},this.lowerCaseTagNames=(rt=nt.lowerCaseTags)!==null&&rt!==void 0?rt:!nt.xmlMode,this.lowerCaseAttributeNames=(it=nt.lowerCaseAttributeNames)!==null&&it!==void 0?it:!nt.xmlMode,this.tokenizer=new((st=nt.Tokenizer)!==null&&st!==void 0?st:Tokenizer_js_1.default)(this.options,this),(lt=(ot=this.cbs).onparserinit)===null||lt===void 0||lt.call(ot,this)}return tt.prototype.ontext=function(et,nt){var rt,it,st=this.getSlice(et,nt);this.endIndex=nt-1,(it=(rt=this.cbs).ontext)===null||it===void 0||it.call(rt,st),this.startIndex=nt},tt.prototype.ontextentity=function(et){var nt,rt,it=this.tokenizer.getSectionStart();this.endIndex=it-1,(rt=(nt=this.cbs).ontext)===null||rt===void 0||rt.call(nt,(0,decode_js_1.fromCodePoint)(et)),this.startIndex=it},tt.prototype.isVoidElement=function(et){return!this.options.xmlMode&&voidElements.has(et)},tt.prototype.onopentagname=function(et,nt){this.endIndex=nt;var rt=this.getSlice(et,nt);this.lowerCaseTagNames&&(rt=rt.toLowerCase()),this.emitOpenTag(rt)},tt.prototype.emitOpenTag=function(et){var nt,rt,it,st;this.openTagStart=this.startIndex,this.tagname=et;var ot=!this.options.xmlMode&&openImpliesClose.get(et);if(ot)for(;this.stack.length>0&&ot.has(this.stack[this.stack.length-1]);){var lt=this.stack.pop();(rt=(nt=this.cbs).onclosetag)===null||rt===void 0||rt.call(nt,lt,!0)}this.isVoidElement(et)||(this.stack.push(et),foreignContextElements.has(et)?this.foreignContext.push(!0):htmlIntegrationElements.has(et)&&this.foreignContext.push(!1)),(st=(it=this.cbs).onopentagname)===null||st===void 0||st.call(it,et),this.cbs.onopentag&&(this.attribs={})},tt.prototype.endOpenTag=function(et){var nt,rt;this.startIndex=this.openTagStart,this.attribs&&((rt=(nt=this.cbs).onopentag)===null||rt===void 0||rt.call(nt,this.tagname,this.attribs,et),this.attribs=null),this.cbs.onclosetag&&this.isVoidElement(this.tagname)&&this.cbs.onclosetag(this.tagname,!0),this.tagname=""},tt.prototype.onopentagend=function(et){this.endIndex=et,this.endOpenTag(!1),this.startIndex=et+1},tt.prototype.onclosetag=function(et,nt){var rt,it,st,ot,lt,ut;this.endIndex=nt;var ct=this.getSlice(et,nt);if(this.lowerCaseTagNames&&(ct=ct.toLowerCase()),(foreignContextElements.has(ct)||htmlIntegrationElements.has(ct))&&this.foreignContext.pop(),this.isVoidElement(ct))!this.options.xmlMode&&ct==="br"&&((it=(rt=this.cbs).onopentagname)===null||it===void 0||it.call(rt,"br"),(ot=(st=this.cbs).onopentag)===null||ot===void 0||ot.call(st,"br",{},!0),(ut=(lt=this.cbs).onclosetag)===null||ut===void 0||ut.call(lt,"br",!1));else{var dt=this.stack.lastIndexOf(ct);if(dt!==-1)if(this.cbs.onclosetag)for(var ft=this.stack.length-dt;ft--;)this.cbs.onclosetag(this.stack.pop(),ft!==0);else this.stack.length=dt;else!this.options.xmlMode&&ct==="p"&&(this.emitOpenTag("p"),this.closeCurrentTag(!0))}this.startIndex=nt+1},tt.prototype.onselfclosingtag=function(et){this.endIndex=et,this.options.xmlMode||this.options.recognizeSelfClosing||this.foreignContext[this.foreignContext.length-1]?(this.closeCurrentTag(!1),this.startIndex=et+1):this.onopentagend(et)},tt.prototype.closeCurrentTag=function(et){var nt,rt,it=this.tagname;this.endOpenTag(et),this.stack[this.stack.length-1]===it&&((rt=(nt=this.cbs).onclosetag)===null||rt===void 0||rt.call(nt,it,!et),this.stack.pop())},tt.prototype.onattribname=function(et,nt){this.startIndex=et;var rt=this.getSlice(et,nt);this.attribname=this.lowerCaseAttributeNames?rt.toLowerCase():rt},tt.prototype.onattribdata=function(et,nt){this.attribvalue+=this.getSlice(et,nt)},tt.prototype.onattribentity=function(et){this.attribvalue+=(0,decode_js_1.fromCodePoint)(et)},tt.prototype.onattribend=function(et,nt){var rt,it;this.endIndex=nt,(it=(rt=this.cbs).onattribute)===null||it===void 0||it.call(rt,this.attribname,this.attribvalue,et===Tokenizer_js_1.QuoteType.Double?'"':et===Tokenizer_js_1.QuoteType.Single?"'":et===Tokenizer_js_1.QuoteType.NoValue?void 0:null),this.attribs&&!Object.prototype.hasOwnProperty.call(this.attribs,this.attribname)&&(this.attribs[this.attribname]=this.attribvalue),this.attribvalue=""},tt.prototype.getInstructionName=function(et){var nt=et.search(reNameEnd),rt=nt<0?et:et.substr(0,nt);return this.lowerCaseTagNames&&(rt=rt.toLowerCase()),rt},tt.prototype.ondeclaration=function(et,nt){this.endIndex=nt;var rt=this.getSlice(et,nt);if(this.cbs.onprocessinginstruction){var it=this.getInstructionName(rt);this.cbs.onprocessinginstruction("!".concat(it),"!".concat(rt))}this.startIndex=nt+1},tt.prototype.onprocessinginstruction=function(et,nt){this.endIndex=nt;var rt=this.getSlice(et,nt);if(this.cbs.onprocessinginstruction){var it=this.getInstructionName(rt);this.cbs.onprocessinginstruction("?".concat(it),"?".concat(rt))}this.startIndex=nt+1},tt.prototype.oncomment=function(et,nt,rt){var it,st,ot,lt;this.endIndex=nt,(st=(it=this.cbs).oncomment)===null||st===void 0||st.call(it,this.getSlice(et,nt-rt)),(lt=(ot=this.cbs).oncommentend)===null||lt===void 0||lt.call(ot),this.startIndex=nt+1},tt.prototype.oncdata=function(et,nt,rt){var it,st,ot,lt,ut,ct,dt,ft,pt,gt;this.endIndex=nt;var _r=this.getSlice(et,nt-rt);this.options.xmlMode||this.options.recognizeCDATA?((st=(it=this.cbs).oncdatastart)===null||st===void 0||st.call(it),(lt=(ot=this.cbs).ontext)===null||lt===void 0||lt.call(ot,_r),(ct=(ut=this.cbs).oncdataend)===null||ct===void 0||ct.call(ut)):((ft=(dt=this.cbs).oncomment)===null||ft===void 0||ft.call(dt,"[CDATA[".concat(_r,"]]")),(gt=(pt=this.cbs).oncommentend)===null||gt===void 0||gt.call(pt)),this.startIndex=nt+1},tt.prototype.onend=function(){var et,nt;if(this.cbs.onclosetag){this.endIndex=this.startIndex;for(var rt=this.stack.length;rt>0;this.cbs.onclosetag(this.stack[--rt],!0));}(nt=(et=this.cbs).onend)===null||nt===void 0||nt.call(et)},tt.prototype.reset=function(){var et,nt,rt,it;(nt=(et=this.cbs).onreset)===null||nt===void 0||nt.call(et),this.tokenizer.reset(),this.tagname="",this.attribname="",this.attribs=null,this.stack.length=0,this.startIndex=0,this.endIndex=0,(it=(rt=this.cbs).onparserinit)===null||it===void 0||it.call(rt,this),this.buffers.length=0,this.bufferOffset=0,this.writeIndex=0,this.ended=!1},tt.prototype.parseComplete=function(et){this.reset(),this.end(et)},tt.prototype.getSlice=function(et,nt){for(;et-this.bufferOffset>=this.buffers[0].length;)this.shiftBuffer();for(var rt=this.buffers[0].slice(et-this.bufferOffset,nt-this.bufferOffset);nt-this.bufferOffset>this.buffers[0].length;)this.shiftBuffer(),rt+=this.buffers[0].slice(0,nt-this.bufferOffset);return rt},tt.prototype.shiftBuffer=function(){this.bufferOffset+=this.buffers[0].length,this.writeIndex--,this.buffers.shift()},tt.prototype.write=function(et){var nt,rt;if(this.ended){(rt=(nt=this.cbs).onerror)===null||rt===void 0||rt.call(nt,new Error(".write() after done!"));return}this.buffers.push(et),this.tokenizer.running&&(this.tokenizer.write(et),this.writeIndex++)},tt.prototype.end=function(et){var nt,rt;if(this.ended){(rt=(nt=this.cbs).onerror)===null||rt===void 0||rt.call(nt,new Error(".end() after done!"));return}et&&this.write(et),this.ended=!0,this.tokenizer.end()},tt.prototype.pause=function(){this.tokenizer.pause()},tt.prototype.resume=function(){for(this.tokenizer.resume();this.tokenizer.running&&this.writeIndex<this.buffers.length;)this.tokenizer.write(this.buffers[this.writeIndex++]);this.ended&&this.tokenizer.end()},tt.prototype.parseChunk=function(et){this.write(et)},tt.prototype.done=function(et){this.end(et)},tt}();Parser$3.Parser=Parser$2;var lib$4={},lib$3={};(function(tt){Object.defineProperty(tt,"__esModule",{value:!0}),tt.Doctype=tt.CDATA=tt.Tag=tt.Style=tt.Script=tt.Comment=tt.Directive=tt.Text=tt.Root=tt.isTag=tt.ElementType=void 0;var et;(function(rt){rt.Root="root",rt.Text="text",rt.Directive="directive",rt.Comment="comment",rt.Script="script",rt.Style="style",rt.Tag="tag",rt.CDATA="cdata",rt.Doctype="doctype"})(et=tt.ElementType||(tt.ElementType={}));function nt(rt){return rt.type===et.Tag||rt.type===et.Script||rt.type===et.Style}tt.isTag=nt,tt.Root=et.Root,tt.Text=et.Text,tt.Directive=et.Directive,tt.Comment=et.Comment,tt.Script=et.Script,tt.Style=et.Style,tt.Tag=et.Tag,tt.CDATA=et.CDATA,tt.Doctype=et.Doctype})(lib$3);var node$1={},__extends=commonjsGlobal&&commonjsGlobal.__extends||function(){var tt=function(et,nt){return tt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(rt,it){rt.__proto__=it}||function(rt,it){for(var st in it)Object.prototype.hasOwnProperty.call(it,st)&&(rt[st]=it[st])},tt(et,nt)};return function(et,nt){if(typeof nt!="function"&&nt!==null)throw new TypeError("Class extends value "+String(nt)+" is not a constructor or null");tt(et,nt);function rt(){this.constructor=et}et.prototype=nt===null?Object.create(nt):(rt.prototype=nt.prototype,new rt)}}(),__assign$2=commonjsGlobal&&commonjsGlobal.__assign||function(){return __assign$2=Object.assign||function(tt){for(var et,nt=1,rt=arguments.length;nt<rt;nt++){et=arguments[nt];for(var it in et)Object.prototype.hasOwnProperty.call(et,it)&&(tt[it]=et[it])}return tt},__assign$2.apply(this,arguments)};Object.defineProperty(node$1,"__esModule",{value:!0}),node$1.cloneNode=node$1.hasChildren=node$1.isDocument=node$1.isDirective=node$1.isComment=node$1.isText=node$1.isCDATA=node$1.isTag=node$1.Element=node$1.Document=node$1.CDATA=node$1.NodeWithChildren=node$1.ProcessingInstruction=node$1.Comment=node$1.Text=node$1.DataNode=node$1.Node=void 0;var domelementtype_1$1=lib$3,Node$6=function(){function tt(){this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}return Object.defineProperty(tt.prototype,"parentNode",{get:function(){return this.parent},set:function(et){this.parent=et},enumerable:!1,configurable:!0}),Object.defineProperty(tt.prototype,"previousSibling",{get:function(){return this.prev},set:function(et){this.prev=et},enumerable:!1,configurable:!0}),Object.defineProperty(tt.prototype,"nextSibling",{get:function(){return this.next},set:function(et){this.next=et},enumerable:!1,configurable:!0}),tt.prototype.cloneNode=function(et){return et===void 0&&(et=!1),cloneNode$1(this,et)},tt}();node$1.Node=Node$6;var DataNode=function(tt){__extends(et,tt);function et(nt){var rt=tt.call(this)||this;return rt.data=nt,rt}return Object.defineProperty(et.prototype,"nodeValue",{get:function(){return this.data},set:function(nt){this.data=nt},enumerable:!1,configurable:!0}),et}(Node$6);node$1.DataNode=DataNode;var Text=function(tt){__extends(et,tt);function et(){var nt=tt!==null&&tt.apply(this,arguments)||this;return nt.type=domelementtype_1$1.ElementType.Text,nt}return Object.defineProperty(et.prototype,"nodeType",{get:function(){return 3},enumerable:!1,configurable:!0}),et}(DataNode);node$1.Text=Text;var Comment$5=function(tt){__extends(et,tt);function et(){var nt=tt!==null&&tt.apply(this,arguments)||this;return nt.type=domelementtype_1$1.ElementType.Comment,nt}return Object.defineProperty(et.prototype,"nodeType",{get:function(){return 8},enumerable:!1,configurable:!0}),et}(DataNode);node$1.Comment=Comment$5;var ProcessingInstruction=function(tt){__extends(et,tt);function et(nt,rt){var it=tt.call(this,rt)||this;return it.name=nt,it.type=domelementtype_1$1.ElementType.Directive,it}return Object.defineProperty(et.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),et}(DataNode);node$1.ProcessingInstruction=ProcessingInstruction;var NodeWithChildren=function(tt){__extends(et,tt);function et(nt){var rt=tt.call(this)||this;return rt.children=nt,rt}return Object.defineProperty(et.prototype,"firstChild",{get:function(){var nt;return(nt=this.children[0])!==null&&nt!==void 0?nt:null},enumerable:!1,configurable:!0}),Object.defineProperty(et.prototype,"lastChild",{get:function(){return this.children.length>0?this.children[this.children.length-1]:null},enumerable:!1,configurable:!0}),Object.defineProperty(et.prototype,"childNodes",{get:function(){return this.children},set:function(nt){this.children=nt},enumerable:!1,configurable:!0}),et}(Node$6);node$1.NodeWithChildren=NodeWithChildren;var CDATA=function(tt){__extends(et,tt);function et(){var nt=tt!==null&&tt.apply(this,arguments)||this;return nt.type=domelementtype_1$1.ElementType.CDATA,nt}return Object.defineProperty(et.prototype,"nodeType",{get:function(){return 4},enumerable:!1,configurable:!0}),et}(NodeWithChildren);node$1.CDATA=CDATA;var Document$4=function(tt){__extends(et,tt);function et(){var nt=tt!==null&&tt.apply(this,arguments)||this;return nt.type=domelementtype_1$1.ElementType.Root,nt}return Object.defineProperty(et.prototype,"nodeType",{get:function(){return 9},enumerable:!1,configurable:!0}),et}(NodeWithChildren);node$1.Document=Document$4;var Element$1=function(tt){__extends(et,tt);function et(nt,rt,it,st){it===void 0&&(it=[]),st===void 0&&(st=nt==="script"?domelementtype_1$1.ElementType.Script:nt==="style"?domelementtype_1$1.ElementType.Style:domelementtype_1$1.ElementType.Tag);var ot=tt.call(this,it)||this;return ot.name=nt,ot.attribs=rt,ot.type=st,ot}return Object.defineProperty(et.prototype,"nodeType",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(et.prototype,"tagName",{get:function(){return this.name},set:function(nt){this.name=nt},enumerable:!1,configurable:!0}),Object.defineProperty(et.prototype,"attributes",{get:function(){var nt=this;return Object.keys(this.attribs).map(function(rt){var it,st;return{name:rt,value:nt.attribs[rt],namespace:(it=nt["x-attribsNamespace"])===null||it===void 0?void 0:it[rt],prefix:(st=nt["x-attribsPrefix"])===null||st===void 0?void 0:st[rt]}})},enumerable:!1,configurable:!0}),et}(NodeWithChildren);node$1.Element=Element$1;function isTag(tt){return(0,domelementtype_1$1.isTag)(tt)}node$1.isTag=isTag;function isCDATA(tt){return tt.type===domelementtype_1$1.ElementType.CDATA}node$1.isCDATA=isCDATA;function isText(tt){return tt.type===domelementtype_1$1.ElementType.Text}node$1.isText=isText;function isComment(tt){return tt.type===domelementtype_1$1.ElementType.Comment}node$1.isComment=isComment;function isDirective(tt){return tt.type===domelementtype_1$1.ElementType.Directive}node$1.isDirective=isDirective;function isDocument(tt){return tt.type===domelementtype_1$1.ElementType.Root}node$1.isDocument=isDocument;function hasChildren(tt){return Object.prototype.hasOwnProperty.call(tt,"children")}node$1.hasChildren=hasChildren;function cloneNode$1(tt,et){et===void 0&&(et=!1);var nt;if(isText(tt))nt=new Text(tt.data);else if(isComment(tt))nt=new Comment$5(tt.data);else if(isTag(tt)){var rt=et?cloneChildren(tt.children):[],it=new Element$1(tt.name,__assign$2({},tt.attribs),rt);rt.forEach(function(ut){return ut.parent=it}),tt.namespace!=null&&(it.namespace=tt.namespace),tt["x-attribsNamespace"]&&(it["x-attribsNamespace"]=__assign$2({},tt["x-attribsNamespace"])),tt["x-attribsPrefix"]&&(it["x-attribsPrefix"]=__assign$2({},tt["x-attribsPrefix"])),nt=it}else if(isCDATA(tt)){var rt=et?cloneChildren(tt.children):[],st=new CDATA(rt);rt.forEach(function(ct){return ct.parent=st}),nt=st}else if(isDocument(tt)){var rt=et?cloneChildren(tt.children):[],ot=new Document$4(rt);rt.forEach(function(ct){return ct.parent=ot}),tt["x-mode"]&&(ot["x-mode"]=tt["x-mode"]),nt=ot}else if(isDirective(tt)){var lt=new ProcessingInstruction(tt.name,tt.data);tt["x-name"]!=null&&(lt["x-name"]=tt["x-name"],lt["x-publicId"]=tt["x-publicId"],lt["x-systemId"]=tt["x-systemId"]),nt=lt}else throw new Error("Not implemented yet: ".concat(tt.type));return nt.startIndex=tt.startIndex,nt.endIndex=tt.endIndex,tt.sourceCodeLocation!=null&&(nt.sourceCodeLocation=tt.sourceCodeLocation),nt}node$1.cloneNode=cloneNode$1;function cloneChildren(tt){for(var et=tt.map(function(rt){return cloneNode$1(rt,!0)}),nt=1;nt<et.length;nt++)et[nt].prev=et[nt-1],et[nt-1].next=et[nt];return et}(function(tt){var et=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(lt,ut,ct,dt){dt===void 0&&(dt=ct);var ft=Object.getOwnPropertyDescriptor(ut,ct);(!ft||("get"in ft?!ut.__esModule:ft.writable||ft.configurable))&&(ft={enumerable:!0,get:function(){return ut[ct]}}),Object.defineProperty(lt,dt,ft)}:function(lt,ut,ct,dt){dt===void 0&&(dt=ct),lt[dt]=ut[ct]}),nt=commonjsGlobal&&commonjsGlobal.__exportStar||function(lt,ut){for(var ct in lt)ct!=="default"&&!Object.prototype.hasOwnProperty.call(ut,ct)&&et(ut,lt,ct)};Object.defineProperty(tt,"__esModule",{value:!0}),tt.DomHandler=void 0;var rt=lib$3,it=node$1;nt(node$1,tt);var st={withStartIndices:!1,withEndIndices:!1,xmlMode:!1},ot=function(){function lt(ut,ct,dt){this.dom=[],this.root=new it.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,typeof ct=="function"&&(dt=ct,ct=st),typeof ut=="object"&&(ct=ut,ut=void 0),this.callback=ut??null,this.options=ct??st,this.elementCB=dt??null}return lt.prototype.onparserinit=function(ut){this.parser=ut},lt.prototype.onreset=function(){this.dom=[],this.root=new it.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null},lt.prototype.onend=function(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))},lt.prototype.onerror=function(ut){this.handleCallback(ut)},lt.prototype.onclosetag=function(){this.lastNode=null;var ut=this.tagStack.pop();this.options.withEndIndices&&(ut.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(ut)},lt.prototype.onopentag=function(ut,ct){var dt=this.options.xmlMode?rt.ElementType.Tag:void 0,ft=new it.Element(ut,ct,void 0,dt);this.addNode(ft),this.tagStack.push(ft)},lt.prototype.ontext=function(ut){var ct=this.lastNode;if(ct&&ct.type===rt.ElementType.Text)ct.data+=ut,this.options.withEndIndices&&(ct.endIndex=this.parser.endIndex);else{var dt=new it.Text(ut);this.addNode(dt),this.lastNode=dt}},lt.prototype.oncomment=function(ut){if(this.lastNode&&this.lastNode.type===rt.ElementType.Comment){this.lastNode.data+=ut;return}var ct=new it.Comment(ut);this.addNode(ct),this.lastNode=ct},lt.prototype.oncommentend=function(){this.lastNode=null},lt.prototype.oncdatastart=function(){var ut=new it.Text(""),ct=new it.CDATA([ut]);this.addNode(ct),ut.parent=ct,this.lastNode=ut},lt.prototype.oncdataend=function(){this.lastNode=null},lt.prototype.onprocessinginstruction=function(ut,ct){var dt=new it.ProcessingInstruction(ut,ct);this.addNode(dt)},lt.prototype.handleCallback=function(ut){if(typeof this.callback=="function")this.callback(ut,this.dom);else if(ut)throw ut},lt.prototype.addNode=function(ut){var ct=this.tagStack[this.tagStack.length-1],dt=ct.children[ct.children.length-1];this.options.withStartIndices&&(ut.startIndex=this.parser.startIndex),this.options.withEndIndices&&(ut.endIndex=this.parser.endIndex),ct.children.push(ut),dt&&(ut.prev=dt,dt.next=ut),ut.parent=ct,this.lastNode=null},lt}();tt.DomHandler=ot,tt.default=ot})(lib$4);var lib$2={},stringify$5={},lib$1={},lib={},encode={},encodeHtml={};Object.defineProperty(encodeHtml,"__esModule",{value:!0});function restoreDiff(tt){for(var et=1;et<tt.length;et++)tt[et][0]+=tt[et-1][0]+1;return tt}encodeHtml.default=new Map(restoreDiff([[9,"&Tab;"],[0,"&NewLine;"],[22,"&excl;"],[0,"&quot;"],[0,"&num;"],[0,"&dollar;"],[0,"&percnt;"],[0,"&amp;"],[0,"&apos;"],[0,"&lpar;"],[0,"&rpar;"],[0,"&ast;"],[0,"&plus;"],[0,"&comma;"],[1,"&period;"],[0,"&sol;"],[10,"&colon;"],[0,"&semi;"],[0,{v:"&lt;",n:8402,o:"&nvlt;"}],[0,{v:"&equals;",n:8421,o:"&bne;"}],[0,{v:"&gt;",n:8402,o:"&nvgt;"}],[0,"&quest;"],[0,"&commat;"],[26,"&lbrack;"],[0,"&bsol;"],[0,"&rbrack;"],[0,"&Hat;"],[0,"&lowbar;"],[0,"&DiacriticalGrave;"],[5,{n:106,o:"&fjlig;"}],[20,"&lbrace;"],[0,"&verbar;"],[0,"&rbrace;"],[34,"&nbsp;"],[0,"&iexcl;"],[0,"&cent;"],[0,"&pound;"],[0,"&curren;"],[0,"&yen;"],[0,"&brvbar;"],[0,"&sect;"],[0,"&die;"],[0,"&copy;"],[0,"&ordf;"],[0,"&laquo;"],[0,"&not;"],[0,"&shy;"],[0,"&circledR;"],[0,"&macr;"],[0,"&deg;"],[0,"&PlusMinus;"],[0,"&sup2;"],[0,"&sup3;"],[0,"&acute;"],[0,"&micro;"],[0,"&para;"],[0,"&centerdot;"],[0,"&cedil;"],[0,"&sup1;"],[0,"&ordm;"],[0,"&raquo;"],[0,"&frac14;"],[0,"&frac12;"],[0,"&frac34;"],[0,"&iquest;"],[0,"&Agrave;"],[0,"&Aacute;"],[0,"&Acirc;"],[0,"&Atilde;"],[0,"&Auml;"],[0,"&angst;"],[0,"&AElig;"],[0,"&Ccedil;"],[0,"&Egrave;"],[0,"&Eacute;"],[0,"&Ecirc;"],[0,"&Euml;"],[0,"&Igrave;"],[0,"&Iacute;"],[0,"&Icirc;"],[0,"&Iuml;"],[0,"&ETH;"],[0,"&Ntilde;"],[0,"&Ograve;"],[0,"&Oacute;"],[0,"&Ocirc;"],[0,"&Otilde;"],[0,"&Ouml;"],[0,"&times;"],[0,"&Oslash;"],[0,"&Ugrave;"],[0,"&Uacute;"],[0,"&Ucirc;"],[0,"&Uuml;"],[0,"&Yacute;"],[0,"&THORN;"],[0,"&szlig;"],[0,"&agrave;"],[0,"&aacute;"],[0,"&acirc;"],[0,"&atilde;"],[0,"&auml;"],[0,"&aring;"],[0,"&aelig;"],[0,"&ccedil;"],[0,"&egrave;"],[0,"&eacute;"],[0,"&ecirc;"],[0,"&euml;"],[0,"&igrave;"],[0,"&iacute;"],[0,"&icirc;"],[0,"&iuml;"],[0,"&eth;"],[0,"&ntilde;"],[0,"&ograve;"],[0,"&oacute;"],[0,"&ocirc;"],[0,"&otilde;"],[0,"&ouml;"],[0,"&div;"],[0,"&oslash;"],[0,"&ugrave;"],[0,"&uacute;"],[0,"&ucirc;"],[0,"&uuml;"],[0,"&yacute;"],[0,"&thorn;"],[0,"&yuml;"],[0,"&Amacr;"],[0,"&amacr;"],[0,"&Abreve;"],[0,"&abreve;"],[0,"&Aogon;"],[0,"&aogon;"],[0,"&Cacute;"],[0,"&cacute;"],[0,"&Ccirc;"],[0,"&ccirc;"],[0,"&Cdot;"],[0,"&cdot;"],[0,"&Ccaron;"],[0,"&ccaron;"],[0,"&Dcaron;"],[0,"&dcaron;"],[0,"&Dstrok;"],[0,"&dstrok;"],[0,"&Emacr;"],[0,"&emacr;"],[2,"&Edot;"],[0,"&edot;"],[0,"&Eogon;"],[0,"&eogon;"],[0,"&Ecaron;"],[0,"&ecaron;"],[0,"&Gcirc;"],[0,"&gcirc;"],[0,"&Gbreve;"],[0,"&gbreve;"],[0,"&Gdot;"],[0,"&gdot;"],[0,"&Gcedil;"],[1,"&Hcirc;"],[0,"&hcirc;"],[0,"&Hstrok;"],[0,"&hstrok;"],[0,"&Itilde;"],[0,"&itilde;"],[0,"&Imacr;"],[0,"&imacr;"],[2,"&Iogon;"],[0,"&iogon;"],[0,"&Idot;"],[0,"&imath;"],[0,"&IJlig;"],[0,"&ijlig;"],[0,"&Jcirc;"],[0,"&jcirc;"],[0,"&Kcedil;"],[0,"&kcedil;"],[0,"&kgreen;"],[0,"&Lacute;"],[0,"&lacute;"],[0,"&Lcedil;"],[0,"&lcedil;"],[0,"&Lcaron;"],[0,"&lcaron;"],[0,"&Lmidot;"],[0,"&lmidot;"],[0,"&Lstrok;"],[0,"&lstrok;"],[0,"&Nacute;"],[0,"&nacute;"],[0,"&Ncedil;"],[0,"&ncedil;"],[0,"&Ncaron;"],[0,"&ncaron;"],[0,"&napos;"],[0,"&ENG;"],[0,"&eng;"],[0,"&Omacr;"],[0,"&omacr;"],[2,"&Odblac;"],[0,"&odblac;"],[0,"&OElig;"],[0,"&oelig;"],[0,"&Racute;"],[0,"&racute;"],[0,"&Rcedil;"],[0,"&rcedil;"],[0,"&Rcaron;"],[0,"&rcaron;"],[0,"&Sacute;"],[0,"&sacute;"],[0,"&Scirc;"],[0,"&scirc;"],[0,"&Scedil;"],[0,"&scedil;"],[0,"&Scaron;"],[0,"&scaron;"],[0,"&Tcedil;"],[0,"&tcedil;"],[0,"&Tcaron;"],[0,"&tcaron;"],[0,"&Tstrok;"],[0,"&tstrok;"],[0,"&Utilde;"],[0,"&utilde;"],[0,"&Umacr;"],[0,"&umacr;"],[0,"&Ubreve;"],[0,"&ubreve;"],[0,"&Uring;"],[0,"&uring;"],[0,"&Udblac;"],[0,"&udblac;"],[0,"&Uogon;"],[0,"&uogon;"],[0,"&Wcirc;"],[0,"&wcirc;"],[0,"&Ycirc;"],[0,"&ycirc;"],[0,"&Yuml;"],[0,"&Zacute;"],[0,"&zacute;"],[0,"&Zdot;"],[0,"&zdot;"],[0,"&Zcaron;"],[0,"&zcaron;"],[19,"&fnof;"],[34,"&imped;"],[63,"&gacute;"],[65,"&jmath;"],[142,"&circ;"],[0,"&caron;"],[16,"&breve;"],[0,"&DiacriticalDot;"],[0,"&ring;"],[0,"&ogon;"],[0,"&DiacriticalTilde;"],[0,"&dblac;"],[51,"&DownBreve;"],[127,"&Alpha;"],[0,"&Beta;"],[0,"&Gamma;"],[0,"&Delta;"],[0,"&Epsilon;"],[0,"&Zeta;"],[0,"&Eta;"],[0,"&Theta;"],[0,"&Iota;"],[0,"&Kappa;"],[0,"&Lambda;"],[0,"&Mu;"],[0,"&Nu;"],[0,"&Xi;"],[0,"&Omicron;"],[0,"&Pi;"],[0,"&Rho;"],[1,"&Sigma;"],[0,"&Tau;"],[0,"&Upsilon;"],[0,"&Phi;"],[0,"&Chi;"],[0,"&Psi;"],[0,"&ohm;"],[7,"&alpha;"],[0,"&beta;"],[0,"&gamma;"],[0,"&delta;"],[0,"&epsi;"],[0,"&zeta;"],[0,"&eta;"],[0,"&theta;"],[0,"&iota;"],[0,"&kappa;"],[0,"&lambda;"],[0,"&mu;"],[0,"&nu;"],[0,"&xi;"],[0,"&omicron;"],[0,"&pi;"],[0,"&rho;"],[0,"&sigmaf;"],[0,"&sigma;"],[0,"&tau;"],[0,"&upsi;"],[0,"&phi;"],[0,"&chi;"],[0,"&psi;"],[0,"&omega;"],[7,"&thetasym;"],[0,"&Upsi;"],[2,"&phiv;"],[0,"&piv;"],[5,"&Gammad;"],[0,"&digamma;"],[18,"&kappav;"],[0,"&rhov;"],[3,"&epsiv;"],[0,"&backepsilon;"],[10,"&IOcy;"],[0,"&DJcy;"],[0,"&GJcy;"],[0,"&Jukcy;"],[0,"&DScy;"],[0,"&Iukcy;"],[0,"&YIcy;"],[0,"&Jsercy;"],[0,"&LJcy;"],[0,"&NJcy;"],[0,"&TSHcy;"],[0,"&KJcy;"],[1,"&Ubrcy;"],[0,"&DZcy;"],[0,"&Acy;"],[0,"&Bcy;"],[0,"&Vcy;"],[0,"&Gcy;"],[0,"&Dcy;"],[0,"&IEcy;"],[0,"&ZHcy;"],[0,"&Zcy;"],[0,"&Icy;"],[0,"&Jcy;"],[0,"&Kcy;"],[0,"&Lcy;"],[0,"&Mcy;"],[0,"&Ncy;"],[0,"&Ocy;"],[0,"&Pcy;"],[0,"&Rcy;"],[0,"&Scy;"],[0,"&Tcy;"],[0,"&Ucy;"],[0,"&Fcy;"],[0,"&KHcy;"],[0,"&TScy;"],[0,"&CHcy;"],[0,"&SHcy;"],[0,"&SHCHcy;"],[0,"&HARDcy;"],[0,"&Ycy;"],[0,"&SOFTcy;"],[0,"&Ecy;"],[0,"&YUcy;"],[0,"&YAcy;"],[0,"&acy;"],[0,"&bcy;"],[0,"&vcy;"],[0,"&gcy;"],[0,"&dcy;"],[0,"&iecy;"],[0,"&zhcy;"],[0,"&zcy;"],[0,"&icy;"],[0,"&jcy;"],[0,"&kcy;"],[0,"&lcy;"],[0,"&mcy;"],[0,"&ncy;"],[0,"&ocy;"],[0,"&pcy;"],[0,"&rcy;"],[0,"&scy;"],[0,"&tcy;"],[0,"&ucy;"],[0,"&fcy;"],[0,"&khcy;"],[0,"&tscy;"],[0,"&chcy;"],[0,"&shcy;"],[0,"&shchcy;"],[0,"&hardcy;"],[0,"&ycy;"],[0,"&softcy;"],[0,"&ecy;"],[0,"&yucy;"],[0,"&yacy;"],[1,"&iocy;"],[0,"&djcy;"],[0,"&gjcy;"],[0,"&jukcy;"],[0,"&dscy;"],[0,"&iukcy;"],[0,"&yicy;"],[0,"&jsercy;"],[0,"&ljcy;"],[0,"&njcy;"],[0,"&tshcy;"],[0,"&kjcy;"],[1,"&ubrcy;"],[0,"&dzcy;"],[7074,"&ensp;"],[0,"&emsp;"],[0,"&emsp13;"],[0,"&emsp14;"],[1,"&numsp;"],[0,"&puncsp;"],[0,"&ThinSpace;"],[0,"&hairsp;"],[0,"&NegativeMediumSpace;"],[0,"&zwnj;"],[0,"&zwj;"],[0,"&lrm;"],[0,"&rlm;"],[0,"&dash;"],[2,"&ndash;"],[0,"&mdash;"],[0,"&horbar;"],[0,"&Verbar;"],[1,"&lsquo;"],[0,"&CloseCurlyQuote;"],[0,"&lsquor;"],[1,"&ldquo;"],[0,"&CloseCurlyDoubleQuote;"],[0,"&bdquo;"],[1,"&dagger;"],[0,"&Dagger;"],[0,"&bull;"],[2,"&nldr;"],[0,"&hellip;"],[9,"&permil;"],[0,"&pertenk;"],[0,"&prime;"],[0,"&Prime;"],[0,"&tprime;"],[0,"&backprime;"],[3,"&lsaquo;"],[0,"&rsaquo;"],[3,"&oline;"],[2,"&caret;"],[1,"&hybull;"],[0,"&frasl;"],[10,"&bsemi;"],[7,"&qprime;"],[7,{v:"&MediumSpace;",n:8202,o:"&ThickSpace;"}],[0,"&NoBreak;"],[0,"&af;"],[0,"&InvisibleTimes;"],[0,"&ic;"],[72,"&euro;"],[46,"&tdot;"],[0,"&DotDot;"],[37,"&complexes;"],[2,"&incare;"],[4,"&gscr;"],[0,"&hamilt;"],[0,"&Hfr;"],[0,"&Hopf;"],[0,"&planckh;"],[0,"&hbar;"],[0,"&imagline;"],[0,"&Ifr;"],[0,"&lagran;"],[0,"&ell;"],[1,"&naturals;"],[0,"&numero;"],[0,"&copysr;"],[0,"&weierp;"],[0,"&Popf;"],[0,"&Qopf;"],[0,"&realine;"],[0,"&real;"],[0,"&reals;"],[0,"&rx;"],[3,"&trade;"],[1,"&integers;"],[2,"&mho;"],[0,"&zeetrf;"],[0,"&iiota;"],[2,"&bernou;"],[0,"&Cayleys;"],[1,"&escr;"],[0,"&Escr;"],[0,"&Fouriertrf;"],[1,"&Mellintrf;"],[0,"&order;"],[0,"&alefsym;"],[0,"&beth;"],[0,"&gimel;"],[0,"&daleth;"],[12,"&CapitalDifferentialD;"],[0,"&dd;"],[0,"&ee;"],[0,"&ii;"],[10,"&frac13;"],[0,"&frac23;"],[0,"&frac15;"],[0,"&frac25;"],[0,"&frac35;"],[0,"&frac45;"],[0,"&frac16;"],[0,"&frac56;"],[0,"&frac18;"],[0,"&frac38;"],[0,"&frac58;"],[0,"&frac78;"],[49,"&larr;"],[0,"&ShortUpArrow;"],[0,"&rarr;"],[0,"&darr;"],[0,"&harr;"],[0,"&updownarrow;"],[0,"&nwarr;"],[0,"&nearr;"],[0,"&LowerRightArrow;"],[0,"&LowerLeftArrow;"],[0,"&nlarr;"],[0,"&nrarr;"],[1,{v:"&rarrw;",n:824,o:"&nrarrw;"}],[0,"&Larr;"],[0,"&Uarr;"],[0,"&Rarr;"],[0,"&Darr;"],[0,"&larrtl;"],[0,"&rarrtl;"],[0,"&LeftTeeArrow;"],[0,"&mapstoup;"],[0,"&map;"],[0,"&DownTeeArrow;"],[1,"&hookleftarrow;"],[0,"&hookrightarrow;"],[0,"&larrlp;"],[0,"&looparrowright;"],[0,"&harrw;"],[0,"&nharr;"],[1,"&lsh;"],[0,"&rsh;"],[0,"&ldsh;"],[0,"&rdsh;"],[1,"&crarr;"],[0,"&cularr;"],[0,"&curarr;"],[2,"&circlearrowleft;"],[0,"&circlearrowright;"],[0,"&leftharpoonup;"],[0,"&DownLeftVector;"],[0,"&RightUpVector;"],[0,"&LeftUpVector;"],[0,"&rharu;"],[0,"&DownRightVector;"],[0,"&dharr;"],[0,"&dharl;"],[0,"&RightArrowLeftArrow;"],[0,"&udarr;"],[0,"&LeftArrowRightArrow;"],[0,"&leftleftarrows;"],[0,"&upuparrows;"],[0,"&rightrightarrows;"],[0,"&ddarr;"],[0,"&leftrightharpoons;"],[0,"&Equilibrium;"],[0,"&nlArr;"],[0,"&nhArr;"],[0,"&nrArr;"],[0,"&DoubleLeftArrow;"],[0,"&DoubleUpArrow;"],[0,"&DoubleRightArrow;"],[0,"&dArr;"],[0,"&DoubleLeftRightArrow;"],[0,"&DoubleUpDownArrow;"],[0,"&nwArr;"],[0,"&neArr;"],[0,"&seArr;"],[0,"&swArr;"],[0,"&lAarr;"],[0,"&rAarr;"],[1,"&zigrarr;"],[6,"&larrb;"],[0,"&rarrb;"],[15,"&DownArrowUpArrow;"],[7,"&loarr;"],[0,"&roarr;"],[0,"&hoarr;"],[0,"&forall;"],[0,"&comp;"],[0,{v:"&part;",n:824,o:"&npart;"}],[0,"&exist;"],[0,"&nexist;"],[0,"&empty;"],[1,"&Del;"],[0,"&Element;"],[0,"&NotElement;"],[1,"&ni;"],[0,"&notni;"],[2,"&prod;"],[0,"&coprod;"],[0,"&sum;"],[0,"&minus;"],[0,"&MinusPlus;"],[0,"&dotplus;"],[1,"&Backslash;"],[0,"&lowast;"],[0,"&compfn;"],[1,"&radic;"],[2,"&prop;"],[0,"&infin;"],[0,"&angrt;"],[0,{v:"&ang;",n:8402,o:"&nang;"}],[0,"&angmsd;"],[0,"&angsph;"],[0,"&mid;"],[0,"&nmid;"],[0,"&DoubleVerticalBar;"],[0,"&NotDoubleVerticalBar;"],[0,"&and;"],[0,"&or;"],[0,{v:"&cap;",n:65024,o:"&caps;"}],[0,{v:"&cup;",n:65024,o:"&cups;"}],[0,"&int;"],[0,"&Int;"],[0,"&iiint;"],[0,"&conint;"],[0,"&Conint;"],[0,"&Cconint;"],[0,"&cwint;"],[0,"&ClockwiseContourIntegral;"],[0,"&awconint;"],[0,"&there4;"],[0,"&becaus;"],[0,"&ratio;"],[0,"&Colon;"],[0,"&dotminus;"],[1,"&mDDot;"],[0,"&homtht;"],[0,{v:"&sim;",n:8402,o:"&nvsim;"}],[0,{v:"&backsim;",n:817,o:"&race;"}],[0,{v:"&ac;",n:819,o:"&acE;"}],[0,"&acd;"],[0,"&VerticalTilde;"],[0,"&NotTilde;"],[0,{v:"&eqsim;",n:824,o:"&nesim;"}],[0,"&sime;"],[0,"&NotTildeEqual;"],[0,"&cong;"],[0,"&simne;"],[0,"&ncong;"],[0,"&ap;"],[0,"&nap;"],[0,"&ape;"],[0,{v:"&apid;",n:824,o:"&napid;"}],[0,"&backcong;"],[0,{v:"&asympeq;",n:8402,o:"&nvap;"}],[0,{v:"&bump;",n:824,o:"&nbump;"}],[0,{v:"&bumpe;",n:824,o:"&nbumpe;"}],[0,{v:"&doteq;",n:824,o:"&nedot;"}],[0,"&doteqdot;"],[0,"&efDot;"],[0,"&erDot;"],[0,"&Assign;"],[0,"&ecolon;"],[0,"&ecir;"],[0,"&circeq;"],[1,"&wedgeq;"],[0,"&veeeq;"],[1,"&triangleq;"],[2,"&equest;"],[0,"&ne;"],[0,{v:"&Congruent;",n:8421,o:"&bnequiv;"}],[0,"&nequiv;"],[1,{v:"&le;",n:8402,o:"&nvle;"}],[0,{v:"&ge;",n:8402,o:"&nvge;"}],[0,{v:"&lE;",n:824,o:"&nlE;"}],[0,{v:"&gE;",n:824,o:"&ngE;"}],[0,{v:"&lnE;",n:65024,o:"&lvertneqq;"}],[0,{v:"&gnE;",n:65024,o:"&gvertneqq;"}],[0,{v:"&ll;",n:new Map(restoreDiff([[824,"&nLtv;"],[7577,"&nLt;"]]))}],[0,{v:"&gg;",n:new Map(restoreDiff([[824,"&nGtv;"],[7577,"&nGt;"]]))}],[0,"&between;"],[0,"&NotCupCap;"],[0,"&nless;"],[0,"&ngt;"],[0,"&nle;"],[0,"&nge;"],[0,"&lesssim;"],[0,"&GreaterTilde;"],[0,"&nlsim;"],[0,"&ngsim;"],[0,"&LessGreater;"],[0,"&gl;"],[0,"&NotLessGreater;"],[0,"&NotGreaterLess;"],[0,"&pr;"],[0,"&sc;"],[0,"&prcue;"],[0,"&sccue;"],[0,"&PrecedesTilde;"],[0,{v:"&scsim;",n:824,o:"&NotSucceedsTilde;"}],[0,"&NotPrecedes;"],[0,"&NotSucceeds;"],[0,{v:"&sub;",n:8402,o:"&NotSubset;"}],[0,{v:"&sup;",n:8402,o:"&NotSuperset;"}],[0,"&nsub;"],[0,"&nsup;"],[0,"&sube;"],[0,"&supe;"],[0,"&NotSubsetEqual;"],[0,"&NotSupersetEqual;"],[0,{v:"&subne;",n:65024,o:"&varsubsetneq;"}],[0,{v:"&supne;",n:65024,o:"&varsupsetneq;"}],[1,"&cupdot;"],[0,"&UnionPlus;"],[0,{v:"&sqsub;",n:824,o:"&NotSquareSubset;"}],[0,{v:"&sqsup;",n:824,o:"&NotSquareSuperset;"}],[0,"&sqsube;"],[0,"&sqsupe;"],[0,{v:"&sqcap;",n:65024,o:"&sqcaps;"}],[0,{v:"&sqcup;",n:65024,o:"&sqcups;"}],[0,"&CirclePlus;"],[0,"&CircleMinus;"],[0,"&CircleTimes;"],[0,"&osol;"],[0,"&CircleDot;"],[0,"&circledcirc;"],[0,"&circledast;"],[1,"&circleddash;"],[0,"&boxplus;"],[0,"&boxminus;"],[0,"&boxtimes;"],[0,"&dotsquare;"],[0,"&RightTee;"],[0,"&dashv;"],[0,"&DownTee;"],[0,"&bot;"],[1,"&models;"],[0,"&DoubleRightTee;"],[0,"&Vdash;"],[0,"&Vvdash;"],[0,"&VDash;"],[0,"&nvdash;"],[0,"&nvDash;"],[0,"&nVdash;"],[0,"&nVDash;"],[0,"&prurel;"],[1,"&LeftTriangle;"],[0,"&RightTriangle;"],[0,{v:"&LeftTriangleEqual;",n:8402,o:"&nvltrie;"}],[0,{v:"&RightTriangleEqual;",n:8402,o:"&nvrtrie;"}],[0,"&origof;"],[0,"&imof;"],[0,"&multimap;"],[0,"&hercon;"],[0,"&intcal;"],[0,"&veebar;"],[1,"&barvee;"],[0,"&angrtvb;"],[0,"&lrtri;"],[0,"&bigwedge;"],[0,"&bigvee;"],[0,"&bigcap;"],[0,"&bigcup;"],[0,"&diam;"],[0,"&sdot;"],[0,"&sstarf;"],[0,"&divideontimes;"],[0,"&bowtie;"],[0,"&ltimes;"],[0,"&rtimes;"],[0,"&leftthreetimes;"],[0,"&rightthreetimes;"],[0,"&backsimeq;"],[0,"&curlyvee;"],[0,"&curlywedge;"],[0,"&Sub;"],[0,"&Sup;"],[0,"&Cap;"],[0,"&Cup;"],[0,"&fork;"],[0,"&epar;"],[0,"&lessdot;"],[0,"&gtdot;"],[0,{v:"&Ll;",n:824,o:"&nLl;"}],[0,{v:"&Gg;",n:824,o:"&nGg;"}],[0,{v:"&leg;",n:65024,o:"&lesg;"}],[0,{v:"&gel;",n:65024,o:"&gesl;"}],[2,"&cuepr;"],[0,"&cuesc;"],[0,"&NotPrecedesSlantEqual;"],[0,"&NotSucceedsSlantEqual;"],[0,"&NotSquareSubsetEqual;"],[0,"&NotSquareSupersetEqual;"],[2,"&lnsim;"],[0,"&gnsim;"],[0,"&precnsim;"],[0,"&scnsim;"],[0,"&nltri;"],[0,"&NotRightTriangle;"],[0,"&nltrie;"],[0,"&NotRightTriangleEqual;"],[0,"&vellip;"],[0,"&ctdot;"],[0,"&utdot;"],[0,"&dtdot;"],[0,"&disin;"],[0,"&isinsv;"],[0,"&isins;"],[0,{v:"&isindot;",n:824,o:"&notindot;"}],[0,"&notinvc;"],[0,"&notinvb;"],[1,{v:"&isinE;",n:824,o:"&notinE;"}],[0,"&nisd;"],[0,"&xnis;"],[0,"&nis;"],[0,"&notnivc;"],[0,"&notnivb;"],[6,"&barwed;"],[0,"&Barwed;"],[1,"&lceil;"],[0,"&rceil;"],[0,"&LeftFloor;"],[0,"&rfloor;"],[0,"&drcrop;"],[0,"&dlcrop;"],[0,"&urcrop;"],[0,"&ulcrop;"],[0,"&bnot;"],[1,"&profline;"],[0,"&profsurf;"],[1,"&telrec;"],[0,"&target;"],[5,"&ulcorn;"],[0,"&urcorn;"],[0,"&dlcorn;"],[0,"&drcorn;"],[2,"&frown;"],[0,"&smile;"],[9,"&cylcty;"],[0,"&profalar;"],[7,"&topbot;"],[6,"&ovbar;"],[1,"&solbar;"],[60,"&angzarr;"],[51,"&lmoustache;"],[0,"&rmoustache;"],[2,"&OverBracket;"],[0,"&bbrk;"],[0,"&bbrktbrk;"],[37,"&OverParenthesis;"],[0,"&UnderParenthesis;"],[0,"&OverBrace;"],[0,"&UnderBrace;"],[2,"&trpezium;"],[4,"&elinters;"],[59,"&blank;"],[164,"&circledS;"],[55,"&boxh;"],[1,"&boxv;"],[9,"&boxdr;"],[3,"&boxdl;"],[3,"&boxur;"],[3,"&boxul;"],[3,"&boxvr;"],[7,"&boxvl;"],[7,"&boxhd;"],[7,"&boxhu;"],[7,"&boxvh;"],[19,"&boxH;"],[0,"&boxV;"],[0,"&boxdR;"],[0,"&boxDr;"],[0,"&boxDR;"],[0,"&boxdL;"],[0,"&boxDl;"],[0,"&boxDL;"],[0,"&boxuR;"],[0,"&boxUr;"],[0,"&boxUR;"],[0,"&boxuL;"],[0,"&boxUl;"],[0,"&boxUL;"],[0,"&boxvR;"],[0,"&boxVr;"],[0,"&boxVR;"],[0,"&boxvL;"],[0,"&boxVl;"],[0,"&boxVL;"],[0,"&boxHd;"],[0,"&boxhD;"],[0,"&boxHD;"],[0,"&boxHu;"],[0,"&boxhU;"],[0,"&boxHU;"],[0,"&boxvH;"],[0,"&boxVh;"],[0,"&boxVH;"],[19,"&uhblk;"],[3,"&lhblk;"],[3,"&block;"],[8,"&blk14;"],[0,"&blk12;"],[0,"&blk34;"],[13,"&square;"],[8,"&blacksquare;"],[0,"&EmptyVerySmallSquare;"],[1,"&rect;"],[0,"&marker;"],[2,"&fltns;"],[1,"&bigtriangleup;"],[0,"&blacktriangle;"],[0,"&triangle;"],[2,"&blacktriangleright;"],[0,"&rtri;"],[3,"&bigtriangledown;"],[0,"&blacktriangledown;"],[0,"&dtri;"],[2,"&blacktriangleleft;"],[0,"&ltri;"],[6,"&loz;"],[0,"&cir;"],[32,"&tridot;"],[2,"&bigcirc;"],[8,"&ultri;"],[0,"&urtri;"],[0,"&lltri;"],[0,"&EmptySmallSquare;"],[0,"&FilledSmallSquare;"],[8,"&bigstar;"],[0,"&star;"],[7,"&phone;"],[49,"&female;"],[1,"&male;"],[29,"&spades;"],[2,"&clubs;"],[1,"&hearts;"],[0,"&diamondsuit;"],[3,"&sung;"],[2,"&flat;"],[0,"&natural;"],[0,"&sharp;"],[163,"&check;"],[3,"&cross;"],[8,"&malt;"],[21,"&sext;"],[33,"&VerticalSeparator;"],[25,"&lbbrk;"],[0,"&rbbrk;"],[84,"&bsolhsub;"],[0,"&suphsol;"],[28,"&LeftDoubleBracket;"],[0,"&RightDoubleBracket;"],[0,"&lang;"],[0,"&rang;"],[0,"&Lang;"],[0,"&Rang;"],[0,"&loang;"],[0,"&roang;"],[7,"&longleftarrow;"],[0,"&longrightarrow;"],[0,"&longleftrightarrow;"],[0,"&DoubleLongLeftArrow;"],[0,"&DoubleLongRightArrow;"],[0,"&DoubleLongLeftRightArrow;"],[1,"&longmapsto;"],[2,"&dzigrarr;"],[258,"&nvlArr;"],[0,"&nvrArr;"],[0,"&nvHarr;"],[0,"&Map;"],[6,"&lbarr;"],[0,"&bkarow;"],[0,"&lBarr;"],[0,"&dbkarow;"],[0,"&drbkarow;"],[0,"&DDotrahd;"],[0,"&UpArrowBar;"],[0,"&DownArrowBar;"],[2,"&Rarrtl;"],[2,"&latail;"],[0,"&ratail;"],[0,"&lAtail;"],[0,"&rAtail;"],[0,"&larrfs;"],[0,"&rarrfs;"],[0,"&larrbfs;"],[0,"&rarrbfs;"],[2,"&nwarhk;"],[0,"&nearhk;"],[0,"&hksearow;"],[0,"&hkswarow;"],[0,"&nwnear;"],[0,"&nesear;"],[0,"&seswar;"],[0,"&swnwar;"],[8,{v:"&rarrc;",n:824,o:"&nrarrc;"}],[1,"&cudarrr;"],[0,"&ldca;"],[0,"&rdca;"],[0,"&cudarrl;"],[0,"&larrpl;"],[2,"&curarrm;"],[0,"&cularrp;"],[7,"&rarrpl;"],[2,"&harrcir;"],[0,"&Uarrocir;"],[0,"&lurdshar;"],[0,"&ldrushar;"],[2,"&LeftRightVector;"],[0,"&RightUpDownVector;"],[0,"&DownLeftRightVector;"],[0,"&LeftUpDownVector;"],[0,"&LeftVectorBar;"],[0,"&RightVectorBar;"],[0,"&RightUpVectorBar;"],[0,"&RightDownVectorBar;"],[0,"&DownLeftVectorBar;"],[0,"&DownRightVectorBar;"],[0,"&LeftUpVectorBar;"],[0,"&LeftDownVectorBar;"],[0,"&LeftTeeVector;"],[0,"&RightTeeVector;"],[0,"&RightUpTeeVector;"],[0,"&RightDownTeeVector;"],[0,"&DownLeftTeeVector;"],[0,"&DownRightTeeVector;"],[0,"&LeftUpTeeVector;"],[0,"&LeftDownTeeVector;"],[0,"&lHar;"],[0,"&uHar;"],[0,"&rHar;"],[0,"&dHar;"],[0,"&luruhar;"],[0,"&ldrdhar;"],[0,"&ruluhar;"],[0,"&rdldhar;"],[0,"&lharul;"],[0,"&llhard;"],[0,"&rharul;"],[0,"&lrhard;"],[0,"&udhar;"],[0,"&duhar;"],[0,"&RoundImplies;"],[0,"&erarr;"],[0,"&simrarr;"],[0,"&larrsim;"],[0,"&rarrsim;"],[0,"&rarrap;"],[0,"&ltlarr;"],[1,"&gtrarr;"],[0,"&subrarr;"],[1,"&suplarr;"],[0,"&lfisht;"],[0,"&rfisht;"],[0,"&ufisht;"],[0,"&dfisht;"],[5,"&lopar;"],[0,"&ropar;"],[4,"&lbrke;"],[0,"&rbrke;"],[0,"&lbrkslu;"],[0,"&rbrksld;"],[0,"&lbrksld;"],[0,"&rbrkslu;"],[0,"&langd;"],[0,"&rangd;"],[0,"&lparlt;"],[0,"&rpargt;"],[0,"&gtlPar;"],[0,"&ltrPar;"],[3,"&vzigzag;"],[1,"&vangrt;"],[0,"&angrtvbd;"],[6,"&ange;"],[0,"&range;"],[0,"&dwangle;"],[0,"&uwangle;"],[0,"&angmsdaa;"],[0,"&angmsdab;"],[0,"&angmsdac;"],[0,"&angmsdad;"],[0,"&angmsdae;"],[0,"&angmsdaf;"],[0,"&angmsdag;"],[0,"&angmsdah;"],[0,"&bemptyv;"],[0,"&demptyv;"],[0,"&cemptyv;"],[0,"&raemptyv;"],[0,"&laemptyv;"],[0,"&ohbar;"],[0,"&omid;"],[0,"&opar;"],[1,"&operp;"],[1,"&olcross;"],[0,"&odsold;"],[1,"&olcir;"],[0,"&ofcir;"],[0,"&olt;"],[0,"&ogt;"],[0,"&cirscir;"],[0,"&cirE;"],[0,"&solb;"],[0,"&bsolb;"],[3,"&boxbox;"],[3,"&trisb;"],[0,"&rtriltri;"],[0,{v:"&LeftTriangleBar;",n:824,o:"&NotLeftTriangleBar;"}],[0,{v:"&RightTriangleBar;",n:824,o:"&NotRightTriangleBar;"}],[11,"&iinfin;"],[0,"&infintie;"],[0,"&nvinfin;"],[4,"&eparsl;"],[0,"&smeparsl;"],[0,"&eqvparsl;"],[5,"&blacklozenge;"],[8,"&RuleDelayed;"],[1,"&dsol;"],[9,"&bigodot;"],[0,"&bigoplus;"],[0,"&bigotimes;"],[1,"&biguplus;"],[1,"&bigsqcup;"],[5,"&iiiint;"],[0,"&fpartint;"],[2,"&cirfnint;"],[0,"&awint;"],[0,"&rppolint;"],[0,"&scpolint;"],[0,"&npolint;"],[0,"&pointint;"],[0,"&quatint;"],[0,"&intlarhk;"],[10,"&pluscir;"],[0,"&plusacir;"],[0,"&simplus;"],[0,"&plusdu;"],[0,"&plussim;"],[0,"&plustwo;"],[1,"&mcomma;"],[0,"&minusdu;"],[2,"&loplus;"],[0,"&roplus;"],[0,"&Cross;"],[0,"&timesd;"],[0,"&timesbar;"],[1,"&smashp;"],[0,"&lotimes;"],[0,"&rotimes;"],[0,"&otimesas;"],[0,"&Otimes;"],[0,"&odiv;"],[0,"&triplus;"],[0,"&triminus;"],[0,"&tritime;"],[0,"&intprod;"],[2,"&amalg;"],[0,"&capdot;"],[1,"&ncup;"],[0,"&ncap;"],[0,"&capand;"],[0,"&cupor;"],[0,"&cupcap;"],[0,"&capcup;"],[0,"&cupbrcap;"],[0,"&capbrcup;"],[0,"&cupcup;"],[0,"&capcap;"],[0,"&ccups;"],[0,"&ccaps;"],[2,"&ccupssm;"],[2,"&And;"],[0,"&Or;"],[0,"&andand;"],[0,"&oror;"],[0,"&orslope;"],[0,"&andslope;"],[1,"&andv;"],[0,"&orv;"],[0,"&andd;"],[0,"&ord;"],[1,"&wedbar;"],[6,"&sdote;"],[3,"&simdot;"],[2,{v:"&congdot;",n:824,o:"&ncongdot;"}],[0,"&easter;"],[0,"&apacir;"],[0,{v:"&apE;",n:824,o:"&napE;"}],[0,"&eplus;"],[0,"&pluse;"],[0,"&Esim;"],[0,"&Colone;"],[0,"&Equal;"],[1,"&ddotseq;"],[0,"&equivDD;"],[0,"&ltcir;"],[0,"&gtcir;"],[0,"&ltquest;"],[0,"&gtquest;"],[0,{v:"&leqslant;",n:824,o:"&nleqslant;"}],[0,{v:"&geqslant;",n:824,o:"&ngeqslant;"}],[0,"&lesdot;"],[0,"&gesdot;"],[0,"&lesdoto;"],[0,"&gesdoto;"],[0,"&lesdotor;"],[0,"&gesdotol;"],[0,"&lap;"],[0,"&gap;"],[0,"&lne;"],[0,"&gne;"],[0,"&lnap;"],[0,"&gnap;"],[0,"&lEg;"],[0,"&gEl;"],[0,"&lsime;"],[0,"&gsime;"],[0,"&lsimg;"],[0,"&gsiml;"],[0,"&lgE;"],[0,"&glE;"],[0,"&lesges;"],[0,"&gesles;"],[0,"&els;"],[0,"&egs;"],[0,"&elsdot;"],[0,"&egsdot;"],[0,"&el;"],[0,"&eg;"],[2,"&siml;"],[0,"&simg;"],[0,"&simlE;"],[0,"&simgE;"],[0,{v:"&LessLess;",n:824,o:"&NotNestedLessLess;"}],[0,{v:"&GreaterGreater;",n:824,o:"&NotNestedGreaterGreater;"}],[1,"&glj;"],[0,"&gla;"],[0,"&ltcc;"],[0,"&gtcc;"],[0,"&lescc;"],[0,"&gescc;"],[0,"&smt;"],[0,"&lat;"],[0,{v:"&smte;",n:65024,o:"&smtes;"}],[0,{v:"&late;",n:65024,o:"&lates;"}],[0,"&bumpE;"],[0,{v:"&PrecedesEqual;",n:824,o:"&NotPrecedesEqual;"}],[0,{v:"&sce;",n:824,o:"&NotSucceedsEqual;"}],[2,"&prE;"],[0,"&scE;"],[0,"&precneqq;"],[0,"&scnE;"],[0,"&prap;"],[0,"&scap;"],[0,"&precnapprox;"],[0,"&scnap;"],[0,"&Pr;"],[0,"&Sc;"],[0,"&subdot;"],[0,"&supdot;"],[0,"&subplus;"],[0,"&supplus;"],[0,"&submult;"],[0,"&supmult;"],[0,"&subedot;"],[0,"&supedot;"],[0,{v:"&subE;",n:824,o:"&nsubE;"}],[0,{v:"&supE;",n:824,o:"&nsupE;"}],[0,"&subsim;"],[0,"&supsim;"],[2,{v:"&subnE;",n:65024,o:"&varsubsetneqq;"}],[0,{v:"&supnE;",n:65024,o:"&varsupsetneqq;"}],[2,"&csub;"],[0,"&csup;"],[0,"&csube;"],[0,"&csupe;"],[0,"&subsup;"],[0,"&supsub;"],[0,"&subsub;"],[0,"&supsup;"],[0,"&suphsub;"],[0,"&supdsub;"],[0,"&forkv;"],[0,"&topfork;"],[0,"&mlcp;"],[8,"&Dashv;"],[1,"&Vdashl;"],[0,"&Barv;"],[0,"&vBar;"],[0,"&vBarv;"],[1,"&Vbar;"],[0,"&Not;"],[0,"&bNot;"],[0,"&rnmid;"],[0,"&cirmid;"],[0,"&midcir;"],[0,"&topcir;"],[0,"&nhpar;"],[0,"&parsim;"],[9,{v:"&parsl;",n:8421,o:"&nparsl;"}],[44343,{n:new Map(restoreDiff([[56476,"&Ascr;"],[1,"&Cscr;"],[0,"&Dscr;"],[2,"&Gscr;"],[2,"&Jscr;"],[0,"&Kscr;"],[2,"&Nscr;"],[0,"&Oscr;"],[0,"&Pscr;"],[0,"&Qscr;"],[1,"&Sscr;"],[0,"&Tscr;"],[0,"&Uscr;"],[0,"&Vscr;"],[0,"&Wscr;"],[0,"&Xscr;"],[0,"&Yscr;"],[0,"&Zscr;"],[0,"&ascr;"],[0,"&bscr;"],[0,"&cscr;"],[0,"&dscr;"],[1,"&fscr;"],[1,"&hscr;"],[0,"&iscr;"],[0,"&jscr;"],[0,"&kscr;"],[0,"&lscr;"],[0,"&mscr;"],[0,"&nscr;"],[1,"&pscr;"],[0,"&qscr;"],[0,"&rscr;"],[0,"&sscr;"],[0,"&tscr;"],[0,"&uscr;"],[0,"&vscr;"],[0,"&wscr;"],[0,"&xscr;"],[0,"&yscr;"],[0,"&zscr;"],[52,"&Afr;"],[0,"&Bfr;"],[1,"&Dfr;"],[0,"&Efr;"],[0,"&Ffr;"],[0,"&Gfr;"],[2,"&Jfr;"],[0,"&Kfr;"],[0,"&Lfr;"],[0,"&Mfr;"],[0,"&Nfr;"],[0,"&Ofr;"],[0,"&Pfr;"],[0,"&Qfr;"],[1,"&Sfr;"],[0,"&Tfr;"],[0,"&Ufr;"],[0,"&Vfr;"],[0,"&Wfr;"],[0,"&Xfr;"],[0,"&Yfr;"],[1,"&afr;"],[0,"&bfr;"],[0,"&cfr;"],[0,"&dfr;"],[0,"&efr;"],[0,"&ffr;"],[0,"&gfr;"],[0,"&hfr;"],[0,"&ifr;"],[0,"&jfr;"],[0,"&kfr;"],[0,"&lfr;"],[0,"&mfr;"],[0,"&nfr;"],[0,"&ofr;"],[0,"&pfr;"],[0,"&qfr;"],[0,"&rfr;"],[0,"&sfr;"],[0,"&tfr;"],[0,"&ufr;"],[0,"&vfr;"],[0,"&wfr;"],[0,"&xfr;"],[0,"&yfr;"],[0,"&zfr;"],[0,"&Aopf;"],[0,"&Bopf;"],[1,"&Dopf;"],[0,"&Eopf;"],[0,"&Fopf;"],[0,"&Gopf;"],[1,"&Iopf;"],[0,"&Jopf;"],[0,"&Kopf;"],[0,"&Lopf;"],[0,"&Mopf;"],[1,"&Oopf;"],[3,"&Sopf;"],[0,"&Topf;"],[0,"&Uopf;"],[0,"&Vopf;"],[0,"&Wopf;"],[0,"&Xopf;"],[0,"&Yopf;"],[1,"&aopf;"],[0,"&bopf;"],[0,"&copf;"],[0,"&dopf;"],[0,"&eopf;"],[0,"&fopf;"],[0,"&gopf;"],[0,"&hopf;"],[0,"&iopf;"],[0,"&jopf;"],[0,"&kopf;"],[0,"&lopf;"],[0,"&mopf;"],[0,"&nopf;"],[0,"&oopf;"],[0,"&popf;"],[0,"&qopf;"],[0,"&ropf;"],[0,"&sopf;"],[0,"&topf;"],[0,"&uopf;"],[0,"&vopf;"],[0,"&wopf;"],[0,"&xopf;"],[0,"&yopf;"],[0,"&zopf;"]]))}],[8906,"&fflig;"],[0,"&filig;"],[0,"&fllig;"],[0,"&ffilig;"],[0,"&ffllig;"]]));var _escape={};(function(tt){Object.defineProperty(tt,"__esModule",{value:!0}),tt.escapeText=tt.escapeAttribute=tt.escapeUTF8=tt.escape=tt.encodeXML=tt.getCodePoint=tt.xmlReplacer=void 0,tt.xmlReplacer=/["&'<>$\x80-\uFFFF]/g;var et=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]);tt.getCodePoint=String.prototype.codePointAt!=null?function(it,st){return it.codePointAt(st)}:function(it,st){return(it.charCodeAt(st)&64512)===55296?(it.charCodeAt(st)-55296)*1024+it.charCodeAt(st+1)-56320+65536:it.charCodeAt(st)};function nt(it){for(var st="",ot=0,lt;(lt=tt.xmlReplacer.exec(it))!==null;){var ut=lt.index,ct=it.charCodeAt(ut),dt=et.get(ct);dt!==void 0?(st+=it.substring(ot,ut)+dt,ot=ut+1):(st+="".concat(it.substring(ot,ut),"&#x").concat((0,tt.getCodePoint)(it,ut).toString(16),";"),ot=tt.xmlReplacer.lastIndex+=+((ct&64512)===55296))}return st+it.substr(ot)}tt.encodeXML=nt,tt.escape=nt;function rt(it,st){return function(lt){for(var ut,ct=0,dt="";ut=it.exec(lt);)ct!==ut.index&&(dt+=lt.substring(ct,ut.index)),dt+=st.get(ut[0].charCodeAt(0)),ct=ut.index+1;return dt+lt.substring(ct)}}tt.escapeUTF8=rt(/[&<>'"]/g,et),tt.escapeAttribute=rt(/["&\u00A0]/g,new Map([[34,"&quot;"],[38,"&amp;"],[160,"&nbsp;"]])),tt.escapeText=rt(/[&<>\u00A0]/g,new Map([[38,"&amp;"],[60,"&lt;"],[62,"&gt;"],[160,"&nbsp;"]]))})(_escape);var __importDefault$1=commonjsGlobal&&commonjsGlobal.__importDefault||function(tt){return tt&&tt.__esModule?tt:{default:tt}};Object.defineProperty(encode,"__esModule",{value:!0}),encode.encodeNonAsciiHTML=encode.encodeHTML=void 0;var encode_html_js_1=__importDefault$1(encodeHtml),escape_js_1=_escape,htmlReplacer=/[\t\n!-,./:-@[-`\f{-}$\x80-\uFFFF]/g;function encodeHTML(tt){return encodeHTMLTrieRe(htmlReplacer,tt)}encode.encodeHTML=encodeHTML;function encodeNonAsciiHTML(tt){return encodeHTMLTrieRe(escape_js_1.xmlReplacer,tt)}encode.encodeNonAsciiHTML=encodeNonAsciiHTML;function encodeHTMLTrieRe(tt,et){for(var nt="",rt=0,it;(it=tt.exec(et))!==null;){var st=it.index;nt+=et.substring(rt,st);var ot=et.charCodeAt(st),lt=encode_html_js_1.default.get(ot);if(typeof lt=="object"){if(st+1<et.length){var ut=et.charCodeAt(st+1),ct=typeof lt.n=="number"?lt.n===ut?lt.o:void 0:lt.n.get(ut);if(ct!==void 0){nt+=ct,rt=tt.lastIndex+=1;continue}}lt=lt.v}if(lt!==void 0)nt+=lt,rt=st+1;else{var dt=(0,escape_js_1.getCodePoint)(et,st);nt+="&#x".concat(dt.toString(16),";"),rt=tt.lastIndex+=+(dt!==ot)}}return nt+et.substr(rt)}(function(tt){Object.defineProperty(tt,"__esModule",{value:!0}),tt.decodeXMLStrict=tt.decodeHTML5Strict=tt.decodeHTML4Strict=tt.decodeHTML5=tt.decodeHTML4=tt.decodeHTMLAttribute=tt.decodeHTMLStrict=tt.decodeHTML=tt.decodeXML=tt.DecodingMode=tt.EntityDecoder=tt.encodeHTML5=tt.encodeHTML4=tt.encodeNonAsciiHTML=tt.encodeHTML=tt.escapeText=tt.escapeAttribute=tt.escapeUTF8=tt.escape=tt.encodeXML=tt.encode=tt.decodeStrict=tt.decode=tt.EncodingMode=tt.EntityLevel=void 0;var et=decode,nt=encode,rt=_escape,it;(function(pt){pt[pt.XML=0]="XML",pt[pt.HTML=1]="HTML"})(it=tt.EntityLevel||(tt.EntityLevel={}));var st;(function(pt){pt[pt.UTF8=0]="UTF8",pt[pt.ASCII=1]="ASCII",pt[pt.Extensive=2]="Extensive",pt[pt.Attribute=3]="Attribute",pt[pt.Text=4]="Text"})(st=tt.EncodingMode||(tt.EncodingMode={}));function ot(pt,gt){gt===void 0&&(gt=it.XML);var _r=typeof gt=="number"?gt:gt.level;if(_r===it.HTML){var Yr=typeof gt=="object"?gt.mode:void 0;return(0,et.decodeHTML)(pt,Yr)}return(0,et.decodeXML)(pt)}tt.decode=ot;function lt(pt,gt){var _r;gt===void 0&&(gt=it.XML);var Yr=typeof gt=="number"?{level:gt}:gt;return(_r=Yr.mode)!==null&&_r!==void 0||(Yr.mode=et.DecodingMode.Strict),ot(pt,Yr)}tt.decodeStrict=lt;function ut(pt,gt){gt===void 0&&(gt=it.XML);var _r=typeof gt=="number"?{level:gt}:gt;return _r.mode===st.UTF8?(0,rt.escapeUTF8)(pt):_r.mode===st.Attribute?(0,rt.escapeAttribute)(pt):_r.mode===st.Text?(0,rt.escapeText)(pt):_r.level===it.HTML?_r.mode===st.ASCII?(0,nt.encodeNonAsciiHTML)(pt):(0,nt.encodeHTML)(pt):(0,rt.encodeXML)(pt)}tt.encode=ut;var ct=_escape;Object.defineProperty(tt,"encodeXML",{enumerable:!0,get:function(){return ct.encodeXML}}),Object.defineProperty(tt,"escape",{enumerable:!0,get:function(){return ct.escape}}),Object.defineProperty(tt,"escapeUTF8",{enumerable:!0,get:function(){return ct.escapeUTF8}}),Object.defineProperty(tt,"escapeAttribute",{enumerable:!0,get:function(){return ct.escapeAttribute}}),Object.defineProperty(tt,"escapeText",{enumerable:!0,get:function(){return ct.escapeText}});var dt=encode;Object.defineProperty(tt,"encodeHTML",{enumerable:!0,get:function(){return dt.encodeHTML}}),Object.defineProperty(tt,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return dt.encodeNonAsciiHTML}}),Object.defineProperty(tt,"encodeHTML4",{enumerable:!0,get:function(){return dt.encodeHTML}}),Object.defineProperty(tt,"encodeHTML5",{enumerable:!0,get:function(){return dt.encodeHTML}});var ft=decode;Object.defineProperty(tt,"EntityDecoder",{enumerable:!0,get:function(){return ft.EntityDecoder}}),Object.defineProperty(tt,"DecodingMode",{enumerable:!0,get:function(){return ft.DecodingMode}}),Object.defineProperty(tt,"decodeXML",{enumerable:!0,get:function(){return ft.decodeXML}}),Object.defineProperty(tt,"decodeHTML",{enumerable:!0,get:function(){return ft.decodeHTML}}),Object.defineProperty(tt,"decodeHTMLStrict",{enumerable:!0,get:function(){return ft.decodeHTMLStrict}}),Object.defineProperty(tt,"decodeHTMLAttribute",{enumerable:!0,get:function(){return ft.decodeHTMLAttribute}}),Object.defineProperty(tt,"decodeHTML4",{enumerable:!0,get:function(){return ft.decodeHTML}}),Object.defineProperty(tt,"decodeHTML5",{enumerable:!0,get:function(){return ft.decodeHTML}}),Object.defineProperty(tt,"decodeHTML4Strict",{enumerable:!0,get:function(){return ft.decodeHTMLStrict}}),Object.defineProperty(tt,"decodeHTML5Strict",{enumerable:!0,get:function(){return ft.decodeHTMLStrict}}),Object.defineProperty(tt,"decodeXMLStrict",{enumerable:!0,get:function(){return ft.decodeXML}})})(lib);var foreignNames={};Object.defineProperty(foreignNames,"__esModule",{value:!0}),foreignNames.attributeNames=foreignNames.elementNames=void 0,foreignNames.elementNames=new Map(["altGlyph","altGlyphDef","altGlyphItem","animateColor","animateMotion","animateTransform","clipPath","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","foreignObject","glyphRef","linearGradient","radialGradient","textPath"].map(function(tt){return[tt.toLowerCase(),tt]})),foreignNames.attributeNames=new Map(["definitionURL","attributeName","attributeType","baseFrequency","baseProfile","calcMode","clipPathUnits","diffuseConstant","edgeMode","filterUnits","glyphRef","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","keySplines","keyTimes","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","repeatCount","repeatDur","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].map(function(tt){return[tt.toLowerCase(),tt]}));var __assign$1=commonjsGlobal&&commonjsGlobal.__assign||function(){return __assign$1=Object.assign||function(tt){for(var et,nt=1,rt=arguments.length;nt<rt;nt++){et=arguments[nt];for(var it in et)Object.prototype.hasOwnProperty.call(et,it)&&(tt[it]=et[it])}return tt},__assign$1.apply(this,arguments)},__createBinding=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(tt,et,nt,rt){rt===void 0&&(rt=nt);var it=Object.getOwnPropertyDescriptor(et,nt);(!it||("get"in it?!et.__esModule:it.writable||it.configurable))&&(it={enumerable:!0,get:function(){return et[nt]}}),Object.defineProperty(tt,rt,it)}:function(tt,et,nt,rt){rt===void 0&&(rt=nt),tt[rt]=et[nt]}),__setModuleDefault=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(tt,et){Object.defineProperty(tt,"default",{enumerable:!0,value:et})}:function(tt,et){tt.default=et}),__importStar=commonjsGlobal&&commonjsGlobal.__importStar||function(tt){if(tt&&tt.__esModule)return tt;var et={};if(tt!=null)for(var nt in tt)nt!=="default"&&Object.prototype.hasOwnProperty.call(tt,nt)&&__createBinding(et,tt,nt);return __setModuleDefault(et,tt),et};Object.defineProperty(lib$1,"__esModule",{value:!0}),lib$1.render=void 0;var ElementType=__importStar(lib$3),entities_1=lib,foreignNames_js_1=foreignNames,unencodedElements=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);function replaceQuotes(tt){return tt.replace(/"/g,"&quot;")}function formatAttributes(tt,et){var nt;if(tt){var rt=((nt=et.encodeEntities)!==null&&nt!==void 0?nt:et.decodeEntities)===!1?replaceQuotes:et.xmlMode||et.encodeEntities!=="utf8"?entities_1.encodeXML:entities_1.escapeAttribute;return Object.keys(tt).map(function(it){var st,ot,lt=(st=tt[it])!==null&&st!==void 0?st:"";return et.xmlMode==="foreign"&&(it=(ot=foreignNames_js_1.attributeNames.get(it))!==null&&ot!==void 0?ot:it),!et.emptyAttrs&&!et.xmlMode&&lt===""?it:"".concat(it,'="').concat(rt(lt),'"')}).join(" ")}}var singleTag=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function render(tt,et){et===void 0&&(et={});for(var nt=("length"in tt)?tt:[tt],rt="",it=0;it<nt.length;it++)rt+=renderNode(nt[it],et);return rt}lib$1.render=render,lib$1.default=render;function renderNode(tt,et){switch(tt.type){case ElementType.Root:return render(tt.children,et);case ElementType.Doctype:case ElementType.Directive:return renderDirective(tt);case ElementType.Comment:return renderComment(tt);case ElementType.CDATA:return renderCdata(tt);case ElementType.Script:case ElementType.Style:case ElementType.Tag:return renderTag(tt,et);case ElementType.Text:return renderText(tt,et)}}var foreignModeIntegrationPoints=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),foreignElements=new Set(["svg","math"]);function renderTag(tt,et){var nt;et.xmlMode==="foreign"&&(tt.name=(nt=foreignNames_js_1.elementNames.get(tt.name))!==null&&nt!==void 0?nt:tt.name,tt.parent&&foreignModeIntegrationPoints.has(tt.parent.name)&&(et=__assign$1(__assign$1({},et),{xmlMode:!1}))),!et.xmlMode&&foreignElements.has(tt.name)&&(et=__assign$1(__assign$1({},et),{xmlMode:"foreign"}));var rt="<".concat(tt.name),it=formatAttributes(tt.attribs,et);return it&&(rt+=" ".concat(it)),tt.children.length===0&&(et.xmlMode?et.selfClosingTags!==!1:et.selfClosingTags&&singleTag.has(tt.name))?(et.xmlMode||(rt+=" "),rt+="/>"):(rt+=">",tt.children.length>0&&(rt+=render(tt.children,et)),(et.xmlMode||!singleTag.has(tt.name))&&(rt+="</".concat(tt.name,">"))),rt}function renderDirective(tt){return"<".concat(tt.data,">")}function renderText(tt,et){var nt,rt=tt.data||"";return((nt=et.encodeEntities)!==null&&nt!==void 0?nt:et.decodeEntities)!==!1&&!(!et.xmlMode&&tt.parent&&unencodedElements.has(tt.parent.name))&&(rt=et.xmlMode||et.encodeEntities!=="utf8"?(0,entities_1.encodeXML)(rt):(0,entities_1.escapeText)(rt)),rt}function renderCdata(tt){return"<![CDATA[".concat(tt.children[0].data,"]]>")}function renderComment(tt){return"<!--".concat(tt.data,"-->")}var __importDefault=commonjsGlobal&&commonjsGlobal.__importDefault||function(tt){return tt&&tt.__esModule?tt:{default:tt}};Object.defineProperty(stringify$5,"__esModule",{value:!0}),stringify$5.innerText=stringify$5.textContent=stringify$5.getText=stringify$5.getInnerHTML=stringify$5.getOuterHTML=void 0;var domhandler_1$3=lib$4,dom_serializer_1=__importDefault(lib$1),domelementtype_1=lib$3;function getOuterHTML(tt,et){return(0,dom_serializer_1.default)(tt,et)}stringify$5.getOuterHTML=getOuterHTML;function getInnerHTML(tt,et){return(0,domhandler_1$3.hasChildren)(tt)?tt.children.map(function(nt){return getOuterHTML(nt,et)}).join(""):""}stringify$5.getInnerHTML=getInnerHTML;function getText(tt){return Array.isArray(tt)?tt.map(getText).join(""):(0,domhandler_1$3.isTag)(tt)?tt.name==="br"?`
`:getText(tt.children):(0,domhandler_1$3.isCDATA)(tt)?getText(tt.children):(0,domhandler_1$3.isText)(tt)?tt.data:""}stringify$5.getText=getText;function textContent(tt){return Array.isArray(tt)?tt.map(textContent).join(""):(0,domhandler_1$3.hasChildren)(tt)&&!(0,domhandler_1$3.isComment)(tt)?textContent(tt.children):(0,domhandler_1$3.isText)(tt)?tt.data:""}stringify$5.textContent=textContent;function innerText(tt){return Array.isArray(tt)?tt.map(innerText).join(""):(0,domhandler_1$3.hasChildren)(tt)&&(tt.type===domelementtype_1.ElementType.Tag||(0,domhandler_1$3.isCDATA)(tt))?innerText(tt.children):(0,domhandler_1$3.isText)(tt)?tt.data:""}stringify$5.innerText=innerText;var traversal={};Object.defineProperty(traversal,"__esModule",{value:!0}),traversal.prevElementSibling=traversal.nextElementSibling=traversal.getName=traversal.hasAttrib=traversal.getAttributeValue=traversal.getSiblings=traversal.getParent=traversal.getChildren=void 0;var domhandler_1$2=lib$4;function getChildren(tt){return(0,domhandler_1$2.hasChildren)(tt)?tt.children:[]}traversal.getChildren=getChildren;function getParent(tt){return tt.parent||null}traversal.getParent=getParent;function getSiblings(tt){var et,nt,rt=getParent(tt);if(rt!=null)return getChildren(rt);for(var it=[tt],st=tt.prev,ot=tt.next;st!=null;)it.unshift(st),et=st,st=et.prev;for(;ot!=null;)it.push(ot),nt=ot,ot=nt.next;return it}traversal.getSiblings=getSiblings;function getAttributeValue(tt,et){var nt;return(nt=tt.attribs)===null||nt===void 0?void 0:nt[et]}traversal.getAttributeValue=getAttributeValue;function hasAttrib(tt,et){return tt.attribs!=null&&Object.prototype.hasOwnProperty.call(tt.attribs,et)&&tt.attribs[et]!=null}traversal.hasAttrib=hasAttrib;function getName(tt){return tt.name}traversal.getName=getName;function nextElementSibling(tt){for(var et,nt=tt.next;nt!==null&&!(0,domhandler_1$2.isTag)(nt);)et=nt,nt=et.next;return nt}traversal.nextElementSibling=nextElementSibling;function prevElementSibling(tt){for(var et,nt=tt.prev;nt!==null&&!(0,domhandler_1$2.isTag)(nt);)et=nt,nt=et.prev;return nt}traversal.prevElementSibling=prevElementSibling;var manipulation={};Object.defineProperty(manipulation,"__esModule",{value:!0}),manipulation.prepend=manipulation.prependChild=manipulation.append=manipulation.appendChild=manipulation.replaceElement=manipulation.removeElement=void 0;function removeElement(tt){if(tt.prev&&(tt.prev.next=tt.next),tt.next&&(tt.next.prev=tt.prev),tt.parent){var et=tt.parent.children,nt=et.lastIndexOf(tt);nt>=0&&et.splice(nt,1)}tt.next=null,tt.prev=null,tt.parent=null}manipulation.removeElement=removeElement;function replaceElement(tt,et){var nt=et.prev=tt.prev;nt&&(nt.next=et);var rt=et.next=tt.next;rt&&(rt.prev=et);var it=et.parent=tt.parent;if(it){var st=it.children;st[st.lastIndexOf(tt)]=et,tt.parent=null}}manipulation.replaceElement=replaceElement;function appendChild(tt,et){if(removeElement(et),et.next=null,et.parent=tt,tt.children.push(et)>1){var nt=tt.children[tt.children.length-2];nt.next=et,et.prev=nt}else et.prev=null}manipulation.appendChild=appendChild;function append(tt,et){removeElement(et);var nt=tt.parent,rt=tt.next;if(et.next=rt,et.prev=tt,tt.next=et,et.parent=nt,rt){if(rt.prev=et,nt){var it=nt.children;it.splice(it.lastIndexOf(rt),0,et)}}else nt&&nt.children.push(et)}manipulation.append=append;function prependChild(tt,et){if(removeElement(et),et.parent=tt,et.prev=null,tt.children.unshift(et)!==1){var nt=tt.children[1];nt.prev=et,et.next=nt}else et.next=null}manipulation.prependChild=prependChild;function prepend(tt,et){removeElement(et);var nt=tt.parent;if(nt){var rt=nt.children;rt.splice(rt.indexOf(tt),0,et)}tt.prev&&(tt.prev.next=et),et.parent=nt,et.prev=tt.prev,et.next=tt,tt.prev=et}manipulation.prepend=prepend;var querying={};Object.defineProperty(querying,"__esModule",{value:!0}),querying.findAll=querying.existsOne=querying.findOne=querying.findOneChild=querying.find=querying.filter=void 0;var domhandler_1$1=lib$4;function filter$1(tt,et,nt,rt){return nt===void 0&&(nt=!0),rt===void 0&&(rt=1/0),find(tt,Array.isArray(et)?et:[et],nt,rt)}querying.filter=filter$1;function find(tt,et,nt,rt){for(var it=[],st=[et],ot=[0];;){if(ot[0]>=st[0].length){if(ot.length===1)return it;st.shift(),ot.shift();continue}var lt=st[0][ot[0]++];if(tt(lt)&&(it.push(lt),--rt<=0))return it;nt&&(0,domhandler_1$1.hasChildren)(lt)&&lt.children.length>0&&(ot.unshift(0),st.unshift(lt.children))}}querying.find=find;function findOneChild(tt,et){return et.find(tt)}querying.findOneChild=findOneChild;function findOne(tt,et,nt){nt===void 0&&(nt=!0);for(var rt=null,it=0;it<et.length&&!rt;it++){var st=et[it];if((0,domhandler_1$1.isTag)(st))tt(st)?rt=st:nt&&st.children.length>0&&(rt=findOne(tt,st.children,!0));else continue}return rt}querying.findOne=findOne;function existsOne(tt,et){return et.some(function(nt){return(0,domhandler_1$1.isTag)(nt)&&(tt(nt)||existsOne(tt,nt.children))})}querying.existsOne=existsOne;function findAll(tt,et){for(var nt=[],rt=[et],it=[0];;){if(it[0]>=rt[0].length){if(rt.length===1)return nt;rt.shift(),it.shift();continue}var st=rt[0][it[0]++];(0,domhandler_1$1.isTag)(st)&&(tt(st)&&nt.push(st),st.children.length>0&&(it.unshift(0),rt.unshift(st.children)))}}querying.findAll=findAll;var legacy={};Object.defineProperty(legacy,"__esModule",{value:!0}),legacy.getElementsByTagType=legacy.getElementsByTagName=legacy.getElementById=legacy.getElements=legacy.testElement=void 0;var domhandler_1=lib$4,querying_js_1=querying,Checks={tag_name:function(tt){return typeof tt=="function"?function(et){return(0,domhandler_1.isTag)(et)&&tt(et.name)}:tt==="*"?domhandler_1.isTag:function(et){return(0,domhandler_1.isTag)(et)&&et.name===tt}},tag_type:function(tt){return typeof tt=="function"?function(et){return tt(et.type)}:function(et){return et.type===tt}},tag_contains:function(tt){return typeof tt=="function"?function(et){return(0,domhandler_1.isText)(et)&&tt(et.data)}:function(et){return(0,domhandler_1.isText)(et)&&et.data===tt}}};function getAttribCheck(tt,et){return typeof et=="function"?function(nt){return(0,domhandler_1.isTag)(nt)&&et(nt.attribs[tt])}:function(nt){return(0,domhandler_1.isTag)(nt)&&nt.attribs[tt]===et}}function combineFuncs(tt,et){return function(nt){return tt(nt)||et(nt)}}function compileTest(tt){var et=Object.keys(tt).map(function(nt){var rt=tt[nt];return Object.prototype.hasOwnProperty.call(Checks,nt)?Checks[nt](rt):getAttribCheck(nt,rt)});return et.length===0?null:et.reduce(combineFuncs)}function testElement(tt,et){var nt=compileTest(tt);return nt?nt(et):!0}legacy.testElement=testElement;function getElements(tt,et,nt,rt){rt===void 0&&(rt=1/0);var it=compileTest(tt);return it?(0,querying_js_1.filter)(it,et,nt,rt):[]}legacy.getElements=getElements;function getElementById(tt,et,nt){return nt===void 0&&(nt=!0),Array.isArray(et)||(et=[et]),(0,querying_js_1.findOne)(getAttribCheck("id",tt),et,nt)}legacy.getElementById=getElementById;function getElementsByTagName(tt,et,nt,rt){return nt===void 0&&(nt=!0),rt===void 0&&(rt=1/0),(0,querying_js_1.filter)(Checks.tag_name(tt),et,nt,rt)}legacy.getElementsByTagName=getElementsByTagName;function getElementsByTagType(tt,et,nt,rt){return nt===void 0&&(nt=!0),rt===void 0&&(rt=1/0),(0,querying_js_1.filter)(Checks.tag_type(tt),et,nt,rt)}legacy.getElementsByTagType=getElementsByTagType;var helpers={};(function(tt){Object.defineProperty(tt,"__esModule",{value:!0}),tt.uniqueSort=tt.compareDocumentPosition=tt.DocumentPosition=tt.removeSubsets=void 0;var et=lib$4;function nt(ot){for(var lt=ot.length;--lt>=0;){var ut=ot[lt];if(lt>0&&ot.lastIndexOf(ut,lt-1)>=0){ot.splice(lt,1);continue}for(var ct=ut.parent;ct;ct=ct.parent)if(ot.includes(ct)){ot.splice(lt,1);break}}return ot}tt.removeSubsets=nt;var rt;(function(ot){ot[ot.DISCONNECTED=1]="DISCONNECTED",ot[ot.PRECEDING=2]="PRECEDING",ot[ot.FOLLOWING=4]="FOLLOWING",ot[ot.CONTAINS=8]="CONTAINS",ot[ot.CONTAINED_BY=16]="CONTAINED_BY"})(rt=tt.DocumentPosition||(tt.DocumentPosition={}));function it(ot,lt){var ut=[],ct=[];if(ot===lt)return 0;for(var dt=(0,et.hasChildren)(ot)?ot:ot.parent;dt;)ut.unshift(dt),dt=dt.parent;for(dt=(0,et.hasChildren)(lt)?lt:lt.parent;dt;)ct.unshift(dt),dt=dt.parent;for(var ft=Math.min(ut.length,ct.length),pt=0;pt<ft&&ut[pt]===ct[pt];)pt++;if(pt===0)return rt.DISCONNECTED;var gt=ut[pt-1],_r=gt.children,Yr=ut[pt],mt=ct[pt];return _r.indexOf(Yr)>_r.indexOf(mt)?gt===lt?rt.FOLLOWING|rt.CONTAINED_BY:rt.FOLLOWING:gt===ot?rt.PRECEDING|rt.CONTAINS:rt.PRECEDING}tt.compareDocumentPosition=it;function st(ot){return ot=ot.filter(function(lt,ut,ct){return!ct.includes(lt,ut+1)}),ot.sort(function(lt,ut){var ct=it(lt,ut);return ct&rt.PRECEDING?-1:ct&rt.FOLLOWING?1:0}),ot}tt.uniqueSort=st})(helpers);var feeds={};Object.defineProperty(feeds,"__esModule",{value:!0}),feeds.getFeed=void 0;var stringify_js_1=stringify$5,legacy_js_1=legacy;function getFeed(tt){var et=getOneElement(isValidFeed,tt);return et?et.name==="feed"?getAtomFeed(et):getRssFeed(et):null}feeds.getFeed=getFeed;function getAtomFeed(tt){var et,nt=tt.children,rt={type:"atom",items:(0,legacy_js_1.getElementsByTagName)("entry",nt).map(function(ot){var lt,ut=ot.children,ct={media:getMediaElements(ut)};addConditionally(ct,"id","id",ut),addConditionally(ct,"title","title",ut);var dt=(lt=getOneElement("link",ut))===null||lt===void 0?void 0:lt.attribs.href;dt&&(ct.link=dt);var ft=fetch$1("summary",ut)||fetch$1("content",ut);ft&&(ct.description=ft);var pt=fetch$1("updated",ut);return pt&&(ct.pubDate=new Date(pt)),ct})};addConditionally(rt,"id","id",nt),addConditionally(rt,"title","title",nt);var it=(et=getOneElement("link",nt))===null||et===void 0?void 0:et.attribs.href;it&&(rt.link=it),addConditionally(rt,"description","subtitle",nt);var st=fetch$1("updated",nt);return st&&(rt.updated=new Date(st)),addConditionally(rt,"author","email",nt,!0),rt}function getRssFeed(tt){var et,nt,rt=(nt=(et=getOneElement("channel",tt.children))===null||et===void 0?void 0:et.children)!==null&&nt!==void 0?nt:[],it={type:tt.name.substr(0,3),id:"",items:(0,legacy_js_1.getElementsByTagName)("item",tt.children).map(function(ot){var lt=ot.children,ut={media:getMediaElements(lt)};addConditionally(ut,"id","guid",lt),addConditionally(ut,"title","title",lt),addConditionally(ut,"link","link",lt),addConditionally(ut,"description","description",lt);var ct=fetch$1("pubDate",lt)||fetch$1("dc:date",lt);return ct&&(ut.pubDate=new Date(ct)),ut})};addConditionally(it,"title","title",rt),addConditionally(it,"link","link",rt),addConditionally(it,"description","description",rt);var st=fetch$1("lastBuildDate",rt);return st&&(it.updated=new Date(st)),addConditionally(it,"author","managingEditor",rt,!0),it}var MEDIA_KEYS_STRING=["url","type","lang"],MEDIA_KEYS_INT=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function getMediaElements(tt){return(0,legacy_js_1.getElementsByTagName)("media:content",tt).map(function(et){for(var nt=et.attribs,rt={medium:nt.medium,isDefault:!!nt.isDefault},it=0,st=MEDIA_KEYS_STRING;it<st.length;it++){var ot=st[it];nt[ot]&&(rt[ot]=nt[ot])}for(var lt=0,ut=MEDIA_KEYS_INT;lt<ut.length;lt++){var ot=ut[lt];nt[ot]&&(rt[ot]=parseInt(nt[ot],10))}return nt.expression&&(rt.expression=nt.expression),rt})}function getOneElement(tt,et){return(0,legacy_js_1.getElementsByTagName)(tt,et,!0,1)[0]}function fetch$1(tt,et,nt){return nt===void 0&&(nt=!1),(0,stringify_js_1.textContent)((0,legacy_js_1.getElementsByTagName)(tt,et,nt,1)).trim()}function addConditionally(tt,et,nt,rt,it){it===void 0&&(it=!1);var st=fetch$1(nt,rt,it);st&&(tt[et]=st)}function isValidFeed(tt){return tt==="rss"||tt==="feed"||tt==="rdf:RDF"}(function(tt){var et=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(it,st,ot,lt){lt===void 0&&(lt=ot);var ut=Object.getOwnPropertyDescriptor(st,ot);(!ut||("get"in ut?!st.__esModule:ut.writable||ut.configurable))&&(ut={enumerable:!0,get:function(){return st[ot]}}),Object.defineProperty(it,lt,ut)}:function(it,st,ot,lt){lt===void 0&&(lt=ot),it[lt]=st[ot]}),nt=commonjsGlobal&&commonjsGlobal.__exportStar||function(it,st){for(var ot in it)ot!=="default"&&!Object.prototype.hasOwnProperty.call(st,ot)&&et(st,it,ot)};Object.defineProperty(tt,"__esModule",{value:!0}),tt.hasChildren=tt.isDocument=tt.isComment=tt.isText=tt.isCDATA=tt.isTag=void 0,nt(stringify$5,tt),nt(traversal,tt),nt(manipulation,tt),nt(querying,tt),nt(legacy,tt),nt(helpers,tt),nt(feeds,tt);var rt=lib$4;Object.defineProperty(tt,"isTag",{enumerable:!0,get:function(){return rt.isTag}}),Object.defineProperty(tt,"isCDATA",{enumerable:!0,get:function(){return rt.isCDATA}}),Object.defineProperty(tt,"isText",{enumerable:!0,get:function(){return rt.isText}}),Object.defineProperty(tt,"isComment",{enumerable:!0,get:function(){return rt.isComment}}),Object.defineProperty(tt,"isDocument",{enumerable:!0,get:function(){return rt.isDocument}}),Object.defineProperty(tt,"hasChildren",{enumerable:!0,get:function(){return rt.hasChildren}})})(lib$2),function(tt){var et=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(Kr,Xr,Zr,Qr){Qr===void 0&&(Qr=Zr);var _i=Object.getOwnPropertyDescriptor(Xr,Zr);(!_i||("get"in _i?!Xr.__esModule:_i.writable||_i.configurable))&&(_i={enumerable:!0,get:function(){return Xr[Zr]}}),Object.defineProperty(Kr,Qr,_i)}:function(Kr,Xr,Zr,Qr){Qr===void 0&&(Qr=Zr),Kr[Qr]=Xr[Zr]}),nt=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(Kr,Xr){Object.defineProperty(Kr,"default",{enumerable:!0,value:Xr})}:function(Kr,Xr){Kr.default=Xr}),rt=commonjsGlobal&&commonjsGlobal.__importStar||function(Kr){if(Kr&&Kr.__esModule)return Kr;var Xr={};if(Kr!=null)for(var Zr in Kr)Zr!=="default"&&Object.prototype.hasOwnProperty.call(Kr,Zr)&&et(Xr,Kr,Zr);return nt(Xr,Kr),Xr},it=commonjsGlobal&&commonjsGlobal.__importDefault||function(Kr){return Kr&&Kr.__esModule?Kr:{default:Kr}};Object.defineProperty(tt,"__esModule",{value:!0}),tt.DomUtils=tt.parseFeed=tt.getFeed=tt.ElementType=tt.Tokenizer=tt.createDomStream=tt.parseDOM=tt.parseDocument=tt.DefaultHandler=tt.DomHandler=tt.Parser=void 0;var st=Parser$3,ot=Parser$3;Object.defineProperty(tt,"Parser",{enumerable:!0,get:function(){return ot.Parser}});var lt=lib$4,ut=lib$4;Object.defineProperty(tt,"DomHandler",{enumerable:!0,get:function(){return ut.DomHandler}}),Object.defineProperty(tt,"DefaultHandler",{enumerable:!0,get:function(){return ut.DomHandler}});function ct(Kr,Xr){var Zr=new lt.DomHandler(void 0,Xr);return new st.Parser(Zr,Xr).end(Kr),Zr.root}tt.parseDocument=ct;function dt(Kr,Xr){return ct(Kr,Xr).children}tt.parseDOM=dt;function ft(Kr,Xr,Zr){var Qr=new lt.DomHandler(Kr,Xr,Zr);return new st.Parser(Qr,Xr)}tt.createDomStream=ft;var pt=Tokenizer;Object.defineProperty(tt,"Tokenizer",{enumerable:!0,get:function(){return it(pt).default}}),tt.ElementType=rt(lib$3);var gt=lib$2,_r=lib$2;Object.defineProperty(tt,"getFeed",{enumerable:!0,get:function(){return _r.getFeed}});var Yr={xmlMode:!0};function mt(Kr,Xr){return Xr===void 0&&(Xr=Yr),(0,gt.getFeed)(dt(Kr,Xr))}tt.parseFeed=mt,tt.DomUtils=rt(lib$2)}(lib$5);var escapeStringRegexp$1=tt=>{if(typeof tt!="string")throw new TypeError("Expected a string");return tt.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")},isPlainObject$2={};Object.defineProperty(isPlainObject$2,"__esModule",{value:!0});/*!
 * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
 *
 * Copyright (c) 2014-2017, Jon Schlinkert.
 * Released under the MIT License.
 */function isObject(tt){return Object.prototype.toString.call(tt)==="[object Object]"}function isPlainObject$1(tt){var et,nt;return isObject(tt)===!1?!1:(et=tt.constructor,et===void 0?!0:(nt=et.prototype,!(isObject(nt)===!1||nt.hasOwnProperty("isPrototypeOf")===!1)))}isPlainObject$2.isPlainObject=isPlainObject$1;var isMergeableObject=function(et){return isNonNullObject(et)&&!isSpecial(et)};function isNonNullObject(tt){return!!tt&&typeof tt=="object"}function isSpecial(tt){var et=Object.prototype.toString.call(tt);return et==="[object RegExp]"||et==="[object Date]"||isReactElement(tt)}var canUseSymbol=typeof Symbol=="function"&&Symbol.for,REACT_ELEMENT_TYPE=canUseSymbol?Symbol.for("react.element"):60103;function isReactElement(tt){return tt.$$typeof===REACT_ELEMENT_TYPE}function emptyTarget(tt){return Array.isArray(tt)?[]:{}}function cloneUnlessOtherwiseSpecified(tt,et){return et.clone!==!1&&et.isMergeableObject(tt)?deepmerge$1(emptyTarget(tt),tt,et):tt}function defaultArrayMerge(tt,et,nt){return tt.concat(et).map(function(rt){return cloneUnlessOtherwiseSpecified(rt,nt)})}function getMergeFunction(tt,et){if(!et.customMerge)return deepmerge$1;var nt=et.customMerge(tt);return typeof nt=="function"?nt:deepmerge$1}function getEnumerableOwnPropertySymbols(tt){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(tt).filter(function(et){return Object.propertyIsEnumerable.call(tt,et)}):[]}function getKeys(tt){return Object.keys(tt).concat(getEnumerableOwnPropertySymbols(tt))}function propertyIsOnObject(tt,et){try{return et in tt}catch{return!1}}function propertyIsUnsafe(tt,et){return propertyIsOnObject(tt,et)&&!(Object.hasOwnProperty.call(tt,et)&&Object.propertyIsEnumerable.call(tt,et))}function mergeObject(tt,et,nt){var rt={};return nt.isMergeableObject(tt)&&getKeys(tt).forEach(function(it){rt[it]=cloneUnlessOtherwiseSpecified(tt[it],nt)}),getKeys(et).forEach(function(it){propertyIsUnsafe(tt,it)||(propertyIsOnObject(tt,it)&&nt.isMergeableObject(et[it])?rt[it]=getMergeFunction(it,nt)(tt[it],et[it],nt):rt[it]=cloneUnlessOtherwiseSpecified(et[it],nt))}),rt}function deepmerge$1(tt,et,nt){nt=nt||{},nt.arrayMerge=nt.arrayMerge||defaultArrayMerge,nt.isMergeableObject=nt.isMergeableObject||isMergeableObject,nt.cloneUnlessOtherwiseSpecified=cloneUnlessOtherwiseSpecified;var rt=Array.isArray(et),it=Array.isArray(tt),st=rt===it;return st?rt?nt.arrayMerge(tt,et,nt):mergeObject(tt,et,nt):cloneUnlessOtherwiseSpecified(et,nt)}deepmerge$1.all=function(et,nt){if(!Array.isArray(et))throw new Error("first argument should be an array");return et.reduce(function(rt,it){return deepmerge$1(rt,it,nt)},{})};var deepmerge_1=deepmerge$1,cjs=deepmerge_1,parseSrcset$1={exports:{}};(function(tt){(function(et,nt){tt.exports?tt.exports=nt():et.parseSrcset=nt()})(commonjsGlobal,function(){return function(et){function nt(Qr){return Qr===" "||Qr==="	"||Qr===`
`||Qr==="\f"||Qr==="\r"}function rt(Qr){var _i,rs=Qr.exec(et.substring(mt));if(rs)return _i=rs[0],mt+=_i.length,_i}for(var it=et.length,st=/^[ \t\n\r\u000c]+/,ot=/^[, \t\n\r\u000c]+/,lt=/^[^ \t\n\r\u000c]+/,ut=/[,]+$/,ct=/^\d+$/,dt=/^-?(?:[0-9]+|[0-9]*\.[0-9]+)(?:[eE][+-]?[0-9]+)?$/,ft,pt,gt,_r,Yr,mt=0,Kr=[];;){if(rt(ot),mt>=it)return Kr;ft=rt(lt),pt=[],ft.slice(-1)===","?(ft=ft.replace(ut,""),Zr()):Xr()}function Xr(){for(rt(st),gt="",_r="in descriptor";;){if(Yr=et.charAt(mt),_r==="in descriptor")if(nt(Yr))gt&&(pt.push(gt),gt="",_r="after descriptor");else if(Yr===","){mt+=1,gt&&pt.push(gt),Zr();return}else if(Yr==="(")gt=gt+Yr,_r="in parens";else if(Yr===""){gt&&pt.push(gt),Zr();return}else gt=gt+Yr;else if(_r==="in parens")if(Yr===")")gt=gt+Yr,_r="in descriptor";else if(Yr===""){pt.push(gt),Zr();return}else gt=gt+Yr;else if(_r==="after descriptor"&&!nt(Yr))if(Yr===""){Zr();return}else _r="in descriptor",mt-=1;mt+=1}}function Zr(){var Qr=!1,_i,rs,ns,ss,fs={},os,is,cs,ps,vs;for(ss=0;ss<pt.length;ss++)os=pt[ss],is=os[os.length-1],cs=os.substring(0,os.length-1),ps=parseInt(cs,10),vs=parseFloat(cs),ct.test(cs)&&is==="w"?((_i||rs)&&(Qr=!0),ps===0?Qr=!0:_i=ps):dt.test(cs)&&is==="x"?((_i||rs||ns)&&(Qr=!0),vs<0?Qr=!0:rs=vs):ct.test(cs)&&is==="h"?((ns||rs)&&(Qr=!0),ps===0?Qr=!0:ns=ps):Qr=!0;Qr?console&&console.log&&console.log("Invalid srcset descriptor found in '"+et+"' at '"+os+"'."):(fs.url=ft,_i&&(fs.w=_i),rs&&(fs.d=rs),ns&&(fs.h=ns),Kr.push(fs))}}})})(parseSrcset$1);var parseSrcsetExports=parseSrcset$1.exports,picocolors_browser={exports:{}},x=String,create=function(){return{isColorSupported:!1,reset:x,bold:x,dim:x,italic:x,underline:x,inverse:x,hidden:x,strikethrough:x,black:x,red:x,green:x,yellow:x,blue:x,magenta:x,cyan:x,white:x,gray:x,bgBlack:x,bgRed:x,bgGreen:x,bgYellow:x,bgBlue:x,bgMagenta:x,bgCyan:x,bgWhite:x}};picocolors_browser.exports=create(),picocolors_browser.exports.createColors=create;var picocolors_browserExports=picocolors_browser.exports;const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$2=getAugmentedNamespace(__viteBrowserExternal$1);let pico=picocolors_browserExports,terminalHighlight$1=require$$2,CssSyntaxError$3=class ho extends Error{constructor(et,nt,rt,it,st,ot){super(et),this.name="CssSyntaxError",this.reason=et,st&&(this.file=st),it&&(this.source=it),ot&&(this.plugin=ot),typeof nt<"u"&&typeof rt<"u"&&(typeof nt=="number"?(this.line=nt,this.column=rt):(this.line=nt.line,this.column=nt.column,this.endLine=rt.line,this.endColumn=rt.column)),this.setMessage(),Error.captureStackTrace&&Error.captureStackTrace(this,ho)}setMessage(){this.message=this.plugin?this.plugin+": ":"",this.message+=this.file?this.file:"<css input>",typeof this.line<"u"&&(this.message+=":"+this.line+":"+this.column),this.message+=": "+this.reason}showSourceCode(et){if(!this.source)return"";let nt=this.source;et==null&&(et=pico.isColorSupported),terminalHighlight$1&&et&&(nt=terminalHighlight$1(nt));let rt=nt.split(/\r?\n/),it=Math.max(this.line-3,0),st=Math.min(this.line+2,rt.length),ot=String(st).length,lt,ut;if(et){let{bold:ct,gray:dt,red:ft}=pico.createColors(!0);lt=pt=>ct(ft(pt)),ut=pt=>dt(pt)}else lt=ut=ct=>ct;return rt.slice(it,st).map((ct,dt)=>{let ft=it+1+dt,pt=" "+(" "+ft).slice(-ot)+" | ";if(ft===this.line){let gt=ut(pt.replace(/\d/g," "))+ct.slice(0,this.column-1).replace(/[^\t]/g," ");return lt(">")+ut(pt)+ct+`
 `+gt+lt("^")}return" "+ut(pt)+ct}).join(`
`)}toString(){let et=this.showSourceCode();return et&&(et=`

`+et+`
`),this.name+": "+this.message+et}};var cssSyntaxError=CssSyntaxError$3;CssSyntaxError$3.default=CssSyntaxError$3;var symbols={};symbols.isClean=Symbol("isClean"),symbols.my=Symbol("my");const DEFAULT_RAW={after:`
`,beforeClose:`
`,beforeComment:`
`,beforeDecl:`
`,beforeOpen:" ",beforeRule:`
`,colon:": ",commentLeft:" ",commentRight:" ",emptyBody:"",indent:"    ",semicolon:!1};function capitalize(tt){return tt[0].toUpperCase()+tt.slice(1)}let Stringifier$2=class{constructor(et){this.builder=et}atrule(et,nt){let rt="@"+et.name,it=et.params?this.rawValue(et,"params"):"";if(typeof et.raws.afterName<"u"?rt+=et.raws.afterName:it&&(rt+=" "),et.nodes)this.block(et,rt+it);else{let st=(et.raws.between||"")+(nt?";":"");this.builder(rt+it+st,et)}}beforeAfter(et,nt){let rt;et.type==="decl"?rt=this.raw(et,null,"beforeDecl"):et.type==="comment"?rt=this.raw(et,null,"beforeComment"):nt==="before"?rt=this.raw(et,null,"beforeRule"):rt=this.raw(et,null,"beforeClose");let it=et.parent,st=0;for(;it&&it.type!=="root";)st+=1,it=it.parent;if(rt.includes(`
`)){let ot=this.raw(et,null,"indent");if(ot.length)for(let lt=0;lt<st;lt++)rt+=ot}return rt}block(et,nt){let rt=this.raw(et,"between","beforeOpen");this.builder(nt+rt+"{",et,"start");let it;et.nodes&&et.nodes.length?(this.body(et),it=this.raw(et,"after")):it=this.raw(et,"after","emptyBody"),it&&this.builder(it),this.builder("}",et,"end")}body(et){let nt=et.nodes.length-1;for(;nt>0&&et.nodes[nt].type==="comment";)nt-=1;let rt=this.raw(et,"semicolon");for(let it=0;it<et.nodes.length;it++){let st=et.nodes[it],ot=this.raw(st,"before");ot&&this.builder(ot),this.stringify(st,nt!==it||rt)}}comment(et){let nt=this.raw(et,"left","commentLeft"),rt=this.raw(et,"right","commentRight");this.builder("/*"+nt+et.text+rt+"*/",et)}decl(et,nt){let rt=this.raw(et,"between","colon"),it=et.prop+rt+this.rawValue(et,"value");et.important&&(it+=et.raws.important||" !important"),nt&&(it+=";"),this.builder(it,et)}document(et){this.body(et)}raw(et,nt,rt){let it;if(rt||(rt=nt),nt&&(it=et.raws[nt],typeof it<"u"))return it;let st=et.parent;if(rt==="before"&&(!st||st.type==="root"&&st.first===et||st&&st.type==="document"))return"";if(!st)return DEFAULT_RAW[rt];let ot=et.root();if(ot.rawCache||(ot.rawCache={}),typeof ot.rawCache[rt]<"u")return ot.rawCache[rt];if(rt==="before"||rt==="after")return this.beforeAfter(et,rt);{let lt="raw"+capitalize(rt);this[lt]?it=this[lt](ot,et):ot.walk(ut=>{if(it=ut.raws[nt],typeof it<"u")return!1})}return typeof it>"u"&&(it=DEFAULT_RAW[rt]),ot.rawCache[rt]=it,it}rawBeforeClose(et){let nt;return et.walk(rt=>{if(rt.nodes&&rt.nodes.length>0&&typeof rt.raws.after<"u")return nt=rt.raws.after,nt.includes(`
`)&&(nt=nt.replace(/[^\n]+$/,"")),!1}),nt&&(nt=nt.replace(/\S/g,"")),nt}rawBeforeComment(et,nt){let rt;return et.walkComments(it=>{if(typeof it.raws.before<"u")return rt=it.raws.before,rt.includes(`
`)&&(rt=rt.replace(/[^\n]+$/,"")),!1}),typeof rt>"u"?rt=this.raw(nt,null,"beforeDecl"):rt&&(rt=rt.replace(/\S/g,"")),rt}rawBeforeDecl(et,nt){let rt;return et.walkDecls(it=>{if(typeof it.raws.before<"u")return rt=it.raws.before,rt.includes(`
`)&&(rt=rt.replace(/[^\n]+$/,"")),!1}),typeof rt>"u"?rt=this.raw(nt,null,"beforeRule"):rt&&(rt=rt.replace(/\S/g,"")),rt}rawBeforeOpen(et){let nt;return et.walk(rt=>{if(rt.type!=="decl"&&(nt=rt.raws.between,typeof nt<"u"))return!1}),nt}rawBeforeRule(et){let nt;return et.walk(rt=>{if(rt.nodes&&(rt.parent!==et||et.first!==rt)&&typeof rt.raws.before<"u")return nt=rt.raws.before,nt.includes(`
`)&&(nt=nt.replace(/[^\n]+$/,"")),!1}),nt&&(nt=nt.replace(/\S/g,"")),nt}rawColon(et){let nt;return et.walkDecls(rt=>{if(typeof rt.raws.between<"u")return nt=rt.raws.between.replace(/[^\s:]/g,""),!1}),nt}rawEmptyBody(et){let nt;return et.walk(rt=>{if(rt.nodes&&rt.nodes.length===0&&(nt=rt.raws.after,typeof nt<"u"))return!1}),nt}rawIndent(et){if(et.raws.indent)return et.raws.indent;let nt;return et.walk(rt=>{let it=rt.parent;if(it&&it!==et&&it.parent&&it.parent===et&&typeof rt.raws.before<"u"){let st=rt.raws.before.split(`
`);return nt=st[st.length-1],nt=nt.replace(/\S/g,""),!1}}),nt}rawSemicolon(et){let nt;return et.walk(rt=>{if(rt.nodes&&rt.nodes.length&&rt.last.type==="decl"&&(nt=rt.raws.semicolon,typeof nt<"u"))return!1}),nt}rawValue(et,nt){let rt=et[nt],it=et.raws[nt];return it&&it.value===rt?it.raw:rt}root(et){this.body(et),et.raws.after&&this.builder(et.raws.after)}rule(et){this.block(et,this.rawValue(et,"selector")),et.raws.ownSemicolon&&this.builder(et.raws.ownSemicolon,et,"end")}stringify(et,nt){if(!this[et.type])throw new Error("Unknown AST node type "+et.type+". Maybe you need to change PostCSS stringifier.");this[et.type](et,nt)}};var stringifier=Stringifier$2;Stringifier$2.default=Stringifier$2;let Stringifier$1=stringifier;function stringify$4(tt,et){new Stringifier$1(et).stringify(tt)}var stringify_1=stringify$4;stringify$4.default=stringify$4;let{isClean:isClean$2,my:my$2}=symbols,CssSyntaxError$2=cssSyntaxError,Stringifier=stringifier,stringify$3=stringify_1;function cloneNode(tt,et){let nt=new tt.constructor;for(let rt in tt){if(!Object.prototype.hasOwnProperty.call(tt,rt)||rt==="proxyCache")continue;let it=tt[rt],st=typeof it;rt==="parent"&&st==="object"?et&&(nt[rt]=et):rt==="source"?nt[rt]=it:Array.isArray(it)?nt[rt]=it.map(ot=>cloneNode(ot,nt)):(st==="object"&&it!==null&&(it=cloneNode(it)),nt[rt]=it)}return nt}let Node$5=class{constructor(et={}){this.raws={},this[isClean$2]=!1,this[my$2]=!0;for(let nt in et)if(nt==="nodes"){this.nodes=[];for(let rt of et[nt])typeof rt.clone=="function"?this.append(rt.clone()):this.append(rt)}else this[nt]=et[nt]}addToError(et){if(et.postcssNode=this,et.stack&&this.source&&/\n\s{4}at /.test(et.stack)){let nt=this.source;et.stack=et.stack.replace(/\n\s{4}at /,`$&${nt.input.from}:${nt.start.line}:${nt.start.column}$&`)}return et}after(et){return this.parent.insertAfter(this,et),this}assign(et={}){for(let nt in et)this[nt]=et[nt];return this}before(et){return this.parent.insertBefore(this,et),this}cleanRaws(et){delete this.raws.before,delete this.raws.after,et||delete this.raws.between}clone(et={}){let nt=cloneNode(this);for(let rt in et)nt[rt]=et[rt];return nt}cloneAfter(et={}){let nt=this.clone(et);return this.parent.insertAfter(this,nt),nt}cloneBefore(et={}){let nt=this.clone(et);return this.parent.insertBefore(this,nt),nt}error(et,nt={}){if(this.source){let{end:rt,start:it}=this.rangeBy(nt);return this.source.input.error(et,{column:it.column,line:it.line},{column:rt.column,line:rt.line},nt)}return new CssSyntaxError$2(et)}getProxyProcessor(){return{get(et,nt){return nt==="proxyOf"?et:nt==="root"?()=>et.root().toProxy():et[nt]},set(et,nt,rt){return et[nt]===rt||(et[nt]=rt,(nt==="prop"||nt==="value"||nt==="name"||nt==="params"||nt==="important"||nt==="text")&&et.markDirty()),!0}}}markDirty(){if(this[isClean$2]){this[isClean$2]=!1;let et=this;for(;et=et.parent;)et[isClean$2]=!1}}next(){if(!this.parent)return;let et=this.parent.index(this);return this.parent.nodes[et+1]}positionBy(et,nt){let rt=this.source.start;if(et.index)rt=this.positionInside(et.index,nt);else if(et.word){nt=this.toString();let it=nt.indexOf(et.word);it!==-1&&(rt=this.positionInside(it,nt))}return rt}positionInside(et,nt){let rt=nt||this.toString(),it=this.source.start.column,st=this.source.start.line;for(let ot=0;ot<et;ot++)rt[ot]===`
`?(it=1,st+=1):it+=1;return{column:it,line:st}}prev(){if(!this.parent)return;let et=this.parent.index(this);return this.parent.nodes[et-1]}rangeBy(et){let nt={column:this.source.start.column,line:this.source.start.line},rt=this.source.end?{column:this.source.end.column+1,line:this.source.end.line}:{column:nt.column+1,line:nt.line};if(et.word){let it=this.toString(),st=it.indexOf(et.word);st!==-1&&(nt=this.positionInside(st,it),rt=this.positionInside(st+et.word.length,it))}else et.start?nt={column:et.start.column,line:et.start.line}:et.index&&(nt=this.positionInside(et.index)),et.end?rt={column:et.end.column,line:et.end.line}:et.endIndex?rt=this.positionInside(et.endIndex):et.index&&(rt=this.positionInside(et.index+1));return(rt.line<nt.line||rt.line===nt.line&&rt.column<=nt.column)&&(rt={column:nt.column+1,line:nt.line}),{end:rt,start:nt}}raw(et,nt){return new Stringifier().raw(this,et,nt)}remove(){return this.parent&&this.parent.removeChild(this),this.parent=void 0,this}replaceWith(...et){if(this.parent){let nt=this,rt=!1;for(let it of et)it===this?rt=!0:rt?(this.parent.insertAfter(nt,it),nt=it):this.parent.insertBefore(nt,it);rt||this.remove()}return this}root(){let et=this;for(;et.parent&&et.parent.type!=="document";)et=et.parent;return et}toJSON(et,nt){let rt={},it=nt==null;nt=nt||new Map;let st=0;for(let ot in this){if(!Object.prototype.hasOwnProperty.call(this,ot)||ot==="parent"||ot==="proxyCache")continue;let lt=this[ot];if(Array.isArray(lt))rt[ot]=lt.map(ut=>typeof ut=="object"&&ut.toJSON?ut.toJSON(null,nt):ut);else if(typeof lt=="object"&&lt.toJSON)rt[ot]=lt.toJSON(null,nt);else if(ot==="source"){let ut=nt.get(lt.input);ut==null&&(ut=st,nt.set(lt.input,st),st++),rt[ot]={end:lt.end,inputId:ut,start:lt.start}}else rt[ot]=lt}return it&&(rt.inputs=[...nt.keys()].map(ot=>ot.toJSON())),rt}toProxy(){return this.proxyCache||(this.proxyCache=new Proxy(this,this.getProxyProcessor())),this.proxyCache}toString(et=stringify$3){et.stringify&&(et=et.stringify);let nt="";return et(this,rt=>{nt+=rt}),nt}warn(et,nt,rt){let it={node:this};for(let st in rt)it[st]=rt[st];return et.warn(nt,it)}get proxyOf(){return this}};var node=Node$5;Node$5.default=Node$5;let Node$4=node,Declaration$4=class extends Node$4{constructor(et){et&&typeof et.value<"u"&&typeof et.value!="string"&&(et={...et,value:String(et.value)}),super(et),this.type="decl"}get variable(){return this.prop.startsWith("--")||this.prop[0]==="$"}};var declaration=Declaration$4;Declaration$4.default=Declaration$4;let urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",customAlphabet=(tt,et=21)=>(nt=et)=>{let rt="",it=nt;for(;it--;)rt+=tt[Math.random()*tt.length|0];return rt},nanoid$1=(tt=21)=>{let et="",nt=tt;for(;nt--;)et+=urlAlphabet[Math.random()*64|0];return et};var nonSecure={nanoid:nanoid$1,customAlphabet};let{SourceMapConsumer:SourceMapConsumer$2,SourceMapGenerator:SourceMapGenerator$2}=require$$2,{existsSync,readFileSync}=require$$2,{dirname:dirname$1,join}=require$$2;function fromBase64(tt){return Buffer?Buffer.from(tt,"base64").toString():window.atob(tt)}let PreviousMap$2=class{constructor(et,nt){if(nt.map===!1)return;this.loadAnnotation(et),this.inline=this.startWith(this.annotation,"data:");let rt=nt.map?nt.map.prev:void 0,it=this.loadMap(nt.from,rt);!this.mapFile&&nt.from&&(this.mapFile=nt.from),this.mapFile&&(this.root=dirname$1(this.mapFile)),it&&(this.text=it)}consumer(){return this.consumerCache||(this.consumerCache=new SourceMapConsumer$2(this.text)),this.consumerCache}decodeInline(et){let nt=/^data:application\/json;charset=utf-?8;base64,/,rt=/^data:application\/json;base64,/,it=/^data:application\/json;charset=utf-?8,/,st=/^data:application\/json,/;if(it.test(et)||st.test(et))return decodeURIComponent(et.substr(RegExp.lastMatch.length));if(nt.test(et)||rt.test(et))return fromBase64(et.substr(RegExp.lastMatch.length));let ot=et.match(/data:application\/json;([^,]+),/)[1];throw new Error("Unsupported source map encoding "+ot)}getAnnotationURL(et){return et.replace(/^\/\*\s*# sourceMappingURL=/,"").trim()}isMap(et){return typeof et!="object"?!1:typeof et.mappings=="string"||typeof et._mappings=="string"||Array.isArray(et.sections)}loadAnnotation(et){let nt=et.match(/\/\*\s*# sourceMappingURL=/gm);if(!nt)return;let rt=et.lastIndexOf(nt.pop()),it=et.indexOf("*/",rt);rt>-1&&it>-1&&(this.annotation=this.getAnnotationURL(et.substring(rt,it)))}loadFile(et){if(this.root=dirname$1(et),existsSync(et))return this.mapFile=et,readFileSync(et,"utf-8").toString().trim()}loadMap(et,nt){if(nt===!1)return!1;if(nt){if(typeof nt=="string")return nt;if(typeof nt=="function"){let rt=nt(et);if(rt){let it=this.loadFile(rt);if(!it)throw new Error("Unable to load previous source map: "+rt.toString());return it}}else{if(nt instanceof SourceMapConsumer$2)return SourceMapGenerator$2.fromSourceMap(nt).toString();if(nt instanceof SourceMapGenerator$2)return nt.toString();if(this.isMap(nt))return JSON.stringify(nt);throw new Error("Unsupported previous source map format: "+nt.toString())}}else{if(this.inline)return this.decodeInline(this.annotation);if(this.annotation){let rt=this.annotation;return et&&(rt=join(dirname$1(et),rt)),this.loadFile(rt)}}}startWith(et,nt){return et?et.substr(0,nt.length)===nt:!1}withContent(){return!!(this.consumer().sourcesContent&&this.consumer().sourcesContent.length>0)}};var previousMap=PreviousMap$2;PreviousMap$2.default=PreviousMap$2;let{SourceMapConsumer:SourceMapConsumer$1,SourceMapGenerator:SourceMapGenerator$1}=require$$2,{fileURLToPath,pathToFileURL:pathToFileURL$1}=require$$2,{isAbsolute,resolve:resolve$1}=require$$2,{nanoid}=nonSecure,terminalHighlight=require$$2,CssSyntaxError$1=cssSyntaxError,PreviousMap$1=previousMap,fromOffsetCache=Symbol("fromOffsetCache"),sourceMapAvailable$1=!!(SourceMapConsumer$1&&SourceMapGenerator$1),pathAvailable$1=!!(resolve$1&&isAbsolute),Input$4=class{constructor(et,nt={}){if(et===null||typeof et>"u"||typeof et=="object"&&!et.toString)throw new Error(`PostCSS received ${et} instead of CSS string`);if(this.css=et.toString(),this.css[0]==="\uFEFF"||this.css[0]===""?(this.hasBOM=!0,this.css=this.css.slice(1)):this.hasBOM=!1,nt.from&&(!pathAvailable$1||/^\w+:\/\//.test(nt.from)||isAbsolute(nt.from)?this.file=nt.from:this.file=resolve$1(nt.from)),pathAvailable$1&&sourceMapAvailable$1){let rt=new PreviousMap$1(this.css,nt);if(rt.text){this.map=rt;let it=rt.consumer().file;!this.file&&it&&(this.file=this.mapResolve(it))}}this.file||(this.id="<input css "+nanoid(6)+">"),this.map&&(this.map.file=this.from)}error(et,nt,rt,it={}){let st,ot,lt;if(nt&&typeof nt=="object"){let ct=nt,dt=rt;if(typeof ct.offset=="number"){let ft=this.fromOffset(ct.offset);nt=ft.line,rt=ft.col}else nt=ct.line,rt=ct.column;if(typeof dt.offset=="number"){let ft=this.fromOffset(dt.offset);ot=ft.line,lt=ft.col}else ot=dt.line,lt=dt.column}else if(!rt){let ct=this.fromOffset(nt);nt=ct.line,rt=ct.col}let ut=this.origin(nt,rt,ot,lt);return ut?st=new CssSyntaxError$1(et,ut.endLine===void 0?ut.line:{column:ut.column,line:ut.line},ut.endLine===void 0?ut.column:{column:ut.endColumn,line:ut.endLine},ut.source,ut.file,it.plugin):st=new CssSyntaxError$1(et,ot===void 0?nt:{column:rt,line:nt},ot===void 0?rt:{column:lt,line:ot},this.css,this.file,it.plugin),st.input={column:rt,endColumn:lt,endLine:ot,line:nt,source:this.css},this.file&&(pathToFileURL$1&&(st.input.url=pathToFileURL$1(this.file).toString()),st.input.file=this.file),st}fromOffset(et){let nt,rt;if(this[fromOffsetCache])rt=this[fromOffsetCache];else{let st=this.css.split(`
`);rt=new Array(st.length);let ot=0;for(let lt=0,ut=st.length;lt<ut;lt++)rt[lt]=ot,ot+=st[lt].length+1;this[fromOffsetCache]=rt}nt=rt[rt.length-1];let it=0;if(et>=nt)it=rt.length-1;else{let st=rt.length-2,ot;for(;it<st;)if(ot=it+(st-it>>1),et<rt[ot])st=ot-1;else if(et>=rt[ot+1])it=ot+1;else{it=ot;break}}return{col:et-rt[it]+1,line:it+1}}mapResolve(et){return/^\w+:\/\//.test(et)?et:resolve$1(this.map.consumer().sourceRoot||this.map.root||".",et)}origin(et,nt,rt,it){if(!this.map)return!1;let st=this.map.consumer(),ot=st.originalPositionFor({column:nt,line:et});if(!ot.source)return!1;let lt;typeof rt=="number"&&(lt=st.originalPositionFor({column:it,line:rt}));let ut;isAbsolute(ot.source)?ut=pathToFileURL$1(ot.source):ut=new URL(ot.source,this.map.consumer().sourceRoot||pathToFileURL$1(this.map.mapFile));let ct={column:ot.column,endColumn:lt&&lt.column,endLine:lt&&lt.line,line:ot.line,url:ut.toString()};if(ut.protocol==="file:")if(fileURLToPath)ct.file=fileURLToPath(ut);else throw new Error("file: protocol is not available in this PostCSS build");let dt=st.sourceContentFor(ot.source);return dt&&(ct.source=dt),ct}toJSON(){let et={};for(let nt of["hasBOM","css","file","id"])this[nt]!=null&&(et[nt]=this[nt]);return this.map&&(et.map={...this.map},et.map.consumerCache&&(et.map.consumerCache=void 0)),et}get from(){return this.file||this.id}};var input=Input$4;Input$4.default=Input$4,terminalHighlight&&terminalHighlight.registerInput&&terminalHighlight.registerInput(Input$4);let{SourceMapConsumer,SourceMapGenerator}=require$$2,{dirname,relative,resolve,sep}=require$$2,{pathToFileURL}=require$$2,Input$3=input,sourceMapAvailable=!!(SourceMapConsumer&&SourceMapGenerator),pathAvailable=!!(dirname&&resolve&&relative&&sep),MapGenerator$2=class{constructor(et,nt,rt,it){this.stringify=et,this.mapOpts=rt.map||{},this.root=nt,this.opts=rt,this.css=it,this.originalCSS=it,this.usesFileUrls=!this.mapOpts.from&&this.mapOpts.absolute,this.memoizedFileURLs=new Map,this.memoizedPaths=new Map,this.memoizedURLs=new Map}addAnnotation(){let et;this.isInline()?et="data:application/json;base64,"+this.toBase64(this.map.toString()):typeof this.mapOpts.annotation=="string"?et=this.mapOpts.annotation:typeof this.mapOpts.annotation=="function"?et=this.mapOpts.annotation(this.opts.to,this.root):et=this.outputFile()+".map";let nt=`
`;this.css.includes(`\r
`)&&(nt=`\r
`),this.css+=nt+"/*# sourceMappingURL="+et+" */"}applyPrevMaps(){for(let et of this.previous()){let nt=this.toUrl(this.path(et.file)),rt=et.root||dirname(et.file),it;this.mapOpts.sourcesContent===!1?(it=new SourceMapConsumer(et.text),it.sourcesContent&&(it.sourcesContent=null)):it=et.consumer(),this.map.applySourceMap(it,nt,this.toUrl(this.path(rt)))}}clearAnnotation(){if(this.mapOpts.annotation!==!1)if(this.root){let et;for(let nt=this.root.nodes.length-1;nt>=0;nt--)et=this.root.nodes[nt],et.type==="comment"&&et.text.indexOf("# sourceMappingURL=")===0&&this.root.removeChild(nt)}else this.css&&(this.css=this.css.replace(/\n*?\/\*#[\S\s]*?\*\/$/gm,""))}generate(){if(this.clearAnnotation(),pathAvailable&&sourceMapAvailable&&this.isMap())return this.generateMap();{let et="";return this.stringify(this.root,nt=>{et+=nt}),[et]}}generateMap(){if(this.root)this.generateString();else if(this.previous().length===1){let et=this.previous()[0].consumer();et.file=this.outputFile(),this.map=SourceMapGenerator.fromSourceMap(et)}else this.map=new SourceMapGenerator({file:this.outputFile()}),this.map.addMapping({generated:{column:0,line:1},original:{column:0,line:1},source:this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>"});return this.isSourcesContent()&&this.setSourcesContent(),this.root&&this.previous().length>0&&this.applyPrevMaps(),this.isAnnotation()&&this.addAnnotation(),this.isInline()?[this.css]:[this.css,this.map]}generateString(){this.css="",this.map=new SourceMapGenerator({file:this.outputFile()});let et=1,nt=1,rt="<no source>",it={generated:{column:0,line:0},original:{column:0,line:0},source:""},st,ot;this.stringify(this.root,(lt,ut,ct)=>{if(this.css+=lt,ut&&ct!=="end"&&(it.generated.line=et,it.generated.column=nt-1,ut.source&&ut.source.start?(it.source=this.sourcePath(ut),it.original.line=ut.source.start.line,it.original.column=ut.source.start.column-1,this.map.addMapping(it)):(it.source=rt,it.original.line=1,it.original.column=0,this.map.addMapping(it))),st=lt.match(/\n/g),st?(et+=st.length,ot=lt.lastIndexOf(`
`),nt=lt.length-ot):nt+=lt.length,ut&&ct!=="start"){let dt=ut.parent||{raws:{}};(!(ut.type==="decl"||ut.type==="atrule"&&!ut.nodes)||ut!==dt.last||dt.raws.semicolon)&&(ut.source&&ut.source.end?(it.source=this.sourcePath(ut),it.original.line=ut.source.end.line,it.original.column=ut.source.end.column-1,it.generated.line=et,it.generated.column=nt-2,this.map.addMapping(it)):(it.source=rt,it.original.line=1,it.original.column=0,it.generated.line=et,it.generated.column=nt-1,this.map.addMapping(it)))}})}isAnnotation(){return this.isInline()?!0:typeof this.mapOpts.annotation<"u"?this.mapOpts.annotation:this.previous().length?this.previous().some(et=>et.annotation):!0}isInline(){if(typeof this.mapOpts.inline<"u")return this.mapOpts.inline;let et=this.mapOpts.annotation;return typeof et<"u"&&et!==!0?!1:this.previous().length?this.previous().some(nt=>nt.inline):!0}isMap(){return typeof this.opts.map<"u"?!!this.opts.map:this.previous().length>0}isSourcesContent(){return typeof this.mapOpts.sourcesContent<"u"?this.mapOpts.sourcesContent:this.previous().length?this.previous().some(et=>et.withContent()):!0}outputFile(){return this.opts.to?this.path(this.opts.to):this.opts.from?this.path(this.opts.from):"to.css"}path(et){if(this.mapOpts.absolute||et.charCodeAt(0)===60||/^\w+:\/\//.test(et))return et;let nt=this.memoizedPaths.get(et);if(nt)return nt;let rt=this.opts.to?dirname(this.opts.to):".";typeof this.mapOpts.annotation=="string"&&(rt=dirname(resolve(rt,this.mapOpts.annotation)));let it=relative(rt,et);return this.memoizedPaths.set(et,it),it}previous(){if(!this.previousMaps)if(this.previousMaps=[],this.root)this.root.walk(et=>{if(et.source&&et.source.input.map){let nt=et.source.input.map;this.previousMaps.includes(nt)||this.previousMaps.push(nt)}});else{let et=new Input$3(this.originalCSS,this.opts);et.map&&this.previousMaps.push(et.map)}return this.previousMaps}setSourcesContent(){let et={};if(this.root)this.root.walk(nt=>{if(nt.source){let rt=nt.source.input.from;if(rt&&!et[rt]){et[rt]=!0;let it=this.usesFileUrls?this.toFileUrl(rt):this.toUrl(this.path(rt));this.map.setSourceContent(it,nt.source.input.css)}}});else if(this.css){let nt=this.opts.from?this.toUrl(this.path(this.opts.from)):"<no source>";this.map.setSourceContent(nt,this.css)}}sourcePath(et){return this.mapOpts.from?this.toUrl(this.mapOpts.from):this.usesFileUrls?this.toFileUrl(et.source.input.from):this.toUrl(this.path(et.source.input.from))}toBase64(et){return Buffer?Buffer.from(et).toString("base64"):window.btoa(unescape(encodeURIComponent(et)))}toFileUrl(et){let nt=this.memoizedFileURLs.get(et);if(nt)return nt;if(pathToFileURL){let rt=pathToFileURL(et).toString();return this.memoizedFileURLs.set(et,rt),rt}else throw new Error("`map.absolute` option is not available in this PostCSS build")}toUrl(et){let nt=this.memoizedURLs.get(et);if(nt)return nt;sep==="\\"&&(et=et.replace(/\\/g,"/"));let rt=encodeURI(et).replace(/[#?]/g,encodeURIComponent);return this.memoizedURLs.set(et,rt),rt}};var mapGenerator=MapGenerator$2;let Node$3=node,Comment$4=class extends Node$3{constructor(et){super(et),this.type="comment"}};var comment=Comment$4;Comment$4.default=Comment$4;let{isClean:isClean$1,my:my$1}=symbols,Declaration$3=declaration,Comment$3=comment,Node$2=node,parse$8,Rule$4,AtRule$4,Root$6;function cleanSource(tt){return tt.map(et=>(et.nodes&&(et.nodes=cleanSource(et.nodes)),delete et.source,et))}function markDirtyUp(tt){if(tt[isClean$1]=!1,tt.proxyOf.nodes)for(let et of tt.proxyOf.nodes)markDirtyUp(et)}let Container$7=class po extends Node$2{append(...et){for(let nt of et){let rt=this.normalize(nt,this.last);for(let it of rt)this.proxyOf.nodes.push(it)}return this.markDirty(),this}cleanRaws(et){if(super.cleanRaws(et),this.nodes)for(let nt of this.nodes)nt.cleanRaws(et)}each(et){if(!this.proxyOf.nodes)return;let nt=this.getIterator(),rt,it;for(;this.indexes[nt]<this.proxyOf.nodes.length&&(rt=this.indexes[nt],it=et(this.proxyOf.nodes[rt],rt),it!==!1);)this.indexes[nt]+=1;return delete this.indexes[nt],it}every(et){return this.nodes.every(et)}getIterator(){this.lastEach||(this.lastEach=0),this.indexes||(this.indexes={}),this.lastEach+=1;let et=this.lastEach;return this.indexes[et]=0,et}getProxyProcessor(){return{get(et,nt){return nt==="proxyOf"?et:et[nt]?nt==="each"||typeof nt=="string"&&nt.startsWith("walk")?(...rt)=>et[nt](...rt.map(it=>typeof it=="function"?(st,ot)=>it(st.toProxy(),ot):it)):nt==="every"||nt==="some"?rt=>et[nt]((it,...st)=>rt(it.toProxy(),...st)):nt==="root"?()=>et.root().toProxy():nt==="nodes"?et.nodes.map(rt=>rt.toProxy()):nt==="first"||nt==="last"?et[nt].toProxy():et[nt]:et[nt]},set(et,nt,rt){return et[nt]===rt||(et[nt]=rt,(nt==="name"||nt==="params"||nt==="selector")&&et.markDirty()),!0}}}index(et){return typeof et=="number"?et:(et.proxyOf&&(et=et.proxyOf),this.proxyOf.nodes.indexOf(et))}insertAfter(et,nt){let rt=this.index(et),it=this.normalize(nt,this.proxyOf.nodes[rt]).reverse();rt=this.index(et);for(let ot of it)this.proxyOf.nodes.splice(rt+1,0,ot);let st;for(let ot in this.indexes)st=this.indexes[ot],rt<st&&(this.indexes[ot]=st+it.length);return this.markDirty(),this}insertBefore(et,nt){let rt=this.index(et),it=rt===0?"prepend":!1,st=this.normalize(nt,this.proxyOf.nodes[rt],it).reverse();rt=this.index(et);for(let lt of st)this.proxyOf.nodes.splice(rt,0,lt);let ot;for(let lt in this.indexes)ot=this.indexes[lt],rt<=ot&&(this.indexes[lt]=ot+st.length);return this.markDirty(),this}normalize(et,nt){if(typeof et=="string")et=cleanSource(parse$8(et).nodes);else if(typeof et>"u")et=[];else if(Array.isArray(et)){et=et.slice(0);for(let it of et)it.parent&&it.parent.removeChild(it,"ignore")}else if(et.type==="root"&&this.type!=="document"){et=et.nodes.slice(0);for(let it of et)it.parent&&it.parent.removeChild(it,"ignore")}else if(et.type)et=[et];else if(et.prop){if(typeof et.value>"u")throw new Error("Value field is missed in node creation");typeof et.value!="string"&&(et.value=String(et.value)),et=[new Declaration$3(et)]}else if(et.selector)et=[new Rule$4(et)];else if(et.name)et=[new AtRule$4(et)];else if(et.text)et=[new Comment$3(et)];else throw new Error("Unknown node type in node creation");return et.map(it=>(it[my$1]||po.rebuild(it),it=it.proxyOf,it.parent&&it.parent.removeChild(it),it[isClean$1]&&markDirtyUp(it),typeof it.raws.before>"u"&&nt&&typeof nt.raws.before<"u"&&(it.raws.before=nt.raws.before.replace(/\S/g,"")),it.parent=this.proxyOf,it))}prepend(...et){et=et.reverse();for(let nt of et){let rt=this.normalize(nt,this.first,"prepend").reverse();for(let it of rt)this.proxyOf.nodes.unshift(it);for(let it in this.indexes)this.indexes[it]=this.indexes[it]+rt.length}return this.markDirty(),this}push(et){return et.parent=this,this.proxyOf.nodes.push(et),this}removeAll(){for(let et of this.proxyOf.nodes)et.parent=void 0;return this.proxyOf.nodes=[],this.markDirty(),this}removeChild(et){et=this.index(et),this.proxyOf.nodes[et].parent=void 0,this.proxyOf.nodes.splice(et,1);let nt;for(let rt in this.indexes)nt=this.indexes[rt],nt>=et&&(this.indexes[rt]=nt-1);return this.markDirty(),this}replaceValues(et,nt,rt){return rt||(rt=nt,nt={}),this.walkDecls(it=>{nt.props&&!nt.props.includes(it.prop)||nt.fast&&!it.value.includes(nt.fast)||(it.value=it.value.replace(et,rt))}),this.markDirty(),this}some(et){return this.nodes.some(et)}walk(et){return this.each((nt,rt)=>{let it;try{it=et(nt,rt)}catch(st){throw nt.addToError(st)}return it!==!1&&nt.walk&&(it=nt.walk(et)),it})}walkAtRules(et,nt){return nt?et instanceof RegExp?this.walk((rt,it)=>{if(rt.type==="atrule"&&et.test(rt.name))return nt(rt,it)}):this.walk((rt,it)=>{if(rt.type==="atrule"&&rt.name===et)return nt(rt,it)}):(nt=et,this.walk((rt,it)=>{if(rt.type==="atrule")return nt(rt,it)}))}walkComments(et){return this.walk((nt,rt)=>{if(nt.type==="comment")return et(nt,rt)})}walkDecls(et,nt){return nt?et instanceof RegExp?this.walk((rt,it)=>{if(rt.type==="decl"&&et.test(rt.prop))return nt(rt,it)}):this.walk((rt,it)=>{if(rt.type==="decl"&&rt.prop===et)return nt(rt,it)}):(nt=et,this.walk((rt,it)=>{if(rt.type==="decl")return nt(rt,it)}))}walkRules(et,nt){return nt?et instanceof RegExp?this.walk((rt,it)=>{if(rt.type==="rule"&&et.test(rt.selector))return nt(rt,it)}):this.walk((rt,it)=>{if(rt.type==="rule"&&rt.selector===et)return nt(rt,it)}):(nt=et,this.walk((rt,it)=>{if(rt.type==="rule")return nt(rt,it)}))}get first(){if(this.proxyOf.nodes)return this.proxyOf.nodes[0]}get last(){if(this.proxyOf.nodes)return this.proxyOf.nodes[this.proxyOf.nodes.length-1]}};Container$7.registerParse=tt=>{parse$8=tt},Container$7.registerRule=tt=>{Rule$4=tt},Container$7.registerAtRule=tt=>{AtRule$4=tt},Container$7.registerRoot=tt=>{Root$6=tt};var container=Container$7;Container$7.default=Container$7,Container$7.rebuild=tt=>{tt.type==="atrule"?Object.setPrototypeOf(tt,AtRule$4.prototype):tt.type==="rule"?Object.setPrototypeOf(tt,Rule$4.prototype):tt.type==="decl"?Object.setPrototypeOf(tt,Declaration$3.prototype):tt.type==="comment"?Object.setPrototypeOf(tt,Comment$3.prototype):tt.type==="root"&&Object.setPrototypeOf(tt,Root$6.prototype),tt[my$1]=!0,tt.nodes&&tt.nodes.forEach(et=>{Container$7.rebuild(et)})};let Container$6=container,LazyResult$4,Processor$3,Document$3=class extends Container$6{constructor(et){super({type:"document",...et}),this.nodes||(this.nodes=[])}toResult(et={}){return new LazyResult$4(new Processor$3,this,et).stringify()}};Document$3.registerLazyResult=tt=>{LazyResult$4=tt},Document$3.registerProcessor=tt=>{Processor$3=tt};var document$1=Document$3;Document$3.default=Document$3;let Warning$2=class{constructor(et,nt={}){if(this.type="warning",this.text=et,nt.node&&nt.node.source){let rt=nt.node.rangeBy(nt);this.line=rt.start.line,this.column=rt.start.column,this.endLine=rt.end.line,this.endColumn=rt.end.column}for(let rt in nt)this[rt]=nt[rt]}toString(){return this.node?this.node.error(this.text,{index:this.index,plugin:this.plugin,word:this.word}).message:this.plugin?this.plugin+": "+this.text:this.text}};var warning=Warning$2;Warning$2.default=Warning$2;let Warning$1=warning,Result$3=class{constructor(et,nt,rt){this.processor=et,this.messages=[],this.root=nt,this.opts=rt,this.css=void 0,this.map=void 0}toString(){return this.css}warn(et,nt={}){nt.plugin||this.lastPlugin&&this.lastPlugin.postcssPlugin&&(nt.plugin=this.lastPlugin.postcssPlugin);let rt=new Warning$1(et,nt);return this.messages.push(rt),rt}warnings(){return this.messages.filter(et=>et.type==="warning")}get content(){return this.css}};var result=Result$3;Result$3.default=Result$3;const SINGLE_QUOTE=39,DOUBLE_QUOTE=34,BACKSLASH=92,SLASH=47,NEWLINE=10,SPACE=32,FEED=12,TAB=9,CR=13,OPEN_SQUARE=91,CLOSE_SQUARE=93,OPEN_PARENTHESES=40,CLOSE_PARENTHESES=41,OPEN_CURLY=123,CLOSE_CURLY=125,SEMICOLON=59,ASTERISK=42,COLON=58,AT=64,RE_AT_END=/[\t\n\f\r "#'()/;[\\\]{}]/g,RE_WORD_END=/[\t\n\f\r !"#'():;@[\\\]{}]|\/(?=\*)/g,RE_BAD_BRACKET=/.[\r\n"'(/\\]/,RE_HEX_ESCAPE=/[\da-f]/i;var tokenize=function(et,nt={}){let rt=et.css.valueOf(),it=nt.ignoreErrors,st,ot,lt,ut,ct,dt,ft,pt,gt,_r,Yr=rt.length,mt=0,Kr=[],Xr=[];function Zr(){return mt}function Qr(ss){throw et.error("Unclosed "+ss,mt)}function _i(){return Xr.length===0&&mt>=Yr}function rs(ss){if(Xr.length)return Xr.pop();if(mt>=Yr)return;let fs=ss?ss.ignoreUnclosed:!1;switch(st=rt.charCodeAt(mt),st){case NEWLINE:case SPACE:case TAB:case CR:case FEED:{ot=mt;do ot+=1,st=rt.charCodeAt(ot);while(st===SPACE||st===NEWLINE||st===TAB||st===CR||st===FEED);_r=["space",rt.slice(mt,ot)],mt=ot-1;break}case OPEN_SQUARE:case CLOSE_SQUARE:case OPEN_CURLY:case CLOSE_CURLY:case COLON:case SEMICOLON:case CLOSE_PARENTHESES:{let os=String.fromCharCode(st);_r=[os,os,mt];break}case OPEN_PARENTHESES:{if(pt=Kr.length?Kr.pop()[1]:"",gt=rt.charCodeAt(mt+1),pt==="url"&&gt!==SINGLE_QUOTE&&gt!==DOUBLE_QUOTE&&gt!==SPACE&&gt!==NEWLINE&&gt!==TAB&&gt!==FEED&&gt!==CR){ot=mt;do{if(dt=!1,ot=rt.indexOf(")",ot+1),ot===-1)if(it||fs){ot=mt;break}else Qr("bracket");for(ft=ot;rt.charCodeAt(ft-1)===BACKSLASH;)ft-=1,dt=!dt}while(dt);_r=["brackets",rt.slice(mt,ot+1),mt,ot],mt=ot}else ot=rt.indexOf(")",mt+1),ut=rt.slice(mt,ot+1),ot===-1||RE_BAD_BRACKET.test(ut)?_r=["(","(",mt]:(_r=["brackets",ut,mt,ot],mt=ot);break}case SINGLE_QUOTE:case DOUBLE_QUOTE:{lt=st===SINGLE_QUOTE?"'":'"',ot=mt;do{if(dt=!1,ot=rt.indexOf(lt,ot+1),ot===-1)if(it||fs){ot=mt+1;break}else Qr("string");for(ft=ot;rt.charCodeAt(ft-1)===BACKSLASH;)ft-=1,dt=!dt}while(dt);_r=["string",rt.slice(mt,ot+1),mt,ot],mt=ot;break}case AT:{RE_AT_END.lastIndex=mt+1,RE_AT_END.test(rt),RE_AT_END.lastIndex===0?ot=rt.length-1:ot=RE_AT_END.lastIndex-2,_r=["at-word",rt.slice(mt,ot+1),mt,ot],mt=ot;break}case BACKSLASH:{for(ot=mt,ct=!0;rt.charCodeAt(ot+1)===BACKSLASH;)ot+=1,ct=!ct;if(st=rt.charCodeAt(ot+1),ct&&st!==SLASH&&st!==SPACE&&st!==NEWLINE&&st!==TAB&&st!==CR&&st!==FEED&&(ot+=1,RE_HEX_ESCAPE.test(rt.charAt(ot)))){for(;RE_HEX_ESCAPE.test(rt.charAt(ot+1));)ot+=1;rt.charCodeAt(ot+1)===SPACE&&(ot+=1)}_r=["word",rt.slice(mt,ot+1),mt,ot],mt=ot;break}default:{st===SLASH&&rt.charCodeAt(mt+1)===ASTERISK?(ot=rt.indexOf("*/",mt+2)+1,ot===0&&(it||fs?ot=rt.length:Qr("comment")),_r=["comment",rt.slice(mt,ot+1),mt,ot],mt=ot):(RE_WORD_END.lastIndex=mt+1,RE_WORD_END.test(rt),RE_WORD_END.lastIndex===0?ot=rt.length-1:ot=RE_WORD_END.lastIndex-2,_r=["word",rt.slice(mt,ot+1),mt,ot],Kr.push(_r),mt=ot);break}}return mt++,_r}function ns(ss){Xr.push(ss)}return{back:ns,endOfFile:_i,nextToken:rs,position:Zr}};let Container$5=container,AtRule$3=class extends Container$5{constructor(et){super(et),this.type="atrule"}append(...et){return this.proxyOf.nodes||(this.nodes=[]),super.append(...et)}prepend(...et){return this.proxyOf.nodes||(this.nodes=[]),super.prepend(...et)}};var atRule=AtRule$3;AtRule$3.default=AtRule$3,Container$5.registerAtRule(AtRule$3);let Container$4=container,LazyResult$3,Processor$2,Root$5=class extends Container$4{constructor(et){super(et),this.type="root",this.nodes||(this.nodes=[])}normalize(et,nt,rt){let it=super.normalize(et);if(nt){if(rt==="prepend")this.nodes.length>1?nt.raws.before=this.nodes[1].raws.before:delete nt.raws.before;else if(this.first!==nt)for(let st of it)st.raws.before=nt.raws.before}return it}removeChild(et,nt){let rt=this.index(et);return!nt&&rt===0&&this.nodes.length>1&&(this.nodes[1].raws.before=this.nodes[rt].raws.before),super.removeChild(et)}toResult(et={}){return new LazyResult$3(new Processor$2,this,et).stringify()}};Root$5.registerLazyResult=tt=>{LazyResult$3=tt},Root$5.registerProcessor=tt=>{Processor$2=tt};var root=Root$5;Root$5.default=Root$5,Container$4.registerRoot(Root$5);let list$2={comma(tt){return list$2.split(tt,[","],!0)},space(tt){let et=[" ",`
`,"	"];return list$2.split(tt,et)},split(tt,et,nt){let rt=[],it="",st=!1,ot=0,lt=!1,ut="",ct=!1;for(let dt of tt)ct?ct=!1:dt==="\\"?ct=!0:lt?dt===ut&&(lt=!1):dt==='"'||dt==="'"?(lt=!0,ut=dt):dt==="("?ot+=1:dt===")"?ot>0&&(ot-=1):ot===0&&et.includes(dt)&&(st=!0),st?(it!==""&&rt.push(it.trim()),it="",st=!1):it+=dt;return(nt||it!=="")&&rt.push(it.trim()),rt}};var list_1=list$2;list$2.default=list$2;let Container$3=container,list$1=list_1,Rule$3=class extends Container$3{constructor(et){super(et),this.type="rule",this.nodes||(this.nodes=[])}get selectors(){return list$1.comma(this.selector)}set selectors(et){let nt=this.selector?this.selector.match(/,\s*/):null,rt=nt?nt[0]:","+this.raw("between","beforeOpen");this.selector=et.join(rt)}};var rule=Rule$3;Rule$3.default=Rule$3,Container$3.registerRule(Rule$3);let Declaration$2=declaration,tokenizer=tokenize,Comment$2=comment,AtRule$2=atRule,Root$4=root,Rule$2=rule;const SAFE_COMMENT_NEIGHBOR={empty:!0,space:!0};function findLastWithPosition(tt){for(let et=tt.length-1;et>=0;et--){let nt=tt[et],rt=nt[3]||nt[2];if(rt)return rt}}let Parser$1=class{constructor(et){this.input=et,this.root=new Root$4,this.current=this.root,this.spaces="",this.semicolon=!1,this.createTokenizer(),this.root.source={input:et,start:{column:1,line:1,offset:0}}}atrule(et){let nt=new AtRule$2;nt.name=et[1].slice(1),nt.name===""&&this.unnamedAtrule(nt,et),this.init(nt,et[2]);let rt,it,st,ot=!1,lt=!1,ut=[],ct=[];for(;!this.tokenizer.endOfFile();){if(et=this.tokenizer.nextToken(),rt=et[0],rt==="("||rt==="["?ct.push(rt==="("?")":"]"):rt==="{"&&ct.length>0?ct.push("}"):rt===ct[ct.length-1]&&ct.pop(),ct.length===0)if(rt===";"){nt.source.end=this.getPosition(et[2]),nt.source.end.offset++,this.semicolon=!0;break}else if(rt==="{"){lt=!0;break}else if(rt==="}"){if(ut.length>0){for(st=ut.length-1,it=ut[st];it&&it[0]==="space";)it=ut[--st];it&&(nt.source.end=this.getPosition(it[3]||it[2]),nt.source.end.offset++)}this.end(et);break}else ut.push(et);else ut.push(et);if(this.tokenizer.endOfFile()){ot=!0;break}}nt.raws.between=this.spacesAndCommentsFromEnd(ut),ut.length?(nt.raws.afterName=this.spacesAndCommentsFromStart(ut),this.raw(nt,"params",ut),ot&&(et=ut[ut.length-1],nt.source.end=this.getPosition(et[3]||et[2]),nt.source.end.offset++,this.spaces=nt.raws.between,nt.raws.between="")):(nt.raws.afterName="",nt.params=""),lt&&(nt.nodes=[],this.current=nt)}checkMissedSemicolon(et){let nt=this.colon(et);if(nt===!1)return;let rt=0,it;for(let st=nt-1;st>=0&&(it=et[st],!(it[0]!=="space"&&(rt+=1,rt===2)));st--);throw this.input.error("Missed semicolon",it[0]==="word"?it[3]+1:it[2])}colon(et){let nt=0,rt,it,st;for(let[ot,lt]of et.entries()){if(rt=lt,it=rt[0],it==="("&&(nt+=1),it===")"&&(nt-=1),nt===0&&it===":")if(!st)this.doubleColon(rt);else{if(st[0]==="word"&&st[1]==="progid")continue;return ot}st=rt}return!1}comment(et){let nt=new Comment$2;this.init(nt,et[2]),nt.source.end=this.getPosition(et[3]||et[2]),nt.source.end.offset++;let rt=et[1].slice(2,-2);if(/^\s*$/.test(rt))nt.text="",nt.raws.left=rt,nt.raws.right="";else{let it=rt.match(/^(\s*)([^]*\S)(\s*)$/);nt.text=it[2],nt.raws.left=it[1],nt.raws.right=it[3]}}createTokenizer(){this.tokenizer=tokenizer(this.input)}decl(et,nt){let rt=new Declaration$2;this.init(rt,et[0][2]);let it=et[et.length-1];for(it[0]===";"&&(this.semicolon=!0,et.pop()),rt.source.end=this.getPosition(it[3]||it[2]||findLastWithPosition(et)),rt.source.end.offset++;et[0][0]!=="word";)et.length===1&&this.unknownWord(et),rt.raws.before+=et.shift()[1];for(rt.source.start=this.getPosition(et[0][2]),rt.prop="";et.length;){let ct=et[0][0];if(ct===":"||ct==="space"||ct==="comment")break;rt.prop+=et.shift()[1]}rt.raws.between="";let st;for(;et.length;)if(st=et.shift(),st[0]===":"){rt.raws.between+=st[1];break}else st[0]==="word"&&/\w/.test(st[1])&&this.unknownWord([st]),rt.raws.between+=st[1];(rt.prop[0]==="_"||rt.prop[0]==="*")&&(rt.raws.before+=rt.prop[0],rt.prop=rt.prop.slice(1));let ot=[],lt;for(;et.length&&(lt=et[0][0],!(lt!=="space"&&lt!=="comment"));)ot.push(et.shift());this.precheckMissedSemicolon(et);for(let ct=et.length-1;ct>=0;ct--){if(st=et[ct],st[1].toLowerCase()==="!important"){rt.important=!0;let dt=this.stringFrom(et,ct);dt=this.spacesFromEnd(et)+dt,dt!==" !important"&&(rt.raws.important=dt);break}else if(st[1].toLowerCase()==="important"){let dt=et.slice(0),ft="";for(let pt=ct;pt>0;pt--){let gt=dt[pt][0];if(ft.trim().indexOf("!")===0&&gt!=="space")break;ft=dt.pop()[1]+ft}ft.trim().indexOf("!")===0&&(rt.important=!0,rt.raws.important=ft,et=dt)}if(st[0]!=="space"&&st[0]!=="comment")break}et.some(ct=>ct[0]!=="space"&&ct[0]!=="comment")&&(rt.raws.between+=ot.map(ct=>ct[1]).join(""),ot=[]),this.raw(rt,"value",ot.concat(et),nt),rt.value.includes(":")&&!nt&&this.checkMissedSemicolon(et)}doubleColon(et){throw this.input.error("Double colon",{offset:et[2]},{offset:et[2]+et[1].length})}emptyRule(et){let nt=new Rule$2;this.init(nt,et[2]),nt.selector="",nt.raws.between="",this.current=nt}end(et){this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.semicolon=!1,this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.spaces="",this.current.parent?(this.current.source.end=this.getPosition(et[2]),this.current.source.end.offset++,this.current=this.current.parent):this.unexpectedClose(et)}endFile(){this.current.parent&&this.unclosedBlock(),this.current.nodes&&this.current.nodes.length&&(this.current.raws.semicolon=this.semicolon),this.current.raws.after=(this.current.raws.after||"")+this.spaces,this.root.source.end=this.getPosition(this.tokenizer.position())}freeSemicolon(et){if(this.spaces+=et[1],this.current.nodes){let nt=this.current.nodes[this.current.nodes.length-1];nt&&nt.type==="rule"&&!nt.raws.ownSemicolon&&(nt.raws.ownSemicolon=this.spaces,this.spaces="")}}getPosition(et){let nt=this.input.fromOffset(et);return{column:nt.col,line:nt.line,offset:et}}init(et,nt){this.current.push(et),et.source={input:this.input,start:this.getPosition(nt)},et.raws.before=this.spaces,this.spaces="",et.type!=="comment"&&(this.semicolon=!1)}other(et){let nt=!1,rt=null,it=!1,st=null,ot=[],lt=et[1].startsWith("--"),ut=[],ct=et;for(;ct;){if(rt=ct[0],ut.push(ct),rt==="("||rt==="[")st||(st=ct),ot.push(rt==="("?")":"]");else if(lt&&it&&rt==="{")st||(st=ct),ot.push("}");else if(ot.length===0)if(rt===";")if(it){this.decl(ut,lt);return}else break;else if(rt==="{"){this.rule(ut);return}else if(rt==="}"){this.tokenizer.back(ut.pop()),nt=!0;break}else rt===":"&&(it=!0);else rt===ot[ot.length-1]&&(ot.pop(),ot.length===0&&(st=null));ct=this.tokenizer.nextToken()}if(this.tokenizer.endOfFile()&&(nt=!0),ot.length>0&&this.unclosedBracket(st),nt&&it){if(!lt)for(;ut.length&&(ct=ut[ut.length-1][0],!(ct!=="space"&&ct!=="comment"));)this.tokenizer.back(ut.pop());this.decl(ut,lt)}else this.unknownWord(ut)}parse(){let et;for(;!this.tokenizer.endOfFile();)switch(et=this.tokenizer.nextToken(),et[0]){case"space":this.spaces+=et[1];break;case";":this.freeSemicolon(et);break;case"}":this.end(et);break;case"comment":this.comment(et);break;case"at-word":this.atrule(et);break;case"{":this.emptyRule(et);break;default:this.other(et);break}this.endFile()}precheckMissedSemicolon(){}raw(et,nt,rt,it){let st,ot,lt=rt.length,ut="",ct=!0,dt,ft;for(let pt=0;pt<lt;pt+=1)st=rt[pt],ot=st[0],ot==="space"&&pt===lt-1&&!it?ct=!1:ot==="comment"?(ft=rt[pt-1]?rt[pt-1][0]:"empty",dt=rt[pt+1]?rt[pt+1][0]:"empty",!SAFE_COMMENT_NEIGHBOR[ft]&&!SAFE_COMMENT_NEIGHBOR[dt]?ut.slice(-1)===","?ct=!1:ut+=st[1]:ct=!1):ut+=st[1];if(!ct){let pt=rt.reduce((gt,_r)=>gt+_r[1],"");et.raws[nt]={raw:pt,value:ut}}et[nt]=ut}rule(et){et.pop();let nt=new Rule$2;this.init(nt,et[0][2]),nt.raws.between=this.spacesAndCommentsFromEnd(et),this.raw(nt,"selector",et),this.current=nt}spacesAndCommentsFromEnd(et){let nt,rt="";for(;et.length&&(nt=et[et.length-1][0],!(nt!=="space"&&nt!=="comment"));)rt=et.pop()[1]+rt;return rt}spacesAndCommentsFromStart(et){let nt,rt="";for(;et.length&&(nt=et[0][0],!(nt!=="space"&&nt!=="comment"));)rt+=et.shift()[1];return rt}spacesFromEnd(et){let nt,rt="";for(;et.length&&(nt=et[et.length-1][0],nt==="space");)rt=et.pop()[1]+rt;return rt}stringFrom(et,nt){let rt="";for(let it=nt;it<et.length;it++)rt+=et[it][1];return et.splice(nt,et.length-nt),rt}unclosedBlock(){let et=this.current.source.start;throw this.input.error("Unclosed block",et.line,et.column)}unclosedBracket(et){throw this.input.error("Unclosed bracket",{offset:et[2]},{offset:et[2]+1})}unexpectedClose(et){throw this.input.error("Unexpected }",{offset:et[2]},{offset:et[2]+1})}unknownWord(et){throw this.input.error("Unknown word",{offset:et[0][2]},{offset:et[0][2]+et[0][1].length})}unnamedAtrule(et,nt){throw this.input.error("At-rule without name",{offset:nt[2]},{offset:nt[2]+nt[1].length})}};var parser$1=Parser$1;let Container$2=container,Parser=parser$1,Input$2=input;function parse$7(tt,et){let nt=new Input$2(tt,et),rt=new Parser(nt);try{rt.parse()}catch(it){throw it}return rt.root}var parse_1=parse$7;parse$7.default=parse$7,Container$2.registerParse(parse$7);let{isClean,my}=symbols,MapGenerator$1=mapGenerator,stringify$2=stringify_1,Container$1=container,Document$2=document$1,Result$2=result,parse$6=parse_1,Root$3=root;const TYPE_TO_CLASS_NAME={atrule:"AtRule",comment:"Comment",decl:"Declaration",document:"Document",root:"Root",rule:"Rule"},PLUGIN_PROPS={AtRule:!0,AtRuleExit:!0,Comment:!0,CommentExit:!0,Declaration:!0,DeclarationExit:!0,Document:!0,DocumentExit:!0,Once:!0,OnceExit:!0,postcssPlugin:!0,prepare:!0,Root:!0,RootExit:!0,Rule:!0,RuleExit:!0},NOT_VISITORS={Once:!0,postcssPlugin:!0,prepare:!0},CHILDREN=0;function isPromise$1(tt){return typeof tt=="object"&&typeof tt.then=="function"}function getEvents(tt){let et=!1,nt=TYPE_TO_CLASS_NAME[tt.type];return tt.type==="decl"?et=tt.prop.toLowerCase():tt.type==="atrule"&&(et=tt.name.toLowerCase()),et&&tt.append?[nt,nt+"-"+et,CHILDREN,nt+"Exit",nt+"Exit-"+et]:et?[nt,nt+"-"+et,nt+"Exit",nt+"Exit-"+et]:tt.append?[nt,CHILDREN,nt+"Exit"]:[nt,nt+"Exit"]}function toStack(tt){let et;return tt.type==="document"?et=["Document",CHILDREN,"DocumentExit"]:tt.type==="root"?et=["Root",CHILDREN,"RootExit"]:et=getEvents(tt),{eventIndex:0,events:et,iterator:0,node:tt,visitorIndex:0,visitors:[]}}function cleanMarks(tt){return tt[isClean]=!1,tt.nodes&&tt.nodes.forEach(et=>cleanMarks(et)),tt}let postcss$1={},LazyResult$2=class go{constructor(et,nt,rt){this.stringified=!1,this.processed=!1;let it;if(typeof nt=="object"&&nt!==null&&(nt.type==="root"||nt.type==="document"))it=cleanMarks(nt);else if(nt instanceof go||nt instanceof Result$2)it=cleanMarks(nt.root),nt.map&&(typeof rt.map>"u"&&(rt.map={}),rt.map.inline||(rt.map.inline=!1),rt.map.prev=nt.map);else{let st=parse$6;rt.syntax&&(st=rt.syntax.parse),rt.parser&&(st=rt.parser),st.parse&&(st=st.parse);try{it=st(nt,rt)}catch(ot){this.processed=!0,this.error=ot}it&&!it[my]&&Container$1.rebuild(it)}this.result=new Result$2(et,it,rt),this.helpers={...postcss$1,postcss:postcss$1,result:this.result},this.plugins=this.processor.plugins.map(st=>typeof st=="object"&&st.prepare?{...st,...st.prepare(this.result)}:st)}async(){return this.error?Promise.reject(this.error):this.processed?Promise.resolve(this.result):(this.processing||(this.processing=this.runAsync()),this.processing)}catch(et){return this.async().catch(et)}finally(et){return this.async().then(et,et)}getAsyncError(){throw new Error("Use process(css).then(cb) to work with async plugins")}handleError(et,nt){let rt=this.result.lastPlugin;try{nt&&nt.addToError(et),this.error=et,et.name==="CssSyntaxError"&&!et.plugin?(et.plugin=rt.postcssPlugin,et.setMessage()):rt.postcssVersion}catch(it){console&&console.error&&console.error(it)}return et}prepareVisitors(){this.listeners={};let et=(nt,rt,it)=>{this.listeners[rt]||(this.listeners[rt]=[]),this.listeners[rt].push([nt,it])};for(let nt of this.plugins)if(typeof nt=="object")for(let rt in nt){if(!PLUGIN_PROPS[rt]&&/^[A-Z]/.test(rt))throw new Error(`Unknown event ${rt} in ${nt.postcssPlugin}. Try to update PostCSS (${this.processor.version} now).`);if(!NOT_VISITORS[rt])if(typeof nt[rt]=="object")for(let it in nt[rt])it==="*"?et(nt,rt,nt[rt][it]):et(nt,rt+"-"+it.toLowerCase(),nt[rt][it]);else typeof nt[rt]=="function"&&et(nt,rt,nt[rt])}this.hasListener=Object.keys(this.listeners).length>0}async runAsync(){this.plugin=0;for(let et=0;et<this.plugins.length;et++){let nt=this.plugins[et],rt=this.runOnRoot(nt);if(isPromise$1(rt))try{await rt}catch(it){throw this.handleError(it)}}if(this.prepareVisitors(),this.hasListener){let et=this.result.root;for(;!et[isClean];){et[isClean]=!0;let nt=[toStack(et)];for(;nt.length>0;){let rt=this.visitTick(nt);if(isPromise$1(rt))try{await rt}catch(it){let st=nt[nt.length-1].node;throw this.handleError(it,st)}}}if(this.listeners.OnceExit)for(let[nt,rt]of this.listeners.OnceExit){this.result.lastPlugin=nt;try{if(et.type==="document"){let it=et.nodes.map(st=>rt(st,this.helpers));await Promise.all(it)}else await rt(et,this.helpers)}catch(it){throw this.handleError(it)}}}return this.processed=!0,this.stringify()}runOnRoot(et){this.result.lastPlugin=et;try{if(typeof et=="object"&&et.Once){if(this.result.root.type==="document"){let nt=this.result.root.nodes.map(rt=>et.Once(rt,this.helpers));return isPromise$1(nt[0])?Promise.all(nt):nt}return et.Once(this.result.root,this.helpers)}else if(typeof et=="function")return et(this.result.root,this.result)}catch(nt){throw this.handleError(nt)}}stringify(){if(this.error)throw this.error;if(this.stringified)return this.result;this.stringified=!0,this.sync();let et=this.result.opts,nt=stringify$2;et.syntax&&(nt=et.syntax.stringify),et.stringifier&&(nt=et.stringifier),nt.stringify&&(nt=nt.stringify);let it=new MapGenerator$1(nt,this.result.root,this.result.opts).generate();return this.result.css=it[0],this.result.map=it[1],this.result}sync(){if(this.error)throw this.error;if(this.processed)return this.result;if(this.processed=!0,this.processing)throw this.getAsyncError();for(let et of this.plugins){let nt=this.runOnRoot(et);if(isPromise$1(nt))throw this.getAsyncError()}if(this.prepareVisitors(),this.hasListener){let et=this.result.root;for(;!et[isClean];)et[isClean]=!0,this.walkSync(et);if(this.listeners.OnceExit)if(et.type==="document")for(let nt of et.nodes)this.visitSync(this.listeners.OnceExit,nt);else this.visitSync(this.listeners.OnceExit,et)}return this.result}then(et,nt){return this.async().then(et,nt)}toString(){return this.css}visitSync(et,nt){for(let[rt,it]of et){this.result.lastPlugin=rt;let st;try{st=it(nt,this.helpers)}catch(ot){throw this.handleError(ot,nt.proxyOf)}if(nt.type!=="root"&&nt.type!=="document"&&!nt.parent)return!0;if(isPromise$1(st))throw this.getAsyncError()}}visitTick(et){let nt=et[et.length-1],{node:rt,visitors:it}=nt;if(rt.type!=="root"&&rt.type!=="document"&&!rt.parent){et.pop();return}if(it.length>0&&nt.visitorIndex<it.length){let[ot,lt]=it[nt.visitorIndex];nt.visitorIndex+=1,nt.visitorIndex===it.length&&(nt.visitors=[],nt.visitorIndex=0),this.result.lastPlugin=ot;try{return lt(rt.toProxy(),this.helpers)}catch(ut){throw this.handleError(ut,rt)}}if(nt.iterator!==0){let ot=nt.iterator,lt;for(;lt=rt.nodes[rt.indexes[ot]];)if(rt.indexes[ot]+=1,!lt[isClean]){lt[isClean]=!0,et.push(toStack(lt));return}nt.iterator=0,delete rt.indexes[ot]}let st=nt.events;for(;nt.eventIndex<st.length;){let ot=st[nt.eventIndex];if(nt.eventIndex+=1,ot===CHILDREN){rt.nodes&&rt.nodes.length&&(rt[isClean]=!0,nt.iterator=rt.getIterator());return}else if(this.listeners[ot]){nt.visitors=this.listeners[ot];return}}et.pop()}walkSync(et){et[isClean]=!0;let nt=getEvents(et);for(let rt of nt)if(rt===CHILDREN)et.nodes&&et.each(it=>{it[isClean]||this.walkSync(it)});else{let it=this.listeners[rt];if(it&&this.visitSync(it,et.toProxy()))return}}warnings(){return this.sync().warnings()}get content(){return this.stringify().content}get css(){return this.stringify().css}get map(){return this.stringify().map}get messages(){return this.sync().messages}get opts(){return this.result.opts}get processor(){return this.result.processor}get root(){return this.sync().root}get[Symbol.toStringTag](){return"LazyResult"}};LazyResult$2.registerPostcss=tt=>{postcss$1=tt};var lazyResult=LazyResult$2;LazyResult$2.default=LazyResult$2,Root$3.registerLazyResult(LazyResult$2),Document$2.registerLazyResult(LazyResult$2);let MapGenerator=mapGenerator,stringify$1=stringify_1,parse$5=parse_1;const Result$1=result;let NoWorkResult$1=class{constructor(et,nt,rt){nt=nt.toString(),this.stringified=!1,this._processor=et,this._css=nt,this._opts=rt,this._map=void 0;let it,st=stringify$1;this.result=new Result$1(this._processor,it,this._opts),this.result.css=nt;let ot=this;Object.defineProperty(this.result,"root",{get(){return ot.root}});let lt=new MapGenerator(st,it,this._opts,nt);if(lt.isMap()){let[ut,ct]=lt.generate();ut&&(this.result.css=ut),ct&&(this.result.map=ct)}else lt.clearAnnotation(),this.result.css=lt.css}async(){return this.error?Promise.reject(this.error):Promise.resolve(this.result)}catch(et){return this.async().catch(et)}finally(et){return this.async().then(et,et)}sync(){if(this.error)throw this.error;return this.result}then(et,nt){return this.async().then(et,nt)}toString(){return this._css}warnings(){return[]}get content(){return this.result.css}get css(){return this.result.css}get map(){return this.result.map}get messages(){return[]}get opts(){return this.result.opts}get processor(){return this.result.processor}get root(){if(this._root)return this._root;let et,nt=parse$5;try{et=nt(this._css,this._opts)}catch(rt){this.error=rt}if(this.error)throw this.error;return this._root=et,et}get[Symbol.toStringTag](){return"NoWorkResult"}};var noWorkResult=NoWorkResult$1;NoWorkResult$1.default=NoWorkResult$1;let NoWorkResult=noWorkResult,LazyResult$1=lazyResult,Document$1=document$1,Root$2=root,Processor$1=class{constructor(et=[]){this.version="8.4.35",this.plugins=this.normalize(et)}normalize(et){let nt=[];for(let rt of et)if(rt.postcss===!0?rt=rt():rt.postcss&&(rt=rt.postcss),typeof rt=="object"&&Array.isArray(rt.plugins))nt=nt.concat(rt.plugins);else if(typeof rt=="object"&&rt.postcssPlugin)nt.push(rt);else if(typeof rt=="function")nt.push(rt);else if(!(typeof rt=="object"&&(rt.parse||rt.stringify)))throw new Error(rt+" is not a PostCSS plugin");return nt}process(et,nt={}){return!this.plugins.length&&!nt.parser&&!nt.stringifier&&!nt.syntax?new NoWorkResult(this,et,nt):new LazyResult$1(this,et,nt)}use(et){return this.plugins=this.plugins.concat(this.normalize([et])),this}};var processor=Processor$1;Processor$1.default=Processor$1,Root$2.registerProcessor(Processor$1),Document$1.registerProcessor(Processor$1);let Declaration$1=declaration,PreviousMap=previousMap,Comment$1=comment,AtRule$1=atRule,Input$1=input,Root$1=root,Rule$1=rule;function fromJSON$1(tt,et){if(Array.isArray(tt))return tt.map(it=>fromJSON$1(it));let{inputs:nt,...rt}=tt;if(nt){et=[];for(let it of nt){let st={...it,__proto__:Input$1.prototype};st.map&&(st.map={...st.map,__proto__:PreviousMap.prototype}),et.push(st)}}if(rt.nodes&&(rt.nodes=tt.nodes.map(it=>fromJSON$1(it,et))),rt.source){let{inputId:it,...st}=rt.source;rt.source=st,it!=null&&(rt.source.input=et[it])}if(rt.type==="root")return new Root$1(rt);if(rt.type==="decl")return new Declaration$1(rt);if(rt.type==="rule")return new Rule$1(rt);if(rt.type==="comment")return new Comment$1(rt);if(rt.type==="atrule")return new AtRule$1(rt);throw new Error("Unknown node type: "+tt.type)}var fromJSON_1=fromJSON$1;fromJSON$1.default=fromJSON$1;let CssSyntaxError=cssSyntaxError,Declaration=declaration,LazyResult=lazyResult,Container=container,Processor=processor,stringify=stringify_1,fromJSON=fromJSON_1,Document=document$1,Warning=warning,Comment=comment,AtRule=atRule,Result=result,Input=input,parse$4=parse_1,list=list_1,Rule=rule,Root=root,Node$1=node;function postcss(...tt){return tt.length===1&&Array.isArray(tt[0])&&(tt=tt[0]),new Processor(tt)}postcss.plugin=function(et,nt){let rt=!1;function it(...ot){console&&console.warn&&!rt&&(rt=!0,console.warn(et+`: postcss.plugin was deprecated. Migration guide:
https://evilmartians.com/chronicles/postcss-8-plugin-migration`),process.env.LANG&&process.env.LANG.startsWith("cn")&&console.warn(et+`:  postcss.plugin . :
https://www.w3ctech.com/topic/2226`));let lt=nt(...ot);return lt.postcssPlugin=et,lt.postcssVersion=new Processor().version,lt}let st;return Object.defineProperty(it,"postcss",{get(){return st||(st=it()),st}}),it.process=function(ot,lt,ut){return postcss([it(ut)]).process(ot,lt)},it},postcss.stringify=stringify,postcss.parse=parse$4,postcss.fromJSON=fromJSON,postcss.list=list,postcss.comment=tt=>new Comment(tt),postcss.atRule=tt=>new AtRule(tt),postcss.decl=tt=>new Declaration(tt),postcss.rule=tt=>new Rule(tt),postcss.root=tt=>new Root(tt),postcss.document=tt=>new Document(tt),postcss.CssSyntaxError=CssSyntaxError,postcss.Declaration=Declaration,postcss.Container=Container,postcss.Processor=Processor,postcss.Document=Document,postcss.Comment=Comment,postcss.Warning=Warning,postcss.AtRule=AtRule,postcss.Result=Result,postcss.Input=Input,postcss.Rule=Rule,postcss.Root=Root,postcss.Node=Node$1,LazyResult.registerPostcss(postcss);var postcss_1=postcss;postcss.default=postcss;const htmlparser=lib$5,escapeStringRegexp=escapeStringRegexp$1,{isPlainObject}=isPlainObject$2,deepmerge=cjs,parseSrcset=parseSrcsetExports,{parse:postcssParse}=postcss_1,mediaTags=["img","audio","video","picture","svg","object","map","iframe","embed"],vulnerableTags=["script","style"];function each(tt,et){tt&&Object.keys(tt).forEach(function(nt){et(tt[nt],nt)})}function has(tt,et){return{}.hasOwnProperty.call(tt,et)}function filter(tt,et){const nt=[];return each(tt,function(rt){et(rt)&&nt.push(rt)}),nt}function isEmptyObject(tt){for(const et in tt)if(has(tt,et))return!1;return!0}function stringifySrcset(tt){return tt.map(function(et){if(!et.url)throw new Error("URL missing");return et.url+(et.w?` ${et.w}w`:"")+(et.h?` ${et.h}h`:"")+(et.d?` ${et.d}x`:"")}).join(", ")}var sanitizeHtml_1=sanitizeHtml;const VALID_HTML_ATTRIBUTE_NAME=/^[^\0\t\n\f\r /<=>]+$/;function sanitizeHtml(tt,et,nt){if(tt==null)return"";typeof tt=="number"&&(tt=tt.toString());let rt="",it="";function st(ls,gs){const us=this;this.tag=ls,this.attribs=gs||{},this.tagPosition=rt.length,this.text="",this.mediaChildren=[],this.updateParentNodeText=function(){if(mt.length){const ms=mt[mt.length-1];ms.text+=us.text}},this.updateParentNodeMediaChildren=function(){mt.length&&mediaTags.includes(this.tag)&&mt[mt.length-1].mediaChildren.push(this.tag)}}et=Object.assign({},sanitizeHtml.defaults,et),et.parser=Object.assign({},htmlParserDefaults,et.parser);const ot=function(ls){return et.allowedTags===!1||(et.allowedTags||[]).indexOf(ls)>-1};vulnerableTags.forEach(function(ls){ot(ls)&&!et.allowVulnerableTags&&console.warn(`

 Your \`allowedTags\` option includes, \`${ls}\`, which is inherently
vulnerable to XSS attacks. Please remove it from \`allowedTags\`.
Or, to disable this warning, add the \`allowVulnerableTags\` option
and ensure you are accounting for this risk.

`)});const lt=et.nonTextTags||["script","style","textarea","option"];let ut,ct;et.allowedAttributes&&(ut={},ct={},each(et.allowedAttributes,function(ls,gs){ut[gs]=[];const us=[];ls.forEach(function(ms){typeof ms=="string"&&ms.indexOf("*")>=0?us.push(escapeStringRegexp(ms).replace(/\\\*/g,".*")):ut[gs].push(ms)}),us.length&&(ct[gs]=new RegExp("^("+us.join("|")+")$"))}));const dt={},ft={},pt={};each(et.allowedClasses,function(ls,gs){if(ut&&(has(ut,gs)||(ut[gs]=[]),ut[gs].push("class")),dt[gs]=ls,Array.isArray(ls)){const us=[];dt[gs]=[],pt[gs]=[],ls.forEach(function(ms){typeof ms=="string"&&ms.indexOf("*")>=0?us.push(escapeStringRegexp(ms).replace(/\\\*/g,".*")):ms instanceof RegExp?pt[gs].push(ms):dt[gs].push(ms)}),us.length&&(ft[gs]=new RegExp("^("+us.join("|")+")$"))}});const gt={};let _r;each(et.transformTags,function(ls,gs){let us;typeof ls=="function"?us=ls:typeof ls=="string"&&(us=sanitizeHtml.simpleTransform(ls)),gs==="*"?_r=us:gt[gs]=us});let Yr,mt,Kr,Xr,Zr,Qr,_i=!1;ns();const rs=new htmlparser.Parser({onopentag:function(ls,gs){if(et.enforceHtmlBoundary&&ls==="html"&&ns(),Zr){Qr++;return}const us=new st(ls,gs);mt.push(us);let ms=!1;const ys=!!us.text;let Es;if(has(gt,ls)&&(Es=gt[ls](ls,gs),us.attribs=gs=Es.attribs,Es.text!==void 0&&(us.innerText=Es.text),ls!==Es.tagName&&(us.name=ls=Es.tagName,Xr[Yr]=Es.tagName)),_r&&(Es=_r(ls,gs),us.attribs=gs=Es.attribs,ls!==Es.tagName&&(us.name=ls=Es.tagName,Xr[Yr]=Es.tagName)),(!ot(ls)||et.disallowedTagsMode==="recursiveEscape"&&!isEmptyObject(Kr)||et.nestingLimit!=null&&Yr>=et.nestingLimit)&&(ms=!0,Kr[Yr]=!0,et.disallowedTagsMode==="discard"&&lt.indexOf(ls)!==-1&&(Zr=!0,Qr=1),Kr[Yr]=!0),Yr++,ms){if(et.disallowedTagsMode==="discard")return;it=rt,rt=""}rt+="<"+ls,ls==="script"&&(et.allowedScriptHostnames||et.allowedScriptDomains)&&(us.innerText=""),(!ut||has(ut,ls)||ut["*"])&&each(gs,function(Ts,Ss){if(!VALID_HTML_ATTRIBUTE_NAME.test(Ss)){delete us.attribs[Ss];return}if(Ts===""&&!et.allowedEmptyAttributes.includes(Ss)&&(et.nonBooleanAttributes.includes(Ss)||et.nonBooleanAttributes.includes("*"))){delete us.attribs[Ss];return}let Ds=!1;if(!ut||has(ut,ls)&&ut[ls].indexOf(Ss)!==-1||ut["*"]&&ut["*"].indexOf(Ss)!==-1||has(ct,ls)&&ct[ls].test(Ss)||ct["*"]&&ct["*"].test(Ss))Ds=!0;else if(ut&&ut[ls]){for(const Cs of ut[ls])if(isPlainObject(Cs)&&Cs.name&&Cs.name===Ss){Ds=!0;let Is="";if(Cs.multiple===!0){const ks=Ts.split(" ");for(const _s of ks)Cs.values.indexOf(_s)!==-1&&(Is===""?Is=_s:Is+=" "+_s)}else Cs.values.indexOf(Ts)>=0&&(Is=Ts);Ts=Is}}if(Ds){if(et.allowedSchemesAppliedToAttributes.indexOf(Ss)!==-1&&fs(ls,Ts)){delete us.attribs[Ss];return}if(ls==="script"&&Ss==="src"){let Cs=!0;try{const Is=os(Ts);if(et.allowedScriptHostnames||et.allowedScriptDomains){const ks=(et.allowedScriptHostnames||[]).find(function(Os){return Os===Is.url.hostname}),_s=(et.allowedScriptDomains||[]).find(function(Os){return Is.url.hostname===Os||Is.url.hostname.endsWith(`.${Os}`)});Cs=ks||_s}}catch{Cs=!1}if(!Cs){delete us.attribs[Ss];return}}if(ls==="iframe"&&Ss==="src"){let Cs=!0;try{const Is=os(Ts);if(Is.isRelativeUrl)Cs=has(et,"allowIframeRelativeUrls")?et.allowIframeRelativeUrls:!et.allowedIframeHostnames&&!et.allowedIframeDomains;else if(et.allowedIframeHostnames||et.allowedIframeDomains){const ks=(et.allowedIframeHostnames||[]).find(function(Os){return Os===Is.url.hostname}),_s=(et.allowedIframeDomains||[]).find(function(Os){return Is.url.hostname===Os||Is.url.hostname.endsWith(`.${Os}`)});Cs=ks||_s}}catch{Cs=!1}if(!Cs){delete us.attribs[Ss];return}}if(Ss==="srcset")try{let Cs=parseSrcset(Ts);if(Cs.forEach(function(Is){fs("srcset",Is.url)&&(Is.evil=!0)}),Cs=filter(Cs,function(Is){return!Is.evil}),Cs.length)Ts=stringifySrcset(filter(Cs,function(Is){return!Is.evil})),us.attribs[Ss]=Ts;else{delete us.attribs[Ss];return}}catch{delete us.attribs[Ss];return}if(Ss==="class"){const Cs=dt[ls],Is=dt["*"],ks=ft[ls],_s=pt[ls],Os=ft["*"],Ys=[ks,Os].concat(_s).filter(function(Vs){return Vs});if(Cs&&Is?Ts=vs(Ts,deepmerge(Cs,Is),Ys):Ts=vs(Ts,Cs||Is,Ys),!Ts.length){delete us.attribs[Ss];return}}if(Ss==="style"){if(et.parseStyleAttributes)try{const Cs=postcssParse(ls+" {"+Ts+"}",{map:!1}),Is=is(Cs,et.allowedStyles);if(Ts=cs(Is),Ts.length===0){delete us.attribs[Ss];return}}catch{typeof window<"u"&&console.warn('Failed to parse "'+ls+" {"+Ts+`}", If you're running this in a browser, we recommend to disable style parsing: options.parseStyleAttributes: false, since this only works in a node environment due to a postcss dependency, More info: https://github.com/apostrophecms/sanitize-html/issues/547`),delete us.attribs[Ss];return}else if(et.allowedStyles)throw new Error("allowedStyles option cannot be used together with parseStyleAttributes: false.")}rt+=" "+Ss,Ts&&Ts.length?rt+='="'+ss(Ts,!0)+'"':et.allowedEmptyAttributes.includes(Ss)&&(rt+='=""')}else delete us.attribs[Ss]}),et.selfClosing.indexOf(ls)!==-1?rt+=" />":(rt+=">",us.innerText&&!ys&&!et.textFilter&&(rt+=ss(us.innerText),_i=!0)),ms&&(rt=it+ss(rt),it="")},ontext:function(ls){if(Zr)return;const gs=mt[mt.length-1];let us;if(gs&&(us=gs.tag,ls=gs.innerText!==void 0?gs.innerText:ls),et.disallowedTagsMode==="discard"&&(us==="script"||us==="style"))rt+=ls;else{const ms=ss(ls,!1);et.textFilter&&!_i?rt+=et.textFilter(ms,us):_i||(rt+=ms)}if(mt.length){const ms=mt[mt.length-1];ms.text+=ls}},onclosetag:function(ls,gs){if(Zr)if(Qr--,!Qr)Zr=!1;else return;const us=mt.pop();if(!us)return;if(us.tag!==ls){mt.push(us);return}Zr=et.enforceHtmlBoundary?ls==="html":!1,Yr--;const ms=Kr[Yr];if(ms){if(delete Kr[Yr],et.disallowedTagsMode==="discard"){us.updateParentNodeText();return}it=rt,rt=""}if(Xr[Yr]&&(ls=Xr[Yr],delete Xr[Yr]),et.exclusiveFilter&&et.exclusiveFilter(us)){rt=rt.substr(0,us.tagPosition);return}if(us.updateParentNodeMediaChildren(),us.updateParentNodeText(),et.selfClosing.indexOf(ls)!==-1||gs&&!ot(ls)&&["escape","recursiveEscape"].indexOf(et.disallowedTagsMode)>=0){ms&&(rt=it,it="");return}rt+="</"+ls+">",ms&&(rt=it+ss(rt),it=""),_i=!1}},et.parser);return rs.write(tt),rs.end(),rt;function ns(){rt="",Yr=0,mt=[],Kr={},Xr={},Zr=!1,Qr=0}function ss(ls,gs){return typeof ls!="string"&&(ls=ls+""),et.parser.decodeEntities&&(ls=ls.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),gs&&(ls=ls.replace(/"/g,"&quot;"))),ls=ls.replace(/&(?![a-zA-Z0-9#]{1,20};)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),gs&&(ls=ls.replace(/"/g,"&quot;")),ls}function fs(ls,gs){for(gs=gs.replace(/[\x00-\x20]+/g,"");;){const ys=gs.indexOf("<!--");if(ys===-1)break;const Es=gs.indexOf("-->",ys+4);if(Es===-1)break;gs=gs.substring(0,ys)+gs.substring(Es+3)}const us=gs.match(/^([a-zA-Z][a-zA-Z0-9.\-+]*):/);if(!us)return gs.match(/^[/\\]{2}/)?!et.allowProtocolRelative:!1;const ms=us[1].toLowerCase();return has(et.allowedSchemesByTag,ls)?et.allowedSchemesByTag[ls].indexOf(ms)===-1:!et.allowedSchemes||et.allowedSchemes.indexOf(ms)===-1}function os(ls){if(ls=ls.replace(/^(\w+:)?\s*[\\/]\s*[\\/]/,"$1//"),ls.startsWith("relative:"))throw new Error("relative: exploit attempt");let gs="relative://relative-site";for(let ys=0;ys<100;ys++)gs+=`/${ys}`;const us=new URL(ls,gs);return{isRelativeUrl:us&&us.hostname==="relative-site"&&us.protocol==="relative:",url:us}}function is(ls,gs){if(!gs)return ls;const us=ls.nodes[0];let ms;return gs[us.selector]&&gs["*"]?ms=deepmerge(gs[us.selector],gs["*"]):ms=gs[us.selector]||gs["*"],ms&&(ls.nodes[0].nodes=us.nodes.reduce(ps(ms),[])),ls}function cs(ls){return ls.nodes[0].nodes.reduce(function(gs,us){return gs.push(`${us.prop}:${us.value}${us.important?" !important":""}`),gs},[]).join(";")}function ps(ls){return function(gs,us){return has(ls,us.prop)&&ls[us.prop].some(function(ys){return ys.test(us.value)})&&gs.push(us),gs}}function vs(ls,gs,us){return gs?(ls=ls.split(/\s+/),ls.filter(function(ms){return gs.indexOf(ms)!==-1||us.some(function(ys){return ys.test(ms)})}).join(" ")):ls}}const htmlParserDefaults={decodeEntities:!0};sanitizeHtml.defaults={allowedTags:["address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","hgroup","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","main","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rb","rp","rt","rtc","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","caption","col","colgroup","table","tbody","td","tfoot","th","thead","tr"],nonBooleanAttributes:["abbr","accept","accept-charset","accesskey","action","allow","alt","as","autocapitalize","autocomplete","blocking","charset","cite","class","color","cols","colspan","content","contenteditable","coords","crossorigin","data","datetime","decoding","dir","dirname","download","draggable","enctype","enterkeyhint","fetchpriority","for","form","formaction","formenctype","formmethod","formtarget","headers","height","hidden","high","href","hreflang","http-equiv","id","imagesizes","imagesrcset","inputmode","integrity","is","itemid","itemprop","itemref","itemtype","kind","label","lang","list","loading","low","max","maxlength","media","method","min","minlength","name","nonce","optimum","pattern","ping","placeholder","popover","popovertarget","popovertargetaction","poster","preload","referrerpolicy","rel","rows","rowspan","sandbox","scope","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","tabindex","target","title","translate","type","usemap","value","width","wrap","onauxclick","onafterprint","onbeforematch","onbeforeprint","onbeforeunload","onbeforetoggle","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncontextlost","oncontextmenu","oncontextrestored","oncopy","oncuechange","oncut","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onformdata","onhashchange","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onlanguagechange","onload","onloadeddata","onloadedmetadata","onloadstart","onmessage","onmessageerror","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onoffline","ononline","onpagehide","onpageshow","onpaste","onpause","onplay","onplaying","onpopstate","onprogress","onratechange","onreset","onresize","onrejectionhandled","onscroll","onscrollend","onsecuritypolicyviolation","onseeked","onseeking","onselect","onslotchange","onstalled","onstorage","onsubmit","onsuspend","ontimeupdate","ontoggle","onunhandledrejection","onunload","onvolumechange","onwaiting","onwheel"],disallowedTagsMode:"discard",allowedAttributes:{a:["href","name","target"],img:["src","srcset","alt","title","width","height","loading"]},allowedEmptyAttributes:["alt"],selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemes:["http","https","ftp","mailto","tel"],allowedSchemesByTag:{},allowedSchemesAppliedToAttributes:["href","src","cite"],allowProtocolRelative:!0,enforceHtmlBoundary:!1,parseStyleAttributes:!0},sanitizeHtml.simpleTransform=function(tt,et,nt){return nt=nt===void 0?!0:nt,et=et||{},function(rt,it){let st;if(nt)for(st in et)it[st]=et[st];else it=et;return{tagName:tt,attribs:it}}};const at=getDefaultExportFromCjs$1(sanitizeHtml_1);function getDefaultExportFromCjs(tt){return tt&&tt.__esModule&&Object.prototype.hasOwnProperty.call(tt,"default")?tt.default:tt}var urlToolkit={exports:{}};(function(tt,et){(function(nt){var rt=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,it=/^(?=([^\/?#]*))\1([^]*)$/,st=/(?:\/|^)\.(?=\/)/g,ot=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,lt={buildAbsoluteURL:function(ut,ct,dt){if(dt=dt||{},ut=ut.trim(),ct=ct.trim(),!ct){if(!dt.alwaysNormalize)return ut;var ft=lt.parseURL(ut);if(!ft)throw new Error("Error trying to parse base URL.");return ft.path=lt.normalizePath(ft.path),lt.buildURLFromParts(ft)}var pt=lt.parseURL(ct);if(!pt)throw new Error("Error trying to parse relative URL.");if(pt.scheme)return dt.alwaysNormalize?(pt.path=lt.normalizePath(pt.path),lt.buildURLFromParts(pt)):ct;var gt=lt.parseURL(ut);if(!gt)throw new Error("Error trying to parse base URL.");if(!gt.netLoc&&gt.path&&gt.path[0]!=="/"){var _r=it.exec(gt.path);gt.netLoc=_r[1],gt.path=_r[2]}gt.netLoc&&!gt.path&&(gt.path="/");var Yr={scheme:gt.scheme,netLoc:pt.netLoc,path:null,params:pt.params,query:pt.query,fragment:pt.fragment};if(!pt.netLoc&&(Yr.netLoc=gt.netLoc,pt.path[0]!=="/"))if(!pt.path)Yr.path=gt.path,pt.params||(Yr.params=gt.params,pt.query||(Yr.query=gt.query));else{var mt=gt.path,Kr=mt.substring(0,mt.lastIndexOf("/")+1)+pt.path;Yr.path=lt.normalizePath(Kr)}return Yr.path===null&&(Yr.path=dt.alwaysNormalize?lt.normalizePath(pt.path):pt.path),lt.buildURLFromParts(Yr)},parseURL:function(ut){var ct=rt.exec(ut);return ct?{scheme:ct[1]||"",netLoc:ct[2]||"",path:ct[3]||"",params:ct[4]||"",query:ct[5]||"",fragment:ct[6]||""}:null},normalizePath:function(ut){for(ut=ut.split("").reverse().join("").replace(st,"");ut.length!==(ut=ut.replace(ot,"")).length;);return ut.split("").reverse().join("")},buildURLFromParts:function(ut){return ut.scheme+ut.netLoc+ut.path+ut.params+ut.query+ut.fragment}};tt.exports=lt})()})(urlToolkit);var urlToolkitExports=urlToolkit.exports;function ownKeys(tt,et){var nt=Object.keys(tt);if(Object.getOwnPropertySymbols){var rt=Object.getOwnPropertySymbols(tt);et&&(rt=rt.filter(function(it){return Object.getOwnPropertyDescriptor(tt,it).enumerable})),nt.push.apply(nt,rt)}return nt}function _objectSpread2(tt){for(var et=1;et<arguments.length;et++){var nt=arguments[et]!=null?arguments[et]:{};et%2?ownKeys(Object(nt),!0).forEach(function(rt){_defineProperty(tt,rt,nt[rt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(tt,Object.getOwnPropertyDescriptors(nt)):ownKeys(Object(nt)).forEach(function(rt){Object.defineProperty(tt,rt,Object.getOwnPropertyDescriptor(nt,rt))})}return tt}function _toPrimitive(tt,et){if(typeof tt!="object"||!tt)return tt;var nt=tt[Symbol.toPrimitive];if(nt!==void 0){var rt=nt.call(tt,et||"default");if(typeof rt!="object")return rt;throw new TypeError("@@toPrimitive must return a primitive value.")}return(et==="string"?String:Number)(tt)}function _toPropertyKey(tt){var et=_toPrimitive(tt,"string");return typeof et=="symbol"?et:String(et)}function _defineProperty(tt,et,nt){return et=_toPropertyKey(et),et in tt?Object.defineProperty(tt,et,{value:nt,enumerable:!0,configurable:!0,writable:!0}):tt[et]=nt,tt}function _extends(){return _extends=Object.assign?Object.assign.bind():function(tt){for(var et=1;et<arguments.length;et++){var nt=arguments[et];for(var rt in nt)Object.prototype.hasOwnProperty.call(nt,rt)&&(tt[rt]=nt[rt])}return tt},_extends.apply(this,arguments)}const isFiniteNumber=Number.isFinite||function(tt){return typeof tt=="number"&&isFinite(tt)},isSafeInteger=Number.isSafeInteger||function(tt){return typeof tt=="number"&&Math.abs(tt)<=MAX_SAFE_INTEGER},MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER||9007199254740991;let Events=function(tt){return tt.MEDIA_ATTACHING="hlsMediaAttaching",tt.MEDIA_ATTACHED="hlsMediaAttached",tt.MEDIA_DETACHING="hlsMediaDetaching",tt.MEDIA_DETACHED="hlsMediaDetached",tt.BUFFER_RESET="hlsBufferReset",tt.BUFFER_CODECS="hlsBufferCodecs",tt.BUFFER_CREATED="hlsBufferCreated",tt.BUFFER_APPENDING="hlsBufferAppending",tt.BUFFER_APPENDED="hlsBufferAppended",tt.BUFFER_EOS="hlsBufferEos",tt.BUFFER_FLUSHING="hlsBufferFlushing",tt.BUFFER_FLUSHED="hlsBufferFlushed",tt.MANIFEST_LOADING="hlsManifestLoading",tt.MANIFEST_LOADED="hlsManifestLoaded",tt.MANIFEST_PARSED="hlsManifestParsed",tt.LEVEL_SWITCHING="hlsLevelSwitching",tt.LEVEL_SWITCHED="hlsLevelSwitched",tt.LEVEL_LOADING="hlsLevelLoading",tt.LEVEL_LOADED="hlsLevelLoaded",tt.LEVEL_UPDATED="hlsLevelUpdated",tt.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",tt.LEVELS_UPDATED="hlsLevelsUpdated",tt.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",tt.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",tt.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",tt.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",tt.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",tt.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",tt.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",tt.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",tt.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",tt.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",tt.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",tt.CUES_PARSED="hlsCuesParsed",tt.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",tt.INIT_PTS_FOUND="hlsInitPtsFound",tt.FRAG_LOADING="hlsFragLoading",tt.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",tt.FRAG_LOADED="hlsFragLoaded",tt.FRAG_DECRYPTED="hlsFragDecrypted",tt.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",tt.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",tt.FRAG_PARSING_METADATA="hlsFragParsingMetadata",tt.FRAG_PARSED="hlsFragParsed",tt.FRAG_BUFFERED="hlsFragBuffered",tt.FRAG_CHANGED="hlsFragChanged",tt.FPS_DROP="hlsFpsDrop",tt.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",tt.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",tt.ERROR="hlsError",tt.DESTROYING="hlsDestroying",tt.KEY_LOADING="hlsKeyLoading",tt.KEY_LOADED="hlsKeyLoaded",tt.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",tt.BACK_BUFFER_REACHED="hlsBackBufferReached",tt.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",tt}({}),ErrorTypes=function(tt){return tt.NETWORK_ERROR="networkError",tt.MEDIA_ERROR="mediaError",tt.KEY_SYSTEM_ERROR="keySystemError",tt.MUX_ERROR="muxError",tt.OTHER_ERROR="otherError",tt}({}),ErrorDetails=function(tt){return tt.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",tt.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",tt.KEY_SYSTEM_NO_SESSION="keySystemNoSession",tt.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",tt.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",tt.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",tt.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",tt.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",tt.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",tt.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",tt.MANIFEST_LOAD_ERROR="manifestLoadError",tt.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",tt.MANIFEST_PARSING_ERROR="manifestParsingError",tt.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",tt.LEVEL_EMPTY_ERROR="levelEmptyError",tt.LEVEL_LOAD_ERROR="levelLoadError",tt.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",tt.LEVEL_PARSING_ERROR="levelParsingError",tt.LEVEL_SWITCH_ERROR="levelSwitchError",tt.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",tt.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",tt.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",tt.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",tt.FRAG_LOAD_ERROR="fragLoadError",tt.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",tt.FRAG_DECRYPT_ERROR="fragDecryptError",tt.FRAG_PARSING_ERROR="fragParsingError",tt.FRAG_GAP="fragGap",tt.REMUX_ALLOC_ERROR="remuxAllocError",tt.KEY_LOAD_ERROR="keyLoadError",tt.KEY_LOAD_TIMEOUT="keyLoadTimeOut",tt.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",tt.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",tt.BUFFER_APPEND_ERROR="bufferAppendError",tt.BUFFER_APPENDING_ERROR="bufferAppendingError",tt.BUFFER_STALLED_ERROR="bufferStalledError",tt.BUFFER_FULL_ERROR="bufferFullError",tt.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",tt.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",tt.INTERNAL_EXCEPTION="internalException",tt.INTERNAL_ABORTED="aborted",tt.UNKNOWN="unknown",tt}({});const noop=function(){},fakeLogger={trace:noop,debug:noop,log:noop,warn:noop,info:noop,error:noop};let exportedLogger=fakeLogger;function consolePrintFn(tt){const et=self.console[tt];return et?et.bind(self.console,`[${tt}] >`):noop}function exportLoggerFunctions(tt,...et){et.forEach(function(nt){exportedLogger[nt]=tt[nt]?tt[nt].bind(tt):consolePrintFn(nt)})}function enableLogs(tt,et){if(typeof console=="object"&&tt===!0||typeof tt=="object"){exportLoggerFunctions(tt,"debug","log","info","warn","error");try{exportedLogger.log(`Debug logs enabled for "${et}" in hls.js version 1.5.6`)}catch{exportedLogger=fakeLogger}}else exportedLogger=fakeLogger}const logger=exportedLogger,DECIMAL_RESOLUTION_REGEX=/^(\d+)x(\d+)$/,ATTR_LIST_REGEX=/(.+?)=(".*?"|.*?)(?:,|$)/g;class AttrList{constructor(et){typeof et=="string"&&(et=AttrList.parseAttrList(et)),_extends(this,et)}get clientAttrs(){return Object.keys(this).filter(et=>et.substring(0,2)==="X-")}decimalInteger(et){const nt=parseInt(this[et],10);return nt>Number.MAX_SAFE_INTEGER?1/0:nt}hexadecimalInteger(et){if(this[et]){let nt=(this[et]||"0x").slice(2);nt=(nt.length&1?"0":"")+nt;const rt=new Uint8Array(nt.length/2);for(let it=0;it<nt.length/2;it++)rt[it]=parseInt(nt.slice(it*2,it*2+2),16);return rt}else return null}hexadecimalIntegerAsNumber(et){const nt=parseInt(this[et],16);return nt>Number.MAX_SAFE_INTEGER?1/0:nt}decimalFloatingPoint(et){return parseFloat(this[et])}optionalFloat(et,nt){const rt=this[et];return rt?parseFloat(rt):nt}enumeratedString(et){return this[et]}bool(et){return this[et]==="YES"}decimalResolution(et){const nt=DECIMAL_RESOLUTION_REGEX.exec(this[et]);if(nt!==null)return{width:parseInt(nt[1],10),height:parseInt(nt[2],10)}}static parseAttrList(et){let nt;const rt={},it='"';for(ATTR_LIST_REGEX.lastIndex=0;(nt=ATTR_LIST_REGEX.exec(et))!==null;){let st=nt[2];st.indexOf(it)===0&&st.lastIndexOf(it)===st.length-1&&(st=st.slice(1,-1));const ot=nt[1].trim();rt[ot]=st}return rt}}function isDateRangeCueAttribute(tt){return tt!=="ID"&&tt!=="CLASS"&&tt!=="START-DATE"&&tt!=="DURATION"&&tt!=="END-DATE"&&tt!=="END-ON-NEXT"}function isSCTE35Attribute(tt){return tt==="SCTE35-OUT"||tt==="SCTE35-IN"}class DateRange{constructor(et,nt){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,nt){const rt=nt.attr;for(const it in rt)if(Object.prototype.hasOwnProperty.call(et,it)&&et[it]!==rt[it]){logger.warn(`DATERANGE tag attribute: "${it}" does not match for tags with ID: "${et.ID}"`),this._badValueForSameId=it;break}et=_extends(new AttrList({}),rt,et)}if(this.attr=et,this._startDate=new Date(et["START-DATE"]),"END-DATE"in this.attr){const rt=new Date(this.attr["END-DATE"]);isFiniteNumber(rt.getTime())&&(this._endDate=rt)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const et=this.duration;return et!==null?new Date(this._startDate.getTime()+et*1e3):null}get duration(){if("DURATION"in this.attr){const et=this.attr.decimalFloatingPoint("DURATION");if(isFiniteNumber(et))return et}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&isFiniteNumber(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class LoadStats{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ElementaryStreamTypes={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class BaseSegment{constructor(et){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[ElementaryStreamTypes.AUDIO]:null,[ElementaryStreamTypes.VIDEO]:null,[ElementaryStreamTypes.AUDIOVIDEO]:null},this.baseurl=et}setByteRange(et,nt){const rt=et.split("@",2);let it;rt.length===1?it=(nt==null?void 0:nt.byteRangeEndOffset)||0:it=parseInt(rt[1]),this._byteRange=[it,parseInt(rt[0])+it]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=urlToolkitExports.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(et){this._url=et}}class Fragment extends BaseSegment{constructor(et,nt){super(nt),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new LoadStats,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=et}get decryptdata(){const{levelkeys:et}=this;if(!et&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const nt=this.levelkeys.identity;if(nt)this._decryptdata=nt.getDecryptData(this.sn);else{const rt=Object.keys(this.levelkeys);if(rt.length===1)return this._decryptdata=this.levelkeys[rt[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!isFiniteNumber(this.programDateTime))return null;const et=isFiniteNumber(this.duration)?this.duration:0;return this.programDateTime+et*1e3}get encrypted(){var et;if((et=this._decryptdata)!=null&&et.encrypted)return!0;if(this.levelkeys){const nt=Object.keys(this.levelkeys),rt=nt.length;if(rt>1||rt===1&&this.levelkeys[nt[0]].encrypted)return!0}return!1}setKeyFormat(et){if(this.levelkeys){const nt=this.levelkeys[et];nt&&!this._decryptdata&&(this._decryptdata=nt.getDecryptData(this.sn))}}abortRequests(){var et,nt;(et=this.loader)==null||et.abort(),(nt=this.keyLoader)==null||nt.abort()}setElementaryStreamInfo(et,nt,rt,it,st,ot=!1){const{elementaryStreams:lt}=this,ut=lt[et];if(!ut){lt[et]={startPTS:nt,endPTS:rt,startDTS:it,endDTS:st,partial:ot};return}ut.startPTS=Math.min(ut.startPTS,nt),ut.endPTS=Math.max(ut.endPTS,rt),ut.startDTS=Math.min(ut.startDTS,it),ut.endDTS=Math.max(ut.endDTS,st)}clearElementaryStreamInfo(){const{elementaryStreams:et}=this;et[ElementaryStreamTypes.AUDIO]=null,et[ElementaryStreamTypes.VIDEO]=null,et[ElementaryStreamTypes.AUDIOVIDEO]=null}}class Part extends BaseSegment{constructor(et,nt,rt,it,st){super(rt),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new LoadStats,this.duration=et.decimalFloatingPoint("DURATION"),this.gap=et.bool("GAP"),this.independent=et.bool("INDEPENDENT"),this.relurl=et.enumeratedString("URI"),this.fragment=nt,this.index=it;const ot=et.enumeratedString("BYTERANGE");ot&&this.setByteRange(ot,st),st&&(this.fragOffset=st.fragOffset+st.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:et}=this;return!!(et.audio||et.video||et.audiovideo)}}const DEFAULT_TARGET_DURATION=10;class LevelDetails{constructor(et){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=et}reloaded(et){if(!et){this.advanced=!0,this.updated=!0;return}const nt=this.lastPartSn-et.lastPartSn,rt=this.lastPartIndex-et.lastPartIndex;this.updated=this.endSN!==et.endSN||!!rt||!!nt||!this.live,this.advanced=this.endSN>et.endSN||nt>0||nt===0&&rt>0,this.updated||this.advanced?this.misses=Math.floor(et.misses*.6):this.misses=et.misses+1,this.availabilityDelay=et.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?isFiniteNumber(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||DEFAULT_TARGET_DURATION}get drift(){const et=this.driftEndTime-this.driftStartTime;return et>0?(this.driftEnd-this.driftStart)*1e3/et:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var et;return(et=this.partList)!=null&&et.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var et;return(et=this.fragments)!=null&&et.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var et;return(et=this.partList)!=null&&et.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var et;return(et=this.partList)!=null&&et.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function base64Decode(tt){return Uint8Array.from(atob(tt),et=>et.charCodeAt(0))}function getKeyIdBytes(tt){const et=strToUtf8array(tt).subarray(0,16),nt=new Uint8Array(16);return nt.set(et,16-et.length),nt}function changeEndianness(tt){const et=function(rt,it,st){const ot=rt[it];rt[it]=rt[st],rt[st]=ot};et(tt,0,3),et(tt,1,2),et(tt,4,5),et(tt,6,7)}function convertDataUriToArrayBytes(tt){const et=tt.split(":");let nt=null;if(et[0]==="data"&&et.length===2){const rt=et[1].split(";"),it=rt[rt.length-1].split(",");if(it.length===2){const st=it[0]==="base64",ot=it[1];st?(rt.splice(-1,1),nt=base64Decode(ot)):nt=getKeyIdBytes(ot)}}return nt}function strToUtf8array(tt){return Uint8Array.from(unescape(encodeURIComponent(tt)),et=>et.charCodeAt(0))}const optionalSelf=typeof self<"u"?self:void 0;var KeySystems={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},KeySystemFormats={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function keySystemFormatToKeySystemDomain(tt){switch(tt){case KeySystemFormats.FAIRPLAY:return KeySystems.FAIRPLAY;case KeySystemFormats.PLAYREADY:return KeySystems.PLAYREADY;case KeySystemFormats.WIDEVINE:return KeySystems.WIDEVINE;case KeySystemFormats.CLEARKEY:return KeySystems.CLEARKEY}}var KeySystemIds={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function keySystemIdToKeySystemDomain(tt){if(tt===KeySystemIds.WIDEVINE)return KeySystems.WIDEVINE}function keySystemDomainToKeySystemFormat(tt){switch(tt){case KeySystems.FAIRPLAY:return KeySystemFormats.FAIRPLAY;case KeySystems.PLAYREADY:return KeySystemFormats.PLAYREADY;case KeySystems.WIDEVINE:return KeySystemFormats.WIDEVINE;case KeySystems.CLEARKEY:return KeySystemFormats.CLEARKEY}}function getKeySystemsForConfig(tt){const{drmSystems:et,widevineLicenseUrl:nt}=tt,rt=et?[KeySystems.FAIRPLAY,KeySystems.WIDEVINE,KeySystems.PLAYREADY,KeySystems.CLEARKEY].filter(it=>!!et[it]):[];return!rt[KeySystems.WIDEVINE]&&nt&&rt.push(KeySystems.WIDEVINE),rt}const requestMediaKeySystemAccess=function(tt){return optionalSelf!=null&&(tt=optionalSelf.navigator)!=null&&tt.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function getSupportedMediaKeySystemConfigurations(tt,et,nt,rt){let it;switch(tt){case KeySystems.FAIRPLAY:it=["cenc","sinf"];break;case KeySystems.WIDEVINE:case KeySystems.PLAYREADY:it=["cenc"];break;case KeySystems.CLEARKEY:it=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${tt}`)}return createMediaKeySystemConfigurations(it,et,nt,rt)}function createMediaKeySystemConfigurations(tt,et,nt,rt){return[{initDataTypes:tt,persistentState:rt.persistentState||"optional",distinctiveIdentifier:rt.distinctiveIdentifier||"optional",sessionTypes:rt.sessionTypes||[rt.sessionType||"temporary"],audioCapabilities:et.map(st=>({contentType:`audio/mp4; codecs="${st}"`,robustness:rt.audioRobustness||"",encryptionScheme:rt.audioEncryptionScheme||null})),videoCapabilities:nt.map(st=>({contentType:`video/mp4; codecs="${st}"`,robustness:rt.videoRobustness||"",encryptionScheme:rt.videoEncryptionScheme||null}))}]}function sliceUint8(tt,et,nt){return Uint8Array.prototype.slice?tt.slice(et,nt):new Uint8Array(Array.prototype.slice.call(tt,et,nt))}const isHeader$2=(tt,et)=>et+10<=tt.length&&tt[et]===73&&tt[et+1]===68&&tt[et+2]===51&&tt[et+3]<255&&tt[et+4]<255&&tt[et+6]<128&&tt[et+7]<128&&tt[et+8]<128&&tt[et+9]<128,isFooter=(tt,et)=>et+10<=tt.length&&tt[et]===51&&tt[et+1]===68&&tt[et+2]===73&&tt[et+3]<255&&tt[et+4]<255&&tt[et+6]<128&&tt[et+7]<128&&tt[et+8]<128&&tt[et+9]<128,getID3Data=(tt,et)=>{const nt=et;let rt=0;for(;isHeader$2(tt,et);){rt+=10;const it=readSize(tt,et+6);rt+=it,isFooter(tt,et+10)&&(rt+=10),et+=rt}if(rt>0)return tt.subarray(nt,nt+rt)},readSize=(tt,et)=>{let nt=0;return nt=(tt[et]&127)<<21,nt|=(tt[et+1]&127)<<14,nt|=(tt[et+2]&127)<<7,nt|=tt[et+3]&127,nt},canParse$2=(tt,et)=>isHeader$2(tt,et)&&readSize(tt,et+6)+10<=tt.length-et,getTimeStamp=tt=>{const et=getID3Frames(tt);for(let nt=0;nt<et.length;nt++){const rt=et[nt];if(isTimeStampFrame(rt))return readTimeStamp(rt)}},isTimeStampFrame=tt=>tt&&tt.key==="PRIV"&&tt.info==="com.apple.streaming.transportStreamTimestamp",getFrameData=tt=>{const et=String.fromCharCode(tt[0],tt[1],tt[2],tt[3]),nt=readSize(tt,4),rt=10;return{type:et,size:nt,data:tt.subarray(rt,rt+nt)}},getID3Frames=tt=>{let et=0;const nt=[];for(;isHeader$2(tt,et);){const rt=readSize(tt,et+6);et+=10;const it=et+rt;for(;et+8<it;){const st=getFrameData(tt.subarray(et)),ot=decodeFrame(st);ot&&nt.push(ot),et+=st.size+10}isFooter(tt,et)&&(et+=10)}return nt},decodeFrame=tt=>tt.type==="PRIV"?decodePrivFrame(tt):tt.type[0]==="W"?decodeURLFrame(tt):decodeTextFrame(tt),decodePrivFrame=tt=>{if(tt.size<2)return;const et=utf8ArrayToStr(tt.data,!0),nt=new Uint8Array(tt.data.subarray(et.length+1));return{key:tt.type,info:et,data:nt.buffer}},decodeTextFrame=tt=>{if(tt.size<2)return;if(tt.type==="TXXX"){let nt=1;const rt=utf8ArrayToStr(tt.data.subarray(nt),!0);nt+=rt.length+1;const it=utf8ArrayToStr(tt.data.subarray(nt));return{key:tt.type,info:rt,data:it}}const et=utf8ArrayToStr(tt.data.subarray(1));return{key:tt.type,data:et}},decodeURLFrame=tt=>{if(tt.type==="WXXX"){if(tt.size<2)return;let nt=1;const rt=utf8ArrayToStr(tt.data.subarray(nt),!0);nt+=rt.length+1;const it=utf8ArrayToStr(tt.data.subarray(nt));return{key:tt.type,info:rt,data:it}}const et=utf8ArrayToStr(tt.data);return{key:tt.type,data:et}},readTimeStamp=tt=>{if(tt.data.byteLength===8){const et=new Uint8Array(tt.data),nt=et[3]&1;let rt=(et[4]<<23)+(et[5]<<15)+(et[6]<<7)+et[7];return rt/=45,nt&&(rt+=4772185884e-2),Math.round(rt)}},utf8ArrayToStr=(tt,et=!1)=>{const nt=getTextDecoder();if(nt){const ct=nt.decode(tt);if(et){const dt=ct.indexOf("\0");return dt!==-1?ct.substring(0,dt):ct}return ct.replace(/\0/g,"")}const rt=tt.length;let it,st,ot,lt="",ut=0;for(;ut<rt;){if(it=tt[ut++],it===0&&et)return lt;if(it===0||it===3)continue;switch(it>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:lt+=String.fromCharCode(it);break;case 12:case 13:st=tt[ut++],lt+=String.fromCharCode((it&31)<<6|st&63);break;case 14:st=tt[ut++],ot=tt[ut++],lt+=String.fromCharCode((it&15)<<12|(st&63)<<6|(ot&63)<<0);break}}return lt};let decoder;function getTextDecoder(){if(!navigator.userAgent.includes("PlayStation 4"))return!decoder&&typeof self.TextDecoder<"u"&&(decoder=new self.TextDecoder("utf-8")),decoder}const Hex={hexDump:function(tt){let et="";for(let nt=0;nt<tt.length;nt++){let rt=tt[nt].toString(16);rt.length<2&&(rt="0"+rt),et+=rt}return et}},UINT32_MAX$1=Math.pow(2,32)-1,push=[].push,RemuxerTrackIdConfig={video:1,audio:2,id3:3,text:4};function bin2str(tt){return String.fromCharCode.apply(null,tt)}function readUint16(tt,et){const nt=tt[et]<<8|tt[et+1];return nt<0?65536+nt:nt}function readUint32(tt,et){const nt=readSint32(tt,et);return nt<0?4294967296+nt:nt}function readUint64(tt,et){let nt=readUint32(tt,et);return nt*=Math.pow(2,32),nt+=readUint32(tt,et+4),nt}function readSint32(tt,et){return tt[et]<<24|tt[et+1]<<16|tt[et+2]<<8|tt[et+3]}function writeUint32(tt,et,nt){tt[et]=nt>>24,tt[et+1]=nt>>16&255,tt[et+2]=nt>>8&255,tt[et+3]=nt&255}function hasMoofData(tt){const et=tt.byteLength;for(let nt=0;nt<et;){const rt=readUint32(tt,nt);if(rt>8&&tt[nt+4]===109&&tt[nt+5]===111&&tt[nt+6]===111&&tt[nt+7]===102)return!0;nt=rt>1?nt+rt:et}return!1}function findBox(tt,et){const nt=[];if(!et.length)return nt;const rt=tt.byteLength;for(let it=0;it<rt;){const st=readUint32(tt,it),ot=bin2str(tt.subarray(it+4,it+8)),lt=st>1?it+st:rt;if(ot===et[0])if(et.length===1)nt.push(tt.subarray(it+8,lt));else{const ut=findBox(tt.subarray(it+8,lt),et.slice(1));ut.length&&push.apply(nt,ut)}it=lt}return nt}function parseSegmentIndex(tt){const et=[],nt=tt[0];let rt=8;const it=readUint32(tt,rt);rt+=4;let st=0,ot=0;nt===0?(st=readUint32(tt,rt),ot=readUint32(tt,rt+4),rt+=8):(st=readUint64(tt,rt),ot=readUint64(tt,rt+8),rt+=16),rt+=2;let lt=tt.length+ot;const ut=readUint16(tt,rt);rt+=2;for(let ct=0;ct<ut;ct++){let dt=rt;const ft=readUint32(tt,dt);dt+=4;const pt=ft&2147483647;if((ft&2147483648)>>>31===1)return logger.warn("SIDX has hierarchical references (not supported)"),null;const _r=readUint32(tt,dt);dt+=4,et.push({referenceSize:pt,subsegmentDuration:_r,info:{duration:_r/it,start:lt,end:lt+pt-1}}),lt+=pt,dt+=4,rt=dt}return{earliestPresentationTime:st,timescale:it,version:nt,referencesCount:ut,references:et}}function parseInitSegment(tt){const et=[],nt=findBox(tt,["moov","trak"]);for(let it=0;it<nt.length;it++){const st=nt[it],ot=findBox(st,["tkhd"])[0];if(ot){let lt=ot[0];const ut=readUint32(ot,lt===0?12:20),ct=findBox(st,["mdia","mdhd"])[0];if(ct){lt=ct[0];const dt=readUint32(ct,lt===0?12:20),ft=findBox(st,["mdia","hdlr"])[0];if(ft){const pt=bin2str(ft.subarray(8,12)),gt={soun:ElementaryStreamTypes.AUDIO,vide:ElementaryStreamTypes.VIDEO}[pt];if(gt){const _r=findBox(st,["mdia","minf","stbl","stsd"])[0],Yr=parseStsd(_r);et[ut]={timescale:dt,type:gt},et[gt]=_objectSpread2({timescale:dt,id:ut},Yr)}}}}}return findBox(tt,["moov","mvex","trex"]).forEach(it=>{const st=readUint32(it,4),ot=et[st];ot&&(ot.default={duration:readUint32(it,12),flags:readUint32(it,20)})}),et}function parseStsd(tt){const et=tt.subarray(8),nt=et.subarray(86),rt=bin2str(et.subarray(4,8));let it=rt;const st=rt==="enca"||rt==="encv";if(st){const lt=findBox(et,[rt])[0].subarray(rt==="enca"?28:78);findBox(lt,["sinf"]).forEach(ct=>{const dt=findBox(ct,["schm"])[0];if(dt){const ft=bin2str(dt.subarray(4,8));if(ft==="cbcs"||ft==="cenc"){const pt=findBox(ct,["frma"])[0];pt&&(it=bin2str(pt))}}})}switch(it){case"avc1":case"avc2":case"avc3":case"avc4":{const ot=findBox(nt,["avcC"])[0];it+="."+toHex(ot[1])+toHex(ot[2])+toHex(ot[3]);break}case"mp4a":{const ot=findBox(et,[rt])[0],lt=findBox(ot.subarray(28),["esds"])[0];if(lt&&lt.length>12){let ut=4;if(lt[ut++]!==3)break;ut=skipBERInteger(lt,ut),ut+=2;const ct=lt[ut++];if(ct&128&&(ut+=2),ct&64&&(ut+=lt[ut++]),lt[ut++]!==4)break;ut=skipBERInteger(lt,ut);const dt=lt[ut++];if(dt===64)it+="."+toHex(dt);else break;if(ut+=12,lt[ut++]!==5)break;ut=skipBERInteger(lt,ut);const ft=lt[ut++];let pt=(ft&248)>>3;pt===31&&(pt+=1+((ft&7)<<3)+((lt[ut]&224)>>5)),it+="."+pt}break}case"hvc1":case"hev1":{const ot=findBox(nt,["hvcC"])[0],lt=ot[1],ut=["","A","B","C"][lt>>6],ct=lt&31,dt=readUint32(ot,2),ft=(lt&32)>>5?"H":"L",pt=ot[12],gt=ot.subarray(6,12);it+="."+ut+ct,it+="."+dt.toString(16).toUpperCase(),it+="."+ft+pt;let _r="";for(let Yr=gt.length;Yr--;){const mt=gt[Yr];(mt||_r)&&(_r="."+mt.toString(16).toUpperCase()+_r)}it+=_r;break}case"dvh1":case"dvhe":{const ot=findBox(nt,["dvcC"])[0],lt=ot[2]>>1&127,ut=ot[2]<<5&32|ot[3]>>3&31;it+="."+addLeadingZero(lt)+"."+addLeadingZero(ut);break}case"vp09":{const ot=findBox(nt,["vpcC"])[0],lt=ot[4],ut=ot[5],ct=ot[6]>>4&15;it+="."+addLeadingZero(lt)+"."+addLeadingZero(ut)+"."+addLeadingZero(ct);break}case"av01":{const ot=findBox(nt,["av1C"])[0],lt=ot[1]>>>5,ut=ot[1]&31,ct=ot[2]>>>7?"H":"M",dt=(ot[2]&64)>>6,ft=(ot[2]&32)>>5,pt=lt===2&&dt?ft?12:10:dt?10:8,gt=(ot[2]&16)>>4,_r=(ot[2]&8)>>3,Yr=(ot[2]&4)>>2,mt=ot[2]&3;it+="."+lt+"."+addLeadingZero(ut)+ct+"."+addLeadingZero(pt)+"."+gt+"."+_r+Yr+mt+"."+addLeadingZero(1)+"."+addLeadingZero(1)+"."+addLeadingZero(1)+"."+0;break}}return{codec:it,encrypted:st}}function skipBERInteger(tt,et){const nt=et+5;for(;tt[et++]&128&&et<nt;);return et}function toHex(tt){return("0"+tt.toString(16).toUpperCase()).slice(-2)}function addLeadingZero(tt){return(tt<10?"0":"")+tt}function patchEncyptionData(tt,et){if(!tt||!et)return tt;const nt=et.keyId;return nt&&et.isCommonEncryption&&findBox(tt,["moov","trak"]).forEach(it=>{const ot=findBox(it,["mdia","minf","stbl","stsd"])[0].subarray(8);let lt=findBox(ot,["enca"]);const ut=lt.length>0;ut||(lt=findBox(ot,["encv"])),lt.forEach(ct=>{const dt=ut?ct.subarray(28):ct.subarray(78);findBox(dt,["sinf"]).forEach(pt=>{const gt=parseSinf(pt);if(gt){const _r=gt.subarray(8,24);_r.some(Yr=>Yr!==0)||(logger.log(`[eme] Patching keyId in 'enc${ut?"a":"v"}>sinf>>tenc' box: ${Hex.hexDump(_r)} -> ${Hex.hexDump(nt)}`),gt.set(nt,8))}})})}),tt}function parseSinf(tt){const et=findBox(tt,["schm"])[0];if(et){const nt=bin2str(et.subarray(4,8));if(nt==="cbcs"||nt==="cenc")return findBox(tt,["schi","tenc"])[0]}return logger.error("[eme] missing 'schm' box"),null}function getStartDTS(tt,et){return findBox(et,["moof","traf"]).reduce((nt,rt)=>{const it=findBox(rt,["tfdt"])[0],st=it[0],ot=findBox(rt,["tfhd"]).reduce((lt,ut)=>{const ct=readUint32(ut,4),dt=tt[ct];if(dt){let ft=readUint32(it,4);if(st===1){if(ft===UINT32_MAX$1)return logger.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),lt;ft*=UINT32_MAX$1+1,ft+=readUint32(it,8)}const pt=dt.timescale||9e4,gt=ft/pt;if(isFiniteNumber(gt)&&(lt===null||gt<lt))return gt}return lt},null);return ot!==null&&isFiniteNumber(ot)&&(nt===null||ot<nt)?ot:nt},null)}function getDuration(tt,et){let nt=0,rt=0,it=0;const st=findBox(tt,["moof","traf"]);for(let ot=0;ot<st.length;ot++){const lt=st[ot],ut=findBox(lt,["tfhd"])[0],ct=readUint32(ut,4),dt=et[ct];if(!dt)continue;const ft=dt.default,pt=readUint32(ut,0)|(ft==null?void 0:ft.flags);let gt=ft==null?void 0:ft.duration;pt&8&&(pt&2?gt=readUint32(ut,12):gt=readUint32(ut,8));const _r=dt.timescale||9e4,Yr=findBox(lt,["trun"]);for(let mt=0;mt<Yr.length;mt++){if(nt=computeRawDurationFromSamples(Yr[mt]),!nt&&gt){const Kr=readUint32(Yr[mt],4);nt=gt*Kr}dt.type===ElementaryStreamTypes.VIDEO?rt+=nt/_r:dt.type===ElementaryStreamTypes.AUDIO&&(it+=nt/_r)}}if(rt===0&&it===0){let ot=1/0,lt=0,ut=0;const ct=findBox(tt,["sidx"]);for(let dt=0;dt<ct.length;dt++){const ft=parseSegmentIndex(ct[dt]);if(ft!=null&&ft.references){ot=Math.min(ot,ft.earliestPresentationTime/ft.timescale);const pt=ft.references.reduce((gt,_r)=>gt+_r.info.duration||0,0);lt=Math.max(lt,pt+ft.earliestPresentationTime/ft.timescale),ut=lt-ot}}if(ut&&isFiniteNumber(ut))return ut}return rt||it}function computeRawDurationFromSamples(tt){const et=readUint32(tt,0);let nt=8;et&1&&(nt+=4),et&4&&(nt+=4);let rt=0;const it=readUint32(tt,4);for(let st=0;st<it;st++){if(et&256){const ot=readUint32(tt,nt);rt+=ot,nt+=4}et&512&&(nt+=4),et&1024&&(nt+=4),et&2048&&(nt+=4)}return rt}function offsetStartDTS(tt,et,nt){findBox(et,["moof","traf"]).forEach(rt=>{findBox(rt,["tfhd"]).forEach(it=>{const st=readUint32(it,4),ot=tt[st];if(!ot)return;const lt=ot.timescale||9e4;findBox(rt,["tfdt"]).forEach(ut=>{const ct=ut[0],dt=nt*lt;if(dt){let ft=readUint32(ut,4);if(ct===0)ft-=dt,ft=Math.max(ft,0),writeUint32(ut,4,ft);else{ft*=Math.pow(2,32),ft+=readUint32(ut,8),ft-=dt,ft=Math.max(ft,0);const pt=Math.floor(ft/(UINT32_MAX$1+1)),gt=Math.floor(ft%(UINT32_MAX$1+1));writeUint32(ut,4,pt),writeUint32(ut,8,gt)}}})})})}function segmentValidRange(tt){const et={valid:null,remainder:null},nt=findBox(tt,["moof"]);if(nt.length<2)return et.remainder=tt,et;const rt=nt[nt.length-1];return et.valid=sliceUint8(tt,0,rt.byteOffset-8),et.remainder=sliceUint8(tt,rt.byteOffset-8),et}function appendUint8Array(tt,et){const nt=new Uint8Array(tt.length+et.length);return nt.set(tt),nt.set(et,tt.length),nt}function parseSamples(tt,et){const nt=[],rt=et.samples,it=et.timescale,st=et.id;let ot=!1;return findBox(rt,["moof"]).map(ut=>{const ct=ut.byteOffset-8;findBox(ut,["traf"]).map(ft=>{const pt=findBox(ft,["tfdt"]).map(gt=>{const _r=gt[0];let Yr=readUint32(gt,4);return _r===1&&(Yr*=Math.pow(2,32),Yr+=readUint32(gt,8)),Yr/it})[0];return pt!==void 0&&(tt=pt),findBox(ft,["tfhd"]).map(gt=>{const _r=readUint32(gt,4),Yr=readUint32(gt,0)&16777215,mt=(Yr&1)!==0,Kr=(Yr&2)!==0,Xr=(Yr&8)!==0;let Zr=0;const Qr=(Yr&16)!==0;let _i=0;const rs=(Yr&32)!==0;let ns=8;_r===st&&(mt&&(ns+=8),Kr&&(ns+=4),Xr&&(Zr=readUint32(gt,ns),ns+=4),Qr&&(_i=readUint32(gt,ns),ns+=4),rs&&(ns+=4),et.type==="video"&&(ot=isHEVC(et.codec)),findBox(ft,["trun"]).map(ss=>{const fs=ss[0],os=readUint32(ss,0)&16777215,is=(os&1)!==0;let cs=0;const ps=(os&4)!==0,vs=(os&256)!==0;let ls=0;const gs=(os&512)!==0;let us=0;const ms=(os&1024)!==0,ys=(os&2048)!==0;let Es=0;const Ts=readUint32(ss,4);let Ss=8;is&&(cs=readUint32(ss,Ss),Ss+=4),ps&&(Ss+=4);let Ds=cs+ct;for(let Cs=0;Cs<Ts;Cs++){if(vs?(ls=readUint32(ss,Ss),Ss+=4):ls=Zr,gs?(us=readUint32(ss,Ss),Ss+=4):us=_i,ms&&(Ss+=4),ys&&(fs===0?Es=readUint32(ss,Ss):Es=readSint32(ss,Ss),Ss+=4),et.type===ElementaryStreamTypes.VIDEO){let Is=0;for(;Is<us;){const ks=readUint32(rt,Ds);if(Ds+=4,isSEIMessage(ot,rt[Ds])){const _s=rt.subarray(Ds,Ds+ks);parseSEIMessageFromNALu(_s,ot?2:1,tt+Es/it,nt)}Ds+=ks,Is+=ks+4}}tt+=ls/it}}))})})}),nt}function isHEVC(tt){if(!tt)return!1;const et=tt.indexOf("."),nt=et<0?tt:tt.substring(0,et);return nt==="hvc1"||nt==="hev1"||nt==="dvh1"||nt==="dvhe"}function isSEIMessage(tt,et){if(tt){const nt=et>>1&63;return nt===39||nt===40}else return(et&31)===6}function parseSEIMessageFromNALu(tt,et,nt,rt){const it=discardEPB(tt);let st=0;st+=et;let ot=0,lt=0,ut=0;for(;st<it.length;){ot=0;do{if(st>=it.length)break;ut=it[st++],ot+=ut}while(ut===255);lt=0;do{if(st>=it.length)break;ut=it[st++],lt+=ut}while(ut===255);const ct=it.length-st;let dt=st;if(lt<ct)st+=lt;else if(lt>ct){logger.error(`Malformed SEI payload. ${lt} is too small, only ${ct} bytes left to parse.`);break}if(ot===4){if(it[dt++]===181){const pt=readUint16(it,dt);if(dt+=2,pt===49){const gt=readUint32(it,dt);if(dt+=4,gt===1195456820){const _r=it[dt++];if(_r===3){const Yr=it[dt++],mt=31&Yr,Kr=64&Yr,Xr=Kr?2+mt*3:0,Zr=new Uint8Array(Xr);if(Kr){Zr[0]=Yr;for(let Qr=1;Qr<Xr;Qr++)Zr[Qr]=it[dt++]}rt.push({type:_r,payloadType:ot,pts:nt,bytes:Zr})}}}}}else if(ot===5&&lt>16){const ft=[];for(let _r=0;_r<16;_r++){const Yr=it[dt++].toString(16);ft.push(Yr.length==1?"0"+Yr:Yr),(_r===3||_r===5||_r===7||_r===9)&&ft.push("-")}const pt=lt-16,gt=new Uint8Array(pt);for(let _r=0;_r<pt;_r++)gt[_r]=it[dt++];rt.push({payloadType:ot,pts:nt,uuid:ft.join(""),userData:utf8ArrayToStr(gt),userDataBytes:gt})}}}function discardEPB(tt){const et=tt.byteLength,nt=[];let rt=1;for(;rt<et-2;)tt[rt]===0&&tt[rt+1]===0&&tt[rt+2]===3?(nt.push(rt+2),rt+=2):rt++;if(nt.length===0)return tt;const it=et-nt.length,st=new Uint8Array(it);let ot=0;for(rt=0;rt<it;ot++,rt++)ot===nt[0]&&(ot++,nt.shift()),st[rt]=tt[ot];return st}function parseEmsg(tt){const et=tt[0];let nt="",rt="",it=0,st=0,ot=0,lt=0,ut=0,ct=0;if(et===0){for(;bin2str(tt.subarray(ct,ct+1))!=="\0";)nt+=bin2str(tt.subarray(ct,ct+1)),ct+=1;for(nt+=bin2str(tt.subarray(ct,ct+1)),ct+=1;bin2str(tt.subarray(ct,ct+1))!=="\0";)rt+=bin2str(tt.subarray(ct,ct+1)),ct+=1;rt+=bin2str(tt.subarray(ct,ct+1)),ct+=1,it=readUint32(tt,12),st=readUint32(tt,16),lt=readUint32(tt,20),ut=readUint32(tt,24),ct=28}else if(et===1){ct+=4,it=readUint32(tt,ct),ct+=4;const ft=readUint32(tt,ct);ct+=4;const pt=readUint32(tt,ct);for(ct+=4,ot=2**32*ft+pt,isSafeInteger(ot)||(ot=Number.MAX_SAFE_INTEGER,logger.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),lt=readUint32(tt,ct),ct+=4,ut=readUint32(tt,ct),ct+=4;bin2str(tt.subarray(ct,ct+1))!=="\0";)nt+=bin2str(tt.subarray(ct,ct+1)),ct+=1;for(nt+=bin2str(tt.subarray(ct,ct+1)),ct+=1;bin2str(tt.subarray(ct,ct+1))!=="\0";)rt+=bin2str(tt.subarray(ct,ct+1)),ct+=1;rt+=bin2str(tt.subarray(ct,ct+1)),ct+=1}const dt=tt.subarray(ct,tt.byteLength);return{schemeIdUri:nt,value:rt,timeScale:it,presentationTime:ot,presentationTimeDelta:st,eventDuration:lt,id:ut,payload:dt}}function mp4Box(tt,...et){const nt=et.length;let rt=8,it=nt;for(;it--;)rt+=et[it].byteLength;const st=new Uint8Array(rt);for(st[0]=rt>>24&255,st[1]=rt>>16&255,st[2]=rt>>8&255,st[3]=rt&255,st.set(tt,4),it=0,rt=8;it<nt;it++)st.set(et[it],rt),rt+=et[it].byteLength;return st}function mp4pssh(tt,et,nt){if(tt.byteLength!==16)throw new RangeError("Invalid system id");let rt,it;if(et){rt=1,it=new Uint8Array(et.length*16);for(let lt=0;lt<et.length;lt++){const ut=et[lt];if(ut.byteLength!==16)throw new RangeError("Invalid key");it.set(ut,lt*16)}}else rt=0,it=new Uint8Array;let st;rt>0?(st=new Uint8Array(4),et.length>0&&new DataView(st.buffer).setUint32(0,et.length,!1)):st=new Uint8Array;const ot=new Uint8Array(4);return nt&&nt.byteLength>0&&new DataView(ot.buffer).setUint32(0,nt.byteLength,!1),mp4Box([112,115,115,104],new Uint8Array([rt,0,0,0]),tt,st,it,ot,nt||new Uint8Array)}function parsePssh(tt){if(!(tt instanceof ArrayBuffer)||tt.byteLength<32)return null;const et={version:0,systemId:"",kids:null,data:null},nt=new DataView(tt),rt=nt.getUint32(0);if(tt.byteLength!==rt&&rt>44||nt.getUint32(4)!==1886614376||(et.version=nt.getUint32(8)>>>24,et.version>1))return null;et.systemId=Hex.hexDump(new Uint8Array(tt,12,16));const st=nt.getUint32(28);if(et.version===0){if(rt-32<st)return null;et.data=new Uint8Array(tt,32,st)}else if(et.version===1){et.kids=[];for(let ot=0;ot<st;ot++)et.kids.push(new Uint8Array(tt,32+ot*16,16))}return et}let keyUriToKeyIdMap={};class LevelKey{static clearKeyUriToKeyIdMap(){keyUriToKeyIdMap={}}constructor(et,nt,rt,it=[1],st=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=et,this.uri=nt,this.keyFormat=rt,this.keyFormatVersions=it,this.iv=st,this.encrypted=et?et!=="NONE":!1,this.isCommonEncryption=this.encrypted&&et!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case KeySystemFormats.FAIRPLAY:case KeySystemFormats.WIDEVINE:case KeySystemFormats.PLAYREADY:case KeySystemFormats.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(et){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof et!="number"&&(this.method==="AES-128"&&!this.iv&&logger.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),et=0);const rt=createInitializationVector(et);return new LevelKey(this.method,this.uri,"identity",this.keyFormatVersions,rt)}const nt=convertDataUriToArrayBytes(this.uri);if(nt)switch(this.keyFormat){case KeySystemFormats.WIDEVINE:this.pssh=nt,nt.length>=22&&(this.keyId=nt.subarray(nt.length-22,nt.length-6));break;case KeySystemFormats.PLAYREADY:{const rt=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=mp4pssh(rt,null,nt);const it=new Uint16Array(nt.buffer,nt.byteOffset,nt.byteLength/2),st=String.fromCharCode.apply(null,Array.from(it)),ot=st.substring(st.indexOf("<"),st.length),ct=new DOMParser().parseFromString(ot,"text/xml").getElementsByTagName("KID")[0];if(ct){const dt=ct.childNodes[0]?ct.childNodes[0].nodeValue:ct.getAttribute("VALUE");if(dt){const ft=base64Decode(dt).subarray(0,16);changeEndianness(ft),this.keyId=ft}}break}default:{let rt=nt.subarray(0,16);if(rt.length!==16){const it=new Uint8Array(16);it.set(rt,16-rt.length),rt=it}this.keyId=rt;break}}if(!this.keyId||this.keyId.byteLength!==16){let rt=keyUriToKeyIdMap[this.uri];if(!rt){const it=Object.keys(keyUriToKeyIdMap).length%Number.MAX_SAFE_INTEGER;rt=new Uint8Array(16),new DataView(rt.buffer,12,4).setUint32(0,it),keyUriToKeyIdMap[this.uri]=rt}this.keyId=rt}return this}}function createInitializationVector(tt){const et=new Uint8Array(16);for(let nt=12;nt<16;nt++)et[nt]=tt>>8*(15-nt)&255;return et}const VARIABLE_REPLACEMENT_REGEX=/\{\$([a-zA-Z0-9-_]+)\}/g;function hasVariableReferences(tt){return VARIABLE_REPLACEMENT_REGEX.test(tt)}function substituteVariablesInAttributes(tt,et,nt){if(tt.variableList!==null||tt.hasVariableRefs)for(let rt=nt.length;rt--;){const it=nt[rt],st=et[it];st&&(et[it]=substituteVariables(tt,st))}}function substituteVariables(tt,et){if(tt.variableList!==null||tt.hasVariableRefs){const nt=tt.variableList;return et.replace(VARIABLE_REPLACEMENT_REGEX,rt=>{const it=rt.substring(2,rt.length-1),st=nt==null?void 0:nt[it];return st===void 0?(tt.playlistParsingError||(tt.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${it}"`)),rt):st})}return et}function addVariableDefinition(tt,et,nt){let rt=tt.variableList;rt||(tt.variableList=rt={});let it,st;if("QUERYPARAM"in et){it=et.QUERYPARAM;try{const ot=new self.URL(nt).searchParams;if(ot.has(it))st=ot.get(it);else throw new Error(`"${it}" does not match any query parameter in URI: "${nt}"`)}catch(ot){tt.playlistParsingError||(tt.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${ot.message}`))}}else it=et.NAME,st=et.VALUE;it in rt?tt.playlistParsingError||(tt.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${it}"`)):rt[it]=st||""}function importVariableDefinition(tt,et,nt){const rt=et.IMPORT;if(nt&&rt in nt){let it=tt.variableList;it||(tt.variableList=it={}),it[rt]=nt[rt]}else tt.playlistParsingError||(tt.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${rt}"`))}function getMediaSource(tt=!0){return typeof self>"u"?void 0:(tt||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}const sampleEntryCodesISO={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function isCodecType(tt,et){const nt=sampleEntryCodesISO[et];return!!nt&&!!nt[tt.slice(0,4)]}function areCodecsMediaSourceSupported(tt,et,nt=!0){return!tt.split(",").some(rt=>!isCodecMediaSourceSupported(rt,et,nt))}function isCodecMediaSourceSupported(tt,et,nt=!0){var rt;const it=getMediaSource(nt);return(rt=it==null?void 0:it.isTypeSupported(mimeTypeForCodec(tt,et)))!=null?rt:!1}function mimeTypeForCodec(tt,et){return`${et}/mp4;codecs="${tt}"`}function videoCodecPreferenceValue(tt){if(tt){const et=tt.substring(0,4);return sampleEntryCodesISO.video[et]}return 2}function codecsSetSelectionPreferenceValue(tt){return tt.split(",").reduce((et,nt)=>{const rt=sampleEntryCodesISO.video[nt];return rt?(rt*2+et)/(et?3:2):(sampleEntryCodesISO.audio[nt]+et)/(et?2:1)},0)}const CODEC_COMPATIBLE_NAMES={};function getCodecCompatibleNameLower(tt,et=!0){if(CODEC_COMPATIBLE_NAMES[tt])return CODEC_COMPATIBLE_NAMES[tt];const nt={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[tt];for(let rt=0;rt<nt.length;rt++)if(isCodecMediaSourceSupported(nt[rt],"audio",et))return CODEC_COMPATIBLE_NAMES[tt]=nt[rt],nt[rt];return tt}const AUDIO_CODEC_REGEXP=/flac|opus/i;function getCodecCompatibleName(tt,et=!0){return tt.replace(AUDIO_CODEC_REGEXP,nt=>getCodecCompatibleNameLower(nt.toLowerCase(),et))}function pickMostCompleteCodecName(tt,et){return tt&&tt!=="mp4a"?tt:et}function convertAVC1ToAVCOTI(tt){const et=tt.split(".");if(et.length>2){let nt=et.shift()+".";return nt+=parseInt(et.shift()).toString(16),nt+=("000"+parseInt(et.shift()).toString(16)).slice(-4),nt}return tt}const MASTER_PLAYLIST_REGEX=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,MASTER_PLAYLIST_MEDIA_REGEX=/#EXT-X-MEDIA:(.*)/g,IS_MEDIA_PLAYLIST=/^#EXT(?:INF|-X-TARGETDURATION):/m,LEVEL_PLAYLIST_REGEX_FAST=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),LEVEL_PLAYLIST_REGEX_SLOW=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class M3U8Parser{static findGroup(et,nt){for(let rt=0;rt<et.length;rt++){const it=et[rt];if(it.id===nt)return it}}static resolve(et,nt){return urlToolkitExports.buildAbsoluteURL(nt,et,{alwaysNormalize:!0})}static isMediaPlaylist(et){return IS_MEDIA_PLAYLIST.test(et)}static parseMasterPlaylist(et,nt){const rt=hasVariableReferences(et),it={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:rt},st=[];MASTER_PLAYLIST_REGEX.lastIndex=0;let ot;for(;(ot=MASTER_PLAYLIST_REGEX.exec(et))!=null;)if(ot[1]){var lt;const ct=new AttrList(ot[1]);substituteVariablesInAttributes(it,ct,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const dt=substituteVariables(it,ot[2]),ft={attrs:ct,bitrate:ct.decimalInteger("BANDWIDTH")||ct.decimalInteger("AVERAGE-BANDWIDTH"),name:ct.NAME,url:M3U8Parser.resolve(dt,nt)},pt=ct.decimalResolution("RESOLUTION");pt&&(ft.width=pt.width,ft.height=pt.height),setCodecs(ct.CODECS,ft),(lt=ft.unknownCodecs)!=null&&lt.length||st.push(ft),it.levels.push(ft)}else if(ot[3]){const ct=ot[3],dt=ot[4];switch(ct){case"SESSION-DATA":{const ft=new AttrList(dt);substituteVariablesInAttributes(it,ft,["DATA-ID","LANGUAGE","VALUE","URI"]);const pt=ft["DATA-ID"];pt&&(it.sessionData===null&&(it.sessionData={}),it.sessionData[pt]=ft);break}case"SESSION-KEY":{const ft=parseKey(dt,nt,it);ft.encrypted&&ft.isSupported()?(it.sessionKeys===null&&(it.sessionKeys=[]),it.sessionKeys.push(ft)):logger.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${dt}"`);break}case"DEFINE":{{const ft=new AttrList(dt);substituteVariablesInAttributes(it,ft,["NAME","VALUE","QUERYPARAM"]),addVariableDefinition(it,ft,nt)}break}case"CONTENT-STEERING":{const ft=new AttrList(dt);substituteVariablesInAttributes(it,ft,["SERVER-URI","PATHWAY-ID"]),it.contentSteering={uri:M3U8Parser.resolve(ft["SERVER-URI"],nt),pathwayId:ft["PATHWAY-ID"]||"."};break}case"START":{it.startTimeOffset=parseStartTimeOffset(dt);break}}}const ut=st.length>0&&st.length<it.levels.length;return it.levels=ut?st:it.levels,it.levels.length===0&&(it.playlistParsingError=new Error("no levels found in manifest")),it}static parseMasterPlaylistMedia(et,nt,rt){let it;const st={},ot=rt.levels,lt={AUDIO:ot.map(ct=>({id:ct.attrs.AUDIO,audioCodec:ct.audioCodec})),SUBTITLES:ot.map(ct=>({id:ct.attrs.SUBTITLES,textCodec:ct.textCodec})),"CLOSED-CAPTIONS":[]};let ut=0;for(MASTER_PLAYLIST_MEDIA_REGEX.lastIndex=0;(it=MASTER_PLAYLIST_MEDIA_REGEX.exec(et))!==null;){const ct=new AttrList(it[1]),dt=ct.TYPE;if(dt){const ft=lt[dt],pt=st[dt]||[];st[dt]=pt,substituteVariablesInAttributes(rt,ct,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const gt=ct.LANGUAGE,_r=ct["ASSOC-LANGUAGE"],Yr=ct.CHANNELS,mt=ct.CHARACTERISTICS,Kr=ct["INSTREAM-ID"],Xr={attrs:ct,bitrate:0,id:ut++,groupId:ct["GROUP-ID"]||"",name:ct.NAME||gt||"",type:dt,default:ct.bool("DEFAULT"),autoselect:ct.bool("AUTOSELECT"),forced:ct.bool("FORCED"),lang:gt,url:ct.URI?M3U8Parser.resolve(ct.URI,nt):""};if(_r&&(Xr.assocLang=_r),Yr&&(Xr.channels=Yr),mt&&(Xr.characteristics=mt),Kr&&(Xr.instreamId=Kr),ft!=null&&ft.length){const Zr=M3U8Parser.findGroup(ft,Xr.groupId)||ft[0];assignCodec(Xr,Zr,"audioCodec"),assignCodec(Xr,Zr,"textCodec")}pt.push(Xr)}}return st}static parseLevelPlaylist(et,nt,rt,it,st,ot){const lt=new LevelDetails(nt),ut=lt.fragments;let ct=null,dt=0,ft=0,pt=0,gt=0,_r=null,Yr=new Fragment(it,nt),mt,Kr,Xr,Zr=-1,Qr=!1,_i=null;for(LEVEL_PLAYLIST_REGEX_FAST.lastIndex=0,lt.m3u8=et,lt.hasVariableRefs=hasVariableReferences(et);(mt=LEVEL_PLAYLIST_REGEX_FAST.exec(et))!==null;){Qr&&(Qr=!1,Yr=new Fragment(it,nt),Yr.start=pt,Yr.sn=dt,Yr.cc=gt,Yr.level=rt,ct&&(Yr.initSegment=ct,Yr.rawProgramDateTime=ct.rawProgramDateTime,ct.rawProgramDateTime=null,_i&&(Yr.setByteRange(_i),_i=null)));const fs=mt[1];if(fs){Yr.duration=parseFloat(fs);const os=(" "+mt[2]).slice(1);Yr.title=os||null,Yr.tagList.push(os?["INF",fs,os]:["INF",fs])}else if(mt[3]){if(isFiniteNumber(Yr.duration)){Yr.start=pt,Xr&&setFragLevelKeys(Yr,Xr,lt),Yr.sn=dt,Yr.level=rt,Yr.cc=gt,ut.push(Yr);const os=(" "+mt[3]).slice(1);Yr.relurl=substituteVariables(lt,os),assignProgramDateTime(Yr,_r),_r=Yr,pt+=Yr.duration,dt++,ft=0,Qr=!0}}else if(mt[4]){const os=(" "+mt[4]).slice(1);_r?Yr.setByteRange(os,_r):Yr.setByteRange(os)}else if(mt[5])Yr.rawProgramDateTime=(" "+mt[5]).slice(1),Yr.tagList.push(["PROGRAM-DATE-TIME",Yr.rawProgramDateTime]),Zr===-1&&(Zr=ut.length);else{if(mt=mt[0].match(LEVEL_PLAYLIST_REGEX_SLOW),!mt){logger.warn("No matches on slow regex match for level playlist!");continue}for(Kr=1;Kr<mt.length&&!(typeof mt[Kr]<"u");Kr++);const os=(" "+mt[Kr]).slice(1),is=(" "+mt[Kr+1]).slice(1),cs=mt[Kr+2]?(" "+mt[Kr+2]).slice(1):"";switch(os){case"PLAYLIST-TYPE":lt.type=is.toUpperCase();break;case"MEDIA-SEQUENCE":dt=lt.startSN=parseInt(is);break;case"SKIP":{const ps=new AttrList(is);substituteVariablesInAttributes(lt,ps,["RECENTLY-REMOVED-DATERANGES"]);const vs=ps.decimalInteger("SKIPPED-SEGMENTS");if(isFiniteNumber(vs)){lt.skippedSegments=vs;for(let gs=vs;gs--;)ut.unshift(null);dt+=vs}const ls=ps.enumeratedString("RECENTLY-REMOVED-DATERANGES");ls&&(lt.recentlyRemovedDateranges=ls.split("	"));break}case"TARGETDURATION":lt.targetduration=Math.max(parseInt(is),1);break;case"VERSION":lt.version=parseInt(is);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":lt.live=!1;break;case"#":(is||cs)&&Yr.tagList.push(cs?[is,cs]:[is]);break;case"DISCONTINUITY":gt++,Yr.tagList.push(["DIS"]);break;case"GAP":Yr.gap=!0,Yr.tagList.push([os]);break;case"BITRATE":Yr.tagList.push([os,is]);break;case"DATERANGE":{const ps=new AttrList(is);substituteVariablesInAttributes(lt,ps,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),substituteVariablesInAttributes(lt,ps,ps.clientAttrs);const vs=new DateRange(ps,lt.dateRanges[ps.ID]);vs.isValid||lt.skippedSegments?lt.dateRanges[vs.id]=vs:logger.warn(`Ignoring invalid DATERANGE tag: "${is}"`),Yr.tagList.push(["EXT-X-DATERANGE",is]);break}case"DEFINE":{{const ps=new AttrList(is);substituteVariablesInAttributes(lt,ps,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in ps?importVariableDefinition(lt,ps,ot):addVariableDefinition(lt,ps,nt)}break}case"DISCONTINUITY-SEQUENCE":gt=parseInt(is);break;case"KEY":{const ps=parseKey(is,nt,lt);if(ps.isSupported()){if(ps.method==="NONE"){Xr=void 0;break}Xr||(Xr={}),Xr[ps.keyFormat]&&(Xr=_extends({},Xr)),Xr[ps.keyFormat]=ps}else logger.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${is}"`);break}case"START":lt.startTimeOffset=parseStartTimeOffset(is);break;case"MAP":{const ps=new AttrList(is);if(substituteVariablesInAttributes(lt,ps,["BYTERANGE","URI"]),Yr.duration){const vs=new Fragment(it,nt);setInitSegment(vs,ps,rt,Xr),ct=vs,Yr.initSegment=ct,ct.rawProgramDateTime&&!Yr.rawProgramDateTime&&(Yr.rawProgramDateTime=ct.rawProgramDateTime)}else{const vs=Yr.byteRangeEndOffset;if(vs){const ls=Yr.byteRangeStartOffset;_i=`${vs-ls}@${ls}`}else _i=null;setInitSegment(Yr,ps,rt,Xr),ct=Yr,Qr=!0}break}case"SERVER-CONTROL":{const ps=new AttrList(is);lt.canBlockReload=ps.bool("CAN-BLOCK-RELOAD"),lt.canSkipUntil=ps.optionalFloat("CAN-SKIP-UNTIL",0),lt.canSkipDateRanges=lt.canSkipUntil>0&&ps.bool("CAN-SKIP-DATERANGES"),lt.partHoldBack=ps.optionalFloat("PART-HOLD-BACK",0),lt.holdBack=ps.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const ps=new AttrList(is);lt.partTarget=ps.decimalFloatingPoint("PART-TARGET");break}case"PART":{let ps=lt.partList;ps||(ps=lt.partList=[]);const vs=ft>0?ps[ps.length-1]:void 0,ls=ft++,gs=new AttrList(is);substituteVariablesInAttributes(lt,gs,["BYTERANGE","URI"]);const us=new Part(gs,Yr,nt,ls,vs);ps.push(us),Yr.duration+=us.duration;break}case"PRELOAD-HINT":{const ps=new AttrList(is);substituteVariablesInAttributes(lt,ps,["URI"]),lt.preloadHint=ps;break}case"RENDITION-REPORT":{const ps=new AttrList(is);substituteVariablesInAttributes(lt,ps,["URI"]),lt.renditionReports=lt.renditionReports||[],lt.renditionReports.push(ps);break}default:logger.warn(`line parsed but not handled: ${mt}`);break}}}_r&&!_r.relurl?(ut.pop(),pt-=_r.duration,lt.partList&&(lt.fragmentHint=_r)):lt.partList&&(assignProgramDateTime(Yr,_r),Yr.cc=gt,lt.fragmentHint=Yr,Xr&&setFragLevelKeys(Yr,Xr,lt));const rs=ut.length,ns=ut[0],ss=ut[rs-1];if(pt+=lt.skippedSegments*lt.targetduration,pt>0&&rs&&ss){lt.averagetargetduration=pt/rs;const fs=ss.sn;lt.endSN=fs!=="initSegment"?fs:0,lt.live||(ss.endList=!0),ns&&(lt.startCC=ns.cc)}else lt.endSN=0,lt.startCC=0;return lt.fragmentHint&&(pt+=lt.fragmentHint.duration),lt.totalduration=pt,lt.endCC=gt,Zr>0&&backfillProgramDateTimes(ut,Zr),lt}}function parseKey(tt,et,nt){var rt,it;const st=new AttrList(tt);substituteVariablesInAttributes(nt,st,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const ot=(rt=st.METHOD)!=null?rt:"",lt=st.URI,ut=st.hexadecimalInteger("IV"),ct=st.KEYFORMATVERSIONS,dt=(it=st.KEYFORMAT)!=null?it:"identity";lt&&st.IV&&!ut&&logger.error(`Invalid IV: ${st.IV}`);const ft=lt?M3U8Parser.resolve(lt,et):"",pt=(ct||"1").split("/").map(Number).filter(Number.isFinite);return new LevelKey(ot,ft,dt,pt,ut)}function parseStartTimeOffset(tt){const nt=new AttrList(tt).decimalFloatingPoint("TIME-OFFSET");return isFiniteNumber(nt)?nt:null}function setCodecs(tt,et){let nt=(tt||"").split(/[ ,]+/).filter(rt=>rt);["video","audio","text"].forEach(rt=>{const it=nt.filter(st=>isCodecType(st,rt));it.length&&(et[`${rt}Codec`]=it.join(","),nt=nt.filter(st=>it.indexOf(st)===-1))}),et.unknownCodecs=nt}function assignCodec(tt,et,nt){const rt=et[nt];rt&&(tt[nt]=rt)}function backfillProgramDateTimes(tt,et){let nt=tt[et];for(let rt=et;rt--;){const it=tt[rt];if(!it)return;it.programDateTime=nt.programDateTime-it.duration*1e3,nt=it}}function assignProgramDateTime(tt,et){tt.rawProgramDateTime?tt.programDateTime=Date.parse(tt.rawProgramDateTime):et!=null&&et.programDateTime&&(tt.programDateTime=et.endProgramDateTime),isFiniteNumber(tt.programDateTime)||(tt.programDateTime=null,tt.rawProgramDateTime=null)}function setInitSegment(tt,et,nt,rt){tt.relurl=et.URI,et.BYTERANGE&&tt.setByteRange(et.BYTERANGE),tt.level=nt,tt.sn="initSegment",rt&&(tt.levelkeys=rt),tt.initSegment=null}function setFragLevelKeys(tt,et,nt){tt.levelkeys=et;const{encryptedFragments:rt}=nt;(!rt.length||rt[rt.length-1].levelkeys!==et)&&Object.keys(et).some(it=>et[it].isCommonEncryption)&&rt.push(tt)}var PlaylistContextType={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},PlaylistLevelType={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function mapContextToLevelType(tt){const{type:et}=tt;switch(et){case PlaylistContextType.AUDIO_TRACK:return PlaylistLevelType.AUDIO;case PlaylistContextType.SUBTITLE_TRACK:return PlaylistLevelType.SUBTITLE;default:return PlaylistLevelType.MAIN}}function getResponseUrl(tt,et){let nt=tt.url;return(nt===void 0||nt.indexOf("data:")===0)&&(nt=et.url),nt}class PlaylistLoader{constructor(et){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=et,this.registerListeners()}startLoad(et){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:et}=this;et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.LEVEL_LOADING,this.onLevelLoading,this),et.on(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),et.on(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:et}=this;et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.LEVEL_LOADING,this.onLevelLoading,this),et.off(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),et.off(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(et){const nt=this.hls.config,rt=nt.pLoader,it=nt.loader,st=rt||it,ot=new st(nt);return this.loaders[et.type]=ot,ot}getInternalLoader(et){return this.loaders[et.type]}resetInternalLoader(et){this.loaders[et]&&delete this.loaders[et]}destroyInternalLoaders(){for(const et in this.loaders){const nt=this.loaders[et];nt&&nt.destroy(),this.resetInternalLoader(et)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(et,nt){const{url:rt}=nt;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:PlaylistContextType.MANIFEST,url:rt,deliveryDirectives:null})}onLevelLoading(et,nt){const{id:rt,level:it,pathwayId:st,url:ot,deliveryDirectives:lt}=nt;this.load({id:rt,level:it,pathwayId:st,responseType:"text",type:PlaylistContextType.LEVEL,url:ot,deliveryDirectives:lt})}onAudioTrackLoading(et,nt){const{id:rt,groupId:it,url:st,deliveryDirectives:ot}=nt;this.load({id:rt,groupId:it,level:null,responseType:"text",type:PlaylistContextType.AUDIO_TRACK,url:st,deliveryDirectives:ot})}onSubtitleTrackLoading(et,nt){const{id:rt,groupId:it,url:st,deliveryDirectives:ot}=nt;this.load({id:rt,groupId:it,level:null,responseType:"text",type:PlaylistContextType.SUBTITLE_TRACK,url:st,deliveryDirectives:ot})}load(et){var nt;const rt=this.hls.config;let it=this.getInternalLoader(et);if(it){const ct=it.context;if(ct&&ct.url===et.url&&ct.level===et.level){logger.trace("[playlist-loader]: playlist request ongoing");return}logger.log(`[playlist-loader]: aborting previous loader for type: ${et.type}`),it.abort()}let st;if(et.type===PlaylistContextType.MANIFEST?st=rt.manifestLoadPolicy.default:st=_extends({},rt.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),it=this.createInternalLoader(et),isFiniteNumber((nt=et.deliveryDirectives)==null?void 0:nt.part)){let ct;if(et.type===PlaylistContextType.LEVEL&&et.level!==null?ct=this.hls.levels[et.level].details:et.type===PlaylistContextType.AUDIO_TRACK&&et.id!==null?ct=this.hls.audioTracks[et.id].details:et.type===PlaylistContextType.SUBTITLE_TRACK&&et.id!==null&&(ct=this.hls.subtitleTracks[et.id].details),ct){const dt=ct.partTarget,ft=ct.targetduration;if(dt&&ft){const pt=Math.max(dt*3,ft*.8)*1e3;st=_extends({},st,{maxTimeToFirstByteMs:Math.min(pt,st.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(pt,st.maxTimeToFirstByteMs)})}}}const ot=st.errorRetry||st.timeoutRetry||{},lt={loadPolicy:st,timeout:st.maxLoadTimeMs,maxRetry:ot.maxNumRetry||0,retryDelay:ot.retryDelayMs||0,maxRetryDelay:ot.maxRetryDelayMs||0},ut={onSuccess:(ct,dt,ft,pt)=>{const gt=this.getInternalLoader(ft);this.resetInternalLoader(ft.type);const _r=ct.data;if(_r.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(ct,ft,new Error("no EXTM3U delimiter"),pt||null,dt);return}dt.parsing.start=performance.now(),M3U8Parser.isMediaPlaylist(_r)?this.handleTrackOrLevelPlaylist(ct,dt,ft,pt||null,gt):this.handleMasterPlaylist(ct,dt,ft,pt)},onError:(ct,dt,ft,pt)=>{this.handleNetworkError(dt,ft,!1,ct,pt)},onTimeout:(ct,dt,ft)=>{this.handleNetworkError(dt,ft,!0,void 0,ct)}};it.load(et,lt,ut)}handleMasterPlaylist(et,nt,rt,it){const st=this.hls,ot=et.data,lt=getResponseUrl(et,rt),ut=M3U8Parser.parseMasterPlaylist(ot,lt);if(ut.playlistParsingError){this.handleManifestParsingError(et,rt,ut.playlistParsingError,it,nt);return}const{contentSteering:ct,levels:dt,sessionData:ft,sessionKeys:pt,startTimeOffset:gt,variableList:_r}=ut;this.variableList=_r;const{AUDIO:Yr=[],SUBTITLES:mt,"CLOSED-CAPTIONS":Kr}=M3U8Parser.parseMasterPlaylistMedia(ot,lt,ut);Yr.length&&!Yr.some(Zr=>!Zr.url)&&dt[0].audioCodec&&!dt[0].attrs.AUDIO&&(logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),Yr.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new AttrList({}),bitrate:0,url:""})),st.trigger(Events.MANIFEST_LOADED,{levels:dt,audioTracks:Yr,subtitles:mt,captions:Kr,contentSteering:ct,url:lt,stats:nt,networkDetails:it,sessionData:ft,sessionKeys:pt,startTimeOffset:gt,variableList:_r})}handleTrackOrLevelPlaylist(et,nt,rt,it,st){const ot=this.hls,{id:lt,level:ut,type:ct}=rt,dt=getResponseUrl(et,rt),ft=0,pt=isFiniteNumber(ut)?ut:isFiniteNumber(lt)?lt:0,gt=mapContextToLevelType(rt),_r=M3U8Parser.parseLevelPlaylist(et.data,dt,pt,gt,ft,this.variableList);if(ct===PlaylistContextType.MANIFEST){const Yr={attrs:new AttrList({}),bitrate:0,details:_r,name:"",url:dt};ot.trigger(Events.MANIFEST_LOADED,{levels:[Yr],audioTracks:[],url:dt,stats:nt,networkDetails:it,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}nt.parsing.end=performance.now(),rt.levelDetails=_r,this.handlePlaylistLoaded(_r,et,nt,rt,it,st)}handleManifestParsingError(et,nt,rt,it,st){this.hls.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.MANIFEST_PARSING_ERROR,fatal:nt.type===PlaylistContextType.MANIFEST,url:et.url,err:rt,error:rt,reason:rt.message,response:et,context:nt,networkDetails:it,stats:st})}handleNetworkError(et,nt,rt=!1,it,st){let ot=`A network ${rt?"timeout":"error"+(it?" (status "+it.code+")":"")} occurred while loading ${et.type}`;et.type===PlaylistContextType.LEVEL?ot+=`: ${et.level} id: ${et.id}`:(et.type===PlaylistContextType.AUDIO_TRACK||et.type===PlaylistContextType.SUBTITLE_TRACK)&&(ot+=` id: ${et.id} group-id: "${et.groupId}"`);const lt=new Error(ot);logger.warn(`[playlist-loader]: ${ot}`);let ut=ErrorDetails.UNKNOWN,ct=!1;const dt=this.getInternalLoader(et);switch(et.type){case PlaylistContextType.MANIFEST:ut=rt?ErrorDetails.MANIFEST_LOAD_TIMEOUT:ErrorDetails.MANIFEST_LOAD_ERROR,ct=!0;break;case PlaylistContextType.LEVEL:ut=rt?ErrorDetails.LEVEL_LOAD_TIMEOUT:ErrorDetails.LEVEL_LOAD_ERROR,ct=!1;break;case PlaylistContextType.AUDIO_TRACK:ut=rt?ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,ct=!1;break;case PlaylistContextType.SUBTITLE_TRACK:ut=rt?ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:ErrorDetails.SUBTITLE_LOAD_ERROR,ct=!1;break}dt&&this.resetInternalLoader(et.type);const ft={type:ErrorTypes.NETWORK_ERROR,details:ut,fatal:ct,url:et.url,loader:dt,context:et,error:lt,networkDetails:nt,stats:st};if(it){const pt=(nt==null?void 0:nt.url)||et.url;ft.response=_objectSpread2({url:pt,data:void 0},it)}this.hls.trigger(Events.ERROR,ft)}handlePlaylistLoaded(et,nt,rt,it,st,ot){const lt=this.hls,{type:ut,level:ct,id:dt,groupId:ft,deliveryDirectives:pt}=it,gt=getResponseUrl(nt,it),_r=mapContextToLevelType(it),Yr=typeof it.level=="number"&&_r===PlaylistLevelType.MAIN?ct:void 0;if(!et.fragments.length){const Kr=new Error("No Segments found in Playlist");lt.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:gt,error:Kr,reason:Kr.message,response:nt,context:it,level:Yr,parent:_r,networkDetails:st,stats:rt});return}et.targetduration||(et.playlistParsingError=new Error("Missing Target Duration"));const mt=et.playlistParsingError;if(mt){lt.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_PARSING_ERROR,fatal:!1,url:gt,error:mt,reason:mt.message,response:nt,context:it,level:Yr,parent:_r,networkDetails:st,stats:rt});return}switch(et.live&&ot&&(ot.getCacheAge&&(et.ageHeader=ot.getCacheAge()||0),(!ot.getCacheAge||isNaN(et.ageHeader))&&(et.ageHeader=0)),ut){case PlaylistContextType.MANIFEST:case PlaylistContextType.LEVEL:lt.trigger(Events.LEVEL_LOADED,{details:et,level:Yr||0,id:dt||0,stats:rt,networkDetails:st,deliveryDirectives:pt});break;case PlaylistContextType.AUDIO_TRACK:lt.trigger(Events.AUDIO_TRACK_LOADED,{details:et,id:dt||0,groupId:ft||"",stats:rt,networkDetails:st,deliveryDirectives:pt});break;case PlaylistContextType.SUBTITLE_TRACK:lt.trigger(Events.SUBTITLE_TRACK_LOADED,{details:et,id:dt||0,groupId:ft||"",stats:rt,networkDetails:st,deliveryDirectives:pt});break}}}function sendAddTrackEvent(tt,et){let nt;try{nt=new Event("addtrack")}catch{nt=document.createEvent("Event"),nt.initEvent("addtrack",!1,!1)}nt.track=tt,et.dispatchEvent(nt)}function addCueToTrack(tt,et){const nt=tt.mode;if(nt==="disabled"&&(tt.mode="hidden"),tt.cues&&!tt.cues.getCueById(et.id))try{if(tt.addCue(et),!tt.cues.getCueById(et.id))throw new Error(`addCue is failed for: ${et}`)}catch(rt){logger.debug(`[texttrack-utils]: ${rt}`);try{const it=new self.TextTrackCue(et.startTime,et.endTime,et.text);it.id=et.id,tt.addCue(it)}catch(it){logger.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${it}`)}}nt==="disabled"&&(tt.mode=nt)}function clearCurrentCues(tt){const et=tt.mode;if(et==="disabled"&&(tt.mode="hidden"),tt.cues)for(let nt=tt.cues.length;nt--;)tt.removeCue(tt.cues[nt]);et==="disabled"&&(tt.mode=et)}function removeCuesInRange(tt,et,nt,rt){const it=tt.mode;if(it==="disabled"&&(tt.mode="hidden"),tt.cues&&tt.cues.length>0){const st=getCuesInRange(tt.cues,et,nt);for(let ot=0;ot<st.length;ot++)(!rt||rt(st[ot]))&&tt.removeCue(st[ot])}it==="disabled"&&(tt.mode=it)}function getFirstCueIndexAfterTime(tt,et){if(et<tt[0].startTime)return 0;const nt=tt.length-1;if(et>tt[nt].endTime)return-1;let rt=0,it=nt;for(;rt<=it;){const st=Math.floor((it+rt)/2);if(et<tt[st].startTime)it=st-1;else if(et>tt[st].startTime&&rt<nt)rt=st+1;else return st}return tt[rt].startTime-et<et-tt[it].startTime?rt:it}function getCuesInRange(tt,et,nt){const rt=[],it=getFirstCueIndexAfterTime(tt,et);if(it>-1)for(let st=it,ot=tt.length;st<ot;st++){const lt=tt[st];if(lt.startTime>=et&&lt.endTime<=nt)rt.push(lt);else if(lt.startTime>nt)return rt}return rt}function filterSubtitleTracks(tt){const et=[];for(let nt=0;nt<tt.length;nt++){const rt=tt[nt];(rt.kind==="subtitles"||rt.kind==="captions")&&rt.label&&et.push(tt[nt])}return et}var MetadataSchema={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const MIN_CUE_DURATION=.25;function getCueClass(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function createCueWithDataFields(tt,et,nt,rt,it){let st=new tt(et,nt,"");try{st.value=rt,it&&(st.type=it)}catch{st=new tt(et,nt,JSON.stringify(it?_objectSpread2({type:it},rt):rt))}return st}const MAX_CUE_ENDTIME=(()=>{const tt=getCueClass();try{tt&&new tt(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function dateRangeDateToTimelineSeconds(tt,et){return tt.getTime()/1e3-et}function hexToArrayBuffer(tt){return Uint8Array.from(tt.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class ID3TrackController{constructor(et){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=et,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:et}=this;et.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),et.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),et.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:et}=this;et.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),et.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),et.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(et,nt){this.media=nt.media}onMediaDetaching(){this.id3Track&&(clearCurrentCues(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(et){const nt=this.getID3Track(et.textTracks);return nt.mode="hidden",nt}getID3Track(et){if(this.media){for(let nt=0;nt<et.length;nt++){const rt=et[nt];if(rt.kind==="metadata"&&rt.label==="id3")return sendAddTrackEvent(rt,this.media),rt}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(et,nt){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:rt,enableID3MetadataCues:it}}}=this;if(!rt&&!it)return;const{samples:st}=nt;this.id3Track||(this.id3Track=this.createTrack(this.media));const ot=getCueClass();if(ot)for(let lt=0;lt<st.length;lt++){const ut=st[lt].type;if(ut===MetadataSchema.emsg&&!rt||!it)continue;const ct=getID3Frames(st[lt].data);if(ct){const dt=st[lt].pts;let ft=dt+st[lt].duration;ft>MAX_CUE_ENDTIME&&(ft=MAX_CUE_ENDTIME),ft-dt<=0&&(ft=dt+MIN_CUE_DURATION);for(let gt=0;gt<ct.length;gt++){const _r=ct[gt];if(!isTimeStampFrame(_r)){this.updateId3CueEnds(dt,ut);const Yr=createCueWithDataFields(ot,dt,ft,_r,ut);Yr&&this.id3Track.addCue(Yr)}}}}}updateId3CueEnds(et,nt){var rt;const it=(rt=this.id3Track)==null?void 0:rt.cues;if(it)for(let st=it.length;st--;){const ot=it[st];ot.type===nt&&ot.startTime<et&&ot.endTime===MAX_CUE_ENDTIME&&(ot.endTime=et)}}onBufferFlushing(et,{startOffset:nt,endOffset:rt,type:it}){const{id3Track:st,hls:ot}=this;if(!ot)return;const{config:{enableEmsgMetadataCues:lt,enableID3MetadataCues:ut}}=ot;if(st&&(lt||ut)){let ct;it==="audio"?ct=dt=>dt.type===MetadataSchema.audioId3&&ut:it==="video"?ct=dt=>dt.type===MetadataSchema.emsg&&lt:ct=dt=>dt.type===MetadataSchema.audioId3&&ut||dt.type===MetadataSchema.emsg&&lt,removeCuesInRange(st,nt,rt,ct)}}onLevelUpdated(et,{details:nt}){if(!this.media||!nt.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:rt,id3Track:it}=this,{dateRanges:st}=nt,ot=Object.keys(st);if(it){const dt=Object.keys(rt).filter(ft=>!ot.includes(ft));for(let ft=dt.length;ft--;){const pt=dt[ft];Object.keys(rt[pt].cues).forEach(gt=>{it.removeCue(rt[pt].cues[gt])}),delete rt[pt]}}const lt=nt.fragments[nt.fragments.length-1];if(ot.length===0||!isFiniteNumber(lt==null?void 0:lt.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const ut=lt.programDateTime/1e3-lt.start,ct=getCueClass();for(let dt=0;dt<ot.length;dt++){const ft=ot[dt],pt=st[ft],gt=dateRangeDateToTimelineSeconds(pt.startDate,ut),_r=rt[ft],Yr=(_r==null?void 0:_r.cues)||{};let mt=(_r==null?void 0:_r.durationKnown)||!1,Kr=MAX_CUE_ENDTIME;const Xr=pt.endDate;if(Xr)Kr=dateRangeDateToTimelineSeconds(Xr,ut),mt=!0;else if(pt.endOnNext&&!mt){const Qr=ot.reduce((_i,rs)=>{if(rs!==pt.id){const ns=st[rs];if(ns.class===pt.class&&ns.startDate>pt.startDate&&(!_i||pt.startDate<_i.startDate))return ns}return _i},null);Qr&&(Kr=dateRangeDateToTimelineSeconds(Qr.startDate,ut),mt=!0)}const Zr=Object.keys(pt.attr);for(let Qr=0;Qr<Zr.length;Qr++){const _i=Zr[Qr];if(!isDateRangeCueAttribute(_i))continue;const rs=Yr[_i];if(rs)mt&&!_r.durationKnown&&(rs.endTime=Kr);else if(ct){let ns=pt.attr[_i];isSCTE35Attribute(_i)&&(ns=hexToArrayBuffer(ns));const ss=createCueWithDataFields(ct,gt,Kr,{key:_i,data:ns},MetadataSchema.dateRange);ss&&(ss.id=ft,this.id3Track.addCue(ss),Yr[_i]=ss)}}rt[ft]={cues:Yr,dateRange:pt,durationKnown:mt}}}}class LatencyController{constructor(et){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=et,this.config=et.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:et,levelDetails:nt}=this;return et.liveMaxLatencyDuration!==void 0?et.liveMaxLatencyDuration:nt?et.liveMaxLatencyDurationCount*nt.targetduration:0}get targetLatency(){const{levelDetails:et}=this;if(et===null)return null;const{holdBack:nt,partHoldBack:rt,targetduration:it}=et,{liveSyncDuration:st,liveSyncDurationCount:ot,lowLatencyMode:lt}=this.config,ut=this.hls.userConfig;let ct=lt&&rt||nt;(ut.liveSyncDuration||ut.liveSyncDurationCount||ct===0)&&(ct=st!==void 0?st:ot*it);const dt=it;return ct+Math.min(this.stallCount*1,dt)}get liveSyncPosition(){const et=this.estimateLiveEdge(),nt=this.targetLatency,rt=this.levelDetails;if(et===null||nt===null||rt===null)return null;const it=rt.edge,st=et-nt-this.edgeStalled,ot=it-rt.totalduration,lt=it-(this.config.lowLatencyMode&&rt.partTarget||rt.targetduration);return Math.min(Math.max(ot,st),lt)}get drift(){const{levelDetails:et}=this;return et===null?1:et.drift}get edgeStalled(){const{levelDetails:et}=this;if(et===null)return 0;const nt=(this.config.lowLatencyMode&&et.partTarget||et.targetduration)*3;return Math.max(et.age-nt,0)}get forwardBufferLength(){const{media:et,levelDetails:nt}=this;if(!et||!nt)return 0;const rt=et.buffered.length;return(rt?et.buffered.end(rt-1):nt.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(Events.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(Events.ERROR,this.onError,this)}onMediaAttached(et,nt){this.media=nt.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(et,{details:nt}){this.levelDetails=nt,nt.advanced&&this.timeupdate(),!nt.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(et,nt){var rt;nt.details===ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,(rt=this.levelDetails)!=null&&rt.live&&logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:et,levelDetails:nt}=this;if(!et||!nt)return;this.currentTime=et.currentTime;const rt=this.computeLatency();if(rt===null)return;this._latency=rt;const{lowLatencyMode:it,maxLiveSyncPlaybackRate:st}=this.config;if(!it||st===1||!nt.live)return;const ot=this.targetLatency;if(ot===null)return;const lt=rt-ot,ut=Math.min(this.maxLatency,ot+nt.targetduration);if(lt<ut&&lt>.05&&this.forwardBufferLength>1){const dt=Math.min(2,Math.max(1,st)),ft=Math.round(2/(1+Math.exp(-.75*lt-this.edgeStalled))*20)/20;et.playbackRate=Math.min(dt,Math.max(1,ft))}else et.playbackRate!==1&&et.playbackRate!==0&&(et.playbackRate=1)}estimateLiveEdge(){const{levelDetails:et}=this;return et===null?null:et.edge+et.age}computeLatency(){const et=this.estimateLiveEdge();return et===null?null:et-this.currentTime}}const HdcpLevels=["NONE","TYPE-0","TYPE-1",null];function isHdcpLevel(tt){return HdcpLevels.indexOf(tt)>-1}const VideoRangeValues=["SDR","PQ","HLG"];function isVideoRange(tt){return!!tt&&VideoRangeValues.indexOf(tt)>-1}var HlsSkip={No:"",Yes:"YES",v2:"v2"};function getSkipValue(tt,et){const{canSkipUntil:nt,canSkipDateRanges:rt,endSN:it}=tt,st=et!==void 0?et-it:0;return nt&&st<nt?rt?HlsSkip.v2:HlsSkip.Yes:HlsSkip.No}class HlsUrlParameters{constructor(et,nt,rt){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=et,this.part=nt,this.skip=rt}addDirectives(et){const nt=new self.URL(et);return this.msn!==void 0&&nt.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&nt.searchParams.set("_HLS_part",this.part.toString()),this.skip&&nt.searchParams.set("_HLS_skip",this.skip),nt.href}}class Level{constructor(et){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[et.url],this._attrs=[et.attrs],this.bitrate=et.bitrate,et.details&&(this.details=et.details),this.id=et.id||0,this.name=et.name,this.width=et.width||0,this.height=et.height||0,this.frameRate=et.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=et.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=et.audioCodec,this.videoCodec=et.videoCodec,this.codecSet=[et.videoCodec,et.audioCodec].filter(nt=>!!nt).map(nt=>nt.substring(0,4)).join(","),this.addGroupId("audio",et.attrs.AUDIO),this.addGroupId("text",et.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(et){return hasGroup(this._audioGroups,et)}hasSubtitleGroup(et){return hasGroup(this._subtitleGroups,et)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(et,nt){if(nt){if(et==="audio"){let rt=this._audioGroups;rt||(rt=this._audioGroups=[]),rt.indexOf(nt)===-1&&rt.push(nt)}else if(et==="text"){let rt=this._subtitleGroups;rt||(rt=this._subtitleGroups=[]),rt.indexOf(nt)===-1&&rt.push(nt)}}}get urlId(){return 0}set urlId(et){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var et;return(et=this.audioGroups)==null?void 0:et[0]}get textGroupId(){var et;return(et=this.subtitleGroups)==null?void 0:et[0]}addFallback(){}}function hasGroup(tt,et){return!et||!tt?!1:tt.indexOf(et)!==-1}function updateFromToPTS(tt,et){const nt=et.startPTS;if(isFiniteNumber(nt)){let rt=0,it;et.sn>tt.sn?(rt=nt-tt.start,it=tt):(rt=tt.start-nt,it=et),it.duration!==rt&&(it.duration=rt)}else et.sn>tt.sn?tt.cc===et.cc&&tt.minEndPTS?et.start=tt.start+(tt.minEndPTS-tt.start):et.start=tt.start+tt.duration:et.start=Math.max(tt.start-et.duration,0)}function updateFragPTSDTS(tt,et,nt,rt,it,st){rt-nt<=0&&(logger.warn("Fragment should have a positive duration",et),rt=nt+et.duration,st=it+et.duration);let lt=nt,ut=rt;const ct=et.startPTS,dt=et.endPTS;if(isFiniteNumber(ct)){const mt=Math.abs(ct-nt);isFiniteNumber(et.deltaPTS)?et.deltaPTS=Math.max(mt,et.deltaPTS):et.deltaPTS=mt,lt=Math.max(nt,ct),nt=Math.min(nt,ct),it=Math.min(it,et.startDTS),ut=Math.min(rt,dt),rt=Math.max(rt,dt),st=Math.max(st,et.endDTS)}const ft=nt-et.start;et.start!==0&&(et.start=nt),et.duration=rt-et.start,et.startPTS=nt,et.maxStartPTS=lt,et.startDTS=it,et.endPTS=rt,et.minEndPTS=ut,et.endDTS=st;const pt=et.sn;if(!tt||pt<tt.startSN||pt>tt.endSN)return 0;let gt;const _r=pt-tt.startSN,Yr=tt.fragments;for(Yr[_r]=et,gt=_r;gt>0;gt--)updateFromToPTS(Yr[gt],Yr[gt-1]);for(gt=_r;gt<Yr.length-1;gt++)updateFromToPTS(Yr[gt],Yr[gt+1]);return tt.fragmentHint&&updateFromToPTS(Yr[Yr.length-1],tt.fragmentHint),tt.PTSKnown=tt.alignedSliding=!0,ft}function mergeDetails(tt,et){let nt=null;const rt=tt.fragments;for(let ut=rt.length-1;ut>=0;ut--){const ct=rt[ut].initSegment;if(ct){nt=ct;break}}tt.fragmentHint&&delete tt.fragmentHint.endPTS;let it=0,st;if(mapFragmentIntersection(tt,et,(ut,ct)=>{ut.relurl&&(it=ut.cc-ct.cc),isFiniteNumber(ut.startPTS)&&isFiniteNumber(ut.endPTS)&&(ct.start=ct.startPTS=ut.startPTS,ct.startDTS=ut.startDTS,ct.maxStartPTS=ut.maxStartPTS,ct.endPTS=ut.endPTS,ct.endDTS=ut.endDTS,ct.minEndPTS=ut.minEndPTS,ct.duration=ut.endPTS-ut.startPTS,ct.duration&&(st=ct),et.PTSKnown=et.alignedSliding=!0),ct.elementaryStreams=ut.elementaryStreams,ct.loader=ut.loader,ct.stats=ut.stats,ut.initSegment&&(ct.initSegment=ut.initSegment,nt=ut.initSegment)}),nt&&(et.fragmentHint?et.fragments.concat(et.fragmentHint):et.fragments).forEach(ct=>{var dt;ct&&(!ct.initSegment||ct.initSegment.relurl===((dt=nt)==null?void 0:dt.relurl))&&(ct.initSegment=nt)}),et.skippedSegments)if(et.deltaUpdateFailed=et.fragments.some(ut=>!ut),et.deltaUpdateFailed){logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let ut=et.skippedSegments;ut--;)et.fragments.shift();et.startSN=et.fragments[0].sn,et.startCC=et.fragments[0].cc}else et.canSkipDateRanges&&(et.dateRanges=mergeDateRanges(tt.dateRanges,et.dateRanges,et.recentlyRemovedDateranges));const ot=et.fragments;if(it){logger.warn("discontinuity sliding from playlist, take drift into account");for(let ut=0;ut<ot.length;ut++)ot[ut].cc+=it}et.skippedSegments&&(et.startCC=et.fragments[0].cc),mapPartIntersection(tt.partList,et.partList,(ut,ct)=>{ct.elementaryStreams=ut.elementaryStreams,ct.stats=ut.stats}),st?updateFragPTSDTS(et,st,st.startPTS,st.endPTS,st.startDTS,st.endDTS):adjustSliding(tt,et),ot.length&&(et.totalduration=et.edge-ot[0].start),et.driftStartTime=tt.driftStartTime,et.driftStart=tt.driftStart;const lt=et.advancedDateTime;if(et.advanced&&lt){const ut=et.edge;et.driftStart||(et.driftStartTime=lt,et.driftStart=ut),et.driftEndTime=lt,et.driftEnd=ut}else et.driftEndTime=tt.driftEndTime,et.driftEnd=tt.driftEnd,et.advancedDateTime=tt.advancedDateTime}function mergeDateRanges(tt,et,nt){const rt=_extends({},tt);return nt&&nt.forEach(it=>{delete rt[it]}),Object.keys(et).forEach(it=>{const st=new DateRange(et[it].attr,rt[it]);st.isValid?rt[it]=st:logger.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(et[it].attr)}"`)}),rt}function mapPartIntersection(tt,et,nt){if(tt&&et){let rt=0;for(let it=0,st=tt.length;it<=st;it++){const ot=tt[it],lt=et[it+rt];ot&&lt&&ot.index===lt.index&&ot.fragment.sn===lt.fragment.sn?nt(ot,lt):rt--}}}function mapFragmentIntersection(tt,et,nt){const rt=et.skippedSegments,it=Math.max(tt.startSN,et.startSN)-et.startSN,st=(tt.fragmentHint?1:0)+(rt?et.endSN:Math.min(tt.endSN,et.endSN))-et.startSN,ot=et.startSN-tt.startSN,lt=et.fragmentHint?et.fragments.concat(et.fragmentHint):et.fragments,ut=tt.fragmentHint?tt.fragments.concat(tt.fragmentHint):tt.fragments;for(let ct=it;ct<=st;ct++){const dt=ut[ot+ct];let ft=lt[ct];rt&&!ft&&ct<rt&&(ft=et.fragments[ct]=dt),dt&&ft&&nt(dt,ft)}}function adjustSliding(tt,et){const nt=et.startSN+et.skippedSegments-tt.startSN,rt=tt.fragments;nt<0||nt>=rt.length||addSliding(et,rt[nt].start)}function addSliding(tt,et){if(et){const nt=tt.fragments;for(let rt=tt.skippedSegments;rt<nt.length;rt++)nt[rt].start+=et;tt.fragmentHint&&(tt.fragmentHint.start+=et)}}function computeReloadInterval(tt,et=1/0){let nt=1e3*tt.targetduration;if(tt.updated){const rt=tt.fragments;if(rt.length&&nt*4>et){const st=rt[rt.length-1].duration*1e3;st<nt&&(nt=st)}}else nt/=2;return Math.round(nt)}function getFragmentWithSN(tt,et,nt){if(!(tt!=null&&tt.details))return null;const rt=tt.details;let it=rt.fragments[et-rt.startSN];return it||(it=rt.fragmentHint,it&&it.sn===et)?it:et<rt.startSN&&nt&&nt.sn===et?nt:null}function getPartWith(tt,et,nt){var rt;return tt!=null&&tt.details?findPart((rt=tt.details)==null?void 0:rt.partList,et,nt):null}function findPart(tt,et,nt){if(tt)for(let rt=tt.length;rt--;){const it=tt[rt];if(it.index===nt&&it.fragment.sn===et)return it}return null}function reassignFragmentLevelIndexes(tt){tt.forEach((et,nt)=>{const{details:rt}=et;rt!=null&&rt.fragments&&rt.fragments.forEach(it=>{it.level=nt})})}function isTimeoutError(tt){switch(tt.details){case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_TIMEOUT:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function getRetryConfig(tt,et){const nt=isTimeoutError(et);return tt.default[`${nt?"timeout":"error"}Retry`]}function getRetryDelay(tt,et){const nt=tt.backoff==="linear"?1:Math.pow(2,et);return Math.min(nt*tt.retryDelayMs,tt.maxRetryDelayMs)}function getLoaderConfigWithoutReties(tt){return _objectSpread2(_objectSpread2({},tt),{errorRetry:null,timeoutRetry:null})}function shouldRetry(tt,et,nt,rt){if(!tt)return!1;const it=rt==null?void 0:rt.code,st=et<tt.maxNumRetry&&(retryForHttpStatus(it)||!!nt);return tt.shouldRetry?tt.shouldRetry(tt,et,nt,rt,st):st}function retryForHttpStatus(tt){return tt===0&&navigator.onLine===!1||!!tt&&(tt<400||tt>499)}const BinarySearch={search:function(tt,et){let nt=0,rt=tt.length-1,it=null,st=null;for(;nt<=rt;){it=(nt+rt)/2|0,st=tt[it];const ot=et(st);if(ot>0)nt=it+1;else if(ot<0)rt=it-1;else return st}return null}};function findFragmentByPDT(tt,et,nt){if(et===null||!Array.isArray(tt)||!tt.length||!isFiniteNumber(et))return null;const rt=tt[0].programDateTime;if(et<(rt||0))return null;const it=tt[tt.length-1].endProgramDateTime;if(et>=(it||0))return null;nt=nt||0;for(let st=0;st<tt.length;++st){const ot=tt[st];if(pdtWithinToleranceTest(et,nt,ot))return ot}return null}function findFragmentByPTS(tt,et,nt=0,rt=0){let it=null;if(tt){it=et[tt.sn-et[0].sn+1]||null;const ot=tt.endDTS-nt;ot>0&&ot<15e-7&&(nt+=15e-7)}else nt===0&&et[0].start===0&&(it=et[0]);if(it&&(!tt||tt.level===it.level)&&fragmentWithinToleranceTest(nt,rt,it)===0)return it;const st=BinarySearch.search(et,fragmentWithinToleranceTest.bind(null,nt,rt));return st&&(st!==tt||!it)?st:it}function fragmentWithinToleranceTest(tt=0,et=0,nt){if(nt.start<=tt&&nt.start+nt.duration>tt)return 0;const rt=Math.min(et,nt.duration+(nt.deltaPTS?nt.deltaPTS:0));return nt.start+nt.duration-rt<=tt?1:nt.start-rt>tt&&nt.start?-1:0}function pdtWithinToleranceTest(tt,et,nt){const rt=Math.min(et,nt.duration+(nt.deltaPTS?nt.deltaPTS:0))*1e3;return(nt.endProgramDateTime||0)-rt>tt}function findFragWithCC(tt,et){return BinarySearch.search(tt,nt=>nt.cc<et?1:nt.cc>et?-1:0)}var NetworkErrorAction={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},ErrorActionFlags={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class ErrorController{constructor(et){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=et,this.log=logger.log.bind(logger,"[info]:"),this.warn=logger.warn.bind(logger,"[warning]:"),this.error=logger.error.bind(logger,"[error]:"),this.registerListeners()}registerListeners(){const et=this.hls;et.on(Events.ERROR,this.onError,this),et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const et=this.hls;et&&(et.off(Events.ERROR,this.onError,this),et.off(Events.ERROR,this.onErrorOut,this),et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(et){}stopLoad(){this.playlistError=0}getVariantLevelIndex(et){return(et==null?void 0:et.type)===PlaylistLevelType.MAIN?et.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(et,nt){var rt,it;if(nt.fatal)return;const st=this.hls,ot=nt.context;switch(nt.details){case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:nt.errorAction=this.getFragRetryOrSwitchAction(nt);return;case ErrorDetails.FRAG_PARSING_ERROR:if((rt=nt.frag)!=null&&rt.gap){nt.errorAction={action:NetworkErrorAction.DoNothing,flags:ErrorActionFlags.None};return}case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_DECRYPT_ERROR:{nt.errorAction=this.getFragRetryOrSwitchAction(nt),nt.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox;return}case ErrorDetails.LEVEL_EMPTY_ERROR:case ErrorDetails.LEVEL_PARSING_ERROR:{var lt,ut;const ct=nt.parent===PlaylistLevelType.MAIN?nt.level:st.loadLevel;nt.details===ErrorDetails.LEVEL_EMPTY_ERROR&&((lt=nt.context)!=null&&(ut=lt.levelDetails)!=null&&ut.live)?nt.errorAction=this.getPlaylistRetryOrSwitchAction(nt,ct):(nt.levelRetry=!1,nt.errorAction=this.getLevelSwitchAction(nt,ct))}return;case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:typeof(ot==null?void 0:ot.level)=="number"&&(nt.errorAction=this.getPlaylistRetryOrSwitchAction(nt,ot.level));return;case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.SUBTITLE_LOAD_ERROR:case ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:if(ot){const ct=st.levels[st.loadLevel];if(ct&&(ot.type===PlaylistContextType.AUDIO_TRACK&&ct.hasAudioGroup(ot.groupId)||ot.type===PlaylistContextType.SUBTITLE_TRACK&&ct.hasSubtitleGroup(ot.groupId))){nt.errorAction=this.getPlaylistRetryOrSwitchAction(nt,st.loadLevel),nt.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox,nt.errorAction.flags=ErrorActionFlags.MoveAllAlternatesMatchingHost;return}}return;case ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const ct=st.levels[st.loadLevel],dt=ct==null?void 0:ct.attrs["HDCP-LEVEL"];dt?nt.errorAction={action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHDCP,hdcpLevel:dt}:this.keySystemError(nt)}return;case ErrorDetails.BUFFER_ADD_CODEC_ERROR:case ErrorDetails.REMUX_ALLOC_ERROR:case ErrorDetails.BUFFER_APPEND_ERROR:nt.errorAction=this.getLevelSwitchAction(nt,(it=nt.level)!=null?it:st.loadLevel);return;case ErrorDetails.INTERNAL_EXCEPTION:case ErrorDetails.BUFFER_APPENDING_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:case ErrorDetails.LEVEL_SWITCH_ERROR:case ErrorDetails.BUFFER_STALLED_ERROR:case ErrorDetails.BUFFER_SEEK_OVER_HOLE:case ErrorDetails.BUFFER_NUDGE_ON_STALL:nt.errorAction={action:NetworkErrorAction.DoNothing,flags:ErrorActionFlags.None};return}nt.type===ErrorTypes.KEY_SYSTEM_ERROR&&this.keySystemError(nt)}keySystemError(et){const nt=this.getVariantLevelIndex(et.frag);et.levelRetry=!1,et.errorAction=this.getLevelSwitchAction(et,nt)}getPlaylistRetryOrSwitchAction(et,nt){const rt=this.hls,it=getRetryConfig(rt.config.playlistLoadPolicy,et),st=this.playlistError++;if(shouldRetry(it,st,isTimeoutError(et),et.response))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:it,retryCount:st};const lt=this.getLevelSwitchAction(et,nt);return it&&(lt.retryConfig=it,lt.retryCount=st),lt}getFragRetryOrSwitchAction(et){const nt=this.hls,rt=this.getVariantLevelIndex(et.frag),it=nt.levels[rt],{fragLoadPolicy:st,keyLoadPolicy:ot}=nt.config,lt=getRetryConfig(et.details.startsWith("key")?ot:st,et),ut=nt.levels.reduce((dt,ft)=>dt+ft.fragmentError,0);if(it&&(et.details!==ErrorDetails.FRAG_GAP&&it.fragmentError++,shouldRetry(lt,ut,isTimeoutError(et),et.response)))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:lt,retryCount:ut};const ct=this.getLevelSwitchAction(et,rt);return lt&&(ct.retryConfig=lt,ct.retryCount=ut),ct}getLevelSwitchAction(et,nt){const rt=this.hls;nt==null&&(nt=rt.loadLevel);const it=this.hls.levels[nt];if(it){var st,ot;const ct=et.details;it.loadError++,ct===ErrorDetails.BUFFER_APPEND_ERROR&&it.fragmentError++;let dt=-1;const{levels:ft,loadLevel:pt,minAutoLevel:gt,maxAutoLevel:_r}=rt;rt.autoLevelEnabled||(rt.loadLevel=-1);const Yr=(st=et.frag)==null?void 0:st.type,Kr=(Yr===PlaylistLevelType.AUDIO&&ct===ErrorDetails.FRAG_PARSING_ERROR||et.sourceBufferName==="audio"&&(ct===ErrorDetails.BUFFER_ADD_CODEC_ERROR||ct===ErrorDetails.BUFFER_APPEND_ERROR))&&ft.some(({audioCodec:rs})=>it.audioCodec!==rs),Zr=et.sourceBufferName==="video"&&(ct===ErrorDetails.BUFFER_ADD_CODEC_ERROR||ct===ErrorDetails.BUFFER_APPEND_ERROR)&&ft.some(({codecSet:rs,audioCodec:ns})=>it.codecSet!==rs&&it.audioCodec===ns),{type:Qr,groupId:_i}=(ot=et.context)!=null?ot:{};for(let rs=ft.length;rs--;){const ns=(rs+pt)%ft.length;if(ns!==pt&&ns>=gt&&ns<=_r&&ft[ns].loadError===0){var lt,ut;const ss=ft[ns];if(ct===ErrorDetails.FRAG_GAP&&et.frag){const fs=ft[ns].details;if(fs){const os=findFragmentByPTS(et.frag,fs.fragments,et.frag.start);if(os!=null&&os.gap)continue}}else{if(Qr===PlaylistContextType.AUDIO_TRACK&&ss.hasAudioGroup(_i)||Qr===PlaylistContextType.SUBTITLE_TRACK&&ss.hasSubtitleGroup(_i))continue;if(Yr===PlaylistLevelType.AUDIO&&(lt=it.audioGroups)!=null&&lt.some(fs=>ss.hasAudioGroup(fs))||Yr===PlaylistLevelType.SUBTITLE&&(ut=it.subtitleGroups)!=null&&ut.some(fs=>ss.hasSubtitleGroup(fs))||Kr&&it.audioCodec===ss.audioCodec||!Kr&&it.audioCodec!==ss.audioCodec||Zr&&it.codecSet===ss.codecSet)continue}dt=ns;break}}if(dt>-1&&rt.loadLevel!==dt)return et.levelRetry=!0,this.playlistError=0,{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.None,nextAutoLevel:dt}}return{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHost}}onErrorOut(et,nt){var rt;switch((rt=nt.errorAction)==null?void 0:rt.action){case NetworkErrorAction.DoNothing:break;case NetworkErrorAction.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(nt),!nt.errorAction.resolved&&nt.details!==ErrorDetails.FRAG_GAP?nt.fatal=!0:/MediaSource readyState: ended/.test(nt.error.message)&&(this.warn(`MediaSource ended after "${nt.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(nt.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(et){const nt=this.hls,rt=et.errorAction;if(!rt)return;const{flags:it,hdcpLevel:st,nextAutoLevel:ot}=rt;switch(it){case ErrorActionFlags.None:this.switchLevel(et,ot);break;case ErrorActionFlags.MoveAllAlternatesMatchingHDCP:st&&(nt.maxHdcpLevel=HdcpLevels[HdcpLevels.indexOf(st)-1],rt.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${nt.maxHdcpLevel}" or lower`);break}rt.resolved||this.switchLevel(et,ot)}switchLevel(et,nt){nt!==void 0&&et.errorAction&&(this.warn(`switching to level ${nt} after ${et.details}`),this.hls.nextAutoLevel=nt,et.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}}class BasePlaylistController{constructor(et,nt){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=logger.log.bind(logger,`${nt}:`),this.warn=logger.warn.bind(logger,`${nt}:`),this.hls=et}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(et,nt){const rt=nt==null?void 0:nt.renditionReports;if(rt){let it=-1;for(let st=0;st<rt.length;st++){const ot=rt[st];let lt;try{lt=new self.URL(ot.URI,nt.url).href}catch(ut){logger.warn(`Could not construct new URL for Rendition Report: ${ut}`),lt=ot.URI||""}if(lt===et){it=st;break}else lt===et.substring(0,lt.length)&&(it=st)}if(it!==-1){const st=rt[it],ot=parseInt(st["LAST-MSN"])||(nt==null?void 0:nt.lastPartSn);let lt=parseInt(st["LAST-PART"])||(nt==null?void 0:nt.lastPartIndex);if(this.hls.config.lowLatencyMode){const ut=Math.min(nt.age-nt.partTarget,nt.targetduration);lt>=0&&ut>nt.partTarget&&(lt+=1)}return new HlsUrlParameters(ot,lt>=0?lt:void 0,HlsSkip.No)}}}loadPlaylist(et){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(et){return this.canLoad&&!!et&&!!et.url&&(!et.details||et.details.live)}shouldReloadPlaylist(et){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(et)}playlistLoaded(et,nt,rt){const{details:it,stats:st}=nt,ot=self.performance.now(),lt=st.loading.first?Math.max(0,ot-st.loading.first):0;if(it.advancedDateTime=Date.now()-lt,it.live||rt!=null&&rt.live){if(it.reloaded(rt),rt&&this.log(`live playlist ${et} ${it.advanced?"REFRESHED "+it.lastPartSn+"-"+it.lastPartIndex:it.updated?"UPDATED":"MISSED"}`),rt&&it.fragments.length>0&&mergeDetails(rt,it),!this.canLoad||!it.live)return;let ut,ct,dt;if(it.canBlockReload&&it.endSN&&it.advanced){const mt=this.hls.config.lowLatencyMode,Kr=it.lastPartSn,Xr=it.endSN,Zr=it.lastPartIndex,Qr=Zr!==-1,_i=Kr===Xr,rs=mt?0:Zr;Qr?(ct=_i?Xr+1:Kr,dt=_i?rs:Zr+1):ct=Xr+1;const ns=it.age,ss=ns+it.ageHeader;let fs=Math.min(ss-it.partTarget,it.targetduration*1.5);if(fs>0){if(rt&&fs>rt.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${rt.tuneInGoal} to: ${fs} with playlist age: ${it.age}`),fs=0;else{const os=Math.floor(fs/it.targetduration);if(ct+=os,dt!==void 0){const is=Math.round(fs%it.targetduration/it.partTarget);dt+=is}this.log(`CDN Tune-in age: ${it.ageHeader}s last advanced ${ns.toFixed(2)}s goal: ${fs} skip sn ${os} to part ${dt}`)}it.tuneInGoal=fs}if(ut=this.getDeliveryDirectives(it,nt.deliveryDirectives,ct,dt),mt||!_i){this.loadPlaylist(ut);return}}else(it.canBlockReload||it.canSkipUntil)&&(ut=this.getDeliveryDirectives(it,nt.deliveryDirectives,ct,dt));const ft=this.hls.mainForwardBufferInfo,pt=ft?ft.end-ft.len:0,gt=(it.edge-pt)*1e3,_r=computeReloadInterval(it,gt);it.updated&&ot>this.requestScheduled+_r&&(this.requestScheduled=st.loading.start),ct!==void 0&&it.canBlockReload?this.requestScheduled=st.loading.first+_r-(it.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+_r<ot?this.requestScheduled=ot:this.requestScheduled-ot<=0&&(this.requestScheduled+=_r);let Yr=this.requestScheduled-ot;Yr=Math.max(0,Yr),this.log(`reload live playlist ${et} in ${Math.round(Yr)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(ut),Yr)}else this.clearTimer()}getDeliveryDirectives(et,nt,rt,it){let st=getSkipValue(et,rt);return nt!=null&&nt.skip&&et.deltaUpdateFailed&&(rt=nt.msn,it=nt.part,st=HlsSkip.No),new HlsUrlParameters(rt,it,st)}checkRetry(et){const nt=et.details,rt=isTimeoutError(et),it=et.errorAction,{action:st,retryCount:ot=0,retryConfig:lt}=it||{},ut=!!it&&!!lt&&(st===NetworkErrorAction.RetryRequest||!it.resolved&&st===NetworkErrorAction.SendAlternateToPenaltyBox);if(ut){var ct;if(this.requestScheduled=-1,ot>=lt.maxNumRetry)return!1;if(rt&&(ct=et.context)!=null&&ct.deliveryDirectives)this.warn(`Retrying playlist loading ${ot+1}/${lt.maxNumRetry} after "${nt}" without delivery-directives`),this.loadPlaylist();else{const dt=getRetryDelay(lt,ot);this.timer=self.setTimeout(()=>this.loadPlaylist(),dt),this.warn(`Retrying playlist loading ${ot+1}/${lt.maxNumRetry} after "${nt}" in ${dt}ms`)}et.levelRetry=!0,it.resolved=!0}return ut}}class EWMA{constructor(et,nt=0,rt=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=et,this.alpha_=et?Math.exp(Math.log(.5)/et):0,this.estimate_=nt,this.totalWeight_=rt}sample(et,nt){const rt=Math.pow(this.alpha_,et);this.estimate_=nt*(1-rt)+rt*this.estimate_,this.totalWeight_+=et}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const et=1-Math.pow(this.alpha_,this.totalWeight_);if(et)return this.estimate_/et}return this.estimate_}}class EwmaBandWidthEstimator{constructor(et,nt,rt,it=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=rt,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new EWMA(et),this.fast_=new EWMA(nt),this.defaultTTFB_=it,this.ttfb_=new EWMA(et)}update(et,nt){const{slow_:rt,fast_:it,ttfb_:st}=this;rt.halfLife!==et&&(this.slow_=new EWMA(et,rt.getEstimate(),rt.getTotalWeight())),it.halfLife!==nt&&(this.fast_=new EWMA(nt,it.getEstimate(),it.getTotalWeight())),st.halfLife!==et&&(this.ttfb_=new EWMA(et,st.getEstimate(),st.getTotalWeight()))}sample(et,nt){et=Math.max(et,this.minDelayMs_);const rt=8*nt,it=et/1e3,st=rt/it;this.fast_.sample(it,st),this.slow_.sample(it,st)}sampleTTFB(et){const nt=et/1e3,rt=Math.sqrt(2)*Math.exp(-Math.pow(nt,2)/2);this.ttfb_.sample(rt,Math.max(et,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}const SUPPORTED_INFO_DEFAULT={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},SUPPORTED_INFO_CACHE={};function requiresMediaCapabilitiesDecodingInfo(tt,et,nt,rt,it,st){const ot=tt.audioCodec?tt.audioGroups:null,lt=st==null?void 0:st.audioCodec,ut=st==null?void 0:st.channels,ct=ut?parseInt(ut):lt?1/0:2;let dt=null;if(ot!=null&&ot.length)try{ot.length===1&&ot[0]?dt=et.groups[ot[0]].channels:dt=ot.reduce((ft,pt)=>{if(pt){const gt=et.groups[pt];if(!gt)throw new Error(`Audio track group ${pt} not found`);Object.keys(gt.channels).forEach(_r=>{ft[_r]=(ft[_r]||0)+gt.channels[_r]})}return ft},{2:0})}catch{return!0}return tt.videoCodec!==void 0&&(tt.width>1920&&tt.height>1088||tt.height>1920&&tt.width>1088||tt.frameRate>Math.max(rt,30)||tt.videoRange!=="SDR"&&tt.videoRange!==nt||tt.bitrate>Math.max(it,8e6))||!!dt&&isFiniteNumber(ct)&&Object.keys(dt).some(ft=>parseInt(ft)>ct)}function getMediaDecodingInfoPromise(tt,et,nt){const rt=tt.videoCodec,it=tt.audioCodec;if(!rt||!it||!nt)return Promise.resolve(SUPPORTED_INFO_DEFAULT);const st={width:tt.width,height:tt.height,bitrate:Math.ceil(Math.max(tt.bitrate*.9,tt.averageBitrate)),framerate:tt.frameRate||30},ot=tt.videoRange;ot!=="SDR"&&(st.transferFunction=ot.toLowerCase());const lt=rt.split(",").map(ut=>({type:"media-source",video:_objectSpread2(_objectSpread2({},st),{},{contentType:mimeTypeForCodec(ut,"video")})}));return it&&tt.audioGroups&&tt.audioGroups.forEach(ut=>{var ct;ut&&((ct=et.groups[ut])==null||ct.tracks.forEach(dt=>{if(dt.groupId===ut){const ft=dt.channels||"",pt=parseFloat(ft);isFiniteNumber(pt)&&pt>2&&lt.push.apply(lt,it.split(",").map(gt=>({type:"media-source",audio:{contentType:mimeTypeForCodec(gt,"audio"),channels:""+pt}})))}}))}),Promise.all(lt.map(ut=>{const ct=getMediaDecodingInfoKey(ut);return SUPPORTED_INFO_CACHE[ct]||(SUPPORTED_INFO_CACHE[ct]=nt.decodingInfo(ut))})).then(ut=>({supported:!ut.some(ct=>!ct.supported),configurations:lt,decodingInfoResults:ut})).catch(ut=>({supported:!1,configurations:lt,decodingInfoResults:[],error:ut}))}function getMediaDecodingInfoKey(tt){const{audio:et,video:nt}=tt,rt=nt||et;if(rt){const it=rt.contentType.split('"')[1];if(nt)return`r${nt.height}x${nt.width}f${Math.ceil(nt.framerate)}${nt.transferFunction||"sd"}_${it}_${Math.ceil(nt.bitrate/1e5)}`;if(et)return`c${et.channels}${et.spatialRendering?"s":"n"}_${it}`}return""}function isHdrSupported(){if(typeof matchMedia=="function"){const tt=matchMedia("(dynamic-range: high)"),et=matchMedia("bad query");if(tt.media!==et.media)return tt.matches===!0}return!1}function getVideoSelectionOptions(tt,et){let nt=!1,rt=[];return tt&&(nt=tt!=="SDR",rt=[tt]),et&&(rt=et.allowedVideoRanges||VideoRangeValues.slice(0),nt=et.preferHDR!==void 0?et.preferHDR:isHdrSupported(),nt?rt=rt.filter(it=>it!=="SDR"):rt=["SDR"]),{preferHDR:nt,allowedVideoRanges:rt}}function getStartCodecTier(tt,et,nt,rt,it){const st=Object.keys(tt),ot=rt==null?void 0:rt.channels,lt=rt==null?void 0:rt.audioCodec,ut=ot&&parseInt(ot)===2;let ct=!0,dt=!1,ft=1/0,pt=1/0,gt=1/0,_r=0,Yr=[];const{preferHDR:mt,allowedVideoRanges:Kr}=getVideoSelectionOptions(et,it);for(let _i=st.length;_i--;){const rs=tt[st[_i]];ct=rs.channels[2]>0,ft=Math.min(ft,rs.minHeight),pt=Math.min(pt,rs.minFramerate),gt=Math.min(gt,rs.minBitrate);const ns=Kr.filter(ss=>rs.videoRanges[ss]>0);ns.length>0&&(dt=!0,Yr=ns)}ft=isFiniteNumber(ft)?ft:0,pt=isFiniteNumber(pt)?pt:0;const Xr=Math.max(1080,ft),Zr=Math.max(30,pt);return gt=isFiniteNumber(gt)?gt:nt,nt=Math.max(gt,nt),dt||(et=void 0,Yr=[]),{codecSet:st.reduce((_i,rs)=>{const ns=tt[rs];if(rs===_i)return _i;if(ns.minBitrate>nt)return logStartCodecCandidateIgnored(rs,`min bitrate of ${ns.minBitrate} > current estimate of ${nt}`),_i;if(!ns.hasDefaultAudio)return logStartCodecCandidateIgnored(rs,"no renditions with default or auto-select sound found"),_i;if(lt&&rs.indexOf(lt.substring(0,4))%5!==0)return logStartCodecCandidateIgnored(rs,`audio codec preference "${lt}" not found`),_i;if(ot&&!ut){if(!ns.channels[ot])return logStartCodecCandidateIgnored(rs,`no renditions with ${ot} channel sound found (channels options: ${Object.keys(ns.channels)})`),_i}else if((!lt||ut)&&ct&&ns.channels[2]===0)return logStartCodecCandidateIgnored(rs,"no renditions with stereo sound found"),_i;return ns.minHeight>Xr?(logStartCodecCandidateIgnored(rs,`min resolution of ${ns.minHeight} > maximum of ${Xr}`),_i):ns.minFramerate>Zr?(logStartCodecCandidateIgnored(rs,`min framerate of ${ns.minFramerate} > maximum of ${Zr}`),_i):Yr.some(ss=>ns.videoRanges[ss]>0)?ns.maxScore<_r?(logStartCodecCandidateIgnored(rs,`max score of ${ns.maxScore} < selected max of ${_r}`),_i):_i&&(codecsSetSelectionPreferenceValue(rs)>=codecsSetSelectionPreferenceValue(_i)||ns.fragmentError>tt[_i].fragmentError)?_i:(_r=ns.maxScore,rs):(logStartCodecCandidateIgnored(rs,`no variants with VIDEO-RANGE of ${JSON.stringify(Yr)} found`),_i)},void 0),videoRanges:Yr,preferHDR:mt,minFramerate:pt,minBitrate:gt}}function logStartCodecCandidateIgnored(tt,et){logger.log(`[abr] start candidates with "${tt}" ignored because ${et}`)}function getAudioTracksByGroup(tt){return tt.reduce((et,nt)=>{let rt=et.groups[nt.groupId];rt||(rt=et.groups[nt.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),rt.tracks.push(nt);const it=nt.channels||"2";return rt.channels[it]=(rt.channels[it]||0)+1,rt.hasDefault=rt.hasDefault||nt.default,rt.hasAutoSelect=rt.hasAutoSelect||nt.autoselect,rt.hasDefault&&(et.hasDefaultAudio=!0),rt.hasAutoSelect&&(et.hasAutoSelectAudio=!0),et},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function getCodecTiers(tt,et,nt,rt){return tt.slice(nt,rt+1).reduce((it,st)=>{if(!st.codecSet)return it;const ot=st.audioGroups;let lt=it[st.codecSet];lt||(it[st.codecSet]=lt={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!ot,fragmentError:0}),lt.minBitrate=Math.min(lt.minBitrate,st.bitrate);const ut=Math.min(st.height,st.width);return lt.minHeight=Math.min(lt.minHeight,ut),lt.minFramerate=Math.min(lt.minFramerate,st.frameRate),lt.maxScore=Math.max(lt.maxScore,st.score),lt.fragmentError+=st.fragmentError,lt.videoRanges[st.videoRange]=(lt.videoRanges[st.videoRange]||0)+1,ot&&ot.forEach(ct=>{if(!ct)return;const dt=et.groups[ct];lt.hasDefaultAudio=lt.hasDefaultAudio||et.hasDefaultAudio?dt.hasDefault:dt.hasAutoSelect||!et.hasDefaultAudio&&!et.hasAutoSelectAudio,Object.keys(dt.channels).forEach(ft=>{lt.channels[ft]=(lt.channels[ft]||0)+dt.channels[ft]})}),it},{})}function findMatchingOption(tt,et,nt){if("attrs"in tt){const rt=et.indexOf(tt);if(rt!==-1)return rt}for(let rt=0;rt<et.length;rt++){const it=et[rt];if(matchesOption(tt,it,nt))return rt}return-1}function matchesOption(tt,et,nt){const{groupId:rt,name:it,lang:st,assocLang:ot,characteristics:lt,default:ut}=tt,ct=tt.forced;return(rt===void 0||et.groupId===rt)&&(it===void 0||et.name===it)&&(st===void 0||et.lang===st)&&(st===void 0||et.assocLang===ot)&&(ut===void 0||et.default===ut)&&(ct===void 0||et.forced===ct)&&(lt===void 0||characteristicsMatch(lt,et.characteristics))&&(nt===void 0||nt(tt,et))}function characteristicsMatch(tt,et=""){const nt=tt.split(","),rt=et.split(",");return nt.length===rt.length&&!nt.some(it=>rt.indexOf(it)===-1)}function audioMatchPredicate(tt,et){const{audioCodec:nt,channels:rt}=tt;return(nt===void 0||(et.audioCodec||"").substring(0,4)===nt.substring(0,4))&&(rt===void 0||rt===(et.channels||"2"))}function findClosestLevelWithAudioGroup(tt,et,nt,rt,it){const st=et[rt],lt=et.reduce((pt,gt,_r)=>{const Yr=gt.uri;return(pt[Yr]||(pt[Yr]=[])).push(_r),pt},{})[st.uri];lt.length>1&&(rt=Math.max.apply(Math,lt));const ut=st.videoRange,ct=st.frameRate,dt=st.codecSet.substring(0,4),ft=searchDownAndUpList(et,rt,pt=>{if(pt.videoRange!==ut||pt.frameRate!==ct||pt.codecSet.substring(0,4)!==dt)return!1;const gt=pt.audioGroups,_r=nt.filter(Yr=>!gt||gt.indexOf(Yr.groupId)!==-1);return findMatchingOption(tt,_r,it)>-1});return ft>-1?ft:searchDownAndUpList(et,rt,pt=>{const gt=pt.audioGroups,_r=nt.filter(Yr=>!gt||gt.indexOf(Yr.groupId)!==-1);return findMatchingOption(tt,_r,it)>-1})}function searchDownAndUpList(tt,et,nt){for(let rt=et;rt;rt--)if(nt(tt[rt]))return rt;for(let rt=et+1;rt<tt.length;rt++)if(nt(tt[rt]))return rt;return-1}class AbrController{constructor(et){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=()=>{const{fragCurrent:nt,partCurrent:rt,hls:it}=this,{autoLevelEnabled:st,media:ot}=it;if(!nt||!ot)return;const lt=performance.now(),ut=rt?rt.stats:nt.stats,ct=rt?rt.duration:nt.duration,dt=lt-ut.loading.start,ft=it.minAutoLevel;if(ut.aborted||ut.loaded&&ut.loaded===ut.total||nt.level<=ft){this.clearTimer(),this._nextAutoLevel=-1;return}if(!st||ot.paused||!ot.playbackRate||!ot.readyState)return;const pt=it.mainForwardBufferInfo;if(pt===null)return;const gt=this.bwEstimator.getEstimateTTFB(),_r=Math.abs(ot.playbackRate);if(dt<=Math.max(gt,1e3*(ct/(_r*2))))return;const Yr=pt.len/_r,mt=ut.loading.first?ut.loading.first-ut.loading.start:-1,Kr=ut.loaded&&mt>-1,Xr=this.getBwEstimate(),Zr=it.levels,Qr=Zr[nt.level],_i=ut.total||Math.max(ut.loaded,Math.round(ct*Qr.averageBitrate/8));let rs=Kr?dt-mt:dt;rs<1&&Kr&&(rs=Math.min(dt,ut.loaded*8/Xr));const ns=Kr?ut.loaded*1e3/rs:0,ss=ns?(_i-ut.loaded)/ns:_i*8/Xr+gt/1e3;if(ss<=Yr)return;const fs=ns?ns*8:Xr;let os=Number.POSITIVE_INFINITY,is;for(is=nt.level-1;is>ft;is--){const ps=Zr[is].maxBitrate;if(os=this.getTimeToLoadFrag(gt/1e3,fs,ct*ps,!Zr[is].details),os<Yr)break}if(os>=ss||os>ct*10)return;it.nextLoadLevel=it.nextAutoLevel=is,Kr?this.bwEstimator.sample(dt-Math.min(gt,mt),ut.loaded):this.bwEstimator.sampleTTFB(dt);const cs=Zr[is].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>cs&&this.resetEstimator(cs),this.clearTimer(),logger.warn(`[abr] Fragment ${nt.sn}${rt?" part "+rt.index:""} of level ${nt.level} is loading too slowly;
      Time to underbuffer: ${Yr.toFixed(3)} s
      Estimated load time for current fragment: ${ss.toFixed(3)} s
      Estimated load time for down switch fragment: ${os.toFixed(3)} s
      TTFB estimate: ${mt|0} ms
      Current BW estimate: ${isFiniteNumber(Xr)?Xr|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${is} @ ${cs|0} bps`),it.trigger(Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:nt,part:rt,stats:ut})},this.hls=et,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(et){et&&(logger.log(`setting initial bwe to ${et}`),this.hls.config.abrEwmaDefaultEstimate=et),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const et=this.hls.config;return new EwmaBandWidthEstimator(et.abrEwmaSlowVoD,et.abrEwmaFastVoD,et.abrEwmaDefaultEstimate)}registerListeners(){const{hls:et}=this;et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.FRAG_LOADING,this.onFragLoading,this),et.on(Events.FRAG_LOADED,this.onFragLoaded,this),et.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),et.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),et.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),et.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),et.on(Events.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),et.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:et}=this;et&&(et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.FRAG_LOADING,this.onFragLoading,this),et.off(Events.FRAG_LOADED,this.onFragLoaded,this),et.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),et.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),et.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),et.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),et.off(Events.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),et.off(Events.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(et,nt){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(et,nt){const rt=nt.frag;if(!this.ignoreFragment(rt)){if(!rt.bitrateTest){var it;this.fragCurrent=rt,this.partCurrent=(it=nt.part)!=null?it:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(et,nt){this.clearTimer()}onError(et,nt){if(!nt.fatal)switch(nt.details){case ErrorDetails.BUFFER_ADD_CODEC_ERROR:case ErrorDetails.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case ErrorDetails.FRAG_LOAD_TIMEOUT:{const rt=nt.frag,{fragCurrent:it,partCurrent:st}=this;if(rt&&it&&rt.sn===it.sn&&rt.level===it.level){const ot=performance.now(),lt=st?st.stats:rt.stats,ut=ot-lt.loading.start,ct=lt.loading.first?lt.loading.first-lt.loading.start:-1;if(lt.loaded&&ct>-1){const ft=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(ut-Math.min(ft,ct),lt.loaded)}else this.bwEstimator.sampleTTFB(ut)}break}}}getTimeToLoadFrag(et,nt,rt,it){const st=et+rt/nt,ot=it?this.lastLevelLoadSec:0;return st+ot}onLevelLoaded(et,nt){const rt=this.hls.config,{loading:it}=nt.stats,st=it.end-it.start;isFiniteNumber(st)&&(this.lastLevelLoadSec=st/1e3),nt.details.live?this.bwEstimator.update(rt.abrEwmaSlowLive,rt.abrEwmaFastLive):this.bwEstimator.update(rt.abrEwmaSlowVoD,rt.abrEwmaFastVoD)}onFragLoaded(et,{frag:nt,part:rt}){const it=rt?rt.stats:nt.stats;if(nt.type===PlaylistLevelType.MAIN&&this.bwEstimator.sampleTTFB(it.loading.first-it.loading.start),!this.ignoreFragment(nt)){if(this.clearTimer(),nt.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const st=rt?rt.duration:nt.duration,ot=this.hls.levels[nt.level],lt=(ot.loaded?ot.loaded.bytes:0)+it.loaded,ut=(ot.loaded?ot.loaded.duration:0)+st;ot.loaded={bytes:lt,duration:ut},ot.realBitrate=Math.round(8*lt/ut)}if(nt.bitrateTest){const st={stats:it,frag:nt,part:rt,id:nt.type};this.onFragBuffered(Events.FRAG_BUFFERED,st),nt.bitrateTest=!1}else this.lastLoadedFragLevel=nt.level}}onFragBuffered(et,nt){const{frag:rt,part:it}=nt,st=it!=null&&it.stats.loaded?it.stats:rt.stats;if(st.aborted||this.ignoreFragment(rt))return;const ot=st.parsing.end-st.loading.start-Math.min(st.loading.first-st.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(ot,st.loaded),st.bwEstimate=this.getBwEstimate(),rt.bitrateTest?this.bitrateTestDelay=ot/1e3:this.bitrateTestDelay=0}ignoreFragment(et){return et.type!==PlaylistLevelType.MAIN||et.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:et,minAutoLevel:nt}=this.hls,rt=this.getBwEstimate(),it=this.hls.config.maxStarvationDelay,st=this.findBestLevel(rt,nt,et,0,it,1,1);if(st>-1)return st;const ot=this.hls.firstLevel,lt=Math.min(Math.max(ot,nt),et);return logger.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${ot} clamped to ${lt}`),lt}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const et=this.forcedAutoLevel,rt=this.bwEstimator.canEstimate(),it=this.lastLoadedFragLevel>-1;if(et!==-1&&(!rt||!it||this.nextAutoLevelKey===this.getAutoLevelKey()))return et;const st=rt&&it?this.getNextABRAutoLevel():this.firstAutoLevel;if(et!==-1){const ot=this.hls.levels;if(ot.length>Math.max(et,st)&&ot[et].loadError<=ot[st].loadError)return et}return this._nextAutoLevel=st,this.nextAutoLevelKey=this.getAutoLevelKey(),st}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:et,partCurrent:nt,hls:rt}=this,{maxAutoLevel:it,config:st,minAutoLevel:ot}=rt,lt=nt?nt.duration:et?et.duration:0,ut=this.getBwEstimate(),ct=this.getStarvationDelay();let dt=st.abrBandWidthFactor,ft=st.abrBandWidthUpFactor;if(ct){const mt=this.findBestLevel(ut,ot,it,ct,0,dt,ft);if(mt>=0)return mt}let pt=lt?Math.min(lt,st.maxStarvationDelay):st.maxStarvationDelay;if(!ct){const mt=this.bitrateTestDelay;mt&&(pt=(lt?Math.min(lt,st.maxLoadingDelay):st.maxLoadingDelay)-mt,logger.info(`[abr] bitrate test took ${Math.round(1e3*mt)}ms, set first fragment max fetchDuration to ${Math.round(1e3*pt)} ms`),dt=ft=1)}const gt=this.findBestLevel(ut,ot,it,ct,pt,dt,ft);if(logger.info(`[abr] ${ct?"rebuffering expected":"buffer is empty"}, optimal quality level ${gt}`),gt>-1)return gt;const _r=rt.levels[ot],Yr=rt.levels[rt.loadLevel];return(_r==null?void 0:_r.bitrate)<(Yr==null?void 0:Yr.bitrate)?ot:rt.loadLevel}getStarvationDelay(){const et=this.hls,nt=et.media;if(!nt)return 1/0;const rt=nt&&nt.playbackRate!==0?Math.abs(nt.playbackRate):1,it=et.mainForwardBufferInfo;return(it?it.len:0)/rt}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(et,nt,rt,it,st,ot,lt){var ut;const ct=it+st,dt=this.lastLoadedFragLevel,ft=dt===-1?this.hls.firstLevel:dt,{fragCurrent:pt,partCurrent:gt}=this,{levels:_r,allAudioTracks:Yr,loadLevel:mt,config:Kr}=this.hls;if(_r.length===1)return 0;const Xr=_r[ft],Zr=!!(Xr!=null&&(ut=Xr.details)!=null&&ut.live),Qr=mt===-1||dt===-1;let _i,rs="SDR",ns=(Xr==null?void 0:Xr.frameRate)||0;const{audioPreference:ss,videoPreference:fs}=Kr,os=this.audioTracksByGroup||(this.audioTracksByGroup=getAudioTracksByGroup(Yr));if(Qr){if(this.firstSelection!==-1)return this.firstSelection;const ls=this.codecTiers||(this.codecTiers=getCodecTiers(_r,os,nt,rt)),gs=getStartCodecTier(ls,rs,et,ss,fs),{codecSet:us,videoRanges:ms,minFramerate:ys,minBitrate:Es,preferHDR:Ts}=gs;_i=us,rs=Ts?ms[ms.length-1]:ms[0],ns=ys,et=Math.max(et,Es),logger.log(`[abr] picked start tier ${JSON.stringify(gs)}`)}else _i=Xr==null?void 0:Xr.codecSet,rs=Xr==null?void 0:Xr.videoRange;const is=gt?gt.duration:pt?pt.duration:0,cs=this.bwEstimator.getEstimateTTFB()/1e3,ps=[];for(let ls=rt;ls>=nt;ls--){var vs;const gs=_r[ls],us=ls>ft;if(!gs)continue;if(Kr.useMediaCapabilities&&!gs.supportedResult&&!gs.supportedPromise){const Cs=navigator.mediaCapabilities;typeof(Cs==null?void 0:Cs.decodingInfo)=="function"&&requiresMediaCapabilitiesDecodingInfo(gs,os,rs,ns,et,ss)?(gs.supportedPromise=getMediaDecodingInfoPromise(gs,os,Cs),gs.supportedPromise.then(Is=>{if(!this.hls)return;gs.supportedResult=Is;const ks=this.hls.levels,_s=ks.indexOf(gs);Is.error?logger.warn(`[abr] MediaCapabilities decodingInfo error: "${Is.error}" for level ${_s} ${JSON.stringify(Is)}`):Is.supported||(logger.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${_s} ${JSON.stringify(Is)}`),_s>-1&&ks.length>1&&(logger.log(`[abr] Removing unsupported level ${_s}`),this.hls.removeLevel(_s)))})):gs.supportedResult=SUPPORTED_INFO_DEFAULT}if(_i&&gs.codecSet!==_i||rs&&gs.videoRange!==rs||us&&ns>gs.frameRate||!us&&ns>0&&ns<gs.frameRate||gs.supportedResult&&!((vs=gs.supportedResult.decodingInfoResults)!=null&&vs[0].smooth)){ps.push(ls);continue}const ms=gs.details,ys=(gt?ms==null?void 0:ms.partTarget:ms==null?void 0:ms.averagetargetduration)||is;let Es;us?Es=lt*et:Es=ot*et;const Ts=is&&it>=is*2&&st===0?_r[ls].averageBitrate:_r[ls].maxBitrate,Ss=this.getTimeToLoadFrag(cs,Es,Ts*ys,ms===void 0);if(Es>=Ts&&(ls===dt||gs.loadError===0&&gs.fragmentError===0)&&(Ss<=cs||!isFiniteNumber(Ss)||Zr&&!this.bitrateTestDelay||Ss<ct)){const Cs=this.forcedAutoLevel;return ls!==mt&&(Cs===-1||Cs!==mt)&&(ps.length&&logger.trace(`[abr] Skipped level(s) ${ps.join(",")} of ${rt} max with CODECS and VIDEO-RANGE:"${_r[ps[0]].codecs}" ${_r[ps[0]].videoRange}; not compatible with "${Xr.codecs}" ${rs}`),logger.info(`[abr] switch candidate:${ft}->${ls} adjustedbw(${Math.round(Es)})-bitrate=${Math.round(Es-Ts)} ttfb:${cs.toFixed(1)} avgDuration:${ys.toFixed(1)} maxFetchDuration:${ct.toFixed(1)} fetchDuration:${Ss.toFixed(1)} firstSelection:${Qr} codecSet:${_i} videoRange:${rs} hls.loadLevel:${mt}`)),Qr&&(this.firstSelection=ls),ls}}return-1}set nextAutoLevel(et){const{maxAutoLevel:nt,minAutoLevel:rt}=this.hls,it=Math.min(Math.max(et,rt),nt);this._nextAutoLevel!==it&&(this.nextAutoLevelKey="",this._nextAutoLevel=it)}}class TaskLoop{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(et){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,et),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}var FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class FragmentTracker{constructor(et){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=et,this._registerListeners()}_registerListeners(){const{hls:et}=this;et.on(Events.BUFFER_APPENDED,this.onBufferAppended,this),et.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),et.on(Events.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:et}=this;et.off(Events.BUFFER_APPENDED,this.onBufferAppended,this),et.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),et.off(Events.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(et,nt){const rt=this.activePartLists[nt];if(rt)for(let it=rt.length;it--;){const st=rt[it];if(!st)break;const ot=st.end;if(st.start<=et&&ot!==null&&et<=ot)return st}return this.getBufferedFrag(et,nt)}getBufferedFrag(et,nt){const{fragments:rt}=this,it=Object.keys(rt);for(let st=it.length;st--;){const ot=rt[it[st]];if((ot==null?void 0:ot.body.type)===nt&&ot.buffered){const lt=ot.body;if(lt.start<=et&&et<=lt.end)return lt}}return null}detectEvictedFragments(et,nt,rt,it){this.timeRanges&&(this.timeRanges[et]=nt);const st=(it==null?void 0:it.fragment.sn)||-1;Object.keys(this.fragments).forEach(ot=>{const lt=this.fragments[ot];if(!lt||st>=lt.body.sn)return;if(!lt.buffered&&!lt.loaded){lt.body.type===rt&&this.removeFragment(lt.body);return}const ut=lt.range[et];ut&&ut.time.some(ct=>{const dt=!this.isTimeBuffered(ct.startPTS,ct.endPTS,nt);return dt&&this.removeFragment(lt.body),dt})})}detectPartialFragments(et){const nt=this.timeRanges,{frag:rt,part:it}=et;if(!nt||rt.sn==="initSegment")return;const st=getFragmentKey(rt),ot=this.fragments[st];if(!ot||ot.buffered&&rt.gap)return;const lt=!rt.relurl;Object.keys(nt).forEach(ut=>{const ct=rt.elementaryStreams[ut];if(!ct)return;const dt=nt[ut],ft=lt||ct.partial===!0;ot.range[ut]=this.getBufferedTimes(rt,it,ft,dt)}),ot.loaded=null,Object.keys(ot.range).length?(ot.buffered=!0,(ot.body.endList=rt.endList||ot.body.endList)&&(this.endListFragments[ot.body.type]=ot),isPartial(ot)||this.removeParts(rt.sn-1,rt.type)):this.removeFragment(ot.body)}removeParts(et,nt){const rt=this.activePartLists[nt];rt&&(this.activePartLists[nt]=rt.filter(it=>it.fragment.sn>=et))}fragBuffered(et,nt){const rt=getFragmentKey(et);let it=this.fragments[rt];!it&&nt&&(it=this.fragments[rt]={body:et,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},et.gap&&(this.hasGaps=!0)),it&&(it.loaded=null,it.buffered=!0)}getBufferedTimes(et,nt,rt,it){const st={time:[],partial:rt},ot=et.start,lt=et.end,ut=et.minEndPTS||lt,ct=et.maxStartPTS||ot;for(let dt=0;dt<it.length;dt++){const ft=it.start(dt)-this.bufferPadding,pt=it.end(dt)+this.bufferPadding;if(ct>=ft&&ut<=pt){st.time.push({startPTS:Math.max(ot,it.start(dt)),endPTS:Math.min(lt,it.end(dt))});break}else if(ot<pt&&lt>ft){const gt=Math.max(ot,it.start(dt)),_r=Math.min(lt,it.end(dt));_r>gt&&(st.partial=!0,st.time.push({startPTS:gt,endPTS:_r}))}else if(lt<=ft)break}return st}getPartialFragment(et){let nt=null,rt,it,st,ot=0;const{bufferPadding:lt,fragments:ut}=this;return Object.keys(ut).forEach(ct=>{const dt=ut[ct];dt&&isPartial(dt)&&(it=dt.body.start-lt,st=dt.body.end+lt,et>=it&&et<=st&&(rt=Math.min(et-it,st-et),ot<=rt&&(nt=dt.body,ot=rt)))}),nt}isEndListAppended(et){const nt=this.endListFragments[et];return nt!==void 0&&(nt.buffered||isPartial(nt))}getState(et){const nt=getFragmentKey(et),rt=this.fragments[nt];return rt?rt.buffered?isPartial(rt)?FragmentState.PARTIAL:FragmentState.OK:FragmentState.APPENDING:FragmentState.NOT_LOADED}isTimeBuffered(et,nt,rt){let it,st;for(let ot=0;ot<rt.length;ot++){if(it=rt.start(ot)-this.bufferPadding,st=rt.end(ot)+this.bufferPadding,et>=it&&nt<=st)return!0;if(nt<=it)return!1}return!1}onFragLoaded(et,nt){const{frag:rt,part:it}=nt;if(rt.sn==="initSegment"||rt.bitrateTest)return;const st=it?null:nt,ot=getFragmentKey(rt);this.fragments[ot]={body:rt,appendedPTS:null,loaded:st,buffered:!1,range:Object.create(null)}}onBufferAppended(et,nt){const{frag:rt,part:it,timeRanges:st}=nt;if(rt.sn==="initSegment")return;const ot=rt.type;if(it){let lt=this.activePartLists[ot];lt||(this.activePartLists[ot]=lt=[]),lt.push(it)}this.timeRanges=st,Object.keys(st).forEach(lt=>{const ut=st[lt];this.detectEvictedFragments(lt,ut,ot,it)})}onFragBuffered(et,nt){this.detectPartialFragments(nt)}hasFragment(et){const nt=getFragmentKey(et);return!!this.fragments[nt]}hasParts(et){var nt;return!!((nt=this.activePartLists[et])!=null&&nt.length)}removeFragmentsInRange(et,nt,rt,it,st){it&&!this.hasGaps||Object.keys(this.fragments).forEach(ot=>{const lt=this.fragments[ot];if(!lt)return;const ut=lt.body;ut.type!==rt||it&&!ut.gap||ut.start<nt&&ut.end>et&&(lt.buffered||st)&&this.removeFragment(ut)})}removeFragment(et){const nt=getFragmentKey(et);et.stats.loaded=0,et.clearElementaryStreamInfo();const rt=this.activePartLists[et.type];if(rt){const it=et.sn;this.activePartLists[et.type]=rt.filter(st=>st.fragment.sn!==it)}delete this.fragments[nt],et.endList&&delete this.endListFragments[et.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function isPartial(tt){var et,nt,rt;return tt.buffered&&(tt.body.gap||((et=tt.range.video)==null?void 0:et.partial)||((nt=tt.range.audio)==null?void 0:nt.partial)||((rt=tt.range.audiovideo)==null?void 0:rt.partial))}function getFragmentKey(tt){return`${tt.type}_${tt.level}_${tt.sn}`}const noopBuffered={length:0,start:()=>0,end:()=>0};class BufferHelper{static isBuffered(et,nt){try{if(et){const rt=BufferHelper.getBuffered(et);for(let it=0;it<rt.length;it++)if(nt>=rt.start(it)&&nt<=rt.end(it))return!0}}catch{}return!1}static bufferInfo(et,nt,rt){try{if(et){const it=BufferHelper.getBuffered(et),st=[];let ot;for(ot=0;ot<it.length;ot++)st.push({start:it.start(ot),end:it.end(ot)});return this.bufferedInfo(st,nt,rt)}}catch{}return{len:0,start:nt,end:nt,nextStart:void 0}}static bufferedInfo(et,nt,rt){nt=Math.max(0,nt),et.sort(function(ct,dt){const ft=ct.start-dt.start;return ft||dt.end-ct.end});let it=[];if(rt)for(let ct=0;ct<et.length;ct++){const dt=it.length;if(dt){const ft=it[dt-1].end;et[ct].start-ft<rt?et[ct].end>ft&&(it[dt-1].end=et[ct].end):it.push(et[ct])}else it.push(et[ct])}else it=et;let st=0,ot,lt=nt,ut=nt;for(let ct=0;ct<it.length;ct++){const dt=it[ct].start,ft=it[ct].end;if(nt+rt>=dt&&nt<ft)lt=dt,ut=ft,st=ut-nt;else if(nt+rt<dt){ot=dt;break}}return{len:st,start:lt||0,end:ut||0,nextStart:ot}}static getBuffered(et){try{return et.buffered}catch(nt){return logger.log("failed to get media.buffered",nt),noopBuffered}}}class ChunkMetadata{constructor(et,nt,rt,it=0,st=-1,ot=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=getNewPerformanceTiming(),this.buffering={audio:getNewPerformanceTiming(),video:getNewPerformanceTiming(),audiovideo:getNewPerformanceTiming()},this.level=et,this.sn=nt,this.id=rt,this.size=it,this.part=st,this.partial=ot}}function getNewPerformanceTiming(){return{start:0,executeStart:0,executeEnd:0,end:0}}function findFirstFragWithCC(tt,et){for(let rt=0,it=tt.length;rt<it;rt++){var nt;if(((nt=tt[rt])==null?void 0:nt.cc)===et)return tt[rt]}return null}function shouldAlignOnDiscontinuities(tt,et,nt){return!!(et&&(nt.endCC>nt.startCC||tt&&tt.cc<nt.startCC))}function findDiscontinuousReferenceFrag(tt,et){const nt=tt.fragments,rt=et.fragments;if(!rt.length||!nt.length){logger.log("No fragments to align");return}const it=findFirstFragWithCC(nt,rt[0].cc);if(!it||it&&!it.startPTS){logger.log("No frag in previous level to align on");return}return it}function adjustFragmentStart(tt,et){if(tt){const nt=tt.start+et;tt.start=tt.startPTS=nt,tt.endPTS=nt+tt.duration}}function adjustSlidingStart(tt,et){const nt=et.fragments;for(let rt=0,it=nt.length;rt<it;rt++)adjustFragmentStart(nt[rt],tt);et.fragmentHint&&adjustFragmentStart(et.fragmentHint,tt),et.alignedSliding=!0}function alignStream(tt,et,nt){et&&(alignDiscontinuities(tt,nt,et),!nt.alignedSliding&&et&&alignMediaPlaylistByPDT(nt,et),!nt.alignedSliding&&et&&!nt.skippedSegments&&adjustSliding(et,nt))}function alignDiscontinuities(tt,et,nt){if(shouldAlignOnDiscontinuities(tt,nt,et)){const rt=findDiscontinuousReferenceFrag(nt,et);rt&&isFiniteNumber(rt.start)&&(logger.log(`Adjusting PTS using last level due to CC increase within current level ${et.url}`),adjustSlidingStart(rt.start,et))}}function alignMediaPlaylistByPDT(tt,et){if(!tt.hasProgramDateTime||!et.hasProgramDateTime)return;const nt=tt.fragments,rt=et.fragments;if(!nt.length||!rt.length)return;let it,st;const ot=Math.min(et.endCC,tt.endCC);et.startCC<ot&&tt.startCC<ot&&(it=findFirstFragWithCC(rt,ot),st=findFirstFragWithCC(nt,ot)),(!it||!st)&&(it=rt[Math.floor(rt.length/2)],st=findFirstFragWithCC(nt,it.cc)||nt[Math.floor(nt.length/2)]);const lt=it.programDateTime,ut=st.programDateTime;if(!lt||!ut)return;const ct=(ut-lt)/1e3-(st.start-it.start);adjustSlidingStart(ct,tt)}const MIN_CHUNK_SIZE=Math.pow(2,17);class FragmentLoader{constructor(et){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=et}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(et,nt){const rt=et.url;if(!rt)return Promise.reject(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:et,error:new Error(`Fragment does not have a ${rt?"part list":"url"}`),networkDetails:null}));this.abort();const it=this.config,st=it.fLoader,ot=it.loader;return new Promise((lt,ut)=>{if(this.loader&&this.loader.destroy(),et.gap)if(et.tagList.some(gt=>gt[0]==="GAP")){ut(createGapLoadError(et));return}else et.gap=!1;const ct=this.loader=et.loader=st?new st(it):new ot(it),dt=createLoaderContext(et),ft=getLoaderConfigWithoutReties(it.fragLoadPolicy.default),pt={loadPolicy:ft,timeout:ft.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:et.sn==="initSegment"?1/0:MIN_CHUNK_SIZE};et.stats=ct.stats,ct.load(dt,pt,{onSuccess:(gt,_r,Yr,mt)=>{this.resetLoader(et,ct);let Kr=gt.data;Yr.resetIV&&et.decryptdata&&(et.decryptdata.iv=new Uint8Array(Kr.slice(0,16)),Kr=Kr.slice(16)),lt({frag:et,part:null,payload:Kr,networkDetails:mt})},onError:(gt,_r,Yr,mt)=>{this.resetLoader(et,ct),ut(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:et,response:_objectSpread2({url:rt,data:void 0},gt),error:new Error(`HTTP Error ${gt.code} ${gt.text}`),networkDetails:Yr,stats:mt}))},onAbort:(gt,_r,Yr)=>{this.resetLoader(et,ct),ut(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:et,error:new Error("Aborted"),networkDetails:Yr,stats:gt}))},onTimeout:(gt,_r,Yr)=>{this.resetLoader(et,ct),ut(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:et,error:new Error(`Timeout after ${pt.timeout}ms`),networkDetails:Yr,stats:gt}))},onProgress:(gt,_r,Yr,mt)=>{nt&&nt({frag:et,part:null,payload:Yr,networkDetails:mt})}})})}loadPart(et,nt,rt){this.abort();const it=this.config,st=it.fLoader,ot=it.loader;return new Promise((lt,ut)=>{if(this.loader&&this.loader.destroy(),et.gap||nt.gap){ut(createGapLoadError(et,nt));return}const ct=this.loader=et.loader=st?new st(it):new ot(it),dt=createLoaderContext(et,nt),ft=getLoaderConfigWithoutReties(it.fragLoadPolicy.default),pt={loadPolicy:ft,timeout:ft.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:MIN_CHUNK_SIZE};nt.stats=ct.stats,ct.load(dt,pt,{onSuccess:(gt,_r,Yr,mt)=>{this.resetLoader(et,ct),this.updateStatsFromPart(et,nt);const Kr={frag:et,part:nt,payload:gt.data,networkDetails:mt};rt(Kr),lt(Kr)},onError:(gt,_r,Yr,mt)=>{this.resetLoader(et,ct),ut(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:et,part:nt,response:_objectSpread2({url:dt.url,data:void 0},gt),error:new Error(`HTTP Error ${gt.code} ${gt.text}`),networkDetails:Yr,stats:mt}))},onAbort:(gt,_r,Yr)=>{et.stats.aborted=nt.stats.aborted,this.resetLoader(et,ct),ut(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:et,part:nt,error:new Error("Aborted"),networkDetails:Yr,stats:gt}))},onTimeout:(gt,_r,Yr)=>{this.resetLoader(et,ct),ut(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:et,part:nt,error:new Error(`Timeout after ${pt.timeout}ms`),networkDetails:Yr,stats:gt}))}})})}updateStatsFromPart(et,nt){const rt=et.stats,it=nt.stats,st=it.total;if(rt.loaded+=it.loaded,st){const ut=Math.round(et.duration/nt.duration),ct=Math.min(Math.round(rt.loaded/st),ut),ft=(ut-ct)*Math.round(rt.loaded/ct);rt.total=rt.loaded+ft}else rt.total=Math.max(rt.loaded,rt.total);const ot=rt.loading,lt=it.loading;ot.start?ot.first+=lt.first-lt.start:(ot.start=lt.start,ot.first=lt.first),ot.end=lt.end}resetLoader(et,nt){et.loader=null,this.loader===nt&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),nt.destroy()}}function createLoaderContext(tt,et=null){const nt=et||tt,rt={frag:tt,part:et,responseType:"arraybuffer",url:nt.url,headers:{},rangeStart:0,rangeEnd:0},it=nt.byteRangeStartOffset,st=nt.byteRangeEndOffset;if(isFiniteNumber(it)&&isFiniteNumber(st)){var ot;let lt=it,ut=st;if(tt.sn==="initSegment"&&((ot=tt.decryptdata)==null?void 0:ot.method)==="AES-128"){const ct=st-it;ct%16&&(ut=st+(16-ct%16)),it!==0&&(rt.resetIV=!0,lt=it-16)}rt.rangeStart=lt,rt.rangeEnd=ut}return rt}function createGapLoadError(tt,et){const nt=new Error(`GAP ${tt.gap?"tag":"attribute"} found`),rt={type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_GAP,fatal:!1,frag:tt,error:nt,networkDetails:null};return et&&(rt.part=et),(et||tt).stats.aborted=!0,new LoadError(rt)}class LoadError extends Error{constructor(et){super(et.error.message),this.data=void 0,this.data=et}}class AESCrypto{constructor(et,nt){this.subtle=void 0,this.aesIV=void 0,this.subtle=et,this.aesIV=nt}decrypt(et,nt){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},nt,et)}}class FastAESKey{constructor(et,nt){this.subtle=void 0,this.key=void 0,this.subtle=et,this.key=nt}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function removePadding(tt){const et=tt.byteLength,nt=et&&new DataView(tt.buffer).getUint8(et-1);return nt?sliceUint8(tt,0,et-nt):tt}class AESDecryptor{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(et){const nt=new DataView(et),rt=new Uint32Array(4);for(let it=0;it<4;it++)rt[it]=nt.getUint32(it*4);return rt}initTable(){const et=this.sBox,nt=this.invSBox,rt=this.subMix,it=rt[0],st=rt[1],ot=rt[2],lt=rt[3],ut=this.invSubMix,ct=ut[0],dt=ut[1],ft=ut[2],pt=ut[3],gt=new Uint32Array(256);let _r=0,Yr=0,mt=0;for(mt=0;mt<256;mt++)mt<128?gt[mt]=mt<<1:gt[mt]=mt<<1^283;for(mt=0;mt<256;mt++){let Kr=Yr^Yr<<1^Yr<<2^Yr<<3^Yr<<4;Kr=Kr>>>8^Kr&255^99,et[_r]=Kr,nt[Kr]=_r;const Xr=gt[_r],Zr=gt[Xr],Qr=gt[Zr];let _i=gt[Kr]*257^Kr*16843008;it[_r]=_i<<24|_i>>>8,st[_r]=_i<<16|_i>>>16,ot[_r]=_i<<8|_i>>>24,lt[_r]=_i,_i=Qr*16843009^Zr*65537^Xr*257^_r*16843008,ct[Kr]=_i<<24|_i>>>8,dt[Kr]=_i<<16|_i>>>16,ft[Kr]=_i<<8|_i>>>24,pt[Kr]=_i,_r?(_r=Xr^gt[gt[gt[Qr^Xr]]],Yr^=gt[gt[Yr]]):_r=Yr=1}}expandKey(et){const nt=this.uint8ArrayToUint32Array_(et);let rt=!0,it=0;for(;it<nt.length&&rt;)rt=nt[it]===this.key[it],it++;if(rt)return;this.key=nt;const st=this.keySize=nt.length;if(st!==4&&st!==6&&st!==8)throw new Error("Invalid aes key size="+st);const ot=this.ksRows=(st+6+1)*4;let lt,ut;const ct=this.keySchedule=new Uint32Array(ot),dt=this.invKeySchedule=new Uint32Array(ot),ft=this.sBox,pt=this.rcon,gt=this.invSubMix,_r=gt[0],Yr=gt[1],mt=gt[2],Kr=gt[3];let Xr,Zr;for(lt=0;lt<ot;lt++){if(lt<st){Xr=ct[lt]=nt[lt];continue}Zr=Xr,lt%st===0?(Zr=Zr<<8|Zr>>>24,Zr=ft[Zr>>>24]<<24|ft[Zr>>>16&255]<<16|ft[Zr>>>8&255]<<8|ft[Zr&255],Zr^=pt[lt/st|0]<<24):st>6&&lt%st===4&&(Zr=ft[Zr>>>24]<<24|ft[Zr>>>16&255]<<16|ft[Zr>>>8&255]<<8|ft[Zr&255]),ct[lt]=Xr=(ct[lt-st]^Zr)>>>0}for(ut=0;ut<ot;ut++)lt=ot-ut,ut&3?Zr=ct[lt]:Zr=ct[lt-4],ut<4||lt<=4?dt[ut]=Zr:dt[ut]=_r[ft[Zr>>>24]]^Yr[ft[Zr>>>16&255]]^mt[ft[Zr>>>8&255]]^Kr[ft[Zr&255]],dt[ut]=dt[ut]>>>0}networkToHostOrderSwap(et){return et<<24|(et&65280)<<8|(et&16711680)>>8|et>>>24}decrypt(et,nt,rt){const it=this.keySize+6,st=this.invKeySchedule,ot=this.invSBox,lt=this.invSubMix,ut=lt[0],ct=lt[1],dt=lt[2],ft=lt[3],pt=this.uint8ArrayToUint32Array_(rt);let gt=pt[0],_r=pt[1],Yr=pt[2],mt=pt[3];const Kr=new Int32Array(et),Xr=new Int32Array(Kr.length);let Zr,Qr,_i,rs,ns,ss,fs,os,is,cs,ps,vs,ls,gs;const us=this.networkToHostOrderSwap;for(;nt<Kr.length;){for(is=us(Kr[nt]),cs=us(Kr[nt+1]),ps=us(Kr[nt+2]),vs=us(Kr[nt+3]),ns=is^st[0],ss=vs^st[1],fs=ps^st[2],os=cs^st[3],ls=4,gs=1;gs<it;gs++)Zr=ut[ns>>>24]^ct[ss>>16&255]^dt[fs>>8&255]^ft[os&255]^st[ls],Qr=ut[ss>>>24]^ct[fs>>16&255]^dt[os>>8&255]^ft[ns&255]^st[ls+1],_i=ut[fs>>>24]^ct[os>>16&255]^dt[ns>>8&255]^ft[ss&255]^st[ls+2],rs=ut[os>>>24]^ct[ns>>16&255]^dt[ss>>8&255]^ft[fs&255]^st[ls+3],ns=Zr,ss=Qr,fs=_i,os=rs,ls=ls+4;Zr=ot[ns>>>24]<<24^ot[ss>>16&255]<<16^ot[fs>>8&255]<<8^ot[os&255]^st[ls],Qr=ot[ss>>>24]<<24^ot[fs>>16&255]<<16^ot[os>>8&255]<<8^ot[ns&255]^st[ls+1],_i=ot[fs>>>24]<<24^ot[os>>16&255]<<16^ot[ns>>8&255]<<8^ot[ss&255]^st[ls+2],rs=ot[os>>>24]<<24^ot[ns>>16&255]<<16^ot[ss>>8&255]<<8^ot[fs&255]^st[ls+3],Xr[nt]=us(Zr^gt),Xr[nt+1]=us(rs^_r),Xr[nt+2]=us(_i^Yr),Xr[nt+3]=us(Qr^mt),gt=is,_r=cs,Yr=ps,mt=vs,nt=nt+4}return Xr.buffer}}const CHUNK_SIZE=16;class Decrypter{constructor(et,{removePKCS7Padding:nt=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=et.enableSoftwareAES,this.removePKCS7Padding=nt,nt)try{const rt=self.crypto;rt&&(this.subtle=rt.subtle||rt.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:et,remainderData:nt}=this;if(!et||nt)return this.reset(),null;const rt=new Uint8Array(et);return this.reset(),this.removePKCS7Padding?removePadding(rt):rt}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(et,nt,rt){return this.useSoftware?new Promise((it,st)=>{this.softwareDecrypt(new Uint8Array(et),nt,rt);const ot=this.flush();ot?it(ot.buffer):st(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(et),nt,rt)}softwareDecrypt(et,nt,rt){const{currentIV:it,currentResult:st,remainderData:ot}=this;this.logOnce("JS AES decrypt"),ot&&(et=appendUint8Array(ot,et),this.remainderData=null);const lt=this.getValidChunk(et);if(!lt.length)return null;it&&(rt=it);let ut=this.softwareDecrypter;ut||(ut=this.softwareDecrypter=new AESDecryptor),ut.expandKey(nt);const ct=st;return this.currentResult=ut.decrypt(lt.buffer,0,rt),this.currentIV=sliceUint8(lt,-16).buffer,ct||null}webCryptoDecrypt(et,nt,rt){const it=this.subtle;return(this.key!==nt||!this.fastAesKey)&&(this.key=nt,this.fastAesKey=new FastAESKey(it,nt)),this.fastAesKey.expandKey().then(st=>it?(this.logOnce("WebCrypto AES decrypt"),new AESCrypto(it,new Uint8Array(rt)).decrypt(et.buffer,st)):Promise.reject(new Error("web crypto not initialized"))).catch(st=>(logger.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${st.name}: ${st.message}`),this.onWebCryptoError(et,nt,rt)))}onWebCryptoError(et,nt,rt){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(et,nt,rt);const it=this.flush();if(it)return it.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(et){let nt=et;const rt=et.length-et.length%CHUNK_SIZE;return rt!==et.length&&(nt=sliceUint8(et,0,rt),this.remainderData=sliceUint8(et,rt)),nt}logOnce(et){this.logEnabled&&(logger.log(`[decrypter]: ${et}`),this.logEnabled=!1)}}const TimeRanges={toString:function(tt){let et="";const nt=tt.length;for(let rt=0;rt<nt;rt++)et+=`[${tt.start(rt).toFixed(3)}-${tt.end(rt).toFixed(3)}]`;return et}},State={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class BaseStreamController extends TaskLoop{constructor(et,nt,rt,it,st){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=State.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=st,this.logPrefix=it,this.log=logger.log.bind(logger,`${it}:`),this.warn=logger.warn.bind(logger,`${it}:`),this.hls=et,this.fragmentLoader=new FragmentLoader(et.config),this.keyLoader=rt,this.fragmentTracker=nt,this.config=et.config,this.decrypter=new Decrypter(et.config),et.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(et){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const et=this.fragCurrent;et!=null&&et.loader&&(et.abortRequests(),this.fragmentTracker.removeFragment(et)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=State.STOPPED}_streamEnded(et,nt){if(nt.live||et.nextStart||!et.end||!this.media)return!1;const rt=nt.partList;if(rt!=null&&rt.length){const st=rt[rt.length-1];return BufferHelper.isBuffered(this.media,st.start+st.duration/2)}const it=nt.fragments[nt.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(it)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var et;return(et=this.levelLastLoaded)==null?void 0:et.details}}onMediaAttached(et,nt){const rt=this.media=this.mediaBuffer=nt.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),rt.addEventListener("seeking",this.onvseeking),rt.addEventListener("ended",this.onvended);const it=this.config;this.levels&&it.autoStartLoad&&this.state===State.STOPPED&&this.startLoad(it.startPosition)}onMediaDetaching(){const et=this.media;et!=null&&et.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),et&&this.onvseeking&&this.onvended&&(et.removeEventListener("seeking",this.onvseeking),et.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:et,fragCurrent:nt,media:rt,mediaBuffer:it,state:st}=this,ot=rt?rt.currentTime:0,lt=BufferHelper.bufferInfo(it||rt,ot,et.maxBufferHole);if(this.log(`media seeking to ${isFiniteNumber(ot)?ot.toFixed(3):ot}, state: ${st}`),this.state===State.ENDED)this.resetLoadingState();else if(nt){const ut=et.maxFragLookUpTolerance,ct=nt.start-ut,dt=nt.start+nt.duration+ut;if(!lt.len||dt<lt.start||ct>lt.end){const ft=ot>dt;(ot<ct||ft)&&(ft&&nt.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),nt.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}rt&&(this.fragmentTracker.removeFragmentsInRange(ot,1/0,this.playlistType,!0),this.lastCurrentTime=ot),!this.loadedmetadata&&!lt.len&&(this.nextLoadPosition=this.startPosition=ot),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(et,nt){this.startTimeOffset=nt.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.hls.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}onHandlerDestroyed(){this.state=State.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(et,nt,rt){this._loadFragForPlayback(et,nt,rt)}_loadFragForPlayback(et,nt,rt){const it=st=>{if(this.fragContextChanged(et)){this.warn(`Fragment ${et.sn}${st.part?" p: "+st.part.index:""} of level ${et.level} was dropped during download.`),this.fragmentTracker.removeFragment(et);return}et.stats.chunkCount++,this._handleFragmentLoadProgress(st)};this._doFragLoad(et,nt,rt,it).then(st=>{if(!st)return;const ot=this.state;if(this.fragContextChanged(et)){(ot===State.FRAG_LOADING||!this.fragCurrent&&ot===State.PARSING)&&(this.fragmentTracker.removeFragment(et),this.state=State.IDLE);return}"payload"in st&&(this.log(`Loaded fragment ${et.sn} of level ${et.level}`),this.hls.trigger(Events.FRAG_LOADED,st)),this._handleFragmentLoadComplete(st)}).catch(st=>{this.state===State.STOPPED||this.state===State.ERROR||(this.warn(st),this.resetFragmentLoading(et))})}clearTrackerIfNeeded(et){var nt;const{fragmentTracker:rt}=this;if(rt.getState(et)===FragmentState.APPENDING){const st=et.type,ot=this.getFwdBufferInfo(this.mediaBuffer,st),lt=Math.max(et.duration,ot?ot.len:this.config.maxBufferLength);this.reduceMaxBufferLength(lt)&&rt.removeFragment(et)}else((nt=this.mediaBuffer)==null?void 0:nt.buffered.length)===0?rt.removeAllFragments():rt.hasParts(et.type)&&(rt.detectPartialFragments({frag:et,part:null,stats:et.stats,id:et.type}),rt.getState(et)===FragmentState.PARTIAL&&rt.removeFragment(et))}checkLiveUpdate(et){if(et.updated&&!et.live){const nt=et.fragments[et.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:nt,part:null,stats:nt.stats,id:nt.type})}et.fragments[0]||(et.deltaUpdateFailed=!0)}flushMainBuffer(et,nt,rt=null){if(!(et-nt))return;const it={startOffset:et,endOffset:nt,type:rt};this.hls.trigger(Events.BUFFER_FLUSHING,it)}_loadInitSegment(et,nt){this._doFragLoad(et,nt).then(rt=>{if(!rt||this.fragContextChanged(et)||!this.levels)throw new Error("init load aborted");return rt}).then(rt=>{const{hls:it}=this,{payload:st}=rt,ot=et.decryptdata;if(st&&st.byteLength>0&&ot!=null&&ot.key&&ot.iv&&ot.method==="AES-128"){const lt=self.performance.now();return this.decrypter.decrypt(new Uint8Array(st),ot.key.buffer,ot.iv.buffer).catch(ut=>{throw it.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:ut,reason:ut.message,frag:et}),ut}).then(ut=>{const ct=self.performance.now();return it.trigger(Events.FRAG_DECRYPTED,{frag:et,payload:ut,stats:{tstart:lt,tdecrypt:ct}}),rt.payload=ut,this.completeInitSegmentLoad(rt)})}return this.completeInitSegmentLoad(rt)}).catch(rt=>{this.state===State.STOPPED||this.state===State.ERROR||(this.warn(rt),this.resetFragmentLoading(et))})}completeInitSegmentLoad(et){const{levels:nt}=this;if(!nt)throw new Error("init load aborted, missing levels");const rt=et.frag.stats;this.state=State.IDLE,et.frag.data=new Uint8Array(et.payload),rt.parsing.start=rt.buffering.start=self.performance.now(),rt.parsing.end=rt.buffering.end=self.performance.now(),this.tick()}fragContextChanged(et){const{fragCurrent:nt}=this;return!et||!nt||et.sn!==nt.sn||et.level!==nt.level}fragBufferedComplete(et,nt){var rt,it,st,ot;const lt=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${et.type} sn: ${et.sn}${nt?" part: "+nt.index:""} of ${this.playlistType===PlaylistLevelType.MAIN?"level":"track"} ${et.level} (frag:[${((rt=et.startPTS)!=null?rt:NaN).toFixed(3)}-${((it=et.endPTS)!=null?it:NaN).toFixed(3)}] > buffer:${lt?TimeRanges.toString(BufferHelper.getBuffered(lt)):"(detached)"})`),et.sn!=="initSegment"){var ut;if(et.type!==PlaylistLevelType.SUBTITLE){const dt=et.elementaryStreams;if(!Object.keys(dt).some(ft=>!!dt[ft])){this.state=State.IDLE;return}}const ct=(ut=this.levels)==null?void 0:ut[et.level];ct!=null&&ct.fragmentError&&(this.log(`Resetting level fragment error count of ${ct.fragmentError} on frag buffered`),ct.fragmentError=0)}this.state=State.IDLE,lt&&(!this.loadedmetadata&&et.type==PlaylistLevelType.MAIN&&lt.buffered.length&&((st=this.fragCurrent)==null?void 0:st.sn)===((ot=this.fragPrevious)==null?void 0:ot.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(et){const{transmuxer:nt}=this;if(!nt)return;const{frag:rt,part:it,partsLoaded:st}=et,ot=!st||st.length===0||st.some(ut=>!ut),lt=new ChunkMetadata(rt.level,rt.sn,rt.stats.chunkCount+1,0,it?it.index:-1,!ot);nt.flush(lt)}_handleFragmentLoadProgress(et){}_doFragLoad(et,nt,rt=null,it){var st;const ot=nt==null?void 0:nt.details;if(!this.levels||!ot)throw new Error(`frag load aborted, missing level${ot?"":" detail"}s`);let lt=null;if(et.encrypted&&!((st=et.decryptdata)!=null&&st.key)?(this.log(`Loading key for ${et.sn} of [${ot.startSN}-${ot.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${et.level}`),this.state=State.KEY_LOADING,this.fragCurrent=et,lt=this.keyLoader.load(et).then(dt=>{if(!this.fragContextChanged(dt.frag))return this.hls.trigger(Events.KEY_LOADED,dt),this.state===State.KEY_LOADING&&(this.state=State.IDLE),dt}),this.hls.trigger(Events.KEY_LOADING,{frag:et}),this.fragCurrent===null&&(lt=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!et.encrypted&&ot.encryptedFragments.length&&this.keyLoader.loadClear(et,ot.encryptedFragments),rt=Math.max(et.start,rt||0),this.config.lowLatencyMode&&et.sn!=="initSegment"){const dt=ot.partList;if(dt&&it){rt>et.end&&ot.fragmentHint&&(et=ot.fragmentHint);const ft=this.getNextPart(dt,et,rt);if(ft>-1){const pt=dt[ft];this.log(`Loading part sn: ${et.sn} p: ${pt.index} cc: ${et.cc} of playlist [${ot.startSN}-${ot.endSN}] parts [0-${ft}-${dt.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${et.level}, target: ${parseFloat(rt.toFixed(3))}`),this.nextLoadPosition=pt.start+pt.duration,this.state=State.FRAG_LOADING;let gt;return lt?gt=lt.then(_r=>!_r||this.fragContextChanged(_r.frag)?null:this.doFragPartsLoad(et,pt,nt,it)).catch(_r=>this.handleFragLoadError(_r)):gt=this.doFragPartsLoad(et,pt,nt,it).catch(_r=>this.handleFragLoadError(_r)),this.hls.trigger(Events.FRAG_LOADING,{frag:et,part:pt,targetBufferTime:rt}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):gt}else if(!et.url||this.loadedEndOfParts(dt,rt))return Promise.resolve(null)}}this.log(`Loading fragment ${et.sn} cc: ${et.cc} ${ot?"of ["+ot.startSN+"-"+ot.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${et.level}, target: ${parseFloat(rt.toFixed(3))}`),isFiniteNumber(et.sn)&&!this.bitrateTest&&(this.nextLoadPosition=et.start+et.duration),this.state=State.FRAG_LOADING;const ut=this.config.progressive;let ct;return ut&&lt?ct=lt.then(dt=>!dt||this.fragContextChanged(dt==null?void 0:dt.frag)?null:this.fragmentLoader.load(et,it)).catch(dt=>this.handleFragLoadError(dt)):ct=Promise.all([this.fragmentLoader.load(et,ut?it:void 0),lt]).then(([dt])=>(!ut&&dt&&it&&it(dt),dt)).catch(dt=>this.handleFragLoadError(dt)),this.hls.trigger(Events.FRAG_LOADING,{frag:et,targetBufferTime:rt}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):ct}doFragPartsLoad(et,nt,rt,it){return new Promise((st,ot)=>{var lt;const ut=[],ct=(lt=rt.details)==null?void 0:lt.partList,dt=ft=>{this.fragmentLoader.loadPart(et,ft,it).then(pt=>{ut[ft.index]=pt;const gt=pt.part;this.hls.trigger(Events.FRAG_LOADED,pt);const _r=getPartWith(rt,et.sn,ft.index+1)||findPart(ct,et.sn,ft.index+1);if(_r)dt(_r);else return st({frag:et,part:gt,partsLoaded:ut})}).catch(ot)};dt(nt)})}handleFragLoadError(et){if("data"in et){const nt=et.data;et.data&&nt.details===ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(nt.frag,nt.part):this.hls.trigger(Events.ERROR,nt)}else this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,err:et,error:et,fatal:!0});return null}_handleTransmuxerFlush(et){const nt=this.getCurrentContext(et);if(!nt||this.state!==State.PARSING){!this.fragCurrent&&this.state!==State.STOPPED&&this.state!==State.ERROR&&(this.state=State.IDLE);return}const{frag:rt,part:it,level:st}=nt,ot=self.performance.now();rt.stats.parsing.end=ot,it&&(it.stats.parsing.end=ot),this.updateLevelTiming(rt,it,st,et.partial)}getCurrentContext(et){const{levels:nt,fragCurrent:rt}=this,{level:it,sn:st,part:ot}=et;if(!(nt!=null&&nt[it]))return this.warn(`Levels object was unset while buffering fragment ${st} of level ${it}. The current chunk will not be buffered.`),null;const lt=nt[it],ut=ot>-1?getPartWith(lt,st,ot):null,ct=ut?ut.fragment:getFragmentWithSN(lt,st,rt);return ct?(rt&&rt!==ct&&(ct.stats=rt.stats),{frag:ct,part:ut,level:lt}):null}bufferFragmentData(et,nt,rt,it,st){var ot;if(!et||this.state!==State.PARSING)return;const{data1:lt,data2:ut}=et;let ct=lt;if(lt&&ut&&(ct=appendUint8Array(lt,ut)),!((ot=ct)!=null&&ot.length))return;const dt={type:et.type,frag:nt,part:rt,chunkMeta:it,parent:nt.type,data:ct};if(this.hls.trigger(Events.BUFFER_APPENDING,dt),et.dropped&&et.independent&&!rt){if(st)return;this.flushBufferGap(nt)}}flushBufferGap(et){const nt=this.media;if(!nt)return;if(!BufferHelper.isBuffered(nt,nt.currentTime)){this.flushMainBuffer(0,et.start);return}const rt=nt.currentTime,it=BufferHelper.bufferInfo(nt,rt,0),st=et.duration,ot=Math.min(this.config.maxFragLookUpTolerance*2,st*.25),lt=Math.max(Math.min(et.start-ot,it.end-ot),rt+ot);et.start-lt>ot&&this.flushMainBuffer(lt,et.start)}getFwdBufferInfo(et,nt){const rt=this.getLoadPosition();return isFiniteNumber(rt)?this.getFwdBufferInfoAtPos(et,rt,nt):null}getFwdBufferInfoAtPos(et,nt,rt){const{config:{maxBufferHole:it}}=this,st=BufferHelper.bufferInfo(et,nt,it);if(st.len===0&&st.nextStart!==void 0){const ot=this.fragmentTracker.getBufferedFrag(nt,rt);if(ot&&st.nextStart<ot.end)return BufferHelper.bufferInfo(et,nt,Math.max(st.nextStart,it))}return st}getMaxBufferLength(et){const{config:nt}=this;let rt;return et?rt=Math.max(8*nt.maxBufferSize/et,nt.maxBufferLength):rt=nt.maxBufferLength,Math.min(rt,nt.maxMaxBufferLength)}reduceMaxBufferLength(et){const nt=this.config,rt=et||nt.maxBufferLength;return nt.maxMaxBufferLength>=rt?(nt.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${nt.maxMaxBufferLength}s`),!0):!1}getAppendedFrag(et,nt=PlaylistLevelType.MAIN){const rt=this.fragmentTracker.getAppendedFrag(et,PlaylistLevelType.MAIN);return rt&&"fragment"in rt?rt.fragment:rt}getNextFragment(et,nt){const rt=nt.fragments,it=rt.length;if(!it)return null;const{config:st}=this,ot=rt[0].start;let lt;if(nt.live){const ut=st.initialLiveManifestSize;if(it<ut)return this.warn(`Not enough fragments to start playback (have: ${it}, need: ${ut})`),null;(!nt.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||et<ot)&&(lt=this.getInitialLiveFragment(nt,rt),this.startPosition=this.nextLoadPosition=lt?this.hls.liveSyncPosition||lt.start:et)}else et<=ot&&(lt=rt[0]);if(!lt){const ut=st.lowLatencyMode?nt.partEnd:nt.fragmentEnd;lt=this.getFragmentAtPosition(et,ut,nt)}return this.mapToInitFragWhenRequired(lt)}isLoopLoading(et,nt){const rt=this.fragmentTracker.getState(et);return(rt===FragmentState.OK||rt===FragmentState.PARTIAL&&!!et.gap)&&this.nextLoadPosition>nt}getNextFragmentLoopLoading(et,nt,rt,it,st){const ot=et.gap,lt=this.getNextFragment(this.nextLoadPosition,nt);if(lt===null)return lt;if(et=lt,ot&&et&&!et.gap&&rt.nextStart){const ut=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,rt.nextStart,it);if(ut!==null&&rt.len+ut.len>=st)return this.log(`buffer full after gaps in "${it}" playlist starting at sn: ${et.sn}`),null}return et}mapToInitFragWhenRequired(et){return et!=null&&et.initSegment&&!(et!=null&&et.initSegment.data)&&!this.bitrateTest?et.initSegment:et}getNextPart(et,nt,rt){let it=-1,st=!1,ot=!0;for(let lt=0,ut=et.length;lt<ut;lt++){const ct=et[lt];if(ot=ot&&!ct.independent,it>-1&&rt<ct.start)break;const dt=ct.loaded;dt?it=-1:(st||ct.independent||ot)&&ct.fragment===nt&&(it=lt),st=dt}return it}loadedEndOfParts(et,nt){const rt=et[et.length-1];return rt&&nt>rt.start&&rt.loaded}getInitialLiveFragment(et,nt){const rt=this.fragPrevious;let it=null;if(rt){if(et.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${rt.programDateTime}`),it=findFragmentByPDT(nt,rt.endProgramDateTime,this.config.maxFragLookUpTolerance)),!it){const st=rt.sn+1;if(st>=et.startSN&&st<=et.endSN){const ot=nt[st-et.startSN];rt.cc===ot.cc&&(it=ot,this.log(`Live playlist, switching playlist, load frag with next SN: ${it.sn}`))}it||(it=findFragWithCC(nt,rt.cc),it&&this.log(`Live playlist, switching playlist, load frag with same CC: ${it.sn}`))}}else{const st=this.hls.liveSyncPosition;st!==null&&(it=this.getFragmentAtPosition(st,this.bitrateTest?et.fragmentEnd:et.edge,et))}return it}getFragmentAtPosition(et,nt,rt){const{config:it}=this;let{fragPrevious:st}=this,{fragments:ot,endSN:lt}=rt;const{fragmentHint:ut}=rt,ct=it.maxFragLookUpTolerance,dt=rt.partList,ft=!!(it.lowLatencyMode&&dt!=null&&dt.length&&ut);ft&&ut&&!this.bitrateTest&&(ot=ot.concat(ut),lt=ut.sn);let pt;if(et<nt){const gt=et>nt-ct?0:ct;pt=findFragmentByPTS(st,ot,et,gt)}else pt=ot[ot.length-1];if(pt){const gt=pt.sn-rt.startSN,_r=this.fragmentTracker.getState(pt);if((_r===FragmentState.OK||_r===FragmentState.PARTIAL&&pt.gap)&&(st=pt),st&&pt.sn===st.sn&&(!ft||dt[0].fragment.sn>pt.sn)&&st&&pt.level===st.level){const mt=ot[gt+1];pt.sn<lt&&this.fragmentTracker.getState(mt)!==FragmentState.OK?pt=mt:pt=null}}return pt}synchronizeToLiveEdge(et){const{config:nt,media:rt}=this;if(!rt)return;const it=this.hls.liveSyncPosition,st=rt.currentTime,ot=et.fragments[0].start,lt=et.edge,ut=st>=ot-nt.maxFragLookUpTolerance&&st<=lt;if(it!==null&&rt.duration>it&&(st<it||!ut)){const ct=nt.liveMaxLatencyDuration!==void 0?nt.liveMaxLatencyDuration:nt.liveMaxLatencyDurationCount*et.targetduration;(!ut&&rt.readyState<4||st<lt-ct)&&(this.loadedmetadata||(this.nextLoadPosition=it),rt.readyState&&(this.warn(`Playback: ${st.toFixed(3)} is located too far from the end of live sliding playlist: ${lt}, reset currentTime to : ${it.toFixed(3)}`),rt.currentTime=it))}}alignPlaylists(et,nt,rt){const it=et.fragments.length;if(!it)return this.warn("No fragments in live playlist"),0;const st=et.fragments[0].start,ot=!nt,lt=et.alignedSliding&&isFiniteNumber(st);if(ot||!lt&&!st){const{fragPrevious:ut}=this;alignStream(ut,rt,et);const ct=et.fragments[0].start;return this.log(`Live playlist sliding: ${ct.toFixed(2)} start-sn: ${nt?nt.startSN:"na"}->${et.startSN} prev-sn: ${ut?ut.sn:"na"} fragments: ${it}`),ct}return st}waitForCdnTuneIn(et){return et.live&&et.canBlockReload&&et.partTarget&&et.tuneInGoal>Math.max(et.partHoldBack,et.partTarget*3)}setStartPosition(et,nt){let rt=this.startPosition;if(rt<nt&&(rt=-1),rt===-1||this.lastCurrentTime===-1){const it=this.startTimeOffset!==null,st=it?this.startTimeOffset:et.startTimeOffset;st!==null&&isFiniteNumber(st)?(rt=nt+st,st<0&&(rt+=et.totalduration),rt=Math.min(Math.max(nt,rt),nt+et.totalduration),this.log(`Start time offset ${st} found in ${it?"multivariant":"media"} playlist, adjust startPosition to ${rt}`),this.startPosition=rt):et.live?rt=this.hls.liveSyncPosition||nt:this.startPosition=rt=0,this.lastCurrentTime=rt}this.nextLoadPosition=rt}getLoadPosition(){const{media:et}=this;let nt=0;return this.loadedmetadata&&et?nt=et.currentTime:this.nextLoadPosition&&(nt=this.nextLoadPosition),nt}handleFragLoadAborted(et,nt){this.transmuxer&&et.sn!=="initSegment"&&et.stats.aborted&&(this.warn(`Fragment ${et.sn}${nt?" part "+nt.index:""} of level ${et.level} was aborted`),this.resetFragmentLoading(et))}resetFragmentLoading(et){(!this.fragCurrent||!this.fragContextChanged(et)&&this.state!==State.FRAG_LOADING_WAITING_RETRY)&&(this.state=State.IDLE)}onFragmentOrKeyLoadError(et,nt){if(nt.chunkMeta&&!nt.frag){const dt=this.getCurrentContext(nt.chunkMeta);dt&&(nt.frag=dt.frag)}const rt=nt.frag;if(!rt||rt.type!==et||!this.levels)return;if(this.fragContextChanged(rt)){var it;this.warn(`Frag load error must match current frag to retry ${rt.url} > ${(it=this.fragCurrent)==null?void 0:it.url}`);return}const st=nt.details===ErrorDetails.FRAG_GAP;st&&this.fragmentTracker.fragBuffered(rt,!0);const ot=nt.errorAction,{action:lt,retryCount:ut=0,retryConfig:ct}=ot||{};if(ot&&lt===NetworkErrorAction.RetryRequest&&ct){this.resetStartWhenNotLoaded(this.levelLastLoaded);const dt=getRetryDelay(ct,ut);this.warn(`Fragment ${rt.sn} of ${et} ${rt.level} errored with ${nt.details}, retrying loading ${ut+1}/${ct.maxNumRetry} in ${dt}ms`),ot.resolved=!0,this.retryDate=self.performance.now()+dt,this.state=State.FRAG_LOADING_WAITING_RETRY}else if(ct&&ot)if(this.resetFragmentErrors(et),ut<ct.maxNumRetry)!st&&lt!==NetworkErrorAction.RemoveAlternatePermanently&&(ot.resolved=!0);else{logger.warn(`${nt.details} reached or exceeded max retry (${ut})`);return}else(ot==null?void 0:ot.action)===NetworkErrorAction.SendAlternateToPenaltyBox?this.state=State.WAITING_LEVEL:this.state=State.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(et){if(this.state===State.PARSING||this.state===State.PARSED){const nt=et.parent,rt=this.getFwdBufferInfo(this.mediaBuffer,nt),it=rt&&rt.len>.5;it&&this.reduceMaxBufferLength(rt.len);const st=!it;return st&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${nt} buffer`),et.frag&&(this.fragmentTracker.removeFragment(et.frag),this.nextLoadPosition=et.frag.start),this.resetLoadingState(),st}return!1}resetFragmentErrors(et){et===PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==State.STOPPED&&(this.state=State.IDLE)}afterBufferFlushed(et,nt,rt){if(!et)return;const it=BufferHelper.getBuffered(et);this.fragmentTracker.detectEvictedFragments(nt,it,rt),this.state===State.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=State.IDLE}resetStartWhenNotLoaded(et){if(!this.loadedmetadata){this.startFragRequested=!1;const nt=et?et.details:null;nt!=null&&nt.live?(this.startPosition=-1,this.setStartPosition(nt,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(et){this.warn(`The loading context changed while buffering fragment ${et.sn} of level ${et.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(et=0){this.fragmentTracker.removeFragmentsInRange(et,1/0,this.playlistType,!1,!0)}updateLevelTiming(et,nt,rt,it){var st;const ot=rt.details;if(!ot){this.warn("level.details undefined");return}if(!Object.keys(et.elementaryStreams).reduce((ut,ct)=>{const dt=et.elementaryStreams[ct];if(dt){const ft=dt.endPTS-dt.startPTS;if(ft<=0)return this.warn(`Could not parse fragment ${et.sn} ${ct} duration reliably (${ft})`),ut||!1;const pt=it?0:updateFragPTSDTS(ot,et,dt.startPTS,dt.endPTS,dt.startDTS,dt.endDTS);return this.hls.trigger(Events.LEVEL_PTS_UPDATED,{details:ot,level:rt,drift:pt,type:ct,frag:et,start:dt.startPTS,end:dt.endPTS}),!0}return ut},!1)&&((st=this.transmuxer)==null?void 0:st.error)===null){const ut=new Error(`Found no media in fragment ${et.sn} of level ${et.level} resetting transmuxer to fallback to playlist timing`);if(rt.fragmentError===0&&(rt.fragmentError++,et.gap=!0,this.fragmentTracker.removeFragment(et),this.fragmentTracker.fragBuffered(et,!0)),this.warn(ut.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:ut,frag:et,reason:`Found no media in msn ${et.sn} of level "${rt.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=State.PARSED,this.hls.trigger(Events.FRAG_PARSED,{frag:et,part:nt})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(et){et.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(et){const nt=this._state;nt!==et&&(this._state=et,this.log(`${nt}->${et}`))}get state(){return this._state}}class ChunkCache{constructor(){this.chunks=[],this.dataLength=0}push(et){this.chunks.push(et),this.dataLength+=et.length}flush(){const{chunks:et,dataLength:nt}=this;let rt;if(et.length)et.length===1?rt=et[0]:rt=concatUint8Arrays(et,nt);else return new Uint8Array(0);return this.reset(),rt}reset(){this.chunks.length=0,this.dataLength=0}}function concatUint8Arrays(tt,et){const nt=new Uint8Array(et);let rt=0;for(let it=0;it<tt.length;it++){const st=tt[it];nt.set(st,rt),rt+=st.length}return nt}function hasUMDWorker(){return typeof __HLS_WORKER_BUNDLE__=="function"}function injectWorker(){const tt=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),et=self.URL.createObjectURL(tt);return{worker:new self.Worker(et),objectURL:et}}function loadWorker(tt){const et=new self.URL(tt,self.location.href).href;return{worker:new self.Worker(et),scriptURL:et}}function dummyTrack(tt="",et=9e4){return{type:tt,id:-1,pid:-1,inputTimeScale:et,sequenceNumber:-1,samples:[],dropped:0}}class BaseAudioDemuxer{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(et,nt,rt,it){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(et){this.initPTS=et,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(et,nt){return!1}appendFrame(et,nt,rt){}demux(et,nt){this.cachedData&&(et=appendUint8Array(this.cachedData,et),this.cachedData=null);let rt=getID3Data(et,0),it=rt?rt.length:0,st;const ot=this._audioTrack,lt=this._id3Track,ut=rt?getTimeStamp(rt):void 0,ct=et.length;for((this.basePTS===null||this.frameIndex===0&&isFiniteNumber(ut))&&(this.basePTS=initPTSFn(ut,nt,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),rt&&rt.length>0&&lt.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:rt,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});it<ct;){if(this.canParse(et,it)){const dt=this.appendFrame(ot,et,it);dt?(this.frameIndex++,this.lastPTS=dt.sample.pts,it+=dt.length,st=it):it=ct}else canParse$2(et,it)?(rt=getID3Data(et,it),lt.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:rt,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),it+=rt.length,st=it):it++;if(it===ct&&st!==ct){const dt=sliceUint8(et,st);this.cachedData?this.cachedData=appendUint8Array(this.cachedData,dt):this.cachedData=dt}}return{audioTrack:ot,videoTrack:dummyTrack(),id3Track:lt,textTrack:dummyTrack()}}demuxSampleAes(et,nt,rt){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(et){const nt=this.cachedData;return nt&&(this.cachedData=null,this.demux(nt,0)),{audioTrack:this._audioTrack,videoTrack:dummyTrack(),id3Track:this._id3Track,textTrack:dummyTrack()}}destroy(){}}const initPTSFn=(tt,et,nt)=>{if(isFiniteNumber(tt))return tt*90;const rt=nt?nt.baseTime*9e4/nt.timescale:0;return et*9e4+rt};function getAudioConfig(tt,et,nt,rt){let it,st,ot,lt;const ut=navigator.userAgent.toLowerCase(),ct=rt,dt=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];it=((et[nt+2]&192)>>>6)+1;const ft=(et[nt+2]&60)>>>2;if(ft>dt.length-1){const pt=new Error(`invalid ADTS sampling index:${ft}`);tt.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,error:pt,reason:pt.message});return}return ot=(et[nt+2]&1)<<2,ot|=(et[nt+3]&192)>>>6,logger.log(`manifest codec:${rt}, ADTS type:${it}, samplingIndex:${ft}`),/firefox/i.test(ut)?ft>=6?(it=5,lt=new Array(4),st=ft-3):(it=2,lt=new Array(2),st=ft):ut.indexOf("android")!==-1?(it=2,lt=new Array(2),st=ft):(it=5,lt=new Array(4),rt&&(rt.indexOf("mp4a.40.29")!==-1||rt.indexOf("mp4a.40.5")!==-1)||!rt&&ft>=6?st=ft-3:((rt&&rt.indexOf("mp4a.40.2")!==-1&&(ft>=6&&ot===1||/vivaldi/i.test(ut))||!rt&&ot===1)&&(it=2,lt=new Array(2)),st=ft)),lt[0]=it<<3,lt[0]|=(ft&14)>>1,lt[1]|=(ft&1)<<7,lt[1]|=ot<<3,it===5&&(lt[1]|=(st&14)>>1,lt[2]=(st&1)<<7,lt[2]|=8,lt[3]=0),{config:lt,samplerate:dt[ft],channelCount:ot,codec:"mp4a.40."+it,manifestCodec:ct}}function isHeaderPattern$1(tt,et){return tt[et]===255&&(tt[et+1]&246)===240}function getHeaderLength(tt,et){return tt[et+1]&1?7:9}function getFullFrameLength(tt,et){return(tt[et+3]&3)<<11|tt[et+4]<<3|(tt[et+5]&224)>>>5}function canGetFrameLength(tt,et){return et+5<tt.length}function isHeader$1(tt,et){return et+1<tt.length&&isHeaderPattern$1(tt,et)}function canParse$1(tt,et){return canGetFrameLength(tt,et)&&isHeaderPattern$1(tt,et)&&getFullFrameLength(tt,et)<=tt.length-et}function probe$1(tt,et){if(isHeader$1(tt,et)){const nt=getHeaderLength(tt,et);if(et+nt>=tt.length)return!1;const rt=getFullFrameLength(tt,et);if(rt<=nt)return!1;const it=et+rt;return it===tt.length||isHeader$1(tt,it)}return!1}function initTrackConfig(tt,et,nt,rt,it){if(!tt.samplerate){const st=getAudioConfig(et,nt,rt,it);if(!st)return;tt.config=st.config,tt.samplerate=st.samplerate,tt.channelCount=st.channelCount,tt.codec=st.codec,tt.manifestCodec=st.manifestCodec,logger.log(`parsed codec:${tt.codec}, rate:${st.samplerate}, channels:${st.channelCount}`)}}function getFrameDuration(tt){return 1024*9e4/tt}function parseFrameHeader(tt,et){const nt=getHeaderLength(tt,et);if(et+nt<=tt.length){const rt=getFullFrameLength(tt,et)-nt;if(rt>0)return{headerLength:nt,frameLength:rt}}}function appendFrame$2(tt,et,nt,rt,it){const st=getFrameDuration(tt.samplerate),ot=rt+it*st,lt=parseFrameHeader(et,nt);let ut;if(lt){const{frameLength:ft,headerLength:pt}=lt,gt=pt+ft,_r=Math.max(0,nt+gt-et.length);_r?(ut=new Uint8Array(gt-pt),ut.set(et.subarray(nt+pt,et.length),0)):ut=et.subarray(nt+pt,nt+gt);const Yr={unit:ut,pts:ot};return _r||tt.samples.push(Yr),{sample:Yr,length:gt,missing:_r}}const ct=et.length-nt;return ut=new Uint8Array(ct),ut.set(et.subarray(nt,et.length),0),{sample:{unit:ut,pts:ot},length:ct,missing:-1}}let chromeVersion$1=null;const BitratesMap=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot=[0,1,1,4];function appendFrame$1(tt,et,nt,rt,it){if(nt+24>et.length)return;const st=parseHeader(et,nt);if(st&&nt+st.frameLength<=et.length){const ot=st.samplesPerFrame*9e4/st.sampleRate,lt=rt+it*ot,ut={unit:et.subarray(nt,nt+st.frameLength),pts:lt,dts:lt};return tt.config=[],tt.channelCount=st.channelCount,tt.samplerate=st.sampleRate,tt.samples.push(ut),{sample:ut,length:st.frameLength,missing:0}}}function parseHeader(tt,et){const nt=tt[et+1]>>3&3,rt=tt[et+1]>>1&3,it=tt[et+2]>>4&15,st=tt[et+2]>>2&3;if(nt!==1&&it!==0&&it!==15&&st!==3){const ot=tt[et+2]>>1&1,lt=tt[et+3]>>6,ut=nt===3?3-rt:rt===3?3:4,ct=BitratesMap[ut*14+it-1]*1e3,ft=SamplingRateMap[(nt===3?0:nt===2?1:2)*3+st],pt=lt===3?1:2,gt=SamplesCoefficients[nt][rt],_r=BytesInSlot[rt],Yr=gt*8*_r,mt=Math.floor(gt*ct/ft+ot)*_r;if(chromeVersion$1===null){const Zr=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion$1=Zr?parseInt(Zr[1]):0}return!!chromeVersion$1&&chromeVersion$1<=87&&rt===2&&ct>=224e3&&lt===0&&(tt[et+3]=tt[et+3]|128),{sampleRate:ft,channelCount:pt,frameLength:mt,samplesPerFrame:Yr}}}function isHeaderPattern(tt,et){return tt[et]===255&&(tt[et+1]&224)===224&&(tt[et+1]&6)!==0}function isHeader(tt,et){return et+1<tt.length&&isHeaderPattern(tt,et)}function canParse(tt,et){return isHeaderPattern(tt,et)&&4<=tt.length-et}function probe(tt,et){if(et+1<tt.length&&isHeaderPattern(tt,et)){const rt=parseHeader(tt,et);let it=4;rt!=null&&rt.frameLength&&(it=rt.frameLength);const st=et+it;return st===tt.length||isHeader(tt,st)}return!1}class AACDemuxer extends BaseAudioDemuxer{constructor(et,nt){super(),this.observer=void 0,this.config=void 0,this.observer=et,this.config=nt}resetInitSegment(et,nt,rt,it){super.resetInitSegment(et,nt,rt,it),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:nt,duration:it,inputTimeScale:9e4,dropped:0}}static probe(et){if(!et)return!1;const nt=getID3Data(et,0);let rt=(nt==null?void 0:nt.length)||0;if(probe(et,rt))return!1;for(let it=et.length;rt<it;rt++)if(probe$1(et,rt))return logger.log("ADTS sync word found !"),!0;return!1}canParse(et,nt){return canParse$1(et,nt)}appendFrame(et,nt,rt){initTrackConfig(et,this.observer,nt,rt,et.manifestCodec);const it=appendFrame$2(et,nt,rt,this.basePTS,this.frameIndex);if(it&&it.missing===0)return it}}const emsgSchemePattern=/\/emsg[-/]ID3/i;class MP4Demuxer{constructor(et,nt){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=nt}resetTimeStamp(){}resetInitSegment(et,nt,rt,it){const st=this.videoTrack=dummyTrack("video",1),ot=this.audioTrack=dummyTrack("audio",1),lt=this.txtTrack=dummyTrack("text",1);if(this.id3Track=dummyTrack("id3",1),this.timeOffset=0,!(et!=null&&et.byteLength))return;const ut=parseInitSegment(et);if(ut.video){const{id:ct,timescale:dt,codec:ft}=ut.video;st.id=ct,st.timescale=lt.timescale=dt,st.codec=ft}if(ut.audio){const{id:ct,timescale:dt,codec:ft}=ut.audio;ot.id=ct,ot.timescale=dt,ot.codec=ft}lt.id=RemuxerTrackIdConfig.text,st.sampleDuration=0,st.duration=ot.duration=it}resetContiguity(){this.remainderData=null}static probe(et){return hasMoofData(et)}demux(et,nt){this.timeOffset=nt;let rt=et;const it=this.videoTrack,st=this.txtTrack;if(this.config.progressive){this.remainderData&&(rt=appendUint8Array(this.remainderData,et));const lt=segmentValidRange(rt);this.remainderData=lt.remainder,it.samples=lt.valid||new Uint8Array}else it.samples=rt;const ot=this.extractID3Track(it,nt);return st.samples=parseSamples(nt,it),{videoTrack:it,audioTrack:this.audioTrack,id3Track:ot,textTrack:this.txtTrack}}flush(){const et=this.timeOffset,nt=this.videoTrack,rt=this.txtTrack;nt.samples=this.remainderData||new Uint8Array,this.remainderData=null;const it=this.extractID3Track(nt,this.timeOffset);return rt.samples=parseSamples(et,nt),{videoTrack:nt,audioTrack:dummyTrack(),id3Track:it,textTrack:dummyTrack()}}extractID3Track(et,nt){const rt=this.id3Track;if(et.samples.length){const it=findBox(et.samples,["emsg"]);it&&it.forEach(st=>{const ot=parseEmsg(st);if(emsgSchemePattern.test(ot.schemeIdUri)){const lt=isFiniteNumber(ot.presentationTime)?ot.presentationTime/ot.timeScale:nt+ot.presentationTimeDelta/ot.timeScale;let ut=ot.eventDuration===4294967295?Number.POSITIVE_INFINITY:ot.eventDuration/ot.timeScale;ut<=.001&&(ut=Number.POSITIVE_INFINITY);const ct=ot.payload;rt.samples.push({data:ct,len:ct.byteLength,dts:lt,pts:lt,type:MetadataSchema.emsg,duration:ut})}})}return rt}demuxSampleAes(et,nt,rt){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}const getAudioBSID=(tt,et)=>{let nt=0,rt=5;et+=rt;const it=new Uint32Array(1),st=new Uint32Array(1),ot=new Uint8Array(1);for(;rt>0;){ot[0]=tt[et];const lt=Math.min(rt,8),ut=8-lt;st[0]=4278190080>>>24+ut<<ut,it[0]=(ot[0]&st[0])>>ut,nt=nt?nt<<lt|it[0]:it[0],et+=1,rt-=lt}return nt};class AC3Demuxer extends BaseAudioDemuxer{constructor(et){super(),this.observer=void 0,this.observer=et}resetInitSegment(et,nt,rt,it){super.resetInitSegment(et,nt,rt,it),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:nt,duration:it,inputTimeScale:9e4,dropped:0}}canParse(et,nt){return nt+64<et.length}appendFrame(et,nt,rt){const it=appendFrame(et,nt,rt,this.basePTS,this.frameIndex);if(it!==-1)return{sample:et.samples[et.samples.length-1],length:it,missing:0}}static probe(et){if(!et)return!1;const nt=getID3Data(et,0);if(!nt)return!1;const rt=nt.length;return et[rt]===11&&et[rt+1]===119&&getTimeStamp(nt)!==void 0&&getAudioBSID(et,rt)<16}}function appendFrame(tt,et,nt,rt,it){if(nt+8>et.length||et[nt]!==11||et[nt+1]!==119)return-1;const st=et[nt+4]>>6;if(st>=3)return-1;const lt=[48e3,44100,32e3][st],ut=et[nt+4]&63,dt=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][ut*3+st]*2;if(nt+dt>et.length)return-1;const ft=et[nt+6]>>5;let pt=0;ft===2?pt+=2:(ft&1&&ft!==1&&(pt+=2),ft&4&&(pt+=2));const gt=(et[nt+6]<<8|et[nt+7])>>12-pt&1,Yr=[2,1,2,3,3,4,4,5][ft]+gt,mt=et[nt+5]>>3,Kr=et[nt+5]&7,Xr=new Uint8Array([st<<6|mt<<1|Kr>>2,(Kr&3)<<6|ft<<3|gt<<2|ut>>4,ut<<4&224]),Zr=1536/lt*9e4,Qr=rt+it*Zr,_i=et.subarray(nt,nt+dt);return tt.config=Xr,tt.channelCount=Yr,tt.samplerate=lt,tt.samples.push({unit:_i,pts:Qr}),dt}class BaseVideoParser{constructor(){this.VideoSample=null}createVideoSample(et,nt,rt,it){return{key:et,frame:!1,pts:nt,dts:rt,units:[],debug:it,length:0}}getLastNalUnit(et){var nt;let rt=this.VideoSample,it;if((!rt||rt.units.length===0)&&(rt=et[et.length-1]),(nt=rt)!=null&&nt.units){const st=rt.units;it=st[st.length-1]}return it}pushAccessUnit(et,nt){if(et.units.length&&et.frame){if(et.pts===void 0){const rt=nt.samples,it=rt.length;if(it){const st=rt[it-1];et.pts=st.pts,et.dts=st.dts}else{nt.dropped++;return}}nt.samples.push(et)}et.debug.length&&logger.log(et.pts+"/"+et.dts+":"+et.debug)}}class ExpGolomb{constructor(et){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=et,this.bytesAvailable=et.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const et=this.data,nt=this.bytesAvailable,rt=et.byteLength-nt,it=new Uint8Array(4),st=Math.min(4,nt);if(st===0)throw new Error("no bytes available");it.set(et.subarray(rt,rt+st)),this.word=new DataView(it.buffer).getUint32(0),this.bitsAvailable=st*8,this.bytesAvailable-=st}skipBits(et){let nt;et=Math.min(et,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>et?(this.word<<=et,this.bitsAvailable-=et):(et-=this.bitsAvailable,nt=et>>3,et-=nt<<3,this.bytesAvailable-=nt,this.loadWord(),this.word<<=et,this.bitsAvailable-=et)}readBits(et){let nt=Math.min(this.bitsAvailable,et);const rt=this.word>>>32-nt;if(et>32&&logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=nt,this.bitsAvailable>0)this.word<<=nt;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return nt=et-nt,nt>0&&this.bitsAvailable?rt<<nt|this.readBits(nt):rt}skipLZ(){let et;for(et=0;et<this.bitsAvailable;++et)if(this.word&2147483648>>>et)return this.word<<=et,this.bitsAvailable-=et,et;return this.loadWord(),et+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const et=this.skipLZ();return this.readBits(et+1)-1}readEG(){const et=this.readUEG();return 1&et?1+et>>>1:-1*(et>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(et){let nt=8,rt=8,it;for(let st=0;st<et;st++)rt!==0&&(it=this.readEG(),rt=(nt+it+256)%256),nt=rt===0?nt:rt}readSPS(){let et=0,nt=0,rt=0,it=0,st,ot,lt;const ut=this.readUByte.bind(this),ct=this.readBits.bind(this),dt=this.readUEG.bind(this),ft=this.readBoolean.bind(this),pt=this.skipBits.bind(this),gt=this.skipEG.bind(this),_r=this.skipUEG.bind(this),Yr=this.skipScalingList.bind(this);ut();const mt=ut();if(ct(5),pt(3),ut(),_r(),mt===100||mt===110||mt===122||mt===244||mt===44||mt===83||mt===86||mt===118||mt===128){const rs=dt();if(rs===3&&pt(1),_r(),_r(),pt(1),ft())for(ot=rs!==3?8:12,lt=0;lt<ot;lt++)ft()&&(lt<6?Yr(16):Yr(64))}_r();const Kr=dt();if(Kr===0)dt();else if(Kr===1)for(pt(1),gt(),gt(),st=dt(),lt=0;lt<st;lt++)gt();_r(),pt(1);const Xr=dt(),Zr=dt(),Qr=ct(1);Qr===0&&pt(1),pt(1),ft()&&(et=dt(),nt=dt(),rt=dt(),it=dt());let _i=[1,1];if(ft()&&ft())switch(ut()){case 1:_i=[1,1];break;case 2:_i=[12,11];break;case 3:_i=[10,11];break;case 4:_i=[16,11];break;case 5:_i=[40,33];break;case 6:_i=[24,11];break;case 7:_i=[20,11];break;case 8:_i=[32,11];break;case 9:_i=[80,33];break;case 10:_i=[18,11];break;case 11:_i=[15,11];break;case 12:_i=[64,33];break;case 13:_i=[160,99];break;case 14:_i=[4,3];break;case 15:_i=[3,2];break;case 16:_i=[2,1];break;case 255:{_i=[ut()<<8|ut(),ut()<<8|ut()];break}}return{width:Math.ceil((Xr+1)*16-et*2-nt*2),height:(2-Qr)*(Zr+1)*16-(Qr?2:4)*(rt+it),pixelRatio:_i}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class AvcVideoParser extends BaseVideoParser{parseAVCPES(et,nt,rt,it,st){const ot=this.parseAVCNALu(et,rt.data);let lt=this.VideoSample,ut,ct=!1;rt.data=null,lt&&ot.length&&!et.audFound&&(this.pushAccessUnit(lt,et),lt=this.VideoSample=this.createVideoSample(!1,rt.pts,rt.dts,"")),ot.forEach(dt=>{var ft;switch(dt.type){case 1:{let Yr=!1;ut=!0;const mt=dt.data;if(ct&&mt.length>4){const Kr=new ExpGolomb(mt).readSliceType();(Kr===2||Kr===4||Kr===7||Kr===9)&&(Yr=!0)}if(Yr){var pt;(pt=lt)!=null&&pt.frame&&!lt.key&&(this.pushAccessUnit(lt,et),lt=this.VideoSample=null)}lt||(lt=this.VideoSample=this.createVideoSample(!0,rt.pts,rt.dts,"")),lt.frame=!0,lt.key=Yr;break}case 5:ut=!0,(ft=lt)!=null&&ft.frame&&!lt.key&&(this.pushAccessUnit(lt,et),lt=this.VideoSample=null),lt||(lt=this.VideoSample=this.createVideoSample(!0,rt.pts,rt.dts,"")),lt.key=!0,lt.frame=!0;break;case 6:{ut=!0,parseSEIMessageFromNALu(dt.data,1,rt.pts,nt.samples);break}case 7:{var gt,_r;ut=!0,ct=!0;const Yr=dt.data,Kr=new ExpGolomb(Yr).readSPS();if(!et.sps||et.width!==Kr.width||et.height!==Kr.height||((gt=et.pixelRatio)==null?void 0:gt[0])!==Kr.pixelRatio[0]||((_r=et.pixelRatio)==null?void 0:_r[1])!==Kr.pixelRatio[1]){et.width=Kr.width,et.height=Kr.height,et.pixelRatio=Kr.pixelRatio,et.sps=[Yr],et.duration=st;const Xr=Yr.subarray(1,4);let Zr="avc1.";for(let Qr=0;Qr<3;Qr++){let _i=Xr[Qr].toString(16);_i.length<2&&(_i="0"+_i),Zr+=_i}et.codec=Zr}break}case 8:ut=!0,et.pps=[dt.data];break;case 9:ut=!0,et.audFound=!0,lt&&this.pushAccessUnit(lt,et),lt=this.VideoSample=this.createVideoSample(!1,rt.pts,rt.dts,"");break;case 12:ut=!0;break;default:ut=!1,lt&&(lt.debug+="unknown NAL "+dt.type+" ");break}lt&&ut&&lt.units.push(dt)}),it&&lt&&(this.pushAccessUnit(lt,et),this.VideoSample=null)}parseAVCNALu(et,nt){const rt=nt.byteLength;let it=et.naluState||0;const st=it,ot=[];let lt=0,ut,ct,dt,ft=-1,pt=0;for(it===-1&&(ft=0,pt=nt[0]&31,it=0,lt=1);lt<rt;){if(ut=nt[lt++],!it){it=ut?0:1;continue}if(it===1){it=ut?0:2;continue}if(!ut)it=3;else if(ut===1){if(ct=lt-it-1,ft>=0){const gt={data:nt.subarray(ft,ct),type:pt};ot.push(gt)}else{const gt=this.getLastNalUnit(et.samples);gt&&(st&&lt<=4-st&&gt.state&&(gt.data=gt.data.subarray(0,gt.data.byteLength-st)),ct>0&&(gt.data=appendUint8Array(gt.data,nt.subarray(0,ct)),gt.state=0))}lt<rt?(dt=nt[lt]&31,ft=lt,pt=dt,it=0):it=-1}else it=0}if(ft>=0&&it>=0){const gt={data:nt.subarray(ft,rt),type:pt,state:it};ot.push(gt)}if(ot.length===0){const gt=this.getLastNalUnit(et.samples);gt&&(gt.data=appendUint8Array(gt.data,nt))}return et.naluState=it,ot}}class SampleAesDecrypter{constructor(et,nt,rt){this.keyData=void 0,this.decrypter=void 0,this.keyData=rt,this.decrypter=new Decrypter(nt,{removePKCS7Padding:!1})}decryptBuffer(et){return this.decrypter.decrypt(et,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(et,nt,rt){const it=et[nt].unit;if(it.length<=16)return;const st=it.subarray(16,it.length-it.length%16),ot=st.buffer.slice(st.byteOffset,st.byteOffset+st.length);this.decryptBuffer(ot).then(lt=>{const ut=new Uint8Array(lt);it.set(ut,16),this.decrypter.isSync()||this.decryptAacSamples(et,nt+1,rt)})}decryptAacSamples(et,nt,rt){for(;;nt++){if(nt>=et.length){rt();return}if(!(et[nt].unit.length<32)&&(this.decryptAacSample(et,nt,rt),!this.decrypter.isSync()))return}}getAvcEncryptedData(et){const nt=Math.floor((et.length-48)/160)*16+16,rt=new Int8Array(nt);let it=0;for(let st=32;st<et.length-16;st+=160,it+=16)rt.set(et.subarray(st,st+16),it);return rt}getAvcDecryptedUnit(et,nt){const rt=new Uint8Array(nt);let it=0;for(let st=32;st<et.length-16;st+=160,it+=16)et.set(rt.subarray(it,it+16),st);return et}decryptAvcSample(et,nt,rt,it,st){const ot=discardEPB(st.data),lt=this.getAvcEncryptedData(ot);this.decryptBuffer(lt.buffer).then(ut=>{st.data=this.getAvcDecryptedUnit(ot,ut),this.decrypter.isSync()||this.decryptAvcSamples(et,nt,rt+1,it)})}decryptAvcSamples(et,nt,rt,it){if(et instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;nt++,rt=0){if(nt>=et.length){it();return}const st=et[nt].units;for(;!(rt>=st.length);rt++){const ot=st[rt];if(!(ot.data.length<=48||ot.type!==1&&ot.type!==5)&&(this.decryptAvcSample(et,nt,rt,it,ot),!this.decrypter.isSync()))return}}}}const PACKET_LENGTH=188;class TSDemuxer{constructor(et,nt,rt){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=et,this.config=nt,this.typeSupported=rt,this.videoParser=new AvcVideoParser}static probe(et){const nt=TSDemuxer.syncOffset(et);return nt>0&&logger.warn(`MPEG2-TS detected but first sync word found @ offset ${nt}`),nt!==-1}static syncOffset(et){const nt=et.length;let rt=Math.min(PACKET_LENGTH*5,nt-PACKET_LENGTH)+1,it=0;for(;it<rt;){let st=!1,ot=-1,lt=0;for(let ut=it;ut<nt;ut+=PACKET_LENGTH)if(et[ut]===71&&(nt-ut===PACKET_LENGTH||et[ut+PACKET_LENGTH]===71)){if(lt++,ot===-1&&(ot=ut,ot!==0&&(rt=Math.min(ot+PACKET_LENGTH*99,et.length-PACKET_LENGTH)+1)),st||(st=parsePID(et,ut)===0),st&&lt>1&&(ot===0&&lt>2||ut+PACKET_LENGTH>rt))return ot}else{if(lt)return-1;break}it++}return-1}static createTrack(et,nt){return{container:et==="video"||et==="audio"?"video/mp2t":void 0,type:et,id:RemuxerTrackIdConfig[et],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:et==="audio"?nt:void 0}}resetInitSegment(et,nt,rt,it){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=TSDemuxer.createTrack("video"),this._audioTrack=TSDemuxer.createTrack("audio",it),this._id3Track=TSDemuxer.createTrack("id3"),this._txtTrack=TSDemuxer.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=nt,this.videoCodec=rt,this._duration=it}resetTimeStamp(){}resetContiguity(){const{_audioTrack:et,_videoTrack:nt,_id3Track:rt}=this;et&&(et.pesData=null),nt&&(nt.pesData=null),rt&&(rt.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(et,nt,rt=!1,it=!1){rt||(this.sampleAes=null);let st;const ot=this._videoTrack,lt=this._audioTrack,ut=this._id3Track,ct=this._txtTrack;let dt=ot.pid,ft=ot.pesData,pt=lt.pid,gt=ut.pid,_r=lt.pesData,Yr=ut.pesData,mt=null,Kr=this.pmtParsed,Xr=this._pmtId,Zr=et.length;if(this.remainderData&&(et=appendUint8Array(this.remainderData,et),Zr=et.length,this.remainderData=null),Zr<PACKET_LENGTH&&!it)return this.remainderData=et,{audioTrack:lt,videoTrack:ot,id3Track:ut,textTrack:ct};const Qr=Math.max(0,TSDemuxer.syncOffset(et));Zr-=(Zr-Qr)%PACKET_LENGTH,Zr<et.byteLength&&!it&&(this.remainderData=new Uint8Array(et.buffer,Zr,et.buffer.byteLength-Zr));let _i=0;for(let ns=Qr;ns<Zr;ns+=PACKET_LENGTH)if(et[ns]===71){const ss=!!(et[ns+1]&64),fs=parsePID(et,ns),os=(et[ns+3]&48)>>4;let is;if(os>1){if(is=ns+5+et[ns+4],is===ns+PACKET_LENGTH)continue}else is=ns+4;switch(fs){case dt:ss&&(ft&&(st=parsePES(ft))&&this.videoParser.parseAVCPES(ot,ct,st,!1,this._duration),ft={data:[],size:0}),ft&&(ft.data.push(et.subarray(is,ns+PACKET_LENGTH)),ft.size+=ns+PACKET_LENGTH-is);break;case pt:if(ss){if(_r&&(st=parsePES(_r)))switch(lt.segmentCodec){case"aac":this.parseAACPES(lt,st);break;case"mp3":this.parseMPEGPES(lt,st);break;case"ac3":this.parseAC3PES(lt,st);break}_r={data:[],size:0}}_r&&(_r.data.push(et.subarray(is,ns+PACKET_LENGTH)),_r.size+=ns+PACKET_LENGTH-is);break;case gt:ss&&(Yr&&(st=parsePES(Yr))&&this.parseID3PES(ut,st),Yr={data:[],size:0}),Yr&&(Yr.data.push(et.subarray(is,ns+PACKET_LENGTH)),Yr.size+=ns+PACKET_LENGTH-is);break;case 0:ss&&(is+=et[is]+1),Xr=this._pmtId=parsePAT(et,is);break;case Xr:{ss&&(is+=et[is]+1);const cs=parsePMT(et,is,this.typeSupported,rt);dt=cs.videoPid,dt>0&&(ot.pid=dt,ot.segmentCodec=cs.segmentVideoCodec),pt=cs.audioPid,pt>0&&(lt.pid=pt,lt.segmentCodec=cs.segmentAudioCodec),gt=cs.id3Pid,gt>0&&(ut.pid=gt),mt!==null&&!Kr&&(logger.warn(`MPEG-TS PMT found at ${ns} after unknown PID '${mt}'. Backtracking to sync byte @${Qr} to parse all TS packets.`),mt=null,ns=Qr-188),Kr=this.pmtParsed=!0;break}case 17:case 8191:break;default:mt=fs;break}}else _i++;if(_i>0){const ns=new Error(`Found ${_i} TS packet/s that do not start with 0x47`);this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:ns,reason:ns.message})}ot.pesData=ft,lt.pesData=_r,ut.pesData=Yr;const rs={audioTrack:lt,videoTrack:ot,id3Track:ut,textTrack:ct};return it&&this.extractRemainingSamples(rs),rs}flush(){const{remainderData:et}=this;this.remainderData=null;let nt;return et?nt=this.demux(et,-1,!1,!0):nt={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(nt),this.sampleAes?this.decrypt(nt,this.sampleAes):nt}extractRemainingSamples(et){const{audioTrack:nt,videoTrack:rt,id3Track:it,textTrack:st}=et,ot=rt.pesData,lt=nt.pesData,ut=it.pesData;let ct;if(ot&&(ct=parsePES(ot))?(this.videoParser.parseAVCPES(rt,st,ct,!0,this._duration),rt.pesData=null):rt.pesData=ot,lt&&(ct=parsePES(lt))){switch(nt.segmentCodec){case"aac":this.parseAACPES(nt,ct);break;case"mp3":this.parseMPEGPES(nt,ct);break;case"ac3":this.parseAC3PES(nt,ct);break}nt.pesData=null}else lt!=null&&lt.size&&logger.log("last AAC PES packet truncated,might overlap between fragments"),nt.pesData=lt;ut&&(ct=parsePES(ut))?(this.parseID3PES(it,ct),it.pesData=null):it.pesData=ut}demuxSampleAes(et,nt,rt){const it=this.demux(et,rt,!0,!this.config.progressive),st=this.sampleAes=new SampleAesDecrypter(this.observer,this.config,nt);return this.decrypt(it,st)}decrypt(et,nt){return new Promise(rt=>{const{audioTrack:it,videoTrack:st}=et;it.samples&&it.segmentCodec==="aac"?nt.decryptAacSamples(it.samples,0,()=>{st.samples?nt.decryptAvcSamples(st.samples,0,0,()=>{rt(et)}):rt(et)}):st.samples&&nt.decryptAvcSamples(st.samples,0,0,()=>{rt(et)})})}destroy(){this._duration=0}parseAACPES(et,nt){let rt=0;const it=this.aacOverFlow;let st=nt.data;if(it){this.aacOverFlow=null;const ft=it.missing,pt=it.sample.unit.byteLength;if(ft===-1)st=appendUint8Array(it.sample.unit,st);else{const gt=pt-ft;it.sample.unit.set(st.subarray(0,ft),gt),et.samples.push(it.sample),rt=it.missing}}let ot,lt;for(ot=rt,lt=st.length;ot<lt-1&&!isHeader$1(st,ot);ot++);if(ot!==rt){let ft;const pt=ot<lt-1;pt?ft=`AAC PES did not start with ADTS header,offset:${ot}`:ft="No ADTS header found in AAC PES";const gt=new Error(ft);if(logger.warn(`parsing error: ${ft}`),this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,levelRetry:pt,error:gt,reason:ft}),!pt)return}initTrackConfig(et,this.observer,st,ot,this.audioCodec);let ut;if(nt.pts!==void 0)ut=nt.pts;else if(it){const ft=getFrameDuration(et.samplerate);ut=it.sample.pts+ft}else{logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let ct=0,dt;for(;ot<lt;)if(dt=appendFrame$2(et,st,ot,ut,ct),ot+=dt.length,dt.missing){this.aacOverFlow=dt;break}else for(ct++;ot<lt-1&&!isHeader$1(st,ot);ot++);}parseMPEGPES(et,nt){const rt=nt.data,it=rt.length;let st=0,ot=0;const lt=nt.pts;if(lt===void 0){logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;ot<it;)if(isHeader(rt,ot)){const ut=appendFrame$1(et,rt,ot,lt,st);if(ut)ot+=ut.length,st++;else break}else ot++}parseAC3PES(et,nt){{const rt=nt.data,it=nt.pts;if(it===void 0){logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const st=rt.length;let ot=0,lt=0,ut;for(;lt<st&&(ut=appendFrame(et,rt,lt,it,ot++))>0;)lt+=ut}}parseID3PES(et,nt){if(nt.pts===void 0){logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const rt=_extends({},nt,{type:this._videoTrack?MetadataSchema.emsg:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});et.samples.push(rt)}}function parsePID(tt,et){return((tt[et+1]&31)<<8)+tt[et+2]}function parsePAT(tt,et){return(tt[et+10]&31)<<8|tt[et+11]}function parsePMT(tt,et,nt,rt){const it={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},st=(tt[et+1]&15)<<8|tt[et+2],ot=et+3+st-4,lt=(tt[et+10]&15)<<8|tt[et+11];for(et+=12+lt;et<ot;){const ut=parsePID(tt,et),ct=(tt[et+3]&15)<<8|tt[et+4];switch(tt[et]){case 207:if(!rt){logEncryptedSamplesFoundInUnencryptedStream("ADTS AAC");break}case 15:it.audioPid===-1&&(it.audioPid=ut);break;case 21:it.id3Pid===-1&&(it.id3Pid=ut);break;case 219:if(!rt){logEncryptedSamplesFoundInUnencryptedStream("H.264");break}case 27:it.videoPid===-1&&(it.videoPid=ut,it.segmentVideoCodec="avc");break;case 3:case 4:!nt.mpeg&&!nt.mp3?logger.log("MPEG audio found, not supported in this browser"):it.audioPid===-1&&(it.audioPid=ut,it.segmentAudioCodec="mp3");break;case 193:if(!rt){logEncryptedSamplesFoundInUnencryptedStream("AC-3");break}case 129:nt.ac3?it.audioPid===-1&&(it.audioPid=ut,it.segmentAudioCodec="ac3"):logger.log("AC-3 audio found, not supported in this browser");break;case 6:if(it.audioPid===-1&&ct>0){let dt=et+5,ft=ct;for(;ft>2;){switch(tt[dt]){case 106:nt.ac3!==!0?logger.log("AC-3 audio found, not supported in this browser for now"):(it.audioPid=ut,it.segmentAudioCodec="ac3");break}const gt=tt[dt+1]+2;dt+=gt,ft-=gt}}break;case 194:case 135:logger.warn("Unsupported EC-3 in M2TS found");break;case 36:logger.warn("Unsupported HEVC in M2TS found");break}et+=ct+5}return it}function logEncryptedSamplesFoundInUnencryptedStream(tt){logger.log(`${tt} with AES-128-CBC encryption found in unencrypted stream`)}function parsePES(tt){let et=0,nt,rt,it,st,ot;const lt=tt.data;if(!tt||tt.size===0)return null;for(;lt[0].length<19&&lt.length>1;)lt[0]=appendUint8Array(lt[0],lt[1]),lt.splice(1,1);if(nt=lt[0],(nt[0]<<16)+(nt[1]<<8)+nt[2]===1){if(rt=(nt[4]<<8)+nt[5],rt&&rt>tt.size-6)return null;const ct=nt[7];ct&192&&(st=(nt[9]&14)*536870912+(nt[10]&255)*4194304+(nt[11]&254)*16384+(nt[12]&255)*128+(nt[13]&254)/2,ct&64?(ot=(nt[14]&14)*536870912+(nt[15]&255)*4194304+(nt[16]&254)*16384+(nt[17]&255)*128+(nt[18]&254)/2,st-ot>60*9e4&&(logger.warn(`${Math.round((st-ot)/9e4)}s delta between PTS and DTS, align them`),st=ot)):ot=st),it=nt[8];let dt=it+9;if(tt.size<=dt)return null;tt.size-=dt;const ft=new Uint8Array(tt.size);for(let pt=0,gt=lt.length;pt<gt;pt++){nt=lt[pt];let _r=nt.byteLength;if(dt)if(dt>_r){dt-=_r;continue}else nt=nt.subarray(dt),_r-=dt,dt=0;ft.set(nt,et),et+=_r}return rt&&(rt-=it+3),{data:ft,pts:st,dts:ot,len:rt}}return null}class MP3Demuxer extends BaseAudioDemuxer{resetInitSegment(et,nt,rt,it){super.resetInitSegment(et,nt,rt,it),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:nt,duration:it,inputTimeScale:9e4,dropped:0}}static probe(et){if(!et)return!1;const nt=getID3Data(et,0);let rt=(nt==null?void 0:nt.length)||0;if(nt&&et[rt]===11&&et[rt+1]===119&&getTimeStamp(nt)!==void 0&&getAudioBSID(et,rt)<=16)return!1;for(let it=et.length;rt<it;rt++)if(probe(et,rt))return logger.log("MPEG Audio sync word found !"),!0;return!1}canParse(et,nt){return canParse(et,nt)}appendFrame(et,nt,rt){if(this.basePTS!==null)return appendFrame$1(et,nt,rt,this.basePTS,this.frameIndex)}}class AAC{static getSilentFrame(et,nt){switch(et){case"mp4a.40.2":if(nt===1)return new Uint8Array([0,200,0,128,35,128]);if(nt===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(nt===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(nt===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(nt===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(nt===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(nt===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(nt===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(nt===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const UINT32_MAX=Math.pow(2,32)-1;class MP4{static init(){MP4.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let et;for(et in MP4.types)MP4.types.hasOwnProperty(et)&&(MP4.types[et]=[et.charCodeAt(0),et.charCodeAt(1),et.charCodeAt(2),et.charCodeAt(3)]);const nt=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),rt=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);MP4.HDLR_TYPES={video:nt,audio:rt};const it=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),st=new Uint8Array([0,0,0,0,0,0,0,0]);MP4.STTS=MP4.STSC=MP4.STCO=st,MP4.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),MP4.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),MP4.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),MP4.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const ot=new Uint8Array([105,115,111,109]),lt=new Uint8Array([97,118,99,49]),ut=new Uint8Array([0,0,0,1]);MP4.FTYP=MP4.box(MP4.types.ftyp,ot,ut,ot,lt),MP4.DINF=MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,it))}static box(et,...nt){let rt=8,it=nt.length;const st=it;for(;it--;)rt+=nt[it].byteLength;const ot=new Uint8Array(rt);for(ot[0]=rt>>24&255,ot[1]=rt>>16&255,ot[2]=rt>>8&255,ot[3]=rt&255,ot.set(et,4),it=0,rt=8;it<st;it++)ot.set(nt[it],rt),rt+=nt[it].byteLength;return ot}static hdlr(et){return MP4.box(MP4.types.hdlr,MP4.HDLR_TYPES[et])}static mdat(et){return MP4.box(MP4.types.mdat,et)}static mdhd(et,nt){nt*=et;const rt=Math.floor(nt/(UINT32_MAX+1)),it=Math.floor(nt%(UINT32_MAX+1));return MP4.box(MP4.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,et>>24&255,et>>16&255,et>>8&255,et&255,rt>>24,rt>>16&255,rt>>8&255,rt&255,it>>24,it>>16&255,it>>8&255,it&255,85,196,0,0]))}static mdia(et){return MP4.box(MP4.types.mdia,MP4.mdhd(et.timescale,et.duration),MP4.hdlr(et.type),MP4.minf(et))}static mfhd(et){return MP4.box(MP4.types.mfhd,new Uint8Array([0,0,0,0,et>>24,et>>16&255,et>>8&255,et&255]))}static minf(et){return et.type==="audio"?MP4.box(MP4.types.minf,MP4.box(MP4.types.smhd,MP4.SMHD),MP4.DINF,MP4.stbl(et)):MP4.box(MP4.types.minf,MP4.box(MP4.types.vmhd,MP4.VMHD),MP4.DINF,MP4.stbl(et))}static moof(et,nt,rt){return MP4.box(MP4.types.moof,MP4.mfhd(et),MP4.traf(rt,nt))}static moov(et){let nt=et.length;const rt=[];for(;nt--;)rt[nt]=MP4.trak(et[nt]);return MP4.box.apply(null,[MP4.types.moov,MP4.mvhd(et[0].timescale,et[0].duration)].concat(rt).concat(MP4.mvex(et)))}static mvex(et){let nt=et.length;const rt=[];for(;nt--;)rt[nt]=MP4.trex(et[nt]);return MP4.box.apply(null,[MP4.types.mvex,...rt])}static mvhd(et,nt){nt*=et;const rt=Math.floor(nt/(UINT32_MAX+1)),it=Math.floor(nt%(UINT32_MAX+1)),st=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,et>>24&255,et>>16&255,et>>8&255,et&255,rt>>24,rt>>16&255,rt>>8&255,rt&255,it>>24,it>>16&255,it>>8&255,it&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return MP4.box(MP4.types.mvhd,st)}static sdtp(et){const nt=et.samples||[],rt=new Uint8Array(4+nt.length);let it,st;for(it=0;it<nt.length;it++)st=nt[it].flags,rt[it+4]=st.dependsOn<<4|st.isDependedOn<<2|st.hasRedundancy;return MP4.box(MP4.types.sdtp,rt)}static stbl(et){return MP4.box(MP4.types.stbl,MP4.stsd(et),MP4.box(MP4.types.stts,MP4.STTS),MP4.box(MP4.types.stsc,MP4.STSC),MP4.box(MP4.types.stsz,MP4.STSZ),MP4.box(MP4.types.stco,MP4.STCO))}static avc1(et){let nt=[],rt=[],it,st,ot;for(it=0;it<et.sps.length;it++)st=et.sps[it],ot=st.byteLength,nt.push(ot>>>8&255),nt.push(ot&255),nt=nt.concat(Array.prototype.slice.call(st));for(it=0;it<et.pps.length;it++)st=et.pps[it],ot=st.byteLength,rt.push(ot>>>8&255),rt.push(ot&255),rt=rt.concat(Array.prototype.slice.call(st));const lt=MP4.box(MP4.types.avcC,new Uint8Array([1,nt[3],nt[4],nt[5],255,224|et.sps.length].concat(nt).concat([et.pps.length]).concat(rt))),ut=et.width,ct=et.height,dt=et.pixelRatio[0],ft=et.pixelRatio[1];return MP4.box(MP4.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,ut>>8&255,ut&255,ct>>8&255,ct&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),lt,MP4.box(MP4.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),MP4.box(MP4.types.pasp,new Uint8Array([dt>>24,dt>>16&255,dt>>8&255,dt&255,ft>>24,ft>>16&255,ft>>8&255,ft&255])))}static esds(et){const nt=et.config.length;return new Uint8Array([0,0,0,0,3,23+nt,0,1,0,4,15+nt,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([nt]).concat(et.config).concat([6,1,2]))}static audioStsd(et){const nt=et.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,et.channelCount,0,16,0,0,0,0,nt>>8&255,nt&255,0,0])}static mp4a(et){return MP4.box(MP4.types.mp4a,MP4.audioStsd(et),MP4.box(MP4.types.esds,MP4.esds(et)))}static mp3(et){return MP4.box(MP4.types[".mp3"],MP4.audioStsd(et))}static ac3(et){return MP4.box(MP4.types["ac-3"],MP4.audioStsd(et),MP4.box(MP4.types.dac3,et.config))}static stsd(et){return et.type==="audio"?et.segmentCodec==="mp3"&&et.codec==="mp3"?MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp3(et)):et.segmentCodec==="ac3"?MP4.box(MP4.types.stsd,MP4.STSD,MP4.ac3(et)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp4a(et)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.avc1(et))}static tkhd(et){const nt=et.id,rt=et.duration*et.timescale,it=et.width,st=et.height,ot=Math.floor(rt/(UINT32_MAX+1)),lt=Math.floor(rt%(UINT32_MAX+1));return MP4.box(MP4.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,nt>>24&255,nt>>16&255,nt>>8&255,nt&255,0,0,0,0,ot>>24,ot>>16&255,ot>>8&255,ot&255,lt>>24,lt>>16&255,lt>>8&255,lt&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,it>>8&255,it&255,0,0,st>>8&255,st&255,0,0]))}static traf(et,nt){const rt=MP4.sdtp(et),it=et.id,st=Math.floor(nt/(UINT32_MAX+1)),ot=Math.floor(nt%(UINT32_MAX+1));return MP4.box(MP4.types.traf,MP4.box(MP4.types.tfhd,new Uint8Array([0,0,0,0,it>>24,it>>16&255,it>>8&255,it&255])),MP4.box(MP4.types.tfdt,new Uint8Array([1,0,0,0,st>>24,st>>16&255,st>>8&255,st&255,ot>>24,ot>>16&255,ot>>8&255,ot&255])),MP4.trun(et,rt.length+16+20+8+16+8+8),rt)}static trak(et){return et.duration=et.duration||4294967295,MP4.box(MP4.types.trak,MP4.tkhd(et),MP4.mdia(et))}static trex(et){const nt=et.id;return MP4.box(MP4.types.trex,new Uint8Array([0,0,0,0,nt>>24,nt>>16&255,nt>>8&255,nt&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(et,nt){const rt=et.samples||[],it=rt.length,st=12+16*it,ot=new Uint8Array(st);let lt,ut,ct,dt,ft,pt;for(nt+=8+st,ot.set([et.type==="video"?1:0,0,15,1,it>>>24&255,it>>>16&255,it>>>8&255,it&255,nt>>>24&255,nt>>>16&255,nt>>>8&255,nt&255],0),lt=0;lt<it;lt++)ut=rt[lt],ct=ut.duration,dt=ut.size,ft=ut.flags,pt=ut.cts,ot.set([ct>>>24&255,ct>>>16&255,ct>>>8&255,ct&255,dt>>>24&255,dt>>>16&255,dt>>>8&255,dt&255,ft.isLeading<<2|ft.dependsOn,ft.isDependedOn<<6|ft.hasRedundancy<<4|ft.paddingValue<<1|ft.isNonSync,ft.degradPrio&61440,ft.degradPrio&15,pt>>>24&255,pt>>>16&255,pt>>>8&255,pt&255],12+16*lt);return MP4.box(MP4.types.trun,ot)}static initSegment(et){MP4.types||MP4.init();const nt=MP4.moov(et);return appendUint8Array(MP4.FTYP,nt)}}MP4.types=void 0,MP4.HDLR_TYPES=void 0,MP4.STTS=void 0,MP4.STSC=void 0,MP4.STCO=void 0,MP4.STSZ=void 0,MP4.VMHD=void 0,MP4.SMHD=void 0,MP4.STSD=void 0,MP4.FTYP=void 0,MP4.DINF=void 0;const MPEG_TS_CLOCK_FREQ_HZ=9e4;function toTimescaleFromBase(tt,et,nt=1,rt=!1){const it=tt*et*nt;return rt?Math.round(it):it}function toTimescaleFromScale(tt,et,nt=1,rt=!1){return toTimescaleFromBase(tt,et,1/nt,rt)}function toMsFromMpegTsClock(tt,et=!1){return toTimescaleFromBase(tt,1e3,1/MPEG_TS_CLOCK_FREQ_HZ,et)}function toMpegTsClockFromTimescale(tt,et=1){return toTimescaleFromBase(tt,MPEG_TS_CLOCK_FREQ_HZ,1/et)}const MAX_SILENT_FRAME_DURATION=10*1e3,AAC_SAMPLES_PER_FRAME=1024,MPEG_AUDIO_SAMPLE_PER_FRAME=1152,AC3_SAMPLES_PER_FRAME=1536;let chromeVersion=null,safariWebkitVersion=null;class MP4Remuxer{constructor(et,nt,rt,it=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=et,this.config=nt,this.typeSupported=rt,this.ISGenerated=!1,chromeVersion===null){const ot=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion=ot?parseInt(ot[1]):0}if(safariWebkitVersion===null){const st=navigator.userAgent.match(/Safari\/(\d+)/i);safariWebkitVersion=st?parseInt(st[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(et){logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=et}resetNextTimestamp(){logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(et){let nt=!1;const rt=et.reduce((it,st)=>{const ot=st.pts-it;return ot<-4294967296?(nt=!0,normalizePts(it,st.pts)):ot>0?it:st.pts},et[0].pts);return nt&&logger.debug("PTS rollover detected"),rt}remux(et,nt,rt,it,st,ot,lt,ut){let ct,dt,ft,pt,gt,_r,Yr=st,mt=st;const Kr=et.pid>-1,Xr=nt.pid>-1,Zr=nt.samples.length,Qr=et.samples.length>0,_i=lt&&Zr>0||Zr>1;if((!Kr||Qr)&&(!Xr||_i)||this.ISGenerated||lt){if(this.ISGenerated){var ns,ss,fs,os;const vs=this.videoTrackConfig;vs&&(nt.width!==vs.width||nt.height!==vs.height||((ns=nt.pixelRatio)==null?void 0:ns[0])!==((ss=vs.pixelRatio)==null?void 0:ss[0])||((fs=nt.pixelRatio)==null?void 0:fs[1])!==((os=vs.pixelRatio)==null?void 0:os[1]))&&this.resetInitSegment()}else ft=this.generateIS(et,nt,st,ot);const is=this.isVideoContiguous;let cs=-1,ps;if(_i&&(cs=findKeyframeIndex(nt.samples),!is&&this.config.forceKeyFrameOnDiscontinuity))if(_r=!0,cs>0){logger.warn(`[mp4-remuxer]: Dropped ${cs} out of ${Zr} video samples due to a missing keyframe`);const vs=this.getVideoStartPts(nt.samples);nt.samples=nt.samples.slice(cs),nt.dropped+=cs,mt+=(nt.samples[0].pts-vs)/nt.inputTimeScale,ps=mt}else cs===-1&&(logger.warn(`[mp4-remuxer]: No keyframe found out of ${Zr} video samples`),_r=!1);if(this.ISGenerated){if(Qr&&_i){const vs=this.getVideoStartPts(nt.samples),gs=(normalizePts(et.samples[0].pts,vs)-vs)/nt.inputTimeScale;Yr+=Math.max(0,gs),mt+=Math.max(0,-gs)}if(Qr){if(et.samplerate||(logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),ft=this.generateIS(et,nt,st,ot)),dt=this.remuxAudio(et,Yr,this.isAudioContiguous,ot,Xr||_i||ut===PlaylistLevelType.AUDIO?mt:void 0),_i){const vs=dt?dt.endPTS-dt.startPTS:0;nt.inputTimeScale||(logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),ft=this.generateIS(et,nt,st,ot)),ct=this.remuxVideo(nt,mt,is,vs)}}else _i&&(ct=this.remuxVideo(nt,mt,is,0));ct&&(ct.firstKeyFrame=cs,ct.independent=cs!==-1,ct.firstKeyFramePTS=ps)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(rt.samples.length&&(gt=flushTextTrackMetadataCueSamples(rt,st,this._initPTS,this._initDTS)),it.samples.length&&(pt=flushTextTrackUserdataCueSamples(it,st,this._initPTS))),{audio:dt,video:ct,initSegment:ft,independent:_r,text:pt,id3:gt}}generateIS(et,nt,rt,it){const st=et.samples,ot=nt.samples,lt=this.typeSupported,ut={},ct=this._initPTS;let dt=!ct||it,ft="audio/mp4",pt,gt,_r;if(dt&&(pt=gt=1/0),et.config&&st.length){switch(et.timescale=et.samplerate,et.segmentCodec){case"mp3":lt.mpeg?(ft="audio/mpeg",et.codec=""):lt.mp3&&(et.codec="mp3");break;case"ac3":et.codec="ac-3";break}ut.audio={id:"audio",container:ft,codec:et.codec,initSegment:et.segmentCodec==="mp3"&&lt.mpeg?new Uint8Array(0):MP4.initSegment([et]),metadata:{channelCount:et.channelCount}},dt&&(_r=et.inputTimeScale,!ct||_r!==ct.timescale?pt=gt=st[0].pts-Math.round(_r*rt):dt=!1)}if(nt.sps&&nt.pps&&ot.length){if(nt.timescale=nt.inputTimeScale,ut.video={id:"main",container:"video/mp4",codec:nt.codec,initSegment:MP4.initSegment([nt]),metadata:{width:nt.width,height:nt.height}},dt)if(_r=nt.inputTimeScale,!ct||_r!==ct.timescale){const Yr=this.getVideoStartPts(ot),mt=Math.round(_r*rt);gt=Math.min(gt,normalizePts(ot[0].dts,Yr)-mt),pt=Math.min(pt,Yr-mt)}else dt=!1;this.videoTrackConfig={width:nt.width,height:nt.height,pixelRatio:nt.pixelRatio}}if(Object.keys(ut).length)return this.ISGenerated=!0,dt?(this._initPTS={baseTime:pt,timescale:_r},this._initDTS={baseTime:gt,timescale:_r}):pt=_r=void 0,{tracks:ut,initPTS:pt,timescale:_r}}remuxVideo(et,nt,rt,it){const st=et.inputTimeScale,ot=et.samples,lt=[],ut=ot.length,ct=this._initPTS;let dt=this.nextAvcDts,ft=8,pt=this.videoSampleDuration,gt,_r,Yr=Number.POSITIVE_INFINITY,mt=Number.NEGATIVE_INFINITY,Kr=!1;if(!rt||dt===null){const ys=nt*st,Es=ot[0].pts-normalizePts(ot[0].dts,ot[0].pts);chromeVersion&&dt!==null&&Math.abs(ys-Es-dt)<15e3?rt=!0:dt=ys-Es}const Xr=ct.baseTime*st/ct.timescale;for(let ys=0;ys<ut;ys++){const Es=ot[ys];Es.pts=normalizePts(Es.pts-Xr,dt),Es.dts=normalizePts(Es.dts-Xr,dt),Es.dts<ot[ys>0?ys-1:ys].dts&&(Kr=!0)}Kr&&ot.sort(function(ys,Es){const Ts=ys.dts-Es.dts,Ss=ys.pts-Es.pts;return Ts||Ss}),gt=ot[0].dts,_r=ot[ot.length-1].dts;const Zr=_r-gt,Qr=Zr?Math.round(Zr/(ut-1)):pt||et.inputTimeScale/30;if(rt){const ys=gt-dt,Es=ys>Qr,Ts=ys<-1;if((Es||Ts)&&(Es?logger.warn(`AVC: ${toMsFromMpegTsClock(ys,!0)} ms (${ys}dts) hole between fragments detected at ${nt.toFixed(3)}`):logger.warn(`AVC: ${toMsFromMpegTsClock(-ys,!0)} ms (${ys}dts) overlapping between fragments detected at ${nt.toFixed(3)}`),!Ts||dt>=ot[0].pts||chromeVersion)){gt=dt;const Ss=ot[0].pts-ys;if(Es)ot[0].dts=gt,ot[0].pts=Ss;else for(let Ds=0;Ds<ot.length&&!(ot[Ds].dts>Ss);Ds++)ot[Ds].dts-=ys,ot[Ds].pts-=ys;logger.log(`Video: Initial PTS/DTS adjusted: ${toMsFromMpegTsClock(Ss,!0)}/${toMsFromMpegTsClock(gt,!0)}, delta: ${toMsFromMpegTsClock(ys,!0)} ms`)}}gt=Math.max(0,gt);let _i=0,rs=0,ns=gt;for(let ys=0;ys<ut;ys++){const Es=ot[ys],Ts=Es.units,Ss=Ts.length;let Ds=0;for(let Cs=0;Cs<Ss;Cs++)Ds+=Ts[Cs].data.length;rs+=Ds,_i+=Ss,Es.length=Ds,Es.dts<ns?(Es.dts=ns,ns+=Qr/4|0||1):ns=Es.dts,Yr=Math.min(Es.pts,Yr),mt=Math.max(Es.pts,mt)}_r=ot[ut-1].dts;const ss=rs+4*_i+8;let fs;try{fs=new Uint8Array(ss)}catch(ys){this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:ys,bytes:ss,reason:`fail allocating video mdat ${ss}`});return}const os=new DataView(fs.buffer);os.setUint32(0,ss),fs.set(MP4.types.mdat,4);let is=!1,cs=Number.POSITIVE_INFINITY,ps=Number.POSITIVE_INFINITY,vs=Number.NEGATIVE_INFINITY,ls=Number.NEGATIVE_INFINITY;for(let ys=0;ys<ut;ys++){const Es=ot[ys],Ts=Es.units;let Ss=0;for(let Is=0,ks=Ts.length;Is<ks;Is++){const _s=Ts[Is],Os=_s.data,Ys=_s.data.byteLength;os.setUint32(ft,Ys),ft+=4,fs.set(Os,ft),ft+=Ys,Ss+=4+Ys}let Ds;if(ys<ut-1)pt=ot[ys+1].dts-Es.dts,Ds=ot[ys+1].pts-Es.pts;else{const Is=this.config,ks=ys>0?Es.dts-ot[ys-1].dts:Qr;if(Ds=ys>0?Es.pts-ot[ys-1].pts:Qr,Is.stretchShortVideoTrack&&this.nextAudioPts!==null){const _s=Math.floor(Is.maxBufferHole*st),Os=(it?Yr+it*st:this.nextAudioPts)-Es.pts;Os>_s?(pt=Os-ks,pt<0?pt=ks:is=!0,logger.log(`[mp4-remuxer]: It is approximately ${Os/90} ms to the next segment; using duration ${pt/90} ms for the last video frame.`)):pt=ks}else pt=ks}const Cs=Math.round(Es.pts-Es.dts);cs=Math.min(cs,pt),vs=Math.max(vs,pt),ps=Math.min(ps,Ds),ls=Math.max(ls,Ds),lt.push(new Mp4Sample(Es.key,pt,Ss,Cs))}if(lt.length){if(chromeVersion){if(chromeVersion<70){const ys=lt[0].flags;ys.dependsOn=2,ys.isNonSync=0}}else if(safariWebkitVersion&&ls-ps<vs-cs&&Qr/vs<.025&&lt[0].cts===0){logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let ys=gt;for(let Es=0,Ts=lt.length;Es<Ts;Es++){const Ss=ys+lt[Es].duration,Ds=ys+lt[Es].cts;if(Es<Ts-1){const Cs=Ss+lt[Es+1].cts;lt[Es].duration=Cs-Ds}else lt[Es].duration=Es?lt[Es-1].duration:Qr;lt[Es].cts=0,ys=Ss}}}pt=is||!pt?Qr:pt,this.nextAvcDts=dt=_r+pt,this.videoSampleDuration=pt,this.isVideoContiguous=!0;const ms={data1:MP4.moof(et.sequenceNumber++,gt,_extends({},et,{samples:lt})),data2:fs,startPTS:Yr/st,endPTS:(mt+pt)/st,startDTS:gt/st,endDTS:dt/st,type:"video",hasAudio:!1,hasVideo:!0,nb:lt.length,dropped:et.dropped};return et.samples=[],et.dropped=0,ms}getSamplesPerFrame(et){switch(et.segmentCodec){case"mp3":return MPEG_AUDIO_SAMPLE_PER_FRAME;case"ac3":return AC3_SAMPLES_PER_FRAME;default:return AAC_SAMPLES_PER_FRAME}}remuxAudio(et,nt,rt,it,st){const ot=et.inputTimeScale,lt=et.samplerate?et.samplerate:ot,ut=ot/lt,ct=this.getSamplesPerFrame(et),dt=ct*ut,ft=this._initPTS,pt=et.segmentCodec==="mp3"&&this.typeSupported.mpeg,gt=[],_r=st!==void 0;let Yr=et.samples,mt=pt?0:8,Kr=this.nextAudioPts||-1;const Xr=nt*ot,Zr=ft.baseTime*ot/ft.timescale;if(this.isAudioContiguous=rt=rt||Yr.length&&Kr>0&&(it&&Math.abs(Xr-Kr)<9e3||Math.abs(normalizePts(Yr[0].pts-Zr,Xr)-Kr)<20*dt),Yr.forEach(function(gs){gs.pts=normalizePts(gs.pts-Zr,Xr)}),!rt||Kr<0){if(Yr=Yr.filter(gs=>gs.pts>=0),!Yr.length)return;st===0?Kr=0:it&&!_r?Kr=Math.max(0,Xr):Kr=Yr[0].pts}if(et.segmentCodec==="aac"){const gs=this.config.maxAudioFramesDrift;for(let us=0,ms=Kr;us<Yr.length;us++){const ys=Yr[us],Es=ys.pts,Ts=Es-ms,Ss=Math.abs(1e3*Ts/ot);if(Ts<=-gs*dt&&_r)us===0&&(logger.warn(`Audio frame @ ${(Es/ot).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*Ts/ot)} ms.`),this.nextAudioPts=Kr=ms=Es);else if(Ts>=gs*dt&&Ss<MAX_SILENT_FRAME_DURATION&&_r){let Ds=Math.round(Ts/dt);ms=Es-Ds*dt,ms<0&&(Ds--,ms+=dt),us===0&&(this.nextAudioPts=Kr=ms),logger.warn(`[mp4-remuxer]: Injecting ${Ds} audio frame @ ${(ms/ot).toFixed(3)}s due to ${Math.round(1e3*Ts/ot)} ms gap.`);for(let Cs=0;Cs<Ds;Cs++){const Is=Math.max(ms,0);let ks=AAC.getSilentFrame(et.manifestCodec||et.codec,et.channelCount);ks||(logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),ks=ys.unit.subarray()),Yr.splice(us,0,{unit:ks,pts:Is}),ms+=dt,us++}}ys.pts=ms,ms+=dt}}let Qr=null,_i=null,rs,ns=0,ss=Yr.length;for(;ss--;)ns+=Yr[ss].unit.byteLength;for(let gs=0,us=Yr.length;gs<us;gs++){const ms=Yr[gs],ys=ms.unit;let Es=ms.pts;if(_i!==null){const Ss=gt[gs-1];Ss.duration=Math.round((Es-_i)/ut)}else if(rt&&et.segmentCodec==="aac"&&(Es=Kr),Qr=Es,ns>0){ns+=mt;try{rs=new Uint8Array(ns)}catch(Ss){this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:Ss,bytes:ns,reason:`fail allocating audio mdat ${ns}`});return}pt||(new DataView(rs.buffer).setUint32(0,ns),rs.set(MP4.types.mdat,4))}else return;rs.set(ys,mt);const Ts=ys.byteLength;mt+=Ts,gt.push(new Mp4Sample(!0,ct,Ts,0)),_i=Es}const fs=gt.length;if(!fs)return;const os=gt[gt.length-1];this.nextAudioPts=Kr=_i+ut*os.duration;const is=pt?new Uint8Array(0):MP4.moof(et.sequenceNumber++,Qr/ut,_extends({},et,{samples:gt}));et.samples=[];const cs=Qr/ot,ps=Kr/ot,ls={data1:is,data2:rs,startPTS:cs,endPTS:ps,startDTS:cs,endDTS:ps,type:"audio",hasAudio:!0,hasVideo:!1,nb:fs};return this.isAudioContiguous=!0,ls}remuxEmptyAudio(et,nt,rt,it){const st=et.inputTimeScale,ot=et.samplerate?et.samplerate:st,lt=st/ot,ut=this.nextAudioPts,ct=this._initDTS,dt=ct.baseTime*9e4/ct.timescale,ft=(ut!==null?ut:it.startDTS*st)+dt,pt=it.endDTS*st+dt,gt=lt*AAC_SAMPLES_PER_FRAME,_r=Math.ceil((pt-ft)/gt),Yr=AAC.getSilentFrame(et.manifestCodec||et.codec,et.channelCount);if(logger.warn("[mp4-remuxer]: remux empty Audio"),!Yr){logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const mt=[];for(let Kr=0;Kr<_r;Kr++){const Xr=ft+Kr*gt;mt.push({unit:Yr,pts:Xr,dts:Xr})}return et.samples=mt,this.remuxAudio(et,nt,rt,!1)}}function normalizePts(tt,et){let nt;if(et===null)return tt;for(et<tt?nt=-8589934592:nt=8589934592;Math.abs(tt-et)>4294967296;)tt+=nt;return tt}function findKeyframeIndex(tt){for(let et=0;et<tt.length;et++)if(tt[et].key)return et;return-1}function flushTextTrackMetadataCueSamples(tt,et,nt,rt){const it=tt.samples.length;if(!it)return;const st=tt.inputTimeScale;for(let lt=0;lt<it;lt++){const ut=tt.samples[lt];ut.pts=normalizePts(ut.pts-nt.baseTime*st/nt.timescale,et*st)/st,ut.dts=normalizePts(ut.dts-rt.baseTime*st/rt.timescale,et*st)/st}const ot=tt.samples;return tt.samples=[],{samples:ot}}function flushTextTrackUserdataCueSamples(tt,et,nt){const rt=tt.samples.length;if(!rt)return;const it=tt.inputTimeScale;for(let ot=0;ot<rt;ot++){const lt=tt.samples[ot];lt.pts=normalizePts(lt.pts-nt.baseTime*it/nt.timescale,et*it)/it}tt.samples.sort((ot,lt)=>ot.pts-lt.pts);const st=tt.samples;return tt.samples=[],{samples:st}}class Mp4Sample{constructor(et,nt,rt,it){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=nt,this.size=rt,this.cts=it,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:et?2:1,isNonSync:et?0:1}}}class PassThroughRemuxer{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(et){this.initPTS=et,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(et,nt,rt,it){this.audioCodec=nt,this.videoCodec=rt,this.generateInitSegment(patchEncyptionData(et,it)),this.emitInitSegment=!0}generateInitSegment(et){let{audioCodec:nt,videoCodec:rt}=this;if(!(et!=null&&et.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const it=this.initData=parseInitSegment(et);it.audio&&(nt=getParsedTrackCodec(it.audio,ElementaryStreamTypes.AUDIO)),it.video&&(rt=getParsedTrackCodec(it.video,ElementaryStreamTypes.VIDEO));const st={};it.audio&&it.video?st.audiovideo={container:"video/mp4",codec:nt+","+rt,initSegment:et,id:"main"}:it.audio?st.audio={container:"audio/mp4",codec:nt,initSegment:et,id:"audio"}:it.video?st.video={container:"video/mp4",codec:rt,initSegment:et,id:"main"}:logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=st}remux(et,nt,rt,it,st,ot){var lt,ut;let{initPTS:ct,lastEndTime:dt}=this;const ft={audio:void 0,video:void 0,text:it,id3:rt,initSegment:void 0};isFiniteNumber(dt)||(dt=this.lastEndTime=st||0);const pt=nt.samples;if(!(pt!=null&&pt.length))return ft;const gt={initPTS:void 0,timescale:1};let _r=this.initData;if((lt=_r)!=null&&lt.length||(this.generateInitSegment(pt),_r=this.initData),!((ut=_r)!=null&&ut.length))return logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),ft;this.emitInitSegment&&(gt.tracks=this.initTracks,this.emitInitSegment=!1);const Yr=getDuration(pt,_r),mt=getStartDTS(_r,pt),Kr=mt===null?st:mt;(isInvalidInitPts(ct,Kr,st,Yr)||gt.timescale!==ct.timescale&&ot)&&(gt.initPTS=Kr-st,ct&&ct.timescale===1&&logger.warn(`Adjusting initPTS by ${gt.initPTS-ct.baseTime}`),this.initPTS=ct={baseTime:gt.initPTS,timescale:1});const Xr=et?Kr-ct.baseTime/ct.timescale:dt,Zr=Xr+Yr;offsetStartDTS(_r,pt,ct.baseTime/ct.timescale),Yr>0?this.lastEndTime=Zr:(logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const Qr=!!_r.audio,_i=!!_r.video;let rs="";Qr&&(rs+="audio"),_i&&(rs+="video");const ns={data1:pt,startPTS:Xr,startDTS:Xr,endPTS:Zr,endDTS:Zr,type:rs,hasAudio:Qr,hasVideo:_i,nb:1,dropped:0};return ft.audio=ns.type==="audio"?ns:void 0,ft.video=ns.type!=="audio"?ns:void 0,ft.initSegment=gt,ft.id3=flushTextTrackMetadataCueSamples(rt,st,ct,ct),it.samples.length&&(ft.text=flushTextTrackUserdataCueSamples(it,st,ct)),ft}}function isInvalidInitPts(tt,et,nt,rt){if(tt===null)return!0;const it=Math.max(rt,1),st=et-tt.baseTime/tt.timescale;return Math.abs(st-nt)>it}function getParsedTrackCodec(tt,et){const nt=tt==null?void 0:tt.codec;if(nt&&nt.length>4)return nt;if(et===ElementaryStreamTypes.AUDIO){if(nt==="ec-3"||nt==="ac-3"||nt==="alac")return nt;if(nt==="fLaC"||nt==="Opus")return getCodecCompatibleName(nt,!1);const rt="mp4a.40.5";return logger.info(`Parsed audio codec "${nt}" or audio object type not handled. Using "${rt}"`),rt}return logger.warn(`Unhandled video codec "${nt}"`),nt==="hvc1"||nt==="hev1"?"hvc1.1.6.L120.90":nt==="av01"?"av01.0.04M.08":"avc1.42e01e"}let now;try{now=self.performance.now.bind(self.performance)}catch(tt){logger.debug("Unable to use Performance API on this environment"),now=optionalSelf==null?void 0:optionalSelf.Date.now}const muxConfig=[{demux:MP4Demuxer,remux:PassThroughRemuxer},{demux:TSDemuxer,remux:MP4Remuxer},{demux:AACDemuxer,remux:MP4Remuxer},{demux:MP3Demuxer,remux:MP4Remuxer}];muxConfig.splice(2,0,{demux:AC3Demuxer,remux:MP4Remuxer});class Transmuxer{constructor(et,nt,rt,it,st){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=et,this.typeSupported=nt,this.config=rt,this.vendor=it,this.id=st}configure(et){this.transmuxConfig=et,this.decrypter&&this.decrypter.reset()}push(et,nt,rt,it){const st=rt.transmuxing;st.executeStart=now();let ot=new Uint8Array(et);const{currentTransmuxState:lt,transmuxConfig:ut}=this;it&&(this.currentTransmuxState=it);const{contiguous:ct,discontinuity:dt,trackSwitch:ft,accurateTimeOffset:pt,timeOffset:gt,initSegmentChange:_r}=it||lt,{audioCodec:Yr,videoCodec:mt,defaultInitPts:Kr,duration:Xr,initSegmentData:Zr}=ut,Qr=getEncryptionType(ot,nt);if(Qr&&Qr.method==="AES-128"){const ss=this.getDecrypter();if(ss.isSync()){let fs=ss.softwareDecrypt(ot,Qr.key.buffer,Qr.iv.buffer);if(rt.part>-1&&(fs=ss.flush()),!fs)return st.executeEnd=now(),emptyResult(rt);ot=new Uint8Array(fs)}else return this.decryptionPromise=ss.webCryptoDecrypt(ot,Qr.key.buffer,Qr.iv.buffer).then(fs=>{const os=this.push(fs,null,rt);return this.decryptionPromise=null,os}),this.decryptionPromise}const _i=this.needsProbing(dt,ft);if(_i){const ss=this.configureTransmuxer(ot);if(ss)return logger.warn(`[transmuxer] ${ss.message}`),this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:ss,reason:ss.message}),st.executeEnd=now(),emptyResult(rt)}(dt||ft||_r||_i)&&this.resetInitSegment(Zr,Yr,mt,Xr,nt),(dt||_r||_i)&&this.resetInitialTimestamp(Kr),ct||this.resetContiguity();const rs=this.transmux(ot,Qr,gt,pt,rt),ns=this.currentTransmuxState;return ns.contiguous=!0,ns.discontinuity=!1,ns.trackSwitch=!1,st.executeEnd=now(),rs}flush(et){const nt=et.transmuxing;nt.executeStart=now();const{decrypter:rt,currentTransmuxState:it,decryptionPromise:st}=this;if(st)return st.then(()=>this.flush(et));const ot=[],{timeOffset:lt}=it;if(rt){const ft=rt.flush();ft&&ot.push(this.push(ft,null,et))}const{demuxer:ut,remuxer:ct}=this;if(!ut||!ct)return nt.executeEnd=now(),[emptyResult(et)];const dt=ut.flush(lt);return isPromise(dt)?dt.then(ft=>(this.flushRemux(ot,ft,et),ot)):(this.flushRemux(ot,dt,et),ot)}flushRemux(et,nt,rt){const{audioTrack:it,videoTrack:st,id3Track:ot,textTrack:lt}=nt,{accurateTimeOffset:ut,timeOffset:ct}=this.currentTransmuxState;logger.log(`[transmuxer.ts]: Flushed fragment ${rt.sn}${rt.part>-1?" p: "+rt.part:""} of level ${rt.level}`);const dt=this.remuxer.remux(it,st,ot,lt,ct,ut,!0,this.id);et.push({remuxResult:dt,chunkMeta:rt}),rt.transmuxing.executeEnd=now()}resetInitialTimestamp(et){const{demuxer:nt,remuxer:rt}=this;!nt||!rt||(nt.resetTimeStamp(et),rt.resetTimeStamp(et))}resetContiguity(){const{demuxer:et,remuxer:nt}=this;!et||!nt||(et.resetContiguity(),nt.resetNextTimestamp())}resetInitSegment(et,nt,rt,it,st){const{demuxer:ot,remuxer:lt}=this;!ot||!lt||(ot.resetInitSegment(et,nt,rt,it),lt.resetInitSegment(et,nt,rt,st))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(et,nt,rt,it,st){let ot;return nt&&nt.method==="SAMPLE-AES"?ot=this.transmuxSampleAes(et,nt,rt,it,st):ot=this.transmuxUnencrypted(et,rt,it,st),ot}transmuxUnencrypted(et,nt,rt,it){const{audioTrack:st,videoTrack:ot,id3Track:lt,textTrack:ut}=this.demuxer.demux(et,nt,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(st,ot,lt,ut,nt,rt,!1,this.id),chunkMeta:it}}transmuxSampleAes(et,nt,rt,it,st){return this.demuxer.demuxSampleAes(et,nt,rt).then(ot=>({remuxResult:this.remuxer.remux(ot.audioTrack,ot.videoTrack,ot.id3Track,ot.textTrack,rt,it,!1,this.id),chunkMeta:st}))}configureTransmuxer(et){const{config:nt,observer:rt,typeSupported:it,vendor:st}=this;let ot;for(let pt=0,gt=muxConfig.length;pt<gt;pt++){var lt;if((lt=muxConfig[pt].demux)!=null&&lt.probe(et)){ot=muxConfig[pt];break}}if(!ot)return new Error("Failed to find demuxer by probing fragment data");const ut=this.demuxer,ct=this.remuxer,dt=ot.remux,ft=ot.demux;(!ct||!(ct instanceof dt))&&(this.remuxer=new dt(rt,nt,it,st)),(!ut||!(ut instanceof ft))&&(this.demuxer=new ft(rt,nt,it),this.probe=ft.probe)}needsProbing(et,nt){return!this.demuxer||!this.remuxer||et||nt}getDecrypter(){let et=this.decrypter;return et||(et=this.decrypter=new Decrypter(this.config)),et}}function getEncryptionType(tt,et){let nt=null;return tt.byteLength>0&&(et==null?void 0:et.key)!=null&&et.iv!==null&&et.method!=null&&(nt=et),nt}const emptyResult=tt=>({remuxResult:{},chunkMeta:tt});function isPromise(tt){return"then"in tt&&tt.then instanceof Function}class TransmuxConfig{constructor(et,nt,rt,it,st){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=et,this.videoCodec=nt,this.initSegmentData=rt,this.duration=it,this.defaultInitPts=st||null}}class TransmuxState{constructor(et,nt,rt,it,st,ot){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=et,this.contiguous=nt,this.accurateTimeOffset=rt,this.trackSwitch=it,this.timeOffset=st,this.initSegmentChange=ot}}var eventemitter3={exports:{}};(function(tt){var et=Object.prototype.hasOwnProperty,nt="~";function rt(){}Object.create&&(rt.prototype=Object.create(null),new rt().__proto__||(nt=!1));function it(ut,ct,dt){this.fn=ut,this.context=ct,this.once=dt||!1}function st(ut,ct,dt,ft,pt){if(typeof dt!="function")throw new TypeError("The listener must be a function");var gt=new it(dt,ft||ut,pt),_r=nt?nt+ct:ct;return ut._events[_r]?ut._events[_r].fn?ut._events[_r]=[ut._events[_r],gt]:ut._events[_r].push(gt):(ut._events[_r]=gt,ut._eventsCount++),ut}function ot(ut,ct){--ut._eventsCount===0?ut._events=new rt:delete ut._events[ct]}function lt(){this._events=new rt,this._eventsCount=0}lt.prototype.eventNames=function(){var ct=[],dt,ft;if(this._eventsCount===0)return ct;for(ft in dt=this._events)et.call(dt,ft)&&ct.push(nt?ft.slice(1):ft);return Object.getOwnPropertySymbols?ct.concat(Object.getOwnPropertySymbols(dt)):ct},lt.prototype.listeners=function(ct){var dt=nt?nt+ct:ct,ft=this._events[dt];if(!ft)return[];if(ft.fn)return[ft.fn];for(var pt=0,gt=ft.length,_r=new Array(gt);pt<gt;pt++)_r[pt]=ft[pt].fn;return _r},lt.prototype.listenerCount=function(ct){var dt=nt?nt+ct:ct,ft=this._events[dt];return ft?ft.fn?1:ft.length:0},lt.prototype.emit=function(ct,dt,ft,pt,gt,_r){var Yr=nt?nt+ct:ct;if(!this._events[Yr])return!1;var mt=this._events[Yr],Kr=arguments.length,Xr,Zr;if(mt.fn){switch(mt.once&&this.removeListener(ct,mt.fn,void 0,!0),Kr){case 1:return mt.fn.call(mt.context),!0;case 2:return mt.fn.call(mt.context,dt),!0;case 3:return mt.fn.call(mt.context,dt,ft),!0;case 4:return mt.fn.call(mt.context,dt,ft,pt),!0;case 5:return mt.fn.call(mt.context,dt,ft,pt,gt),!0;case 6:return mt.fn.call(mt.context,dt,ft,pt,gt,_r),!0}for(Zr=1,Xr=new Array(Kr-1);Zr<Kr;Zr++)Xr[Zr-1]=arguments[Zr];mt.fn.apply(mt.context,Xr)}else{var Qr=mt.length,_i;for(Zr=0;Zr<Qr;Zr++)switch(mt[Zr].once&&this.removeListener(ct,mt[Zr].fn,void 0,!0),Kr){case 1:mt[Zr].fn.call(mt[Zr].context);break;case 2:mt[Zr].fn.call(mt[Zr].context,dt);break;case 3:mt[Zr].fn.call(mt[Zr].context,dt,ft);break;case 4:mt[Zr].fn.call(mt[Zr].context,dt,ft,pt);break;default:if(!Xr)for(_i=1,Xr=new Array(Kr-1);_i<Kr;_i++)Xr[_i-1]=arguments[_i];mt[Zr].fn.apply(mt[Zr].context,Xr)}}return!0},lt.prototype.on=function(ct,dt,ft){return st(this,ct,dt,ft,!1)},lt.prototype.once=function(ct,dt,ft){return st(this,ct,dt,ft,!0)},lt.prototype.removeListener=function(ct,dt,ft,pt){var gt=nt?nt+ct:ct;if(!this._events[gt])return this;if(!dt)return ot(this,gt),this;var _r=this._events[gt];if(_r.fn)_r.fn===dt&&(!pt||_r.once)&&(!ft||_r.context===ft)&&ot(this,gt);else{for(var Yr=0,mt=[],Kr=_r.length;Yr<Kr;Yr++)(_r[Yr].fn!==dt||pt&&!_r[Yr].once||ft&&_r[Yr].context!==ft)&&mt.push(_r[Yr]);mt.length?this._events[gt]=mt.length===1?mt[0]:mt:ot(this,gt)}return this},lt.prototype.removeAllListeners=function(ct){var dt;return ct?(dt=nt?nt+ct:ct,this._events[dt]&&ot(this,dt)):(this._events=new rt,this._eventsCount=0),this},lt.prototype.off=lt.prototype.removeListener,lt.prototype.addListener=lt.prototype.on,lt.prefixed=nt,lt.EventEmitter=lt,tt.exports=lt})(eventemitter3);var eventemitter3Exports=eventemitter3.exports,EventEmitter=getDefaultExportFromCjs(eventemitter3Exports);class TransmuxerInterface{constructor(et,nt,rt,it){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const st=et.config;this.hls=et,this.id=nt,this.useWorker=!!st.enableWorker,this.onTransmuxComplete=rt,this.onFlush=it;const ot=(dt,ft)=>{ft=ft||{},ft.frag=this.frag,ft.id=this.id,dt===Events.ERROR&&(this.error=ft.error),this.hls.trigger(dt,ft)};this.observer=new EventEmitter,this.observer.on(Events.FRAG_DECRYPTED,ot),this.observer.on(Events.ERROR,ot);const lt=getMediaSource(st.preferManagedMediaSource)||{isTypeSupported:()=>!1},ut={mpeg:lt.isTypeSupported("audio/mpeg"),mp3:lt.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:lt.isTypeSupported('audio/mp4; codecs="ac-3"')},ct=navigator.vendor;if(this.useWorker&&typeof Worker<"u"&&(st.workerPath||hasUMDWorker())){try{st.workerPath?(logger.log(`loading Web Worker ${st.workerPath} for "${nt}"`),this.workerContext=loadWorker(st.workerPath)):(logger.log(`injecting Web Worker for "${nt}"`),this.workerContext=injectWorker()),this.onwmsg=pt=>this.onWorkerMessage(pt);const{worker:ft}=this.workerContext;ft.addEventListener("message",this.onwmsg),ft.onerror=pt=>{const gt=new Error(`${pt.message}  (${pt.filename}:${pt.lineno})`);st.enableWorker=!1,logger.warn(`Error in "${nt}" Web Worker, fallback to inline`),this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:gt})},ft.postMessage({cmd:"init",typeSupported:ut,vendor:ct,id:nt,config:JSON.stringify(st)})}catch(ft){logger.warn(`Error setting up "${nt}" Web Worker, fallback to inline`,ft),this.resetWorker(),this.error=null,this.transmuxer=new Transmuxer(this.observer,ut,st,ct,nt)}return}this.transmuxer=new Transmuxer(this.observer,ut,st,ct,nt)}resetWorker(){if(this.workerContext){const{worker:et,objectURL:nt}=this.workerContext;nt&&self.URL.revokeObjectURL(nt),et.removeEventListener("message",this.onwmsg),et.onerror=null,et.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const nt=this.transmuxer;nt&&(nt.destroy(),this.transmuxer=null)}const et=this.observer;et&&et.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(et,nt,rt,it,st,ot,lt,ut,ct,dt){var ft,pt;ct.transmuxing.start=self.performance.now();const{transmuxer:gt}=this,_r=ot?ot.start:st.start,Yr=st.decryptdata,mt=this.frag,Kr=!(mt&&st.cc===mt.cc),Xr=!(mt&&ct.level===mt.level),Zr=mt?ct.sn-mt.sn:-1,Qr=this.part?ct.part-this.part.index:-1,_i=Zr===0&&ct.id>1&&ct.id===(mt==null?void 0:mt.stats.chunkCount),rs=!Xr&&(Zr===1||Zr===0&&(Qr===1||_i&&Qr<=0)),ns=self.performance.now();(Xr||Zr||st.stats.parsing.start===0)&&(st.stats.parsing.start=ns),ot&&(Qr||!rs)&&(ot.stats.parsing.start=ns);const ss=!(mt&&((ft=st.initSegment)==null?void 0:ft.url)===((pt=mt.initSegment)==null?void 0:pt.url)),fs=new TransmuxState(Kr,rs,ut,Xr,_r,ss);if(!rs||Kr||ss){logger.log(`[transmuxer-interface, ${st.type}]: Starting new transmux session for sn: ${ct.sn} p: ${ct.part} level: ${ct.level} id: ${ct.id}
        discontinuity: ${Kr}
        trackSwitch: ${Xr}
        contiguous: ${rs}
        accurateTimeOffset: ${ut}
        timeOffset: ${_r}
        initSegmentChange: ${ss}`);const os=new TransmuxConfig(rt,it,nt,lt,dt);this.configureTransmuxer(os)}if(this.frag=st,this.part=ot,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:et,decryptdata:Yr,chunkMeta:ct,state:fs},et instanceof ArrayBuffer?[et]:[]);else if(gt){const os=gt.push(et,Yr,ct,fs);isPromise(os)?(gt.async=!0,os.then(is=>{this.handleTransmuxComplete(is)}).catch(is=>{this.transmuxerError(is,ct,"transmuxer-interface push error")})):(gt.async=!1,this.handleTransmuxComplete(os))}}flush(et){et.transmuxing.start=self.performance.now();const{transmuxer:nt}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:et});else if(nt){let rt=nt.flush(et);isPromise(rt)||nt.async?(isPromise(rt)||(rt=Promise.resolve(rt)),rt.then(st=>{this.handleFlushResult(st,et)}).catch(st=>{this.transmuxerError(st,et,"transmuxer-interface flush error")})):this.handleFlushResult(rt,et)}}transmuxerError(et,nt,rt){this.hls&&(this.error=et,this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:nt,fatal:!1,error:et,err:et,reason:rt}))}handleFlushResult(et,nt){et.forEach(rt=>{this.handleTransmuxComplete(rt)}),this.onFlush(nt)}onWorkerMessage(et){const nt=et.data,rt=this.hls;switch(nt.event){case"init":{var it;const st=(it=this.workerContext)==null?void 0:it.objectURL;st&&self.URL.revokeObjectURL(st);break}case"transmuxComplete":{this.handleTransmuxComplete(nt.data);break}case"flush":{this.onFlush(nt.data);break}case"workerLog":logger[nt.data.logType]&&logger[nt.data.logType](nt.data.message);break;default:{nt.data=nt.data||{},nt.data.frag=this.frag,nt.data.id=this.id,rt.trigger(nt.event,nt.data);break}}}configureTransmuxer(et){const{transmuxer:nt}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:et}):nt&&nt.configure(et)}handleTransmuxComplete(et){et.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(et)}}function subtitleOptionsIdentical(tt,et){if(tt.length!==et.length)return!1;for(let nt=0;nt<tt.length;nt++)if(!mediaAttributesIdentical(tt[nt].attrs,et[nt].attrs))return!1;return!0}function mediaAttributesIdentical(tt,et,nt){const rt=tt["STABLE-RENDITION-ID"];return rt&&!nt?rt===et["STABLE-RENDITION-ID"]:!(nt||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(it=>tt[it]!==et[it])}function subtitleTrackMatchesTextTrack(tt,et){return et.label.toLowerCase()===tt.name.toLowerCase()&&(!et.language||et.language.toLowerCase()===(tt.lang||"").toLowerCase())}const TICK_INTERVAL$2=100;class AudioStreamController extends BaseStreamController{constructor(et,nt,rt){super(et,nt,rt,"[audio-stream-controller]",PlaylistLevelType.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:et}=this;et.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),et.on(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),et.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),et.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),et.on(Events.ERROR,this.onError,this),et.on(Events.BUFFER_RESET,this.onBufferReset,this),et.on(Events.BUFFER_CREATED,this.onBufferCreated,this),et.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),et.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),et.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),et.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:et}=this;et.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),et.off(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),et.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),et.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),et.off(Events.ERROR,this.onError,this),et.off(Events.BUFFER_RESET,this.onBufferReset,this),et.off(Events.BUFFER_CREATED,this.onBufferCreated,this),et.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),et.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),et.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),et.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(et,{frag:nt,id:rt,initPTS:it,timescale:st}){if(rt==="main"){const ot=nt.cc;this.initPTS[nt.cc]={baseTime:it,timescale:st},this.log(`InitPTS for cc: ${ot} found from main: ${it}`),this.videoTrackCC=ot,this.state===State.WAITING_INIT_PTS&&this.tick()}}startLoad(et){if(!this.levels){this.startPosition=et,this.state=State.STOPPED;return}const nt=this.lastCurrentTime;this.stopLoad(),this.setInterval(TICK_INTERVAL$2),nt>0&&et===-1?(this.log(`Override startPosition with lastCurrentTime @${nt.toFixed(3)}`),et=nt,this.state=State.IDLE):(this.loadedmetadata=!1,this.state=State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=et,this.tick()}doTick(){switch(this.state){case State.IDLE:this.doTickIdle();break;case State.WAITING_TRACK:{var et;const{levels:rt,trackId:it}=this,st=rt==null||(et=rt[it])==null?void 0:et.details;if(st){if(this.waitForCdnTuneIn(st))break;this.state=State.WAITING_INIT_PTS}break}case State.FRAG_LOADING_WAITING_RETRY:{var nt;const rt=performance.now(),it=this.retryDate;if(!it||rt>=it||(nt=this.media)!=null&&nt.seeking){const{levels:st,trackId:ot}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((st==null?void 0:st[ot])||null),this.state=State.IDLE}break}case State.WAITING_INIT_PTS:{const rt=this.waitingData;if(rt){const{frag:it,part:st,cache:ot,complete:lt}=rt;if(this.initPTS[it.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=State.FRAG_LOADING;const ut=ot.flush(),ct={frag:it,part:st,payload:ut,networkDetails:null};this._handleFragmentLoadProgress(ct),lt&&super._handleFragmentLoadComplete(ct)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${it.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const ut=this.getLoadPosition(),ct=BufferHelper.bufferInfo(this.mediaBuffer,ut,this.config.maxBufferHole);fragmentWithinToleranceTest(ct.end,this.config.maxFragLookUpTolerance,it)<0&&(this.log(`Waiting fragment cc (${it.cc}) @ ${it.start} cancelled because another fragment at ${ct.end} is needed`),this.clearWaitingFragment())}}else this.state=State.IDLE}}this.onTickEnd()}clearWaitingFragment(){const et=this.waitingData;et&&(this.fragmentTracker.removeFragment(et.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=State.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:et}=this;et!=null&&et.readyState&&(this.lastCurrentTime=et.currentTime)}doTickIdle(){const{hls:et,levels:nt,media:rt,trackId:it}=this,st=et.config;if(!rt&&(this.startFragRequested||!st.startFragPrefetch)||!(nt!=null&&nt[it]))return;const ot=nt[it],lt=ot.details;if(!lt||lt.live&&this.levelLastLoaded!==ot||this.waitForCdnTuneIn(lt)){this.state=State.WAITING_TRACK;return}const ut=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&ut&&(this.bufferFlushed=!1,this.afterBufferFlushed(ut,ElementaryStreamTypes.AUDIO,PlaylistLevelType.AUDIO));const ct=this.getFwdBufferInfo(ut,PlaylistLevelType.AUDIO);if(ct===null)return;const{bufferedTrack:dt,switchingTrack:ft}=this;if(!ft&&this._streamEnded(ct,lt)){et.trigger(Events.BUFFER_EOS,{type:"audio"}),this.state=State.ENDED;return}const pt=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,PlaylistLevelType.MAIN),gt=ct.len,_r=this.getMaxBufferLength(pt==null?void 0:pt.len),Yr=lt.fragments,mt=Yr[0].start;let Kr=this.flushing?this.getLoadPosition():ct.end;if(ft&&rt){const _i=this.getLoadPosition();dt&&!mediaAttributesIdentical(ft.attrs,dt.attrs)&&(Kr=_i),lt.PTSKnown&&_i<mt&&(ct.end>mt||ct.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),rt.currentTime=mt+.05)}if(gt>=_r&&!ft&&Kr<Yr[Yr.length-1].start)return;let Xr=this.getNextFragment(Kr,lt),Zr=!1;if(Xr&&this.isLoopLoading(Xr,Kr)&&(Zr=!!Xr.gap,Xr=this.getNextFragmentLoopLoading(Xr,lt,ct,PlaylistLevelType.MAIN,_r)),!Xr){this.bufferFlushed=!0;return}const Qr=pt&&Xr.start>pt.end+lt.targetduration;if(Qr||!(pt!=null&&pt.len)&&ct.len){const _i=this.getAppendedFrag(Xr.start,PlaylistLevelType.MAIN);if(_i===null||(Zr||(Zr=!!_i.gap||!!Qr&&pt.len===0),Qr&&!Zr||Zr&&ct.nextStart&&ct.nextStart<_i.end))return}this.loadFragment(Xr,ot,Kr)}getMaxBufferLength(et){const nt=super.getMaxBufferLength();return et?Math.min(Math.max(nt,et),this.config.maxMaxBufferLength):nt}onMediaDetaching(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}onAudioTracksUpdated(et,{audioTracks:nt}){this.resetTransmuxer(),this.levels=nt.map(rt=>new Level(rt))}onAudioTrackSwitching(et,nt){const rt=!!nt.url;this.trackId=nt.id;const{fragCurrent:it}=this;it&&(it.abortRequests(),this.removeUnbufferedFrags(it.start)),this.resetLoadingState(),rt?this.setInterval(TICK_INTERVAL$2):this.resetTransmuxer(),rt?(this.switchingTrack=nt,this.state=State.IDLE,this.flushAudioIfNeeded(nt)):(this.switchingTrack=null,this.bufferedTrack=nt,this.state=State.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(et,nt){this.mainDetails=nt.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(et,nt){var rt;if(this.mainDetails==null){this.cachedTrackLoadedData=nt;return}const{levels:it}=this,{details:st,id:ot}=nt;if(!it){this.warn(`Audio tracks were reset while loading level ${ot}`);return}this.log(`Audio track ${ot} loaded [${st.startSN},${st.endSN}]${st.lastPartSn?`[part-${st.lastPartSn}-${st.lastPartIndex}]`:""},duration:${st.totalduration}`);const lt=it[ot];let ut=0;if(st.live||(rt=lt.details)!=null&&rt.live){this.checkLiveUpdate(st);const dt=this.mainDetails;if(st.deltaUpdateFailed||!dt)return;if(!lt.details&&st.hasProgramDateTime&&dt.hasProgramDateTime)alignMediaPlaylistByPDT(st,dt),ut=st.fragments[0].start;else{var ct;ut=this.alignPlaylists(st,lt.details,(ct=this.levelLastLoaded)==null?void 0:ct.details)}}lt.details=st,this.levelLastLoaded=lt,!this.startFragRequested&&(this.mainDetails||!st.live)&&this.setStartPosition(this.mainDetails||st,ut),this.state===State.WAITING_TRACK&&!this.waitForCdnTuneIn(st)&&(this.state=State.IDLE),this.tick()}_handleFragmentLoadProgress(et){var nt;const{frag:rt,part:it,payload:st}=et,{config:ot,trackId:lt,levels:ut}=this;if(!ut){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${rt.sn} of level ${rt.level} will not be buffered`);return}const ct=ut[lt];if(!ct){this.warn("Audio track is undefined on fragment load progress");return}const dt=ct.details;if(!dt){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(rt.start);return}const ft=ot.defaultAudioCodec||ct.audioCodec||"mp4a.40.2";let pt=this.transmuxer;pt||(pt=this.transmuxer=new TransmuxerInterface(this.hls,PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const gt=this.initPTS[rt.cc],_r=(nt=rt.initSegment)==null?void 0:nt.data;if(gt!==void 0){const mt=it?it.index:-1,Kr=mt!==-1,Xr=new ChunkMetadata(rt.level,rt.sn,rt.stats.chunkCount,st.byteLength,mt,Kr);pt.push(st,_r,ft,"",rt,it,dt.totalduration,!1,Xr,gt)}else{this.log(`Unknown video PTS for cc ${rt.cc}, waiting for video PTS before demuxing audio frag ${rt.sn} of [${dt.startSN} ,${dt.endSN}],track ${lt}`);const{cache:Yr}=this.waitingData=this.waitingData||{frag:rt,part:it,cache:new ChunkCache,complete:!1};Yr.push(new Uint8Array(st)),this.waitingVideoCC=this.videoTrackCC,this.state=State.WAITING_INIT_PTS}}_handleFragmentLoadComplete(et){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(et)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(et,nt){const rt=nt.tracks.audio;rt&&(this.mediaBuffer=rt.buffer||null),nt.tracks.video&&(this.videoBuffer=nt.tracks.video.buffer||null)}onFragBuffered(et,nt){const{frag:rt,part:it}=nt;if(rt.type!==PlaylistLevelType.AUDIO){if(!this.loadedmetadata&&rt.type===PlaylistLevelType.MAIN){const st=this.videoBuffer||this.media;st&&BufferHelper.getBuffered(st).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(rt)){this.warn(`Fragment ${rt.sn}${it?" p: "+it.index:""} of level ${rt.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(rt.sn!=="initSegment"){this.fragPrevious=rt;const st=this.switchingTrack;st&&(this.bufferedTrack=st,this.switchingTrack=null,this.hls.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},st)))}this.fragBufferedComplete(rt,it)}onError(et,nt){var rt;if(nt.fatal){this.state=State.ERROR;return}switch(nt.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.AUDIO,nt);break;case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:!nt.levelRetry&&this.state===State.WAITING_TRACK&&((rt=nt.context)==null?void 0:rt.type)===PlaylistContextType.AUDIO_TRACK&&(this.state=State.IDLE);break;case ErrorDetails.BUFFER_APPEND_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:if(!nt.parent||nt.parent!=="audio")return;if(nt.details===ErrorDetails.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(nt)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(nt);break}}onBufferFlushing(et,{type:nt}){nt!==ElementaryStreamTypes.VIDEO&&(this.flushing=!0)}onBufferFlushed(et,{type:nt}){if(nt!==ElementaryStreamTypes.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===State.ENDED&&(this.state=State.IDLE);const rt=this.mediaBuffer||this.media;rt&&(this.afterBufferFlushed(rt,nt,PlaylistLevelType.AUDIO),this.tick())}}_handleTransmuxComplete(et){var nt;const rt="audio",{hls:it}=this,{remuxResult:st,chunkMeta:ot}=et,lt=this.getCurrentContext(ot);if(!lt){this.resetWhenMissingContext(ot);return}const{frag:ut,part:ct,level:dt}=lt,{details:ft}=dt,{audio:pt,text:gt,id3:_r,initSegment:Yr}=st;if(this.fragContextChanged(ut)||!ft){this.fragmentTracker.removeFragment(ut);return}if(this.state=State.PARSING,this.switchingTrack&&pt&&this.completeAudioSwitch(this.switchingTrack),Yr!=null&&Yr.tracks){const mt=ut.initSegment||ut;this._bufferInitSegment(dt,Yr.tracks,mt,ot),it.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:mt,id:rt,tracks:Yr.tracks})}if(pt){const{startPTS:mt,endPTS:Kr,startDTS:Xr,endDTS:Zr}=pt;ct&&(ct.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:mt,endPTS:Kr,startDTS:Xr,endDTS:Zr}),ut.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,mt,Kr,Xr,Zr),this.bufferFragmentData(pt,ut,ct,ot)}if(_r!=null&&(nt=_r.samples)!=null&&nt.length){const mt=_extends({id:rt,frag:ut,details:ft},_r);it.trigger(Events.FRAG_PARSING_METADATA,mt)}if(gt){const mt=_extends({id:rt,frag:ut,details:ft},gt);it.trigger(Events.FRAG_PARSING_USERDATA,mt)}}_bufferInitSegment(et,nt,rt,it){if(this.state!==State.PARSING)return;nt.video&&delete nt.video;const st=nt.audio;if(!st)return;st.id="audio";const ot=et.audioCodec;this.log(`Init audio buffer, container:${st.container}, codecs[level/parsed]=[${ot}/${st.codec}]`),ot&&ot.split(",").length===1&&(st.levelCodec=ot),this.hls.trigger(Events.BUFFER_CODECS,nt);const lt=st.initSegment;if(lt!=null&&lt.byteLength){const ut={type:"audio",frag:rt,part:null,chunkMeta:it,parent:rt.type,data:lt};this.hls.trigger(Events.BUFFER_APPENDING,ut)}this.tickImmediate()}loadFragment(et,nt,rt){const it=this.fragmentTracker.getState(et);if(this.fragCurrent=et,this.switchingTrack||it===FragmentState.NOT_LOADED||it===FragmentState.PARTIAL){var st;if(et.sn==="initSegment")this._loadInitSegment(et,nt);else if((st=nt.details)!=null&&st.live&&!this.initPTS[et.cc]){this.log(`Waiting for video PTS in continuity counter ${et.cc} of live stream before loading audio fragment ${et.sn} of level ${this.trackId}`),this.state=State.WAITING_INIT_PTS;const ot=this.mainDetails;ot&&ot.fragments[0].start!==nt.details.fragments[0].start&&alignMediaPlaylistByPDT(nt.details,ot)}else this.startFragRequested=!0,super.loadFragment(et,nt,rt)}else this.clearTrackerIfNeeded(et)}flushAudioIfNeeded(et){const{media:nt,bufferedTrack:rt}=this,it=rt==null?void 0:rt.attrs,st=et.attrs;nt&&it&&(it.CHANNELS!==st.CHANNELS||rt.name!==et.name||rt.lang!==et.lang)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}completeAudioSwitch(et){const{hls:nt}=this;this.flushAudioIfNeeded(et),this.bufferedTrack=et,this.switchingTrack=null,nt.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},et))}}class AudioTrackController extends BasePlaylistController{constructor(et){super(et,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:et}=this;et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.on(Events.LEVEL_LOADING,this.onLevelLoading,this),et.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),et.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),et.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:et}=this;et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.off(Events.LEVEL_LOADING,this.onLevelLoading,this),et.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),et.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),et.off(Events.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(et,nt){this.tracks=nt.audioTracks||[]}onAudioTrackLoaded(et,nt){const{id:rt,groupId:it,details:st}=nt,ot=this.tracksInGroup[rt];if(!ot||ot.groupId!==it){this.warn(`Audio track with id:${rt} and group:${it} not found in active group ${ot==null?void 0:ot.groupId}`);return}const lt=ot.details;ot.details=nt.details,this.log(`Audio track ${rt} "${ot.name}" lang:${ot.lang} group:${it} loaded [${st.startSN}-${st.endSN}]`),rt===this.trackId&&this.playlistLoaded(rt,nt,lt)}onLevelLoading(et,nt){this.switchLevel(nt.level)}onLevelSwitching(et,nt){this.switchLevel(nt.level)}switchLevel(et){const nt=this.hls.levels[et];if(!nt)return;const rt=nt.audioGroups||null,it=this.groupIds;let st=this.currentTrack;if(!rt||(it==null?void 0:it.length)!==(rt==null?void 0:rt.length)||rt!=null&&rt.some(lt=>(it==null?void 0:it.indexOf(lt))===-1)){this.groupIds=rt,this.trackId=-1,this.currentTrack=null;const lt=this.tracks.filter(pt=>!rt||rt.indexOf(pt.groupId)!==-1);if(lt.length)this.selectDefaultTrack&&!lt.some(pt=>pt.default)&&(this.selectDefaultTrack=!1),lt.forEach((pt,gt)=>{pt.id=gt});else if(!st&&!this.tracksInGroup.length)return;this.tracksInGroup=lt;const ut=this.hls.config.audioPreference;if(!st&&ut){const pt=findMatchingOption(ut,lt,audioMatchPredicate);if(pt>-1)st=lt[pt];else{const gt=findMatchingOption(ut,this.tracks);st=this.tracks[gt]}}let ct=this.findTrackId(st);ct===-1&&st&&(ct=this.findTrackId(null));const dt={audioTracks:lt};this.log(`Updating audio tracks, ${lt.length} track(s) found in group(s): ${rt==null?void 0:rt.join(",")}`),this.hls.trigger(Events.AUDIO_TRACKS_UPDATED,dt);const ft=this.trackId;if(ct!==-1&&ft===-1)this.setAudioTrack(ct);else if(lt.length&&ft===-1){var ot;const pt=new Error(`No audio track selected for current audio group-ID(s): ${(ot=this.groupIds)==null?void 0:ot.join(",")} track count: ${lt.length}`);this.warn(pt.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:pt})}}else this.shouldReloadPlaylist(st)&&this.setAudioTrack(this.trackId)}onError(et,nt){nt.fatal||!nt.context||nt.context.type===PlaylistContextType.AUDIO_TRACK&&nt.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(nt.context.groupId)!==-1)&&(this.requestScheduled=-1,this.checkRetry(nt))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(et){this.selectDefaultTrack=!1,this.setAudioTrack(et)}setAudioOption(et){const nt=this.hls;if(nt.config.audioPreference=et,et){const rt=this.allAudioTracks;if(this.selectDefaultTrack=!1,rt.length){const it=this.currentTrack;if(it&&matchesOption(et,it,audioMatchPredicate))return it;const st=findMatchingOption(et,this.tracksInGroup,audioMatchPredicate);if(st>-1){const ot=this.tracksInGroup[st];return this.setAudioTrack(st),ot}else if(it){let ot=nt.loadLevel;ot===-1&&(ot=nt.firstAutoLevel);const lt=findClosestLevelWithAudioGroup(et,nt.levels,rt,ot,audioMatchPredicate);if(lt===-1)return null;nt.nextLoadLevel=lt}if(et.channels||et.audioCodec){const ot=findMatchingOption(et,rt);if(ot>-1)return rt[ot]}}}return null}setAudioTrack(et){const nt=this.tracksInGroup;if(et<0||et>=nt.length){this.warn(`Invalid audio track id: ${et}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const rt=this.currentTrack,it=nt[et],st=it.details&&!it.details.live;if(et===this.trackId&&it===rt&&st||(this.log(`Switching to audio-track ${et} "${it.name}" lang:${it.lang} group:${it.groupId} channels:${it.channels}`),this.trackId=et,this.currentTrack=it,this.hls.trigger(Events.AUDIO_TRACK_SWITCHING,_objectSpread2({},it)),st))return;const ot=this.switchParams(it.url,rt==null?void 0:rt.details);this.loadPlaylist(ot)}findTrackId(et){const nt=this.tracksInGroup;for(let rt=0;rt<nt.length;rt++){const it=nt[rt];if(!(this.selectDefaultTrack&&!it.default)&&(!et||matchesOption(et,it,audioMatchPredicate)))return rt}if(et){const{name:rt,lang:it,assocLang:st,characteristics:ot,audioCodec:lt,channels:ut}=et;for(let ct=0;ct<nt.length;ct++){const dt=nt[ct];if(matchesOption({name:rt,lang:it,assocLang:st,characteristics:ot,audioCodec:lt,channels:ut},dt,audioMatchPredicate))return ct}for(let ct=0;ct<nt.length;ct++){const dt=nt[ct];if(mediaAttributesIdentical(et.attrs,dt.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return ct}for(let ct=0;ct<nt.length;ct++){const dt=nt[ct];if(mediaAttributesIdentical(et.attrs,dt.attrs,["LANGUAGE"]))return ct}}return-1}loadPlaylist(et){const nt=this.currentTrack;if(this.shouldLoadPlaylist(nt)&&nt){super.loadPlaylist();const rt=nt.id,it=nt.groupId;let st=nt.url;if(et)try{st=et.addDirectives(st)}catch(ot){this.warn(`Could not construct new URL with HLS Delivery Directives: ${ot}`)}this.log(`loading audio-track playlist ${rt} "${nt.name}" lang:${nt.lang} group:${it}`),this.clearTimer(),this.hls.trigger(Events.AUDIO_TRACK_LOADING,{url:st,id:rt,groupId:it,deliveryDirectives:et||null})}}}const TICK_INTERVAL$1=500;class SubtitleStreamController extends BaseStreamController{constructor(et,nt,rt){super(et,nt,rt,"[subtitle-stream-controller]",PlaylistLevelType.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}_registerListeners(){const{hls:et}=this;et.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),et.on(Events.ERROR,this.onError,this),et.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),et.on(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),et.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),et.on(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),et.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),et.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:et}=this;et.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),et.off(Events.ERROR,this.onError,this),et.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),et.off(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),et.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),et.off(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),et.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),et.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(et){this.stopLoad(),this.state=State.IDLE,this.setInterval(TICK_INTERVAL$1),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=et,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(et,nt){this.mainDetails=nt.details}onSubtitleFragProcessed(et,nt){const{frag:rt,success:it}=nt;if(this.fragPrevious=rt,this.state=State.IDLE,!it)return;const st=this.tracksBuffered[this.currentTrackId];if(!st)return;let ot;const lt=rt.start;for(let ct=0;ct<st.length;ct++)if(lt>=st[ct].start&&lt<=st[ct].end){ot=st[ct];break}const ut=rt.start+rt.duration;ot?ot.end=ut:(ot={start:lt,end:ut},st.push(ot)),this.fragmentTracker.fragBuffered(rt),this.fragBufferedComplete(rt,null)}onBufferFlushing(et,nt){const{startOffset:rt,endOffset:it}=nt;if(rt===0&&it!==Number.POSITIVE_INFINITY){const st=it-1;if(st<=0)return;nt.endOffsetSubtitles=Math.max(0,st),this.tracksBuffered.forEach(ot=>{for(let lt=0;lt<ot.length;){if(ot[lt].end<=st){ot.shift();continue}else if(ot[lt].start<st)ot[lt].start=st;else break;lt++}}),this.fragmentTracker.removeFragmentsInRange(rt,st,PlaylistLevelType.SUBTITLE)}}onFragBuffered(et,nt){if(!this.loadedmetadata&&nt.frag.type===PlaylistLevelType.MAIN){var rt;(rt=this.media)!=null&&rt.buffered.length&&(this.loadedmetadata=!0)}}onError(et,nt){const rt=nt.frag;(rt==null?void 0:rt.type)===PlaylistLevelType.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==State.STOPPED&&(this.state=State.IDLE))}onSubtitleTracksUpdated(et,{subtitleTracks:nt}){if(this.levels&&subtitleOptionsIdentical(this.levels,nt)){this.levels=nt.map(rt=>new Level(rt));return}this.tracksBuffered=[],this.levels=nt.map(rt=>{const it=new Level(rt);return this.tracksBuffered[it.id]=[],it}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,PlaylistLevelType.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(et,nt){var rt;if(this.currentTrackId=nt.id,!((rt=this.levels)!=null&&rt.length)||this.currentTrackId===-1){this.clearInterval();return}const it=this.levels[this.currentTrackId];it!=null&&it.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,it&&this.setInterval(TICK_INTERVAL$1)}onSubtitleTrackLoaded(et,nt){var rt;const{currentTrackId:it,levels:st}=this,{details:ot,id:lt}=nt;if(!st){this.warn(`Subtitle tracks were reset while loading level ${lt}`);return}const ut=st[it];if(lt>=st.length||lt!==it||!ut)return;this.log(`Subtitle track ${lt} loaded [${ot.startSN},${ot.endSN}]${ot.lastPartSn?`[part-${ot.lastPartSn}-${ot.lastPartIndex}]`:""},duration:${ot.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let ct=0;if(ot.live||(rt=ut.details)!=null&&rt.live){const ft=this.mainDetails;if(ot.deltaUpdateFailed||!ft)return;const pt=ft.fragments[0];if(!ut.details)ot.hasProgramDateTime&&ft.hasProgramDateTime?(alignMediaPlaylistByPDT(ot,ft),ct=ot.fragments[0].start):pt&&(ct=pt.start,addSliding(ot,ct));else{var dt;ct=this.alignPlaylists(ot,ut.details,(dt=this.levelLastLoaded)==null?void 0:dt.details),ct===0&&pt&&(ct=pt.start,addSliding(ot,ct))}}ut.details=ot,this.levelLastLoaded=ut,!this.startFragRequested&&(this.mainDetails||!ot.live)&&this.setStartPosition(this.mainDetails||ot,ct),this.tick(),ot.live&&!this.fragCurrent&&this.media&&this.state===State.IDLE&&(findFragmentByPTS(null,ot.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),ut.details=void 0))}_handleFragmentLoadComplete(et){const{frag:nt,payload:rt}=et,it=nt.decryptdata,st=this.hls;if(!this.fragContextChanged(nt)&&rt&&rt.byteLength>0&&it!=null&&it.key&&it.iv&&it.method==="AES-128"){const ot=performance.now();this.decrypter.decrypt(new Uint8Array(rt),it.key.buffer,it.iv.buffer).catch(lt=>{throw st.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:lt,reason:lt.message,frag:nt}),lt}).then(lt=>{const ut=performance.now();st.trigger(Events.FRAG_DECRYPTED,{frag:nt,payload:lt,stats:{tstart:ot,tdecrypt:ut}})}).catch(lt=>{this.warn(`${lt.name}: ${lt.message}`),this.state=State.IDLE})}}doTick(){if(!this.media){this.state=State.IDLE;return}if(this.state===State.IDLE){const{currentTrackId:et,levels:nt}=this,rt=nt==null?void 0:nt[et];if(!rt||!nt.length||!rt.details)return;const{config:it}=this,st=this.getLoadPosition(),ot=BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],st,it.maxBufferHole),{end:lt,len:ut}=ot,ct=this.getFwdBufferInfo(this.media,PlaylistLevelType.MAIN),dt=rt.details,ft=this.getMaxBufferLength(ct==null?void 0:ct.len)+dt.levelTargetDuration;if(ut>ft)return;const pt=dt.fragments,gt=pt.length,_r=dt.edge;let Yr=null;const mt=this.fragPrevious;if(lt<_r){const Kr=it.maxFragLookUpTolerance,Xr=lt>_r-Kr?0:Kr;Yr=findFragmentByPTS(mt,pt,Math.max(pt[0].start,lt),Xr),!Yr&&mt&&mt.start<pt[0].start&&(Yr=pt[0])}else Yr=pt[gt-1];if(!Yr)return;if(Yr=this.mapToInitFragWhenRequired(Yr),Yr.sn!=="initSegment"){const Kr=Yr.sn-dt.startSN,Xr=pt[Kr-1];Xr&&Xr.cc===Yr.cc&&this.fragmentTracker.getState(Xr)===FragmentState.NOT_LOADED&&(Yr=Xr)}this.fragmentTracker.getState(Yr)===FragmentState.NOT_LOADED&&this.loadFragment(Yr,rt,lt)}}getMaxBufferLength(et){const nt=super.getMaxBufferLength();return et?Math.max(nt,et):nt}loadFragment(et,nt,rt){this.fragCurrent=et,et.sn==="initSegment"?this._loadInitSegment(et,nt):(this.startFragRequested=!0,super.loadFragment(et,nt,rt))}get mediaBufferTimeRanges(){return new BufferableInstance(this.tracksBuffered[this.currentTrackId]||[])}}class BufferableInstance{constructor(et){this.buffered=void 0;const nt=(rt,it,st)=>{if(it=it>>>0,it>st-1)throw new DOMException(`Failed to execute '${rt}' on 'TimeRanges': The index provided (${it}) is greater than the maximum bound (${st})`);return et[it][rt]};this.buffered={get length(){return et.length},end(rt){return nt("end",rt,et.length)},start(rt){return nt("start",rt,et.length)}}}}class SubtitleTrackController extends BasePlaylistController{constructor(et){super(et,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let nt=null;const rt=filterSubtitleTracks(this.media.textTracks);for(let st=0;st<rt.length;st++)if(rt[st].mode==="hidden")nt=rt[st];else if(rt[st].mode==="showing"){nt=rt[st];break}const it=this.findTrackForTextTrack(nt);this.subtitleTrack!==it&&this.setSubtitleTrack(it)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(et){this._subtitleDisplay=et,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:et}=this;et.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.on(Events.LEVEL_LOADING,this.onLevelLoading,this),et.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),et.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),et.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:et}=this;et.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.off(Events.LEVEL_LOADING,this.onLevelLoading,this),et.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),et.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),et.off(Events.ERROR,this.onError,this)}onMediaAttached(et,nt){this.media=nt.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(et){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,et)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),filterSubtitleTracks(this.media.textTracks).forEach(nt=>{clearCurrentCues(nt)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(et,nt){this.tracks=nt.subtitleTracks}onSubtitleTrackLoaded(et,nt){const{id:rt,groupId:it,details:st}=nt,ot=this.tracksInGroup[rt];if(!ot||ot.groupId!==it){this.warn(`Subtitle track with id:${rt} and group:${it} not found in active group ${ot==null?void 0:ot.groupId}`);return}const lt=ot.details;ot.details=nt.details,this.log(`Subtitle track ${rt} "${ot.name}" lang:${ot.lang} group:${it} loaded [${st.startSN}-${st.endSN}]`),rt===this.trackId&&this.playlistLoaded(rt,nt,lt)}onLevelLoading(et,nt){this.switchLevel(nt.level)}onLevelSwitching(et,nt){this.switchLevel(nt.level)}switchLevel(et){const nt=this.hls.levels[et];if(!nt)return;const rt=nt.subtitleGroups||null,it=this.groupIds;let st=this.currentTrack;if(!rt||(it==null?void 0:it.length)!==(rt==null?void 0:rt.length)||rt!=null&&rt.some(ot=>(it==null?void 0:it.indexOf(ot))===-1)){this.groupIds=rt,this.trackId=-1,this.currentTrack=null;const ot=this.tracks.filter(dt=>!rt||rt.indexOf(dt.groupId)!==-1);if(ot.length)this.selectDefaultTrack&&!ot.some(dt=>dt.default)&&(this.selectDefaultTrack=!1),ot.forEach((dt,ft)=>{dt.id=ft});else if(!st&&!this.tracksInGroup.length)return;this.tracksInGroup=ot;const lt=this.hls.config.subtitlePreference;if(!st&&lt){this.selectDefaultTrack=!1;const dt=findMatchingOption(lt,ot);if(dt>-1)st=ot[dt];else{const ft=findMatchingOption(lt,this.tracks);st=this.tracks[ft]}}let ut=this.findTrackId(st);ut===-1&&st&&(ut=this.findTrackId(null));const ct={subtitleTracks:ot};this.log(`Updating subtitle tracks, ${ot.length} track(s) found in "${rt==null?void 0:rt.join(",")}" group-id`),this.hls.trigger(Events.SUBTITLE_TRACKS_UPDATED,ct),ut!==-1&&this.trackId===-1&&this.setSubtitleTrack(ut)}else this.shouldReloadPlaylist(st)&&this.setSubtitleTrack(this.trackId)}findTrackId(et){const nt=this.tracksInGroup,rt=this.selectDefaultTrack;for(let it=0;it<nt.length;it++){const st=nt[it];if(!(rt&&!st.default||!rt&&!et)&&(!et||matchesOption(st,et)))return it}if(et){for(let it=0;it<nt.length;it++){const st=nt[it];if(mediaAttributesIdentical(et.attrs,st.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return it}for(let it=0;it<nt.length;it++){const st=nt[it];if(mediaAttributesIdentical(et.attrs,st.attrs,["LANGUAGE"]))return it}}return-1}findTrackForTextTrack(et){if(et){const nt=this.tracksInGroup;for(let rt=0;rt<nt.length;rt++){const it=nt[rt];if(subtitleTrackMatchesTextTrack(it,et))return rt}}return-1}onError(et,nt){nt.fatal||!nt.context||nt.context.type===PlaylistContextType.SUBTITLE_TRACK&&nt.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(nt.context.groupId)!==-1)&&this.checkRetry(nt)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(et){this.selectDefaultTrack=!1,this.setSubtitleTrack(et)}setSubtitleOption(et){if(this.hls.config.subtitlePreference=et,et){const nt=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,nt.length){const rt=this.currentTrack;if(rt&&matchesOption(et,rt))return rt;const it=findMatchingOption(et,this.tracksInGroup);if(it>-1){const st=this.tracksInGroup[it];return this.setSubtitleTrack(it),st}else{if(rt)return null;{const st=findMatchingOption(et,nt);if(st>-1)return nt[st]}}}}return null}loadPlaylist(et){super.loadPlaylist();const nt=this.currentTrack;if(this.shouldLoadPlaylist(nt)&&nt){const rt=nt.id,it=nt.groupId;let st=nt.url;if(et)try{st=et.addDirectives(st)}catch(ot){this.warn(`Could not construct new URL with HLS Delivery Directives: ${ot}`)}this.log(`Loading subtitle playlist for id ${rt}`),this.hls.trigger(Events.SUBTITLE_TRACK_LOADING,{url:st,id:rt,groupId:it,deliveryDirectives:et||null})}}toggleTrackModes(){const{media:et}=this;if(!et)return;const nt=filterSubtitleTracks(et.textTracks),rt=this.currentTrack;let it;if(rt&&(it=nt.filter(st=>subtitleTrackMatchesTextTrack(rt,st))[0],it||this.warn(`Unable to find subtitle TextTrack with name "${rt.name}" and language "${rt.lang}"`)),[].slice.call(nt).forEach(st=>{st.mode!=="disabled"&&st!==it&&(st.mode="disabled")}),it){const st=this.subtitleDisplay?"showing":"hidden";it.mode!==st&&(it.mode=st)}}setSubtitleTrack(et){const nt=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=et;return}if(et<-1||et>=nt.length||!isFiniteNumber(et)){this.warn(`Invalid subtitle track id: ${et}`);return}this.clearTimer(),this.selectDefaultTrack=!1;const rt=this.currentTrack,it=nt[et]||null;if(this.trackId=et,this.currentTrack=it,this.toggleTrackModes(),!it){this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:et});return}const st=!!it.details&&!it.details.live;if(et===this.trackId&&it===rt&&st)return;this.log(`Switching to subtitle-track ${et}`+(it?` "${it.name}" lang:${it.lang} group:${it.groupId}`:""));const{id:ot,groupId:lt="",name:ut,type:ct,url:dt}=it;this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:ot,groupId:lt,name:ut,type:ct,url:dt});const ft=this.switchParams(it.url,rt==null?void 0:rt.details);this.loadPlaylist(ft)}}class BufferOperationQueue{constructor(et){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=et}append(et,nt,rt){const it=this.queues[nt];it.push(et),it.length===1&&!rt&&this.executeNext(nt)}insertAbort(et,nt){this.queues[nt].unshift(et),this.executeNext(nt)}appendBlocker(et){let nt;const rt=new Promise(st=>{nt=st}),it={execute:nt,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(it,et),rt}executeNext(et){const nt=this.queues[et];if(nt.length){const rt=nt[0];try{rt.execute()}catch(it){logger.warn(`[buffer-operation-queue]: Exception executing "${et}" SourceBuffer operation: ${it}`),rt.onError(it);const st=this.buffers[et];st!=null&&st.updating||this.shiftAndExecuteNext(et)}}}shiftAndExecuteNext(et){this.queues[et].shift(),this.executeNext(et)}current(et){return this.queues[et][0]}}const VIDEO_CODEC_PROFILE_REPLACE=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/;class BufferController{constructor(et){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=rt=>{this.hls&&this.hls.pauseBuffering()},this._onStartStreaming=rt=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=()=>{const{media:rt,mediaSource:it}=this;this.log("Media source opened"),rt&&(rt.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(Events.MEDIA_ATTACHED,{media:rt,mediaSource:it})),it&&it.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:rt,_objectUrl:it}=this;rt!==it&&logger.error(`Media element src was set while attaching MediaSource (${it} > ${rt})`)},this.hls=et;const nt="[buffer-controller]";this.appendSource=et.config.preferManagedMediaSource,this.log=logger.log.bind(logger,nt),this.warn=logger.warn.bind(logger,nt),this.error=logger.error.bind(logger,nt),this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}registerListeners(){const{hls:et}=this;et.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),et.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.on(Events.BUFFER_RESET,this.onBufferReset,this),et.on(Events.BUFFER_APPENDING,this.onBufferAppending,this),et.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),et.on(Events.BUFFER_EOS,this.onBufferEos,this),et.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),et.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),et.on(Events.FRAG_PARSED,this.onFragParsed,this),et.on(Events.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:et}=this;et.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),et.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.off(Events.BUFFER_RESET,this.onBufferReset,this),et.off(Events.BUFFER_APPENDING,this.onBufferAppending,this),et.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),et.off(Events.BUFFER_EOS,this.onBufferEos,this),et.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),et.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),et.off(Events.FRAG_PARSED,this.onFragParsed,this),et.off(Events.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new BufferOperationQueue(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(et,nt){let rt=2;(nt.audio&&!nt.video||!nt.altAudio)&&(rt=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=rt,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(et,nt){const rt=this.media=nt.media,it=getMediaSource(this.appendSource);if(rt&&it){var st;const ot=this.mediaSource=new it;this.log(`created media source: ${(st=ot.constructor)==null?void 0:st.name}`),ot.addEventListener("sourceopen",this._onMediaSourceOpen),ot.addEventListener("sourceended",this._onMediaSourceEnded),ot.addEventListener("sourceclose",this._onMediaSourceClose),ot.addEventListener("startstreaming",this._onStartStreaming),ot.addEventListener("endstreaming",this._onEndStreaming);const lt=this._objectUrl=self.URL.createObjectURL(ot);if(this.appendSource)try{rt.removeAttribute("src");const ut=self.ManagedMediaSource;rt.disableRemotePlayback=rt.disableRemotePlayback||ut&&ot instanceof ut,removeSourceChildren(rt),addSource(rt,lt),rt.load()}catch{rt.src=lt}else rt.src=lt;rt.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:et,mediaSource:nt,_objectUrl:rt}=this;if(nt){if(this.log("media source detaching"),nt.readyState==="open")try{nt.endOfStream()}catch(it){this.warn(`onMediaDetaching: ${it.message} while calling endOfStream`)}this.onBufferReset(),nt.removeEventListener("sourceopen",this._onMediaSourceOpen),nt.removeEventListener("sourceended",this._onMediaSourceEnded),nt.removeEventListener("sourceclose",this._onMediaSourceClose),nt.removeEventListener("startstreaming",this._onStartStreaming),nt.removeEventListener("endstreaming",this._onEndStreaming),et&&(et.removeEventListener("emptied",this._onMediaEmptied),rt&&self.URL.revokeObjectURL(rt),this.mediaSrc===rt?(et.removeAttribute("src"),this.appendSource&&removeSourceChildren(et),et.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(Events.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(et=>{this.resetBuffer(et)}),this._initSourceBuffer()}resetBuffer(et){const nt=this.sourceBuffer[et];try{if(nt){var rt;this.removeBufferListeners(et),this.sourceBuffer[et]=void 0,(rt=this.mediaSource)!=null&&rt.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(nt)}}catch(it){this.warn(`onBufferReset ${et}`,it)}}onBufferCodecs(et,nt){const rt=this.getSourceBufferTypes().length,it=Object.keys(nt);if(it.forEach(ot=>{if(rt){const ut=this.tracks[ot];if(ut&&typeof ut.buffer.changeType=="function"){var lt;const{id:ct,codec:dt,levelCodec:ft,container:pt,metadata:gt}=nt[ot],_r=pickMostCompleteCodecName(ut.codec,ut.levelCodec),Yr=_r==null?void 0:_r.replace(VIDEO_CODEC_PROFILE_REPLACE,"$1");let mt=pickMostCompleteCodecName(dt,ft);const Kr=(lt=mt)==null?void 0:lt.replace(VIDEO_CODEC_PROFILE_REPLACE,"$1");if(mt&&Yr!==Kr){ot.slice(0,5)==="audio"&&(mt=getCodecCompatibleName(mt,this.hls.config.preferManagedMediaSource));const Xr=`${pt};codecs=${mt}`;this.appendChangeType(ot,Xr),this.log(`switching codec ${_r} to ${mt}`),this.tracks[ot]={buffer:ut.buffer,codec:dt,container:pt,levelCodec:ft,metadata:gt,id:ct}}}}else this.pendingTracks[ot]=nt[ot]}),rt)return;const st=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==st&&(this.log(`${st} bufferCodec event(s) expected ${it.join(",")}`),this.bufferCodecEventsExpected=st),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks()}appendChangeType(et,nt){const{operationQueue:rt}=this,it={execute:()=>{const st=this.sourceBuffer[et];st&&(this.log(`changing ${et} sourceBuffer type to ${nt}`),st.changeType(nt)),rt.shiftAndExecuteNext(et)},onStart:()=>{},onComplete:()=>{},onError:st=>{this.warn(`Failed to change ${et} SourceBuffer type`,st)}};rt.append(it,et,!!this.pendingTracks[et])}onBufferAppending(et,nt){const{hls:rt,operationQueue:it,tracks:st}=this,{data:ot,type:lt,frag:ut,part:ct,chunkMeta:dt}=nt,ft=dt.buffering[lt],pt=self.performance.now();ft.start=pt;const gt=ut.stats.buffering,_r=ct?ct.stats.buffering:null;gt.start===0&&(gt.start=pt),_r&&_r.start===0&&(_r.start=pt);const Yr=st.audio;let mt=!1;lt==="audio"&&(Yr==null?void 0:Yr.container)==="audio/mpeg"&&(mt=!this.lastMpegAudioChunk||dt.id===1||this.lastMpegAudioChunk.sn!==dt.sn,this.lastMpegAudioChunk=dt);const Kr=ut.start,Xr={execute:()=>{if(ft.executeStart=self.performance.now(),mt){const Zr=this.sourceBuffer[lt];if(Zr){const Qr=Kr-Zr.timestampOffset;Math.abs(Qr)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${Kr} (delta: ${Qr}) sn: ${ut.sn})`),Zr.timestampOffset=Kr)}}this.appendExecutor(ot,lt)},onStart:()=>{},onComplete:()=>{const Zr=self.performance.now();ft.executeEnd=ft.end=Zr,gt.first===0&&(gt.first=Zr),_r&&_r.first===0&&(_r.first=Zr);const{sourceBuffer:Qr}=this,_i={};for(const rs in Qr)_i[rs]=BufferHelper.getBuffered(Qr[rs]);this.appendErrors[lt]=0,lt==="audio"||lt==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(Events.BUFFER_APPENDED,{type:lt,frag:ut,part:ct,chunkMeta:dt,parent:ut.type,timeRanges:_i})},onError:Zr=>{const Qr={type:ErrorTypes.MEDIA_ERROR,parent:ut.type,details:ErrorDetails.BUFFER_APPEND_ERROR,sourceBufferName:lt,frag:ut,part:ct,chunkMeta:dt,error:Zr,err:Zr,fatal:!1};if(Zr.code===DOMException.QUOTA_EXCEEDED_ERR)Qr.details=ErrorDetails.BUFFER_FULL_ERROR;else{const _i=++this.appendErrors[lt];Qr.details=ErrorDetails.BUFFER_APPEND_ERROR,this.warn(`Failed ${_i}/${rt.config.appendErrorMaxRetry} times to append segment in "${lt}" sourceBuffer`),_i>=rt.config.appendErrorMaxRetry&&(Qr.fatal=!0)}rt.trigger(Events.ERROR,Qr)}};it.append(Xr,lt,!!this.pendingTracks[lt])}onBufferFlushing(et,nt){const{operationQueue:rt}=this,it=st=>({execute:this.removeExecutor.bind(this,st,nt.startOffset,nt.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(Events.BUFFER_FLUSHED,{type:st})},onError:ot=>{this.warn(`Failed to remove from ${st} SourceBuffer`,ot)}});nt.type?rt.append(it(nt.type),nt.type):this.getSourceBufferTypes().forEach(st=>{rt.append(it(st),st)})}onFragParsed(et,nt){const{frag:rt,part:it}=nt,st=[],ot=it?it.elementaryStreams:rt.elementaryStreams;ot[ElementaryStreamTypes.AUDIOVIDEO]?st.push("audiovideo"):(ot[ElementaryStreamTypes.AUDIO]&&st.push("audio"),ot[ElementaryStreamTypes.VIDEO]&&st.push("video"));const lt=()=>{const ut=self.performance.now();rt.stats.buffering.end=ut,it&&(it.stats.buffering.end=ut);const ct=it?it.stats:rt.stats;this.hls.trigger(Events.FRAG_BUFFERED,{frag:rt,part:it,stats:ct,id:rt.type})};st.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${rt.type} level: ${rt.level} sn: ${rt.sn}`),this.blockBuffers(lt,st)}onFragChanged(et,nt){this.trimBuffers()}onBufferEos(et,nt){this.getSourceBufferTypes().reduce((it,st)=>{const ot=this.sourceBuffer[st];return ot&&(!nt.type||nt.type===st)&&(ot.ending=!0,ot.ended||(ot.ended=!0,this.log(`${st} sourceBuffer now EOS`))),it&&!!(!ot||ot.ended)},!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(st=>{const ot=this.sourceBuffer[st];ot&&(ot.ending=!1)});const{mediaSource:it}=this;if(!it||it.readyState!=="open"){it&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${it.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),it.endOfStream()}))}onLevelUpdated(et,{details:nt}){nt.fragments.length&&(this.details=nt,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}trimBuffers(){const{hls:et,details:nt,media:rt}=this;if(!rt||nt===null||!this.getSourceBufferTypes().length)return;const st=et.config,ot=rt.currentTime,lt=nt.levelTargetDuration,ut=nt.live&&st.liveBackBufferLength!==null?st.liveBackBufferLength:st.backBufferLength;if(isFiniteNumber(ut)&&ut>0){const ct=Math.max(ut,lt),dt=Math.floor(ot/lt)*lt-ct;this.flushBackBuffer(ot,lt,dt)}if(isFiniteNumber(st.frontBufferFlushThreshold)&&st.frontBufferFlushThreshold>0){const ct=Math.max(st.maxBufferLength,st.frontBufferFlushThreshold),dt=Math.max(ct,lt),ft=Math.floor(ot/lt)*lt+dt;this.flushFrontBuffer(ot,lt,ft)}}flushBackBuffer(et,nt,rt){const{details:it,sourceBuffer:st}=this;this.getSourceBufferTypes().forEach(lt=>{const ut=st[lt];if(ut){const ct=BufferHelper.getBuffered(ut);if(ct.length>0&&rt>ct.start(0)){if(this.hls.trigger(Events.BACK_BUFFER_REACHED,{bufferEnd:rt}),it!=null&&it.live)this.hls.trigger(Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:rt});else if(ut.ended&&ct.end(ct.length-1)-et<nt*2){this.log(`Cannot flush ${lt} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:rt,type:lt})}}})}flushFrontBuffer(et,nt,rt){const{sourceBuffer:it}=this;this.getSourceBufferTypes().forEach(ot=>{const lt=it[ot];if(lt){const ut=BufferHelper.getBuffered(lt),ct=ut.length;if(ct<2)return;const dt=ut.start(ct-1),ft=ut.end(ct-1);if(rt>dt||et>=dt&&et<=ft)return;if(lt.ended&&et-ft<2*nt){this.log(`Cannot flush ${ot} front buffer while SourceBuffer is in ended state`);return}this.hls.trigger(Events.BUFFER_FLUSHING,{startOffset:dt,endOffset:1/0,type:ot})}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:et,hls:nt,media:rt,mediaSource:it}=this,st=et.fragments[0].start+et.totalduration,ot=rt.duration,lt=isFiniteNumber(it.duration)?it.duration:0;et.live&&nt.config.liveDurationInfinity?(it.duration=1/0,this.updateSeekableRange(et)):(st>lt&&st>ot||!isFiniteNumber(ot))&&(this.log(`Updating Media Source duration to ${st.toFixed(3)}`),it.duration=st)}updateSeekableRange(et){const nt=this.mediaSource,rt=et.fragments;if(rt.length&&et.live&&nt!=null&&nt.setLiveSeekableRange){const st=Math.max(0,rt[0].start),ot=Math.max(st,st+et.totalduration);this.log(`Media Source duration is set to ${nt.duration}. Setting seekable range to ${st}-${ot}.`),nt.setLiveSeekableRange(st,ot)}}checkPendingTracks(){const{bufferCodecEventsExpected:et,operationQueue:nt,pendingTracks:rt}=this,it=Object.keys(rt).length;if(it&&(!et||it===2||"audiovideo"in rt)){this.createSourceBuffers(rt),this.pendingTracks={};const st=this.getSourceBufferTypes();if(st.length)this.hls.trigger(Events.BUFFER_CREATED,{tracks:this.tracks}),st.forEach(ot=>{nt.executeNext(ot)});else{const ot=new Error("could not create source buffer for media codec(s)");this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:ot,reason:ot.message})}}}createSourceBuffers(et){const{sourceBuffer:nt,mediaSource:rt}=this;if(!rt)throw Error("createSourceBuffers called when mediaSource was null");for(const it in et)if(!nt[it]){const st=et[it];if(!st)throw Error(`source buffer exists for track ${it}, however track does not`);let ot=st.levelCodec||st.codec;ot&&it.slice(0,5)==="audio"&&(ot=getCodecCompatibleName(ot,this.hls.config.preferManagedMediaSource));const lt=`${st.container};codecs=${ot}`;this.log(`creating sourceBuffer(${lt})`);try{const ut=nt[it]=rt.addSourceBuffer(lt),ct=it;this.addBufferListener(ct,"updatestart",this._onSBUpdateStart),this.addBufferListener(ct,"updateend",this._onSBUpdateEnd),this.addBufferListener(ct,"error",this._onSBUpdateError),this.addBufferListener(ct,"bufferedchange",(dt,ft)=>{const pt=ft.removedRanges;pt!=null&&pt.length&&this.hls.trigger(Events.BUFFER_FLUSHED,{type:it})}),this.tracks[it]={buffer:ut,codec:ot,container:st.container,levelCodec:st.levelCodec,metadata:st.metadata,id:st.id}}catch(ut){this.error(`error while trying to add sourceBuffer: ${ut.message}`),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:ut,sourceBufferName:it,mimeType:lt})}}}get mediaSrc(){var et;const nt=((et=this.media)==null?void 0:et.firstChild)||this.media;return nt==null?void 0:nt.src}_onSBUpdateStart(et){const{operationQueue:nt}=this;nt.current(et).onStart()}_onSBUpdateEnd(et){var nt;if(((nt=this.mediaSource)==null?void 0:nt.readyState)==="closed"){this.resetBuffer(et);return}const{operationQueue:rt}=this;rt.current(et).onComplete(),rt.shiftAndExecuteNext(et)}_onSBUpdateError(et,nt){var rt;const it=new Error(`${et} SourceBuffer error. MediaSource readyState: ${(rt=this.mediaSource)==null?void 0:rt.readyState}`);this.error(`${it}`,nt),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_APPENDING_ERROR,sourceBufferName:et,error:it,fatal:!1});const st=this.operationQueue.current(et);st&&st.onError(it)}removeExecutor(et,nt,rt){const{media:it,mediaSource:st,operationQueue:ot,sourceBuffer:lt}=this,ut=lt[et];if(!it||!st||!ut){this.warn(`Attempting to remove from the ${et} SourceBuffer, but it does not exist`),ot.shiftAndExecuteNext(et);return}const ct=isFiniteNumber(it.duration)?it.duration:1/0,dt=isFiniteNumber(st.duration)?st.duration:1/0,ft=Math.max(0,nt),pt=Math.min(rt,ct,dt);pt>ft&&(!ut.ending||ut.ended)?(ut.ended=!1,this.log(`Removing [${ft},${pt}] from the ${et} SourceBuffer`),ut.remove(ft,pt)):ot.shiftAndExecuteNext(et)}appendExecutor(et,nt){const rt=this.sourceBuffer[nt];if(!rt){if(!this.pendingTracks[nt])throw new Error(`Attempting to append to the ${nt} SourceBuffer, but it does not exist`);return}rt.ended=!1,rt.appendBuffer(et)}blockBuffers(et,nt=this.getSourceBufferTypes()){if(!nt.length){this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(et);return}const{operationQueue:rt}=this,it=nt.map(st=>rt.appendBlocker(st));Promise.all(it).then(()=>{et(),nt.forEach(st=>{const ot=this.sourceBuffer[st];ot!=null&&ot.updating||rt.shiftAndExecuteNext(st)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(et,nt,rt){const it=this.sourceBuffer[et];if(!it)return;const st=rt.bind(this,et);this.listeners[et].push({event:nt,listener:st}),it.addEventListener(nt,st)}removeBufferListeners(et){const nt=this.sourceBuffer[et];nt&&this.listeners[et].forEach(rt=>{nt.removeEventListener(rt.event,rt.listener)})}}function removeSourceChildren(tt){const et=tt.querySelectorAll("source");[].slice.call(et).forEach(nt=>{tt.removeChild(nt)})}function addSource(tt,et){const nt=self.document.createElement("source");nt.type="video/mp4",nt.src=et,tt.appendChild(nt)}const specialCea608CharsCodes={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},getCharForByte=function(et){let nt=et;return specialCea608CharsCodes.hasOwnProperty(et)&&(nt=specialCea608CharsCodes[et]),String.fromCharCode(nt)},NR_ROWS=15,NR_COLS=100,rowsLowCh1={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},rowsHighCh1={17:2,18:4,21:6,22:8,23:10,19:13,20:15},rowsLowCh2={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},rowsHighCh2={25:2,26:4,29:6,30:8,31:10,27:13,28:15},backgroundColors=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class CaptionsLogger{constructor(){this.time=null,this.verboseLevel=0}log(et,nt){if(this.verboseLevel>=et){const rt=typeof nt=="function"?nt():nt;logger.log(`${this.time} [${et}] ${rt}`)}}}const numArrayToHexArray=function(et){const nt=[];for(let rt=0;rt<et.length;rt++)nt.push(et[rt].toString(16));return nt};class PenState{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(et){const nt=["foreground","underline","italics","background","flash"];for(let rt=0;rt<nt.length;rt++){const it=nt[rt];et.hasOwnProperty(it)&&(this[it]=et[it])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(et){return this.foreground===et.foreground&&this.underline===et.underline&&this.italics===et.italics&&this.background===et.background&&this.flash===et.flash}copy(et){this.foreground=et.foreground,this.underline=et.underline,this.italics=et.italics,this.background=et.background,this.flash=et.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class StyledUnicodeChar{constructor(){this.uchar=" ",this.penState=new PenState}reset(){this.uchar=" ",this.penState.reset()}setChar(et,nt){this.uchar=et,this.penState.copy(nt)}setPenState(et){this.penState.copy(et)}equals(et){return this.uchar===et.uchar&&this.penState.equals(et.penState)}copy(et){this.uchar=et.uchar,this.penState.copy(et.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Row{constructor(et){this.chars=[],this.pos=0,this.currPenState=new PenState,this.cueStartTime=null,this.logger=void 0;for(let nt=0;nt<NR_COLS;nt++)this.chars.push(new StyledUnicodeChar);this.logger=et}equals(et){for(let nt=0;nt<NR_COLS;nt++)if(!this.chars[nt].equals(et.chars[nt]))return!1;return!0}copy(et){for(let nt=0;nt<NR_COLS;nt++)this.chars[nt].copy(et.chars[nt])}isEmpty(){let et=!0;for(let nt=0;nt<NR_COLS;nt++)if(!this.chars[nt].isEmpty()){et=!1;break}return et}setCursor(et){this.pos!==et&&(this.pos=et),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>NR_COLS&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=NR_COLS)}moveCursor(et){const nt=this.pos+et;if(et>1)for(let rt=this.pos+1;rt<nt+1;rt++)this.chars[rt].setPenState(this.currPenState);this.setCursor(nt)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(et){et>=144&&this.backSpace();const nt=getCharForByte(et);if(this.pos>=NR_COLS){this.logger.log(0,()=>"Cannot insert "+et.toString(16)+" ("+nt+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(nt,this.currPenState),this.moveCursor(1)}clearFromPos(et){let nt;for(nt=et;nt<NR_COLS;nt++)this.chars[nt].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const et=[];let nt=!0;for(let rt=0;rt<NR_COLS;rt++){const it=this.chars[rt].uchar;it!==" "&&(nt=!1),et.push(it)}return nt?"":et.join("")}setPenStyles(et){this.currPenState.setStyles(et),this.chars[this.pos].setPenState(this.currPenState)}}class CaptionScreen{constructor(et){this.rows=[],this.currRow=NR_ROWS-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let nt=0;nt<NR_ROWS;nt++)this.rows.push(new Row(et));this.logger=et}reset(){for(let et=0;et<NR_ROWS;et++)this.rows[et].clear();this.currRow=NR_ROWS-1}equals(et){let nt=!0;for(let rt=0;rt<NR_ROWS;rt++)if(!this.rows[rt].equals(et.rows[rt])){nt=!1;break}return nt}copy(et){for(let nt=0;nt<NR_ROWS;nt++)this.rows[nt].copy(et.rows[nt])}isEmpty(){let et=!0;for(let nt=0;nt<NR_ROWS;nt++)if(!this.rows[nt].isEmpty()){et=!1;break}return et}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(et){this.rows[this.currRow].insertChar(et)}setPen(et){this.rows[this.currRow].setPenStyles(et)}moveCursor(et){this.rows[this.currRow].moveCursor(et)}setCursor(et){this.logger.log(2,"setCursor: "+et),this.rows[this.currRow].setCursor(et)}setPAC(et){this.logger.log(2,()=>"pacData = "+JSON.stringify(et));let nt=et.row-1;if(this.nrRollUpRows&&nt<this.nrRollUpRows-1&&(nt=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==nt){for(let lt=0;lt<NR_ROWS;lt++)this.rows[lt].clear();const st=this.currRow+1-this.nrRollUpRows,ot=this.lastOutputScreen;if(ot){const lt=ot.rows[st].cueStartTime,ut=this.logger.time;if(lt!==null&&ut!==null&&lt<ut)for(let ct=0;ct<this.nrRollUpRows;ct++)this.rows[nt-this.nrRollUpRows+ct+1].copy(ot.rows[st+ct])}}this.currRow=nt;const rt=this.rows[this.currRow];if(et.indent!==null){const st=et.indent,ot=Math.max(st-1,0);rt.setCursor(et.indent),et.color=rt.chars[ot].penState.foreground}const it={foreground:et.color,underline:et.underline,italics:et.italics,background:"black",flash:!1};this.setPen(it)}setBkgData(et){this.logger.log(2,()=>"bkgData = "+JSON.stringify(et)),this.backSpace(),this.setPen(et),this.insertChar(32)}setRollUpRows(et){this.nrRollUpRows=et}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const et=this.currRow+1-this.nrRollUpRows,nt=this.rows.splice(et,1)[0];nt.clear(),this.rows.splice(this.currRow,0,nt),this.logger.log(2,"Rolling up")}getDisplayText(et){et=et||!1;const nt=[];let rt="",it=-1;for(let st=0;st<NR_ROWS;st++){const ot=this.rows[st].getTextString();ot&&(it=st+1,et?nt.push("Row "+it+": '"+ot+"'"):nt.push(ot.trim()))}return nt.length>0&&(et?rt="["+nt.join(" | ")+"]":rt=nt.join(`
`)),rt}getTextAndFormat(){return this.rows}}class Cea608Channel{constructor(et,nt,rt){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=et,this.outputFilter=nt,this.mode=null,this.verbose=0,this.displayedMemory=new CaptionScreen(rt),this.nonDisplayedMemory=new CaptionScreen(rt),this.lastOutputScreen=new CaptionScreen(rt),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=rt}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(et){this.outputFilter=et}setPAC(et){this.writeScreen.setPAC(et)}setBkgData(et){this.writeScreen.setBkgData(et)}setMode(et){et!==this.mode&&(this.mode=et,this.logger.log(2,()=>"MODE="+et),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=et)}insertChars(et){for(let rt=0;rt<et.length;rt++)this.writeScreen.insertChar(et[rt]);const nt=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>nt+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(et){this.logger.log(2,"RU("+et+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(et)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const et=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=et,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(et){this.logger.log(2,"TO("+et+") - Tab Offset"),this.writeScreen.moveCursor(et)}ccMIDROW(et){const nt={flash:!1};if(nt.underline=et%2===1,nt.italics=et>=46,nt.italics)nt.foreground="white";else{const rt=Math.floor(et/2)-16,it=["white","green","blue","cyan","red","yellow","magenta"];nt.foreground=it[rt]}this.logger.log(2,"MIDROW: "+JSON.stringify(nt)),this.writeScreen.setPen(nt)}outputDataUpdate(et=!1){const nt=this.logger.time;nt!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=nt:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,nt,this.lastOutputScreen),et&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:nt),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(et){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,et,this.displayedMemory),this.cueStartTime=et))}}class Cea608Parser{constructor(et,nt,rt){this.channels=void 0,this.currentChannel=0,this.cmdHistory=createCmdHistory(),this.logger=void 0;const it=this.logger=new CaptionsLogger;this.channels=[null,new Cea608Channel(et,nt,it),new Cea608Channel(et+1,rt,it)]}getHandler(et){return this.channels[et].getHandler()}setHandler(et,nt){this.channels[et].setHandler(nt)}addData(et,nt){let rt,it,st,ot=!1;this.logger.time=et;for(let lt=0;lt<nt.length;lt+=2)if(it=nt[lt]&127,st=nt[lt+1]&127,!(it===0&&st===0)){if(this.logger.log(3,"["+numArrayToHexArray([nt[lt],nt[lt+1]])+"] -> ("+numArrayToHexArray([it,st])+")"),rt=this.parseCmd(it,st),rt||(rt=this.parseMidrow(it,st)),rt||(rt=this.parsePAC(it,st)),rt||(rt=this.parseBackgroundAttributes(it,st)),!rt&&(ot=this.parseChars(it,st),ot)){const ut=this.currentChannel;ut&&ut>0?this.channels[ut].insertChars(ot):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!rt&&!ot&&this.logger.log(2,"Couldn't parse cleaned data "+numArrayToHexArray([it,st])+" orig: "+numArrayToHexArray([nt[lt],nt[lt+1]]))}}parseCmd(et,nt){const{cmdHistory:rt}=this,it=(et===20||et===28||et===21||et===29)&&nt>=32&&nt<=47,st=(et===23||et===31)&&nt>=33&&nt<=35;if(!(it||st))return!1;if(hasCmdRepeated(et,nt,rt))return setLastCmd(null,null,rt),this.logger.log(3,"Repeated command ("+numArrayToHexArray([et,nt])+") is dropped"),!0;const ot=et===20||et===21||et===23?1:2,lt=this.channels[ot];return et===20||et===21||et===28||et===29?nt===32?lt.ccRCL():nt===33?lt.ccBS():nt===34?lt.ccAOF():nt===35?lt.ccAON():nt===36?lt.ccDER():nt===37?lt.ccRU(2):nt===38?lt.ccRU(3):nt===39?lt.ccRU(4):nt===40?lt.ccFON():nt===41?lt.ccRDC():nt===42?lt.ccTR():nt===43?lt.ccRTD():nt===44?lt.ccEDM():nt===45?lt.ccCR():nt===46?lt.ccENM():nt===47&&lt.ccEOC():lt.ccTO(nt-32),setLastCmd(et,nt,rt),this.currentChannel=ot,!0}parseMidrow(et,nt){let rt=0;if((et===17||et===25)&&nt>=32&&nt<=47){if(et===17?rt=1:rt=2,rt!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const it=this.channels[rt];return it?(it.ccMIDROW(nt),this.logger.log(3,"MIDROW ("+numArrayToHexArray([et,nt])+")"),!0):!1}return!1}parsePAC(et,nt){let rt;const it=this.cmdHistory,st=(et>=17&&et<=23||et>=25&&et<=31)&&nt>=64&&nt<=127,ot=(et===16||et===24)&&nt>=64&&nt<=95;if(!(st||ot))return!1;if(hasCmdRepeated(et,nt,it))return setLastCmd(null,null,it),!0;const lt=et<=23?1:2;nt>=64&&nt<=95?rt=lt===1?rowsLowCh1[et]:rowsLowCh2[et]:rt=lt===1?rowsHighCh1[et]:rowsHighCh2[et];const ut=this.channels[lt];return ut?(ut.setPAC(this.interpretPAC(rt,nt)),setLastCmd(et,nt,it),this.currentChannel=lt,!0):!1}interpretPAC(et,nt){let rt;const it={color:null,italics:!1,indent:null,underline:!1,row:et};return nt>95?rt=nt-96:rt=nt-64,it.underline=(rt&1)===1,rt<=13?it.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(rt/2)]:rt<=15?(it.italics=!0,it.color="white"):it.indent=Math.floor((rt-16)/2)*4,it}parseChars(et,nt){let rt,it=null,st=null;if(et>=25?(rt=2,st=et-8):(rt=1,st=et),st>=17&&st<=19){let ot;st===17?ot=nt+80:st===18?ot=nt+112:ot=nt+144,this.logger.log(2,"Special char '"+getCharForByte(ot)+"' in channel "+rt),it=[ot]}else et>=32&&et<=127&&(it=nt===0?[et]:[et,nt]);if(it){const ot=numArrayToHexArray(it);this.logger.log(3,"Char codes =  "+ot.join(",")),setLastCmd(et,nt,this.cmdHistory)}return it}parseBackgroundAttributes(et,nt){const rt=(et===16||et===24)&&nt>=32&&nt<=47,it=(et===23||et===31)&&nt>=45&&nt<=47;if(!(rt||it))return!1;let st;const ot={};et===16||et===24?(st=Math.floor((nt-32)/2),ot.background=backgroundColors[st],nt%2===1&&(ot.background=ot.background+"_semi")):nt===45?ot.background="transparent":(ot.foreground="black",nt===47&&(ot.underline=!0));const lt=et<=23?1:2;return this.channels[lt].setBkgData(ot),setLastCmd(et,nt,this.cmdHistory),!0}reset(){for(let et=0;et<Object.keys(this.channels).length;et++){const nt=this.channels[et];nt&&nt.reset()}this.cmdHistory=createCmdHistory()}cueSplitAtTime(et){for(let nt=0;nt<this.channels.length;nt++){const rt=this.channels[nt];rt&&rt.cueSplitAtTime(et)}}}function setLastCmd(tt,et,nt){nt.a=tt,nt.b=et}function hasCmdRepeated(tt,et,nt){return nt.a===tt&&nt.b===et}function createCmdHistory(){return{a:null,b:null}}class OutputFilter{constructor(et,nt){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=et,this.trackName=nt}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(et,nt,rt){(this.startTime===null||this.startTime>et)&&(this.startTime=et),this.endTime=nt,this.screen=rt,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var VTTCue=function(){if(optionalSelf!=null&&optionalSelf.VTTCue)return self.VTTCue;const tt=["","lr","rl"],et=["start","middle","end","left","right"];function nt(lt,ut){if(typeof ut!="string"||!Array.isArray(lt))return!1;const ct=ut.toLowerCase();return~lt.indexOf(ct)?ct:!1}function rt(lt){return nt(tt,lt)}function it(lt){return nt(et,lt)}function st(lt,...ut){let ct=1;for(;ct<arguments.length;ct++){const dt=arguments[ct];for(const ft in dt)lt[ft]=dt[ft]}return lt}function ot(lt,ut,ct){const dt=this,ft={enumerable:!0};dt.hasBeenReset=!1;let pt="",gt=!1,_r=lt,Yr=ut,mt=ct,Kr=null,Xr="",Zr=!0,Qr="auto",_i="start",rs=50,ns="middle",ss=50,fs="middle";Object.defineProperty(dt,"id",st({},ft,{get:function(){return pt},set:function(os){pt=""+os}})),Object.defineProperty(dt,"pauseOnExit",st({},ft,{get:function(){return gt},set:function(os){gt=!!os}})),Object.defineProperty(dt,"startTime",st({},ft,{get:function(){return _r},set:function(os){if(typeof os!="number")throw new TypeError("Start time must be set to a number.");_r=os,this.hasBeenReset=!0}})),Object.defineProperty(dt,"endTime",st({},ft,{get:function(){return Yr},set:function(os){if(typeof os!="number")throw new TypeError("End time must be set to a number.");Yr=os,this.hasBeenReset=!0}})),Object.defineProperty(dt,"text",st({},ft,{get:function(){return mt},set:function(os){mt=""+os,this.hasBeenReset=!0}})),Object.defineProperty(dt,"region",st({},ft,{get:function(){return Kr},set:function(os){Kr=os,this.hasBeenReset=!0}})),Object.defineProperty(dt,"vertical",st({},ft,{get:function(){return Xr},set:function(os){const is=rt(os);if(is===!1)throw new SyntaxError("An invalid or illegal string was specified.");Xr=is,this.hasBeenReset=!0}})),Object.defineProperty(dt,"snapToLines",st({},ft,{get:function(){return Zr},set:function(os){Zr=!!os,this.hasBeenReset=!0}})),Object.defineProperty(dt,"line",st({},ft,{get:function(){return Qr},set:function(os){if(typeof os!="number"&&os!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");Qr=os,this.hasBeenReset=!0}})),Object.defineProperty(dt,"lineAlign",st({},ft,{get:function(){return _i},set:function(os){const is=it(os);if(!is)throw new SyntaxError("An invalid or illegal string was specified.");_i=is,this.hasBeenReset=!0}})),Object.defineProperty(dt,"position",st({},ft,{get:function(){return rs},set:function(os){if(os<0||os>100)throw new Error("Position must be between 0 and 100.");rs=os,this.hasBeenReset=!0}})),Object.defineProperty(dt,"positionAlign",st({},ft,{get:function(){return ns},set:function(os){const is=it(os);if(!is)throw new SyntaxError("An invalid or illegal string was specified.");ns=is,this.hasBeenReset=!0}})),Object.defineProperty(dt,"size",st({},ft,{get:function(){return ss},set:function(os){if(os<0||os>100)throw new Error("Size must be between 0 and 100.");ss=os,this.hasBeenReset=!0}})),Object.defineProperty(dt,"align",st({},ft,{get:function(){return fs},set:function(os){const is=it(os);if(!is)throw new SyntaxError("An invalid or illegal string was specified.");fs=is,this.hasBeenReset=!0}})),dt.displayState=void 0}return ot.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},ot}();class StringDecoder{decode(et,nt){if(!et)return"";if(typeof et!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(et))}}function parseTimeStamp(tt){function et(rt,it,st,ot){return(rt|0)*3600+(it|0)*60+(st|0)+parseFloat(ot||0)}const nt=tt.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return nt?parseFloat(nt[2])>59?et(nt[2],nt[3],0,nt[4]):et(nt[1],nt[2],nt[3],nt[4]):null}class Settings{constructor(){this.values=Object.create(null)}set(et,nt){!this.get(et)&&nt!==""&&(this.values[et]=nt)}get(et,nt,rt){return rt?this.has(et)?this.values[et]:nt[rt]:this.has(et)?this.values[et]:nt}has(et){return et in this.values}alt(et,nt,rt){for(let it=0;it<rt.length;++it)if(nt===rt[it]){this.set(et,nt);break}}integer(et,nt){/^-?\d+$/.test(nt)&&this.set(et,parseInt(nt,10))}percent(et,nt){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(nt)){const rt=parseFloat(nt);if(rt>=0&&rt<=100)return this.set(et,rt),!0}return!1}}function parseOptions(tt,et,nt,rt){const it=rt?tt.split(rt):[tt];for(const st in it){if(typeof it[st]!="string")continue;const ot=it[st].split(nt);if(ot.length!==2)continue;const lt=ot[0],ut=ot[1];et(lt,ut)}}const defaults=new VTTCue(0,0,""),center=defaults.align==="middle"?"middle":"center";function parseCue$1(tt,et,nt){const rt=tt;function it(){const lt=parseTimeStamp(tt);if(lt===null)throw new Error("Malformed timestamp: "+rt);return tt=tt.replace(/^[^\sa-zA-Z-]+/,""),lt}function st(lt,ut){const ct=new Settings;parseOptions(lt,function(pt,gt){let _r;switch(pt){case"region":for(let Yr=nt.length-1;Yr>=0;Yr--)if(nt[Yr].id===gt){ct.set(pt,nt[Yr].region);break}break;case"vertical":ct.alt(pt,gt,["rl","lr"]);break;case"line":_r=gt.split(","),ct.integer(pt,_r[0]),ct.percent(pt,_r[0])&&ct.set("snapToLines",!1),ct.alt(pt,_r[0],["auto"]),_r.length===2&&ct.alt("lineAlign",_r[1],["start",center,"end"]);break;case"position":_r=gt.split(","),ct.percent(pt,_r[0]),_r.length===2&&ct.alt("positionAlign",_r[1],["start",center,"end","line-left","line-right","auto"]);break;case"size":ct.percent(pt,gt);break;case"align":ct.alt(pt,gt,["start",center,"end","left","right"]);break}},/:/,/\s/),ut.region=ct.get("region",null),ut.vertical=ct.get("vertical","");let dt=ct.get("line","auto");dt==="auto"&&defaults.line===-1&&(dt=-1),ut.line=dt,ut.lineAlign=ct.get("lineAlign","start"),ut.snapToLines=ct.get("snapToLines",!0),ut.size=ct.get("size",100),ut.align=ct.get("align",center);let ft=ct.get("position","auto");ft==="auto"&&defaults.position===50&&(ft=ut.align==="start"||ut.align==="left"?0:ut.align==="end"||ut.align==="right"?100:50),ut.position=ft}function ot(){tt=tt.replace(/^\s+/,"")}if(ot(),et.startTime=it(),ot(),tt.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+rt);tt=tt.slice(3),ot(),et.endTime=it(),ot(),st(tt,et)}function fixLineBreaks(tt){return tt.replace(/<br(?: \/)?>/gi,`
`)}class VTTParser{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new StringDecoder,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(et){const nt=this;et&&(nt.buffer+=nt.decoder.decode(et,{stream:!0}));function rt(){let st=nt.buffer,ot=0;for(st=fixLineBreaks(st);ot<st.length&&st[ot]!=="\r"&&st[ot]!==`
`;)++ot;const lt=st.slice(0,ot);return st[ot]==="\r"&&++ot,st[ot]===`
`&&++ot,nt.buffer=st.slice(ot),lt}function it(st){parseOptions(st,function(ot,lt){},/:/)}try{let st="";if(nt.state==="INITIAL"){if(!/\r\n|\n/.test(nt.buffer))return this;st=rt();const lt=st.match(/^()?WEBVTT([ \t].*)?$/);if(!(lt!=null&&lt[0]))throw new Error("Malformed WebVTT signature.");nt.state="HEADER"}let ot=!1;for(;nt.buffer;){if(!/\r\n|\n/.test(nt.buffer))return this;switch(ot?ot=!1:st=rt(),nt.state){case"HEADER":/:/.test(st)?it(st):st||(nt.state="ID");continue;case"NOTE":st||(nt.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(st)){nt.state="NOTE";break}if(!st)continue;if(nt.cue=new VTTCue(0,0,""),nt.state="CUE",st.indexOf("-->")===-1){nt.cue.id=st;continue}case"CUE":if(!nt.cue){nt.state="BADCUE";continue}try{parseCue$1(st,nt.cue,nt.regionList)}catch{nt.cue=null,nt.state="BADCUE";continue}nt.state="CUETEXT";continue;case"CUETEXT":{const lt=st.indexOf("-->")!==-1;if(!st||lt&&(ot=!0)){nt.oncue&&nt.cue&&nt.oncue(nt.cue),nt.cue=null,nt.state="ID";continue}if(nt.cue===null)continue;nt.cue.text&&(nt.cue.text+=`
`),nt.cue.text+=st}continue;case"BADCUE":st||(nt.state="ID")}}}catch{nt.state==="CUETEXT"&&nt.cue&&nt.oncue&&nt.oncue(nt.cue),nt.cue=null,nt.state=nt.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const et=this;try{if((et.cue||et.state==="HEADER")&&(et.buffer+=`

`,et.parse()),et.state==="INITIAL"||et.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(nt){et.onparsingerror&&et.onparsingerror(nt)}return et.onflush&&et.onflush(),this}}const LINEBREAKS=/\r\n|\n\r|\n|\r/g,startsWith=function(et,nt,rt=0){return et.slice(rt,rt+nt.length)===nt},cueString2millis=function(et){let nt=parseInt(et.slice(-3));const rt=parseInt(et.slice(-6,-4)),it=parseInt(et.slice(-9,-7)),st=et.length>9?parseInt(et.substring(0,et.indexOf(":"))):0;if(!isFiniteNumber(nt)||!isFiniteNumber(rt)||!isFiniteNumber(it)||!isFiniteNumber(st))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${et}`);return nt+=1e3*rt,nt+=60*1e3*it,nt+=60*60*1e3*st,nt},hash=function(et){let nt=5381,rt=et.length;for(;rt;)nt=nt*33^et.charCodeAt(--rt);return(nt>>>0).toString()};function generateCueId(tt,et,nt){return hash(tt.toString())+hash(et.toString())+hash(nt)}const calculateOffset=function(et,nt,rt){let it=et[nt],st=et[it.prevCC];if(!st||!st.new&&it.new){et.ccOffset=et.presentationOffset=it.start,it.new=!1;return}for(;(ot=st)!=null&&ot.new;){var ot;et.ccOffset+=it.start-st.start,it.new=!1,it=st,st=et[it.prevCC]}et.presentationOffset=rt};function parseWebVTT(tt,et,nt,rt,it,st,ot){const lt=new VTTParser,ut=utf8ArrayToStr(new Uint8Array(tt)).trim().replace(LINEBREAKS,`
`).split(`
`),ct=[],dt=et?toMpegTsClockFromTimescale(et.baseTime,et.timescale):0;let ft="00:00.000",pt=0,gt=0,_r,Yr=!0;lt.oncue=function(mt){const Kr=nt[rt];let Xr=nt.ccOffset;const Zr=(pt-dt)/9e4;if(Kr!=null&&Kr.new&&(gt!==void 0?Xr=nt.ccOffset=Kr.start:calculateOffset(nt,rt,Zr)),Zr){if(!et){_r=new Error("Missing initPTS for VTT MPEGTS");return}Xr=Zr-nt.presentationOffset}const Qr=mt.endTime-mt.startTime,_i=normalizePts((mt.startTime+Xr-gt)*9e4,it*9e4)/9e4;mt.startTime=Math.max(_i,0),mt.endTime=Math.max(_i+Qr,0);const rs=mt.text.trim();mt.text=decodeURIComponent(encodeURIComponent(rs)),mt.id||(mt.id=generateCueId(mt.startTime,mt.endTime,rs)),mt.endTime>0&&ct.push(mt)},lt.onparsingerror=function(mt){_r=mt},lt.onflush=function(){if(_r){ot(_r);return}st(ct)},ut.forEach(mt=>{if(Yr)if(startsWith(mt,"X-TIMESTAMP-MAP=")){Yr=!1,mt.slice(16).split(",").forEach(Kr=>{startsWith(Kr,"LOCAL:")?ft=Kr.slice(6):startsWith(Kr,"MPEGTS:")&&(pt=parseInt(Kr.slice(7)))});try{gt=cueString2millis(ft)/1e3}catch(Kr){_r=Kr}return}else mt===""&&(Yr=!1);lt.parse(mt+`
`)}),lt.flush()}const IMSC1_CODEC="stpp.ttml.im1t",HMSF_REGEX=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,TIME_UNIT_REGEX=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,textAlignToLineAlign={left:"start",center:"center",right:"end",start:"start",end:"end"};function parseIMSC1(tt,et,nt,rt){const it=findBox(new Uint8Array(tt),["mdat"]);if(it.length===0){rt(new Error("Could not parse IMSC1 mdat"));return}const st=it.map(lt=>utf8ArrayToStr(lt)),ot=toTimescaleFromScale(et.baseTime,1,et.timescale);try{st.forEach(lt=>nt(parseTTML(lt,ot)))}catch(lt){rt(lt)}}function parseTTML(tt,et){const it=new DOMParser().parseFromString(tt,"text/xml").getElementsByTagName("tt")[0];if(!it)throw new Error("Invalid ttml");const st={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},ot=Object.keys(st).reduce((ft,pt)=>(ft[pt]=it.getAttribute(`ttp:${pt}`)||st[pt],ft),{}),lt=it.getAttribute("xml:space")!=="preserve",ut=collectionToDictionary(getElementCollection(it,"styling","style")),ct=collectionToDictionary(getElementCollection(it,"layout","region")),dt=getElementCollection(it,"body","[begin]");return[].map.call(dt,ft=>{const pt=getTextContent(ft,lt);if(!pt||!ft.hasAttribute("begin"))return null;const gt=parseTtmlTime(ft.getAttribute("begin"),ot),_r=parseTtmlTime(ft.getAttribute("dur"),ot);let Yr=parseTtmlTime(ft.getAttribute("end"),ot);if(gt===null)throw timestampParsingError(ft);if(Yr===null){if(_r===null)throw timestampParsingError(ft);Yr=gt+_r}const mt=new VTTCue(gt-et,Yr-et,pt);mt.id=generateCueId(mt.startTime,mt.endTime,mt.text);const Kr=ct[ft.getAttribute("region")],Xr=ut[ft.getAttribute("style")],Zr=getTtmlStyles(Kr,Xr,ut),{textAlign:Qr}=Zr;if(Qr){const _i=textAlignToLineAlign[Qr];_i&&(mt.lineAlign=_i),mt.align=Qr}return _extends(mt,Zr),mt}).filter(ft=>ft!==null)}function getElementCollection(tt,et,nt){const rt=tt.getElementsByTagName(et)[0];return rt?[].slice.call(rt.querySelectorAll(nt)):[]}function collectionToDictionary(tt){return tt.reduce((et,nt)=>{const rt=nt.getAttribute("xml:id");return rt&&(et[rt]=nt),et},{})}function getTextContent(tt,et){return[].slice.call(tt.childNodes).reduce((nt,rt,it)=>{var st;return rt.nodeName==="br"&&it?nt+`
`:(st=rt.childNodes)!=null&&st.length?getTextContent(rt,et):et?nt+rt.textContent.trim().replace(/\s+/g," "):nt+rt.textContent},"")}function getTtmlStyles(tt,et,nt){const rt="http://www.w3.org/ns/ttml#styling";let it=null;const st=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],ot=tt!=null&&tt.hasAttribute("style")?tt.getAttribute("style"):null;return ot&&nt.hasOwnProperty(ot)&&(it=nt[ot]),st.reduce((lt,ut)=>{const ct=getAttributeNS(et,rt,ut)||getAttributeNS(tt,rt,ut)||getAttributeNS(it,rt,ut);return ct&&(lt[ut]=ct),lt},{})}function getAttributeNS(tt,et,nt){return tt&&tt.hasAttributeNS(et,nt)?tt.getAttributeNS(et,nt):null}function timestampParsingError(tt){return new Error(`Could not parse ttml timestamp ${tt}`)}function parseTtmlTime(tt,et){if(!tt)return null;let nt=parseTimeStamp(tt);return nt===null&&(HMSF_REGEX.test(tt)?nt=parseHoursMinutesSecondsFrames(tt,et):TIME_UNIT_REGEX.test(tt)&&(nt=parseTimeUnits(tt,et))),nt}function parseHoursMinutesSecondsFrames(tt,et){const nt=HMSF_REGEX.exec(tt),rt=(nt[4]|0)+(nt[5]|0)/et.subFrameRate;return(nt[1]|0)*3600+(nt[2]|0)*60+(nt[3]|0)+rt/et.frameRate}function parseTimeUnits(tt,et){const nt=TIME_UNIT_REGEX.exec(tt),rt=Number(nt[1]);switch(nt[2]){case"h":return rt*3600;case"m":return rt*60;case"ms":return rt*1e3;case"f":return rt/et.frameRate;case"t":return rt/et.tickRate}return rt}class TimelineController{constructor(et){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this.captionsProperties=void 0,this.hls=et,this.config=et.config,this.Cues=et.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},et.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),et.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),et.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),et.on(Events.FRAG_LOADING,this.onFragLoading,this),et.on(Events.FRAG_LOADED,this.onFragLoaded,this),et.on(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),et.on(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),et.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),et.on(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),et.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:et}=this;et.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),et.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),et.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),et.off(Events.FRAG_LOADING,this.onFragLoading,this),et.off(Events.FRAG_LOADED,this.onFragLoaded,this),et.off(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),et.off(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),et.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),et.off(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),et.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){const et=new OutputFilter(this,"textTrack1"),nt=new OutputFilter(this,"textTrack2"),rt=new OutputFilter(this,"textTrack3"),it=new OutputFilter(this,"textTrack4");this.cea608Parser1=new Cea608Parser(1,et,nt),this.cea608Parser2=new Cea608Parser(3,rt,it)}}addCues(et,nt,rt,it,st){let ot=!1;for(let lt=st.length;lt--;){const ut=st[lt],ct=intersection(ut[0],ut[1],nt,rt);if(ct>=0&&(ut[0]=Math.min(ut[0],nt),ut[1]=Math.max(ut[1],rt),ot=!0,ct/(rt-nt)>.5))return}if(ot||st.push([nt,rt]),this.config.renderTextTracksNatively){const lt=this.captionsTracks[et];this.Cues.newCue(lt,nt,rt,it)}else{const lt=this.Cues.newCue(null,nt,rt,it);this.hls.trigger(Events.CUES_PARSED,{type:"captions",cues:lt,track:et})}}onInitPtsFound(et,{frag:nt,id:rt,initPTS:it,timescale:st}){const{unparsedVttFrags:ot}=this;rt==="main"&&(this.initPTS[nt.cc]={baseTime:it,timescale:st}),ot.length&&(this.unparsedVttFrags=[],ot.forEach(lt=>{this.onFragLoaded(Events.FRAG_LOADED,lt)}))}getExistingTrack(et,nt){const{media:rt}=this;if(rt)for(let it=0;it<rt.textTracks.length;it++){const st=rt.textTracks[it];if(canReuseVttTextTrack(st,{name:et,lang:nt,attrs:{}}))return st}return null}createCaptionsTrack(et){this.config.renderTextTracksNatively?this.createNativeTrack(et):this.createNonNativeTrack(et)}createNativeTrack(et){if(this.captionsTracks[et])return;const{captionsProperties:nt,captionsTracks:rt,media:it}=this,{label:st,languageCode:ot}=nt[et],lt=this.getExistingTrack(st,ot);if(lt)rt[et]=lt,clearCurrentCues(rt[et]),sendAddTrackEvent(rt[et],it);else{const ut=this.createTextTrack("captions",st,ot);ut&&(ut[et]=!0,rt[et]=ut)}}createNonNativeTrack(et){if(this.nonNativeCaptionsTracks[et])return;const nt=this.captionsProperties[et];if(!nt)return;const rt=nt.label,it={_id:et,label:rt,kind:"captions",default:nt.media?!!nt.media.default:!1,closedCaptions:nt.media};this.nonNativeCaptionsTracks[et]=it,this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[it]})}createTextTrack(et,nt,rt){const it=this.media;if(it)return it.addTextTrack(et,nt,rt)}onMediaAttaching(et,nt){this.media=nt.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:et}=this;Object.keys(et).forEach(nt=>{clearCurrentCues(et[nt]),delete et[nt]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:et}=this;if(!et)return;const nt=et.textTracks;if(nt)for(let rt=0;rt<nt.length;rt++)clearCurrentCues(nt[rt])}onSubtitleTracksUpdated(et,nt){const rt=nt.subtitleTracks||[],it=rt.some(st=>st.textCodec===IMSC1_CODEC);if(this.config.enableWebVTT||it&&this.config.enableIMSC1){if(subtitleOptionsIdentical(this.tracks,rt)){this.tracks=rt;return}if(this.textTracks=[],this.tracks=rt,this.config.renderTextTracksNatively){const ot=this.media,lt=ot?filterSubtitleTracks(ot.textTracks):null;if(this.tracks.forEach((ut,ct)=>{let dt;if(lt){let ft=null;for(let pt=0;pt<lt.length;pt++)if(lt[pt]&&canReuseVttTextTrack(lt[pt],ut)){ft=lt[pt],lt[pt]=null;break}ft&&(dt=ft)}if(dt)clearCurrentCues(dt);else{const ft=captionsOrSubtitlesFromCharacteristics(ut);dt=this.createTextTrack(ft,ut.name,ut.lang),dt&&(dt.mode="disabled")}dt&&this.textTracks.push(dt)}),lt!=null&&lt.length){const ut=lt.filter(ct=>ct!==null).map(ct=>ct.label);ut.length&&logger.warn(`Media element contains unused subtitle tracks: ${ut.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const ot=this.tracks.map(lt=>({label:lt.name,kind:lt.type.toLowerCase(),default:lt.default,subtitleTrack:lt}));this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:ot})}}}onManifestLoaded(et,nt){this.config.enableCEA708Captions&&nt.captions&&nt.captions.forEach(rt=>{const it=/(?:CC|SERVICE)([1-4])/.exec(rt.instreamId);if(!it)return;const st=`textTrack${it[1]}`,ot=this.captionsProperties[st];ot&&(ot.label=rt.name,rt.lang&&(ot.languageCode=rt.lang),ot.media=rt)})}closedCaptionsForLevel(et){const nt=this.hls.levels[et.level];return nt==null?void 0:nt.attrs["CLOSED-CAPTIONS"]}onFragLoading(et,nt){this.initCea608Parsers();const{cea608Parser1:rt,cea608Parser2:it,lastCc:st,lastSn:ot,lastPartIndex:lt}=this;if(!(!this.enabled||!rt||!it)&&nt.frag.type===PlaylistLevelType.MAIN){var ut,ct;const{cc:dt,sn:ft}=nt.frag,pt=(ut=nt==null||(ct=nt.part)==null?void 0:ct.index)!=null?ut:-1;ft===ot+1||ft===ot&&pt===lt+1||dt===st||(rt.reset(),it.reset()),this.lastCc=dt,this.lastSn=ft,this.lastPartIndex=pt}}onFragLoaded(et,nt){const{frag:rt,payload:it}=nt;if(rt.type===PlaylistLevelType.SUBTITLE)if(it.byteLength){const st=rt.decryptdata,ot="stats"in nt;if(st==null||!st.encrypted||ot){const lt=this.tracks[rt.level],ut=this.vttCCs;ut[rt.cc]||(ut[rt.cc]={start:rt.start,prevCC:this.prevCC,new:!0},this.prevCC=rt.cc),lt&&lt.textCodec===IMSC1_CODEC?this._parseIMSC1(rt,it):this._parseVTTs(nt)}}else this.hls.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:rt,error:new Error("Empty subtitle payload")})}_parseIMSC1(et,nt){const rt=this.hls;parseIMSC1(nt,this.initPTS[et.cc],it=>{this._appendCues(it,et.level),rt.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:et})},it=>{logger.log(`Failed to parse IMSC1: ${it}`),rt.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:et,error:it})})}_parseVTTs(et){var nt;const{frag:rt,payload:it}=et,{initPTS:st,unparsedVttFrags:ot}=this,lt=st.length-1;if(!st[rt.cc]&&lt===-1){ot.push(et);return}const ut=this.hls,ct=(nt=rt.initSegment)!=null&&nt.data?appendUint8Array(rt.initSegment.data,new Uint8Array(it)):it;parseWebVTT(ct,this.initPTS[rt.cc],this.vttCCs,rt.cc,rt.start,dt=>{this._appendCues(dt,rt.level),ut.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:rt})},dt=>{const ft=dt.message==="Missing initPTS for VTT MPEGTS";ft?ot.push(et):this._fallbackToIMSC1(rt,it),logger.log(`Failed to parse VTT cue: ${dt}`),!(ft&&lt>rt.cc)&&ut.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:rt,error:dt})})}_fallbackToIMSC1(et,nt){const rt=this.tracks[et.level];rt.textCodec||parseIMSC1(nt,this.initPTS[et.cc],()=>{rt.textCodec=IMSC1_CODEC,this._parseIMSC1(et,nt)},()=>{rt.textCodec="wvtt"})}_appendCues(et,nt){const rt=this.hls;if(this.config.renderTextTracksNatively){const it=this.textTracks[nt];if(!it||it.mode==="disabled")return;et.forEach(st=>addCueToTrack(it,st))}else{const it=this.tracks[nt];if(!it)return;const st=it.default?"default":"subtitles"+nt;rt.trigger(Events.CUES_PARSED,{type:"subtitles",cues:et,track:st})}}onFragDecrypted(et,nt){const{frag:rt}=nt;rt.type===PlaylistLevelType.SUBTITLE&&this.onFragLoaded(Events.FRAG_LOADED,nt)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(et,nt){this.initCea608Parsers();const{cea608Parser1:rt,cea608Parser2:it}=this;if(!this.enabled||!rt||!it)return;const{frag:st,samples:ot}=nt;if(!(st.type===PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(st)==="NONE"))for(let lt=0;lt<ot.length;lt++){const ut=ot[lt].bytes;if(ut){const ct=this.extractCea608Data(ut);rt.addData(ot[lt].pts,ct[0]),it.addData(ot[lt].pts,ct[1])}}}onBufferFlushing(et,{startOffset:nt,endOffset:rt,endOffsetSubtitles:it,type:st}){const{media:ot}=this;if(!(!ot||ot.currentTime<rt)){if(!st||st==="video"){const{captionsTracks:lt}=this;Object.keys(lt).forEach(ut=>removeCuesInRange(lt[ut],nt,rt))}if(this.config.renderTextTracksNatively&&nt===0&&it!==void 0){const{textTracks:lt}=this;Object.keys(lt).forEach(ut=>removeCuesInRange(lt[ut],nt,it))}}}extractCea608Data(et){const nt=[[],[]],rt=et[0]&31;let it=2;for(let st=0;st<rt;st++){const ot=et[it++],lt=127&et[it++],ut=127&et[it++];if(lt===0&&ut===0)continue;if((4&ot)!==0){const dt=3&ot;(dt===0||dt===1)&&(nt[dt].push(lt),nt[dt].push(ut))}}return nt}}function captionsOrSubtitlesFromCharacteristics(tt){return tt.characteristics&&/transcribes-spoken-dialog/gi.test(tt.characteristics)&&/describes-music-and-sound/gi.test(tt.characteristics)?"captions":"subtitles"}function canReuseVttTextTrack(tt,et){return!!tt&&tt.kind===captionsOrSubtitlesFromCharacteristics(et)&&subtitleTrackMatchesTextTrack(et,tt)}function intersection(tt,et,nt,rt){return Math.min(et,rt)-Math.max(tt,nt)}function newVTTCCs(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class CapLevelController{constructor(et){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=et,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(et){this.streamController=et}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:et}=this;et.on(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),et.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),et.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),et.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),et.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:et}=this;et.off(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),et.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),et.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),et.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),et.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(et,nt){const rt=this.hls.levels[nt.droppedLevel];this.isLevelAllowed(rt)&&this.restrictedLevels.push({bitrate:rt.bitrate,height:rt.height,width:rt.width})}onMediaAttaching(et,nt){this.media=nt.media instanceof HTMLVideoElement?nt.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(et,nt){const rt=this.hls;this.restrictedLevels=[],this.firstLevel=nt.firstLevel,rt.config.capLevelToPlayerSize&&nt.video&&this.startCapping()}onLevelsUpdated(et,nt){this.timer&&isFiniteNumber(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(et,nt){this.hls.config.capLevelToPlayerSize&&nt.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const et=this.hls.levels;if(et.length){const nt=this.hls,rt=this.getMaxLevel(et.length-1);rt!==this.autoLevelCapping&&logger.log(`Setting autoLevelCapping to ${rt}: ${et[rt].height}p@${et[rt].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),nt.autoLevelCapping=rt,nt.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=nt.autoLevelCapping}}}getMaxLevel(et){const nt=this.hls.levels;if(!nt.length)return-1;const rt=nt.filter((it,st)=>this.isLevelAllowed(it)&&st<=et);return this.clientRect=null,CapLevelController.getMaxLevelByMediaSize(rt,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const et=this.media,nt={width:0,height:0};if(et){const rt=et.getBoundingClientRect();nt.width=rt.width,nt.height=rt.height,!nt.width&&!nt.height&&(nt.width=rt.right-rt.left||et.width||0,nt.height=rt.bottom-rt.top||et.height||0)}return this.clientRect=nt,nt}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let et=1;if(!this.hls.config.ignoreDevicePixelRatio)try{et=self.devicePixelRatio}catch{}return et}isLevelAllowed(et){return!this.restrictedLevels.some(rt=>et.bitrate===rt.bitrate&&et.width===rt.width&&et.height===rt.height)}static getMaxLevelByMediaSize(et,nt,rt){if(!(et!=null&&et.length))return-1;const it=(lt,ut)=>ut?lt.width!==ut.width||lt.height!==ut.height:!0;let st=et.length-1;const ot=Math.max(nt,rt);for(let lt=0;lt<et.length;lt+=1){const ut=et[lt];if((ut.width>=ot||ut.height>=ot)&&it(ut,et[lt+1])){st=lt;break}}return st}}class FPSController{constructor(et){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=et,this.registerListeners()}setStreamController(et){this.streamController=et}registerListeners(){this.hls.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(et,nt){const rt=this.hls.config;if(rt.capLevelOnFPSDrop){const it=nt.media instanceof self.HTMLVideoElement?nt.media:null;this.media=it,it&&typeof it.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),rt.fpsDroppedMonitoringPeriod)}}checkFPS(et,nt,rt){const it=performance.now();if(nt){if(this.lastTime){const st=it-this.lastTime,ot=rt-this.lastDroppedFrames,lt=nt-this.lastDecodedFrames,ut=1e3*ot/st,ct=this.hls;if(ct.trigger(Events.FPS_DROP,{currentDropped:ot,currentDecoded:lt,totalDroppedFrames:rt}),ut>0&&ot>ct.config.fpsDroppedMonitoringThreshold*lt){let dt=ct.currentLevel;logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+dt),dt>0&&(ct.autoLevelCapping===-1||ct.autoLevelCapping>=dt)&&(dt=dt-1,ct.trigger(Events.FPS_DROP_LEVEL_CAPPING,{level:dt,droppedLevel:ct.currentLevel}),ct.autoLevelCapping=dt,this.streamController.nextLevelSwitch())}}this.lastTime=it,this.lastDroppedFrames=rt,this.lastDecodedFrames=nt}}checkFPSInterval(){const et=this.media;if(et)if(this.isVideoPlaybackQualityAvailable){const nt=et.getVideoPlaybackQuality();this.checkFPS(et,nt.totalVideoFrames,nt.droppedVideoFrames)}else this.checkFPS(et,et.webkitDecodedFrameCount,et.webkitDroppedFrameCount)}}const LOGGER_PREFIX="[eme]";class EMEController{constructor(et){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=EMEController.CDMCleanupPromise?[EMEController.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=logger.debug.bind(logger,LOGGER_PREFIX),this.log=logger.log.bind(logger,LOGGER_PREFIX),this.warn=logger.warn.bind(logger,LOGGER_PREFIX),this.error=logger.error.bind(logger,LOGGER_PREFIX),this.hls=et,this.config=et.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const et=this.config;et.requestMediaKeySystemAccessFunc=null,et.licenseXhrSetup=et.licenseResponseCallback=void 0,et.drmSystems=et.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(et){const{drmSystems:nt,widevineLicenseUrl:rt}=this.config,it=nt[et];if(it)return it.licenseUrl;if(et===KeySystems.WIDEVINE&&rt)return rt;throw new Error(`no license server URL configured for key-system "${et}"`)}getServerCertificateUrl(et){const{drmSystems:nt}=this.config,rt=nt[et];if(rt)return rt.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${et}"]`)}attemptKeySystemAccess(et){const nt=this.hls.levels,rt=(ot,lt,ut)=>!!ot&&ut.indexOf(ot)===lt,it=nt.map(ot=>ot.audioCodec).filter(rt),st=nt.map(ot=>ot.videoCodec).filter(rt);return it.length+st.length===0&&st.push("avc1.42e01e"),new Promise((ot,lt)=>{const ut=ct=>{const dt=ct.shift();this.getMediaKeysPromise(dt,it,st).then(ft=>ot({keySystem:dt,mediaKeys:ft})).catch(ft=>{ct.length?ut(ct):ft instanceof EMEKeyError?lt(ft):lt(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:ft,fatal:!0},ft.message))})};ut(et)})}requestMediaKeySystemAccess(et,nt){const{requestMediaKeySystemAccessFunc:rt}=this.config;if(typeof rt!="function"){let it=`Configured requestMediaKeySystemAccess is not a function ${rt}`;return requestMediaKeySystemAccess===null&&self.location.protocol==="http:"&&(it=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(it))}return rt(et,nt)}getMediaKeysPromise(et,nt,rt){const it=getSupportedMediaKeySystemConfigurations(et,nt,rt,this.config.drmSystemOptions),st=this.keySystemAccessPromises[et];let ot=st==null?void 0:st.keySystemAccess;if(!ot){this.log(`Requesting encrypted media "${et}" key-system access with config: ${JSON.stringify(it)}`),ot=this.requestMediaKeySystemAccess(et,it);const lt=this.keySystemAccessPromises[et]={keySystemAccess:ot};return ot.catch(ut=>{this.log(`Failed to obtain access to key-system "${et}": ${ut}`)}),ot.then(ut=>{this.log(`Access for key-system "${ut.keySystem}" obtained`);const ct=this.fetchServerCertificate(et);return this.log(`Create media-keys for "${et}"`),lt.mediaKeys=ut.createMediaKeys().then(dt=>(this.log(`Media-keys created for "${et}"`),ct.then(ft=>ft?this.setMediaKeysServerCertificate(dt,et,ft):dt))),lt.mediaKeys.catch(dt=>{this.error(`Failed to create media-keys for "${et}"}: ${dt}`)}),lt.mediaKeys})}return ot.then(()=>st.mediaKeys)}createMediaKeySessionContext({decryptdata:et,keySystem:nt,mediaKeys:rt}){this.log(`Creating key-system session "${nt}" keyId: ${Hex.hexDump(et.keyId||[])}`);const it=rt.createSession(),st={decryptdata:et,keySystem:nt,mediaKeys:rt,mediaKeysSession:it,keyStatus:"status-pending"};return this.mediaKeySessions.push(st),st}renewKeySession(et){const nt=et.decryptdata;if(nt.pssh){const rt=this.createMediaKeySessionContext(et),it=this.getKeyIdString(nt),st="cenc";this.keyIdToKeySessionPromise[it]=this.generateRequestWithPreferredKeySession(rt,st,nt.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(et)}getKeyIdString(et){if(!et)throw new Error("Could not read keyId of undefined decryptdata");if(et.keyId===null)throw new Error("keyId is null");return Hex.hexDump(et.keyId)}updateKeySession(et,nt){var rt;const it=et.mediaKeysSession;return this.log(`Updating key-session "${it.sessionId}" for keyID ${Hex.hexDump(((rt=et.decryptdata)==null?void 0:rt.keyId)||[])}
      } (data length: ${nt&&nt.byteLength})`),it.update(nt)}selectKeySystemFormat(et){const nt=Object.keys(et.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${et.sn} ${et.type}: ${et.level}) key formats ${nt.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(nt)),this.keyFormatPromise}getKeyFormatPromise(et){return new Promise((nt,rt)=>{const it=getKeySystemsForConfig(this.config),st=et.map(keySystemFormatToKeySystemDomain).filter(ot=>!!ot&&it.indexOf(ot)!==-1);return this.getKeySystemSelectionPromise(st).then(({keySystem:ot})=>{const lt=keySystemDomainToKeySystemFormat(ot);lt?nt(lt):rt(new Error(`Unable to find format for key-system "${ot}"`))}).catch(rt)})}loadKey(et){const nt=et.keyInfo.decryptdata,rt=this.getKeyIdString(nt),it=`(keyId: ${rt} format: "${nt.keyFormat}" method: ${nt.method} uri: ${nt.uri})`;this.log(`Starting session for key ${it}`);let st=this.keyIdToKeySessionPromise[rt];return st||(st=this.keyIdToKeySessionPromise[rt]=this.getKeySystemForKeyPromise(nt).then(({keySystem:ot,mediaKeys:lt})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${et.frag.sn} ${et.frag.type}: ${et.frag.level} using key ${it}`),this.attemptSetMediaKeys(ot,lt).then(()=>{this.throwIfDestroyed();const ut=this.createMediaKeySessionContext({keySystem:ot,mediaKeys:lt,decryptdata:nt});return this.generateRequestWithPreferredKeySession(ut,"cenc",nt.pssh,"playlist-key")}))),st.catch(ot=>this.handleError(ot))),st}throwIfDestroyed(et="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(et){this.hls&&(this.error(et.message),et instanceof EMEKeyError?this.hls.trigger(Events.ERROR,et.data):this.hls.trigger(Events.ERROR,{type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_KEYS,error:et,fatal:!0}))}getKeySystemForKeyPromise(et){const nt=this.getKeyIdString(et),rt=this.keyIdToKeySessionPromise[nt];if(!rt){const it=keySystemFormatToKeySystemDomain(et.keyFormat),st=it?[it]:getKeySystemsForConfig(this.config);return this.attemptKeySystemAccess(st)}return rt}getKeySystemSelectionPromise(et){if(et.length||(et=getKeySystemsForConfig(this.config)),et.length===0)throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(et)}_onMediaEncrypted(et){const{initDataType:nt,initData:rt}=et;if(this.debug(`"${et.type}" event: init data type: "${nt}"`),rt===null)return;let it,st;if(nt==="sinf"&&this.config.drmSystems[KeySystems.FAIRPLAY]){const dt=bin2str(new Uint8Array(rt));try{const ft=base64Decode(JSON.parse(dt).sinf),pt=parseSinf(new Uint8Array(ft));if(!pt)return;it=pt.subarray(8,24),st=KeySystems.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{const dt=parsePssh(rt);if(dt===null)return;dt.version===0&&dt.systemId===KeySystemIds.WIDEVINE&&dt.data&&(it=dt.data.subarray(8,24)),st=keySystemIdToKeySystemDomain(dt.systemId)}if(!st||!it)return;const ot=Hex.hexDump(it),{keyIdToKeySessionPromise:lt,mediaKeySessions:ut}=this;let ct=lt[ot];for(let dt=0;dt<ut.length;dt++){const ft=ut[dt],pt=ft.decryptdata;if(pt.pssh||!pt.keyId)continue;const gt=Hex.hexDump(pt.keyId);if(ot===gt||pt.uri.replace(/-/g,"").indexOf(ot)!==-1){ct=lt[gt],delete lt[gt],pt.pssh=new Uint8Array(rt),pt.keyId=it,ct=lt[ot]=ct.then(()=>this.generateRequestWithPreferredKeySession(ft,nt,rt,"encrypted-event-key-match"));break}}ct||(ct=lt[ot]=this.getKeySystemSelectionPromise([st]).then(({keySystem:dt,mediaKeys:ft})=>{var pt;this.throwIfDestroyed();const gt=new LevelKey("ISO-23001-7",ot,(pt=keySystemDomainToKeySystemFormat(dt))!=null?pt:"");return gt.pssh=new Uint8Array(rt),gt.keyId=it,this.attemptSetMediaKeys(dt,ft).then(()=>{this.throwIfDestroyed();const _r=this.createMediaKeySessionContext({decryptdata:gt,keySystem:dt,mediaKeys:ft});return this.generateRequestWithPreferredKeySession(_r,nt,rt,"encrypted-event-no-match")})})),ct.catch(dt=>this.handleError(dt))}_onWaitingForKey(et){this.log(`"${et.type}" event`)}attemptSetMediaKeys(et,nt){const rt=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${et}"`);const it=Promise.all(rt).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(nt)});return this.setMediaKeysQueue.push(it),it.then(()=>{this.log(`Media-keys set for "${et}"`),rt.push(it),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(st=>rt.indexOf(st)===-1)})}generateRequestWithPreferredKeySession(et,nt,rt,it){var st,ot;const lt=(st=this.config.drmSystems)==null||(ot=st[et.keySystem])==null?void 0:ot.generateRequest;if(lt)try{const _r=lt.call(this.hls,nt,rt,et);if(!_r)throw new Error("Invalid response from configured generateRequest filter");nt=_r.initDataType,rt=et.decryptdata.pssh=_r.initData?new Uint8Array(_r.initData):null}catch(_r){var ut;if(this.warn(_r.message),(ut=this.hls)!=null&&ut.config.debug)throw _r}if(rt===null)return this.log(`Skipping key-session request for "${it}" (no initData)`),Promise.resolve(et);const ct=this.getKeyIdString(et.decryptdata);this.log(`Generating key-session request for "${it}": ${ct} (init data type: ${nt} length: ${rt?rt.byteLength:null})`);const dt=new EventEmitter,ft=et._onmessage=_r=>{const Yr=et.mediaKeysSession;if(!Yr){dt.emit("error",new Error("invalid state"));return}const{messageType:mt,message:Kr}=_r;this.log(`"${mt}" message event for session "${Yr.sessionId}" message size: ${Kr.byteLength}`),mt==="license-request"||mt==="license-renewal"?this.renewLicense(et,Kr).catch(Xr=>{this.handleError(Xr),dt.emit("error",Xr)}):mt==="license-release"?et.keySystem===KeySystems.FAIRPLAY&&(this.updateKeySession(et,strToUtf8array("acknowledged")),this.removeSession(et)):this.warn(`unhandled media key message type "${mt}"`)},pt=et._onkeystatuseschange=_r=>{if(!et.mediaKeysSession){dt.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(et);const mt=et.keyStatus;dt.emit("keyStatus",mt),mt==="expired"&&(this.warn(`${et.keySystem} expired for key ${ct}`),this.renewKeySession(et))};et.mediaKeysSession.addEventListener("message",ft),et.mediaKeysSession.addEventListener("keystatuseschange",pt);const gt=new Promise((_r,Yr)=>{dt.on("error",Yr),dt.on("keyStatus",mt=>{mt.startsWith("usable")?_r():mt==="output-restricted"?Yr(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):mt==="internal-error"?Yr(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${mt}"`)):mt==="expired"?Yr(new Error("key expired while generating request")):this.warn(`unhandled key status change "${mt}"`)})});return et.mediaKeysSession.generateRequest(nt,rt).then(()=>{var _r;this.log(`Request generated for key-session "${(_r=et.mediaKeysSession)==null?void 0:_r.sessionId}" keyId: ${ct}`)}).catch(_r=>{throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_SESSION,error:_r,fatal:!1},`Error generating key-session request: ${_r}`)}).then(()=>gt).catch(_r=>{throw dt.removeAllListeners(),this.removeSession(et),_r}).then(()=>(dt.removeAllListeners(),et))}onKeyStatusChange(et){et.mediaKeysSession.keyStatuses.forEach((nt,rt)=>{this.log(`key status change "${nt}" for keyStatuses keyId: ${Hex.hexDump("buffer"in rt?new Uint8Array(rt.buffer,rt.byteOffset,rt.byteLength):new Uint8Array(rt))} session keyId: ${Hex.hexDump(new Uint8Array(et.decryptdata.keyId||[]))} uri: ${et.decryptdata.uri}`),et.keyStatus=nt})}fetchServerCertificate(et){const nt=this.config,rt=nt.loader,it=new rt(nt),st=this.getServerCertificateUrl(et);return st?(this.log(`Fetching server certificate for "${et}"`),new Promise((ot,lt)=>{const ut={responseType:"arraybuffer",url:st},ct=nt.certLoadPolicy.default,dt={loadPolicy:ct,timeout:ct.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},ft={onSuccess:(pt,gt,_r,Yr)=>{ot(pt.data)},onError:(pt,gt,_r,Yr)=>{lt(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:_r,response:_objectSpread2({url:ut.url,data:void 0},pt)},`"${et}" certificate request failed (${st}). Status: ${pt.code} (${pt.text})`))},onTimeout:(pt,gt,_r)=>{lt(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:_r,response:{url:ut.url,data:void 0}},`"${et}" certificate request timed out (${st})`))},onAbort:(pt,gt,_r)=>{lt(new Error("aborted"))}};it.load(ut,dt,ft)})):Promise.resolve()}setMediaKeysServerCertificate(et,nt,rt){return new Promise((it,st)=>{et.setServerCertificate(rt).then(ot=>{this.log(`setServerCertificate ${ot?"success":"not supported by CDM"} (${rt==null?void 0:rt.byteLength}) on "${nt}"`),it(et)}).catch(ot=>{st(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:ot,fatal:!0},ot.message))})})}renewLicense(et,nt){return this.requestLicense(et,new Uint8Array(nt)).then(rt=>this.updateKeySession(et,new Uint8Array(rt)).catch(it=>{throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:it,fatal:!0},it.message)}))}unpackPlayReadyKeyMessage(et,nt){const rt=String.fromCharCode.apply(null,new Uint16Array(nt.buffer));if(!rt.includes("PlayReadyKeyMessage"))return et.setRequestHeader("Content-Type","text/xml; charset=utf-8"),nt;const it=new DOMParser().parseFromString(rt,"application/xml"),st=it.querySelectorAll("HttpHeader");if(st.length>0){let dt;for(let ft=0,pt=st.length;ft<pt;ft++){var ot,lt;dt=st[ft];const gt=(ot=dt.querySelector("name"))==null?void 0:ot.textContent,_r=(lt=dt.querySelector("value"))==null?void 0:lt.textContent;gt&&_r&&et.setRequestHeader(gt,_r)}}const ut=it.querySelector("Challenge"),ct=ut==null?void 0:ut.textContent;if(!ct)throw new Error("Cannot find <Challenge> in key message");return strToUtf8array(atob(ct))}setupLicenseXHR(et,nt,rt,it){const st=this.config.licenseXhrSetup;return st?Promise.resolve().then(()=>{if(!rt.decryptdata)throw new Error("Key removed");return st.call(this.hls,et,nt,rt,it)}).catch(ot=>{if(!rt.decryptdata)throw ot;return et.open("POST",nt,!0),st.call(this.hls,et,nt,rt,it)}).then(ot=>(et.readyState||et.open("POST",nt,!0),{xhr:et,licenseChallenge:ot||it})):(et.open("POST",nt,!0),Promise.resolve({xhr:et,licenseChallenge:it}))}requestLicense(et,nt){const rt=this.config.keyLoadPolicy.default;return new Promise((it,st)=>{const ot=this.getLicenseServerUrl(et.keySystem);this.log(`Sending license request to URL: ${ot}`);const lt=new XMLHttpRequest;lt.responseType="arraybuffer",lt.onreadystatechange=()=>{if(!this.hls||!et.mediaKeysSession)return st(new Error("invalid state"));if(lt.readyState===4)if(lt.status===200){this._requestLicenseFailureCount=0;let ut=lt.response;this.log(`License received ${ut instanceof ArrayBuffer?ut.byteLength:ut}`);const ct=this.config.licenseResponseCallback;if(ct)try{ut=ct.call(this.hls,lt,ot,et)}catch(dt){this.error(dt)}it(ut)}else{const ut=rt.errorRetry,ct=ut?ut.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>ct||lt.status>=400&&lt.status<500)st(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:lt,response:{url:ot,data:void 0,code:lt.status,text:lt.statusText}},`License Request XHR failed (${ot}). Status: ${lt.status} (${lt.statusText})`));else{const dt=ct-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${dt} attempts left`),this.requestLicense(et,nt).then(it,st)}}},et.licenseXhr&&et.licenseXhr.readyState!==XMLHttpRequest.DONE&&et.licenseXhr.abort(),et.licenseXhr=lt,this.setupLicenseXHR(lt,ot,et,nt).then(({xhr:ut,licenseChallenge:ct})=>{et.keySystem==KeySystems.PLAYREADY&&(ct=this.unpackPlayReadyKeyMessage(ut,ct)),ut.send(ct)})})}onMediaAttached(et,nt){if(!this.config.emeEnabled)return;const rt=nt.media;this.media=rt,rt.addEventListener("encrypted",this.onMediaEncrypted),rt.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const et=this.media,nt=this.mediaKeySessions;et&&(et.removeEventListener("encrypted",this.onMediaEncrypted),et.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},LevelKey.clearKeyUriToKeyIdMap();const rt=nt.length;EMEController.CDMCleanupPromise=Promise.all(nt.map(it=>this.removeSession(it)).concat(et==null?void 0:et.setMediaKeys(null).catch(it=>{this.log(`Could not clear media keys: ${it}`)}))).then(()=>{rt&&(this.log("finished closing key sessions and clearing media keys"),nt.length=0)}).catch(it=>{this.log(`Could not close sessions and clear media keys: ${it}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(et,{sessionKeys:nt}){if(!(!nt||!this.config.emeEnabled)&&!this.keyFormatPromise){const rt=nt.reduce((it,st)=>(it.indexOf(st.keyFormat)===-1&&it.push(st.keyFormat),it),[]);this.log(`Selecting key-system from session-keys ${rt.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(rt)}}removeSession(et){const{mediaKeysSession:nt,licenseXhr:rt}=et;if(nt){this.log(`Remove licenses and keys and close session ${nt.sessionId}`),et._onmessage&&(nt.removeEventListener("message",et._onmessage),et._onmessage=void 0),et._onkeystatuseschange&&(nt.removeEventListener("keystatuseschange",et._onkeystatuseschange),et._onkeystatuseschange=void 0),rt&&rt.readyState!==XMLHttpRequest.DONE&&rt.abort(),et.mediaKeysSession=et.decryptdata=et.licenseXhr=void 0;const it=this.mediaKeySessions.indexOf(et);return it>-1&&this.mediaKeySessions.splice(it,1),nt.remove().catch(st=>{this.log(`Could not remove session: ${st}`)}).then(()=>nt.close()).catch(st=>{this.log(`Could not close session: ${st}`)})}}}EMEController.CDMCleanupPromise=void 0;class EMEKeyError extends Error{constructor(et,nt){super(nt),this.data=void 0,et.error||(et.error=new Error(nt)),this.data=et,et.err=et.error}}var CmObjectType;(function(tt){tt.MANIFEST="m",tt.AUDIO="a",tt.VIDEO="v",tt.MUXED="av",tt.INIT="i",tt.CAPTION="c",tt.TIMED_TEXT="tt",tt.KEY="k",tt.OTHER="o"})(CmObjectType||(CmObjectType={}));var CmStreamingFormat;(function(tt){tt.DASH="d",tt.HLS="h",tt.SMOOTH="s",tt.OTHER="o"})(CmStreamingFormat||(CmStreamingFormat={}));var CmcdHeaderField;(function(tt){tt.OBJECT="CMCD-Object",tt.REQUEST="CMCD-Request",tt.SESSION="CMCD-Session",tt.STATUS="CMCD-Status"})(CmcdHeaderField||(CmcdHeaderField={}));const CmcdHeaderMap={[CmcdHeaderField.OBJECT]:["br","d","ot","tb"],[CmcdHeaderField.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[CmcdHeaderField.SESSION]:["cid","pr","sf","sid","st","v"],[CmcdHeaderField.STATUS]:["bs","rtp"]};class SfItem{constructor(et,nt){this.value=void 0,this.params=void 0,Array.isArray(et)&&(et=et.map(rt=>rt instanceof SfItem?rt:new SfItem(rt))),this.value=et,this.params=nt}}class SfToken{constructor(et){this.description=void 0,this.description=et}}const DICT="Dict";function format(tt){return Array.isArray(tt)?JSON.stringify(tt):tt instanceof Map?"Map{}":tt instanceof Set?"Set{}":typeof tt=="object"?JSON.stringify(tt):String(tt)}function throwError(tt,et,nt,rt){return new Error(`failed to ${tt} "${format(et)}" as ${nt}`,{cause:rt})}const BARE_ITEM="Bare Item",BOOLEAN="Boolean",BYTES="Byte Sequence",DECIMAL="Decimal",INTEGER="Integer";function isInvalidInt(tt){return tt<-999999999999999||999999999999999<tt}const STRING_REGEX=/[\x00-\x1f\x7f]+/,TOKEN="Token",KEY="Key";function serializeError(tt,et,nt){return throwError("serialize",tt,et,nt)}function serializeBoolean(tt){if(typeof tt!="boolean")throw serializeError(tt,BOOLEAN);return tt?"?1":"?0"}function base64encode(tt){return btoa(String.fromCharCode(...tt))}function serializeByteSequence(tt){if(ArrayBuffer.isView(tt)===!1)throw serializeError(tt,BYTES);return`:${base64encode(tt)}:`}function serializeInteger(tt){if(isInvalidInt(tt))throw serializeError(tt,INTEGER);return tt.toString()}function serializeDate(tt){return`@${serializeInteger(tt.getTime()/1e3)}`}function roundToEven(tt,et){if(tt<0)return-roundToEven(-tt,et);const nt=Math.pow(10,et);if(Math.abs(tt*nt%1-.5)<Number.EPSILON){const it=Math.floor(tt*nt);return(it%2===0?it:it+1)/nt}else return Math.round(tt*nt)/nt}function serializeDecimal(tt){const et=roundToEven(tt,3);if(Math.floor(Math.abs(et)).toString().length>12)throw serializeError(tt,DECIMAL);const nt=et.toString();return nt.includes(".")?nt:`${nt}.0`}const STRING="String";function serializeString(tt){if(STRING_REGEX.test(tt))throw serializeError(tt,STRING);return`"${tt.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function symbolToStr(tt){return tt.description||tt.toString().slice(7,-1)}function serializeToken(tt){const et=symbolToStr(tt);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(et)===!1)throw serializeError(et,TOKEN);return et}function serializeBareItem(tt){switch(typeof tt){case"number":if(!isFiniteNumber(tt))throw serializeError(tt,BARE_ITEM);return Number.isInteger(tt)?serializeInteger(tt):serializeDecimal(tt);case"string":return serializeString(tt);case"symbol":return serializeToken(tt);case"boolean":return serializeBoolean(tt);case"object":if(tt instanceof Date)return serializeDate(tt);if(tt instanceof Uint8Array)return serializeByteSequence(tt);if(tt instanceof SfToken)return serializeToken(tt);default:throw serializeError(tt,BARE_ITEM)}}function serializeKey(tt){if(/^[a-z*][a-z0-9\-_.*]*$/.test(tt)===!1)throw serializeError(tt,KEY);return tt}function serializeParams(tt){return tt==null?"":Object.entries(tt).map(([et,nt])=>nt===!0?`;${serializeKey(et)}`:`;${serializeKey(et)}=${serializeBareItem(nt)}`).join("")}function serializeItem(tt){return tt instanceof SfItem?`${serializeBareItem(tt.value)}${serializeParams(tt.params)}`:serializeBareItem(tt)}function serializeInnerList(tt){return`(${tt.value.map(serializeItem).join(" ")})${serializeParams(tt.params)}`}function serializeDict(tt,et={whitespace:!0}){if(typeof tt!="object")throw serializeError(tt,DICT);const nt=tt instanceof Map?tt.entries():Object.entries(tt),rt=et!=null&&et.whitespace?" ":"";return Array.from(nt).map(([it,st])=>{st instanceof SfItem||(st=new SfItem(st));let ot=serializeKey(it);return st.value===!0?ot+=serializeParams(st.params):(ot+="=",Array.isArray(st.value)?ot+=serializeInnerList(st):ot+=serializeItem(st)),ot}).join(`,${rt}`)}function encodeSfDict(tt,et){return serializeDict(tt,et)}const isTokenField=tt=>tt==="ot"||tt==="sf"||tt==="st",isValid=tt=>typeof tt=="number"?isFiniteNumber(tt):tt!=null&&tt!==""&&tt!==!1;function urlToRelativePath(tt,et){const nt=new URL(tt),rt=new URL(et);if(nt.origin!==rt.origin)return tt;const it=nt.pathname.split("/").slice(1),st=rt.pathname.split("/").slice(1,-1);for(;it[0]===st[0];)it.shift(),st.shift();for(;st.length;)st.shift(),it.unshift("..");return it.join("/")}function uuid(){try{return crypto.randomUUID()}catch{try{const et=URL.createObjectURL(new Blob),nt=et.toString();return URL.revokeObjectURL(et),nt.slice(nt.lastIndexOf("/")+1)}catch{let nt=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,it=>{const st=(nt+Math.random()*16)%16|0;return nt=Math.floor(nt/16),(it=="x"?st:st&3|8).toString(16)})}}}const toRounded=tt=>Math.round(tt),toUrlSafe=(tt,et)=>(et!=null&&et.baseUrl&&(tt=urlToRelativePath(tt,et.baseUrl)),encodeURIComponent(tt)),toHundred=tt=>toRounded(tt/100)*100,CmcdFormatters={br:toRounded,d:toRounded,bl:toHundred,dl:toHundred,mtp:toHundred,nor:toUrlSafe,rtp:toHundred,tb:toRounded};function processCmcd(tt,et){const nt={};if(tt==null||typeof tt!="object")return nt;const rt=Object.keys(tt).sort(),it=_extends({},CmcdFormatters,et==null?void 0:et.formatters),st=et==null?void 0:et.filter;return rt.forEach(ot=>{if(st!=null&&st(ot))return;let lt=tt[ot];const ut=it[ot];ut&&(lt=ut(lt,et)),!(ot==="v"&&lt===1)&&(ot=="pr"&&lt===1||isValid(lt)&&(isTokenField(ot)&&typeof lt=="string"&&(lt=new SfToken(lt)),nt[ot]=lt))}),nt}function encodeCmcd(tt,et={}){return tt?encodeSfDict(processCmcd(tt,et),_extends({whitespace:!1},et)):""}function toCmcdHeaders(tt,et={}){if(!tt)return{};const nt=Object.entries(tt),rt=Object.entries(CmcdHeaderMap).concat(Object.entries((et==null?void 0:et.customHeaderMap)||{})),it=nt.reduce((st,ot)=>{var lt,ut;const[ct,dt]=ot,ft=((lt=rt.find(pt=>pt[1].includes(ct)))==null?void 0:lt[0])||CmcdHeaderField.REQUEST;return(ut=st[ft])!=null||(st[ft]={}),st[ft][ct]=dt,st},{});return Object.entries(it).reduce((st,[ot,lt])=>(st[ot]=encodeCmcd(lt,et),st),{})}function appendCmcdHeaders(tt,et,nt){return _extends(tt,toCmcdHeaders(et,nt))}const CMCD_PARAM="CMCD";function toCmcdQuery(tt,et={}){if(!tt)return"";const nt=encodeCmcd(tt,et);return`${CMCD_PARAM}=${encodeURIComponent(nt)}`}const REGEX=/CMCD=[^&#]+/;function appendCmcdQuery(tt,et,nt){const rt=toCmcdQuery(et,nt);if(!rt)return tt;if(REGEX.test(tt))return tt.replace(REGEX,rt);const it=tt.includes("?")?"&":"?";return`${tt}${it}${rt}`}class CMCDController{constructor(et){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=it=>{try{this.apply(it,{ot:CmObjectType.MANIFEST,su:!this.initialized})}catch(st){logger.warn("Could not generate manifest CMCD data.",st)}},this.applyFragmentData=it=>{try{const st=it.frag,ot=this.hls.levels[st.level],lt=this.getObjectType(st),ut={d:st.duration*1e3,ot:lt};(lt===CmObjectType.VIDEO||lt===CmObjectType.AUDIO||lt==CmObjectType.MUXED)&&(ut.br=ot.bitrate/1e3,ut.tb=this.getTopBandwidth(lt)/1e3,ut.bl=this.getBufferLength(lt)),this.apply(it,ut)}catch(st){logger.warn("Could not generate segment CMCD data.",st)}},this.hls=et;const nt=this.config=et.config,{cmcd:rt}=nt;rt!=null&&(nt.pLoader=this.createPlaylistLoader(),nt.fLoader=this.createFragmentLoader(),this.sid=rt.sessionId||uuid(),this.cid=rt.contentId,this.useHeaders=rt.useHeaders===!0,this.includeKeys=rt.includeKeys,this.registerListeners())}registerListeners(){const et=this.hls;et.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),et.on(Events.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const et=this.hls;et.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),et.off(Events.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}onMediaAttached(et,nt){this.media=nt.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(et,nt){var rt,it;this.audioBuffer=(rt=nt.tracks.audio)==null?void 0:rt.buffer,this.videoBuffer=(it=nt.tracks.video)==null?void 0:it.buffer}createData(){var et;return{v:1,sf:CmStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(et=this.media)==null?void 0:et.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(et,nt={}){_extends(nt,this.createData());const rt=nt.ot===CmObjectType.INIT||nt.ot===CmObjectType.VIDEO||nt.ot===CmObjectType.MUXED;this.starved&&rt&&(nt.bs=!0,nt.su=!0,this.starved=!1),nt.su==null&&(nt.su=this.buffering);const{includeKeys:it}=this;it&&(nt=Object.keys(nt).reduce((st,ot)=>(it.includes(ot)&&(st[ot]=nt[ot]),st),{})),this.useHeaders?(et.headers||(et.headers={}),appendCmcdHeaders(et.headers,nt)):et.url=appendCmcdQuery(et.url,nt)}getObjectType(et){const{type:nt}=et;if(nt==="subtitle")return CmObjectType.TIMED_TEXT;if(et.sn==="initSegment")return CmObjectType.INIT;if(nt==="audio")return CmObjectType.AUDIO;if(nt==="main")return this.hls.audioTracks.length?CmObjectType.VIDEO:CmObjectType.MUXED}getTopBandwidth(et){let nt=0,rt;const it=this.hls;if(et===CmObjectType.AUDIO)rt=it.audioTracks;else{const st=it.maxAutoLevel,ot=st>-1?st+1:it.levels.length;rt=it.levels.slice(0,ot)}for(const st of rt)st.bitrate>nt&&(nt=st.bitrate);return nt>0?nt:NaN}getBufferLength(et){const nt=this.hls.media,rt=et===CmObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return!rt||!nt?NaN:BufferHelper.bufferInfo(rt,nt.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:et}=this.config,nt=this.applyPlaylistData,rt=et||this.config.loader;return class{constructor(st){this.loader=void 0,this.loader=new rt(st)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(st,ot,lt){nt(st),this.loader.load(st,ot,lt)}}}createFragmentLoader(){const{fLoader:et}=this.config,nt=this.applyFragmentData,rt=et||this.config.loader;return class{constructor(st){this.loader=void 0,this.loader=new rt(st)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(st,ot,lt){nt(st),this.loader.load(st,ot,lt)}}}}const PATHWAY_PENALTY_DURATION_MS=3e5;class ContentSteeringController{constructor(et){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=et,this.log=logger.log.bind(logger,"[content-steering]:"),this.registerListeners()}registerListeners(){const et=this.hls;et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),et.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.on(Events.ERROR,this.onError,this)}unregisterListeners(){const et=this.hls;et&&(et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),et.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.off(Events.ERROR,this.onError,this))}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const et=this.timeToLoad*1e3-(performance.now()-this.updated);if(et>0){this.scheduleRefresh(this.uri,et);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(et){const nt=this.levels;nt&&(this.levels=nt.filter(rt=>rt!==et))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(et,nt){const{contentSteering:rt}=nt;rt!==null&&(this.pathwayId=rt.pathwayId,this.uri=rt.uri,this.started&&this.startLoad())}onManifestParsed(et,nt){this.audioTracks=nt.audioTracks,this.subtitleTracks=nt.subtitleTracks}onError(et,nt){const{errorAction:rt}=nt;if((rt==null?void 0:rt.action)===NetworkErrorAction.SendAlternateToPenaltyBox&&rt.flags===ErrorActionFlags.MoveAllAlternatesMatchingHost){const it=this.levels;let st=this.pathwayPriority,ot=this.pathwayId;if(nt.context){const{groupId:lt,pathwayId:ut,type:ct}=nt.context;lt&&it?ot=this.getPathwayForGroupId(lt,ct,ot):ut&&(ot=ut)}ot in this.penalizedPathways||(this.penalizedPathways[ot]=performance.now()),!st&&it&&(st=it.reduce((lt,ut)=>(lt.indexOf(ut.pathwayId)===-1&&lt.push(ut.pathwayId),lt),[])),st&&st.length>1&&(this.updatePathwayPriority(st),rt.resolved=this.pathwayId!==ot),rt.resolved||logger.warn(`Could not resolve ${nt.details} ("${nt.error.message}") with content-steering for Pathway: ${ot} levels: ${it&&it.length} priorities: ${JSON.stringify(st)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(et){this.levels=et;let nt=this.getLevelsForPathway(this.pathwayId);if(nt.length===0){const rt=et[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${rt}"`),nt=this.getLevelsForPathway(rt),this.pathwayId=rt}return nt.length!==et.length?(this.log(`Found ${nt.length}/${et.length} levels in Pathway "${this.pathwayId}"`),nt):et}getLevelsForPathway(et){return this.levels===null?[]:this.levels.filter(nt=>et===nt.pathwayId)}updatePathwayPriority(et){this.pathwayPriority=et;let nt;const rt=this.penalizedPathways,it=performance.now();Object.keys(rt).forEach(st=>{it-rt[st]>PATHWAY_PENALTY_DURATION_MS&&delete rt[st]});for(let st=0;st<et.length;st++){const ot=et[st];if(ot in rt)continue;if(ot===this.pathwayId)return;const lt=this.hls.nextLoadLevel,ut=this.hls.levels[lt];if(nt=this.getLevelsForPathway(ot),nt.length>0){this.log(`Setting Pathway to "${ot}"`),this.pathwayId=ot,reassignFragmentLevelIndexes(nt),this.hls.trigger(Events.LEVELS_UPDATED,{levels:nt});const ct=this.hls.levels[lt];ut&&ct&&this.levels&&(ct.attrs["STABLE-VARIANT-ID"]!==ut.attrs["STABLE-VARIANT-ID"]&&ct.bitrate!==ut.bitrate&&this.log(`Unstable Pathways change from bitrate ${ut.bitrate} to ${ct.bitrate}`),this.hls.nextLoadLevel=lt);break}}}getPathwayForGroupId(et,nt,rt){const it=this.getLevelsForPathway(rt).concat(this.levels||[]);for(let st=0;st<it.length;st++)if(nt===PlaylistContextType.AUDIO_TRACK&&it[st].hasAudioGroup(et)||nt===PlaylistContextType.SUBTITLE_TRACK&&it[st].hasSubtitleGroup(et))return it[st].pathwayId;return rt}clonePathways(et){const nt=this.levels;if(!nt)return;const rt={},it={};et.forEach(st=>{const{ID:ot,"BASE-ID":lt,"URI-REPLACEMENT":ut}=st;if(nt.some(dt=>dt.pathwayId===ot))return;const ct=this.getLevelsForPathway(lt).map(dt=>{const ft=new AttrList(dt.attrs);ft["PATHWAY-ID"]=ot;const pt=ft.AUDIO&&`${ft.AUDIO}_clone_${ot}`,gt=ft.SUBTITLES&&`${ft.SUBTITLES}_clone_${ot}`;pt&&(rt[ft.AUDIO]=pt,ft.AUDIO=pt),gt&&(it[ft.SUBTITLES]=gt,ft.SUBTITLES=gt);const _r=performUriReplacement(dt.uri,ft["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",ut),Yr=new Level({attrs:ft,audioCodec:dt.audioCodec,bitrate:dt.bitrate,height:dt.height,name:dt.name,url:_r,videoCodec:dt.videoCodec,width:dt.width});if(dt.audioGroups)for(let mt=1;mt<dt.audioGroups.length;mt++)Yr.addGroupId("audio",`${dt.audioGroups[mt]}_clone_${ot}`);if(dt.subtitleGroups)for(let mt=1;mt<dt.subtitleGroups.length;mt++)Yr.addGroupId("text",`${dt.subtitleGroups[mt]}_clone_${ot}`);return Yr});nt.push(...ct),cloneRenditionGroups(this.audioTracks,rt,ut,ot),cloneRenditionGroups(this.subtitleTracks,it,ut,ot)})}loadSteeringManifest(et){const nt=this.hls.config,rt=nt.loader;this.loader&&this.loader.destroy(),this.loader=new rt(nt);let it;try{it=new self.URL(et)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${et}`);return}if(it.protocol!=="data:"){const dt=(this.hls.bandwidthEstimate||nt.abrEwmaDefaultEstimate)|0;it.searchParams.set("_HLS_pathway",this.pathwayId),it.searchParams.set("_HLS_throughput",""+dt)}const st={responseType:"json",url:it.href},ot=nt.steeringManifestLoadPolicy.default,lt=ot.errorRetry||ot.timeoutRetry||{},ut={loadPolicy:ot,timeout:ot.maxLoadTimeMs,maxRetry:lt.maxNumRetry||0,retryDelay:lt.retryDelayMs||0,maxRetryDelay:lt.maxRetryDelayMs||0},ct={onSuccess:(dt,ft,pt,gt)=>{this.log(`Loaded steering manifest: "${it}"`);const _r=dt.data;if(_r.VERSION!==1){this.log(`Steering VERSION ${_r.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=_r.TTL;const{"RELOAD-URI":Yr,"PATHWAY-CLONES":mt,"PATHWAY-PRIORITY":Kr}=_r;if(Yr)try{this.uri=new self.URL(Yr,it).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${Yr}`);return}this.scheduleRefresh(this.uri||pt.url),mt&&this.clonePathways(mt);const Xr={steeringManifest:_r,url:it.toString()};this.hls.trigger(Events.STEERING_MANIFEST_LOADED,Xr),Kr&&this.updatePathwayPriority(Kr)},onError:(dt,ft,pt,gt)=>{if(this.log(`Error loading steering manifest: ${dt.code} ${dt.text} (${ft.url})`),this.stopLoad(),dt.code===410){this.enabled=!1,this.log(`Steering manifest ${ft.url} no longer available`);return}let _r=this.timeToLoad*1e3;if(dt.code===429){const Yr=this.loader;if(typeof(Yr==null?void 0:Yr.getResponseHeader)=="function"){const mt=Yr.getResponseHeader("Retry-After");mt&&(_r=parseFloat(mt)*1e3)}this.log(`Steering manifest ${ft.url} rate limited`);return}this.scheduleRefresh(this.uri||ft.url,_r)},onTimeout:(dt,ft,pt)=>{this.log(`Timeout loading steering manifest (${ft.url})`),this.scheduleRefresh(this.uri||ft.url)}};this.log(`Requesting steering manifest: ${it}`),this.loader.load(st,ut,ct)}scheduleRefresh(et,nt=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var rt;const it=(rt=this.hls)==null?void 0:rt.media;if(it&&!it.ended){this.loadSteeringManifest(et);return}this.scheduleRefresh(et,this.timeToLoad*1e3)},nt)}}function cloneRenditionGroups(tt,et,nt,rt){tt&&Object.keys(et).forEach(it=>{const st=tt.filter(ot=>ot.groupId===it).map(ot=>{const lt=_extends({},ot);return lt.details=void 0,lt.attrs=new AttrList(lt.attrs),lt.url=lt.attrs.URI=performUriReplacement(ot.url,ot.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",nt),lt.groupId=lt.attrs["GROUP-ID"]=et[it],lt.attrs["PATHWAY-ID"]=rt,lt});tt.push(...st)})}function performUriReplacement(tt,et,nt,rt){const{HOST:it,PARAMS:st,[nt]:ot}=rt;let lt;et&&(lt=ot==null?void 0:ot[et],lt&&(tt=lt));const ut=new self.URL(tt);return it&&!lt&&(ut.host=it),st&&Object.keys(st).sort().forEach(ct=>{ct&&ut.searchParams.set(ct,st[ct])}),ut.href}const AGE_HEADER_LINE_REGEX=/^age:\s*[\d.]+\s*$/im;class XhrLoader{constructor(et){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=et&&et.xhrSetup||null,this.stats=new LoadStats,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null,this.stats=null}abortInternal(){const et=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),et&&(et.onreadystatechange=null,et.onprogress=null,et.readyState!==4&&(this.stats.aborted=!0,et.abort()))}abort(){var et;this.abortInternal(),(et=this.callbacks)!=null&&et.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(et,nt,rt){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=et,this.config=nt,this.callbacks=rt,this.loadInternal()}loadInternal(){const{config:et,context:nt}=this;if(!et||!nt)return;const rt=this.loader=new self.XMLHttpRequest,it=this.stats;it.loading.first=0,it.loaded=0,it.aborted=!1;const st=this.xhrSetup;st?Promise.resolve().then(()=>{if(!this.stats.aborted)return st(rt,nt.url)}).catch(ot=>(rt.open("GET",nt.url,!0),st(rt,nt.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(rt,nt,et)}).catch(ot=>{this.callbacks.onError({code:rt.status,text:ot.message},nt,rt,it)}):this.openAndSendXhr(rt,nt,et)}openAndSendXhr(et,nt,rt){et.readyState||et.open("GET",nt.url,!0);const it=nt.headers,{maxTimeToFirstByteMs:st,maxLoadTimeMs:ot}=rt.loadPolicy;if(it)for(const lt in it)et.setRequestHeader(lt,it[lt]);nt.rangeEnd&&et.setRequestHeader("Range","bytes="+nt.rangeStart+"-"+(nt.rangeEnd-1)),et.onreadystatechange=this.readystatechange.bind(this),et.onprogress=this.loadprogress.bind(this),et.responseType=nt.responseType,self.clearTimeout(this.requestTimeout),rt.timeout=st&&isFiniteNumber(st)?st:ot,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),rt.timeout),et.send()}readystatechange(){const{context:et,loader:nt,stats:rt}=this;if(!et||!nt)return;const it=nt.readyState,st=this.config;if(!rt.aborted&&it>=2&&(rt.loading.first===0&&(rt.loading.first=Math.max(self.performance.now(),rt.loading.start),st.timeout!==st.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),st.timeout=st.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),st.loadPolicy.maxLoadTimeMs-(rt.loading.first-rt.loading.start)))),it===4)){self.clearTimeout(this.requestTimeout),nt.onreadystatechange=null,nt.onprogress=null;const ot=nt.status,lt=nt.responseType!=="text";if(ot>=200&&ot<300&&(lt&&nt.response||nt.responseText!==null)){rt.loading.end=Math.max(self.performance.now(),rt.loading.first);const ut=lt?nt.response:nt.responseText,ct=nt.responseType==="arraybuffer"?ut.byteLength:ut.length;if(rt.loaded=rt.total=ct,rt.bwEstimate=rt.total*8e3/(rt.loading.end-rt.loading.first),!this.callbacks)return;const dt=this.callbacks.onProgress;if(dt&&dt(rt,et,ut,nt),!this.callbacks)return;const ft={url:nt.responseURL,data:ut,code:ot};this.callbacks.onSuccess(ft,rt,et,nt)}else{const ut=st.loadPolicy.errorRetry,ct=rt.retry,dt={url:et.url,data:void 0,code:ot};shouldRetry(ut,ct,!1,dt)?this.retry(ut):(logger.error(`${ot} while loading ${et.url}`),this.callbacks.onError({code:ot,text:nt.statusText},et,nt,rt))}}}loadtimeout(){var et;const nt=(et=this.config)==null?void 0:et.loadPolicy.timeoutRetry,rt=this.stats.retry;if(shouldRetry(nt,rt,!0))this.retry(nt);else{var it;logger.warn(`timeout while loading ${(it=this.context)==null?void 0:it.url}`);const st=this.callbacks;st&&(this.abortInternal(),st.onTimeout(this.stats,this.context,this.loader))}}retry(et){const{context:nt,stats:rt}=this;this.retryDelay=getRetryDelay(et,rt.retry),rt.retry++,logger.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${nt==null?void 0:nt.url}, retrying ${rt.retry}/${et.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(et){const nt=this.stats;nt.loaded=et.loaded,et.lengthComputable&&(nt.total=et.total)}getCacheAge(){let et=null;if(this.loader&&AGE_HEADER_LINE_REGEX.test(this.loader.getAllResponseHeaders())){const nt=this.loader.getResponseHeader("age");et=nt?parseFloat(nt):null}return et}getResponseHeader(et){return this.loader&&new RegExp(`^${et}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(et):null}}function fetchSupported(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const BYTERANGE=/(\d+)-(\d+)\/(\d+)/;class FetchLoader{constructor(et){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=et.fetchSetup||getRequest,this.controller=new self.AbortController,this.stats=new LoadStats}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var et;this.abortInternal(),(et=this.callbacks)!=null&&et.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(et,nt,rt){const it=this.stats;if(it.loading.start)throw new Error("Loader can only be used once.");it.loading.start=self.performance.now();const st=getRequestParameters(et,this.controller.signal),ot=rt.onProgress,lt=et.responseType==="arraybuffer",ut=lt?"byteLength":"length",{maxTimeToFirstByteMs:ct,maxLoadTimeMs:dt}=nt.loadPolicy;this.context=et,this.config=nt,this.callbacks=rt,this.request=this.fetchSetup(et,st),self.clearTimeout(this.requestTimeout),nt.timeout=ct&&isFiniteNumber(ct)?ct:dt,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),rt.onTimeout(it,et,this.response)},nt.timeout),self.fetch(this.request).then(ft=>{this.response=this.loader=ft;const pt=Math.max(self.performance.now(),it.loading.start);if(self.clearTimeout(this.requestTimeout),nt.timeout=dt,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),rt.onTimeout(it,et,this.response)},dt-(pt-it.loading.start)),!ft.ok){const{status:gt,statusText:_r}=ft;throw new FetchError(_r||"fetch, bad network response",gt,ft)}return it.loading.first=pt,it.total=getContentLength(ft.headers)||it.total,ot&&isFiniteNumber(nt.highWaterMark)?this.loadProgressively(ft,it,et,nt.highWaterMark,ot):lt?ft.arrayBuffer():et.responseType==="json"?ft.json():ft.text()}).then(ft=>{const pt=this.response;if(!pt)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),it.loading.end=Math.max(self.performance.now(),it.loading.first);const gt=ft[ut];gt&&(it.loaded=it.total=gt);const _r={url:pt.url,data:ft,code:pt.status};ot&&!isFiniteNumber(nt.highWaterMark)&&ot(it,et,ft,pt),rt.onSuccess(_r,it,et,pt)}).catch(ft=>{if(self.clearTimeout(this.requestTimeout),it.aborted)return;const pt=ft&&ft.code||0,gt=ft?ft.message:null;rt.onError({code:pt,text:gt},et,ft?ft.details:null,it)})}getCacheAge(){let et=null;if(this.response){const nt=this.response.headers.get("age");et=nt?parseFloat(nt):null}return et}getResponseHeader(et){return this.response?this.response.headers.get(et):null}loadProgressively(et,nt,rt,it=0,st){const ot=new ChunkCache,lt=et.body.getReader(),ut=()=>lt.read().then(ct=>{if(ct.done)return ot.dataLength&&st(nt,rt,ot.flush(),et),Promise.resolve(new ArrayBuffer(0));const dt=ct.value,ft=dt.length;return nt.loaded+=ft,ft<it||ot.dataLength?(ot.push(dt),ot.dataLength>=it&&st(nt,rt,ot.flush(),et)):st(nt,rt,dt,et),ut()}).catch(()=>Promise.reject());return ut()}}function getRequestParameters(tt,et){const nt={method:"GET",mode:"cors",credentials:"same-origin",signal:et,headers:new self.Headers(_extends({},tt.headers))};return tt.rangeEnd&&nt.headers.set("Range","bytes="+tt.rangeStart+"-"+String(tt.rangeEnd-1)),nt}function getByteRangeLength(tt){const et=BYTERANGE.exec(tt);if(et)return parseInt(et[2])-parseInt(et[1])+1}function getContentLength(tt){const et=tt.get("Content-Range");if(et){const rt=getByteRangeLength(et);if(isFiniteNumber(rt))return rt}const nt=tt.get("Content-Length");if(nt)return parseInt(nt)}function getRequest(tt,et){return new self.Request(tt.url,et)}class FetchError extends Error{constructor(et,nt,rt){super(et),this.code=void 0,this.details=void 0,this.code=nt,this.details=rt}}const WHITESPACE_CHAR=/\s/,Cues={newCue(tt,et,nt,rt){const it=[];let st,ot,lt,ut,ct;const dt=self.VTTCue||self.TextTrackCue;for(let pt=0;pt<rt.rows.length;pt++)if(st=rt.rows[pt],lt=!0,ut=0,ct="",!st.isEmpty()){var ft;for(let Yr=0;Yr<st.chars.length;Yr++)WHITESPACE_CHAR.test(st.chars[Yr].uchar)&&lt?ut++:(ct+=st.chars[Yr].uchar,lt=!1);st.cueStartTime=et,et===nt&&(nt+=1e-4),ut>=16?ut--:ut++;const gt=fixLineBreaks(ct.trim()),_r=generateCueId(et,nt,gt);tt!=null&&(ft=tt.cues)!=null&&ft.getCueById(_r)||(ot=new dt(et,nt,gt),ot.id=_r,ot.line=pt+1,ot.align="left",ot.position=10+Math.min(80,Math.floor(ut*8/32)*10),it.push(ot))}return tt&&it.length&&(it.sort((pt,gt)=>pt.line==="auto"||gt.line==="auto"?0:pt.line>8&&gt.line>8?gt.line-pt.line:pt.line-gt.line),it.forEach(pt=>addCueToTrack(tt,pt))),it}},defaultLoadPolicy={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},hlsDefaultConfig=_objectSpread2(_objectSpread2({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:XhrLoader,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:AbrController,bufferController:BufferController,capLevelController:CapLevelController,errorController:ErrorController,fpsController:FPSController,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:defaultLoadPolicy},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},timelineConfig()),{},{subtitleStreamController:SubtitleStreamController,subtitleTrackController:SubtitleTrackController,timelineController:TimelineController,audioStreamController:AudioStreamController,audioTrackController:AudioTrackController,emeController:EMEController,cmcdController:CMCDController,contentSteeringController:ContentSteeringController});function timelineConfig(){return{cueHandler:Cues,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function mergeConfig(tt,et){if((et.liveSyncDurationCount||et.liveMaxLatencyDurationCount)&&(et.liveSyncDuration||et.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(et.liveMaxLatencyDurationCount!==void 0&&(et.liveSyncDurationCount===void 0||et.liveMaxLatencyDurationCount<=et.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(et.liveMaxLatencyDuration!==void 0&&(et.liveSyncDuration===void 0||et.liveMaxLatencyDuration<=et.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const nt=deepCpy(tt),rt=["manifest","level","frag"],it=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return rt.forEach(st=>{const ot=`${st==="level"?"playlist":st}LoadPolicy`,lt=et[ot]===void 0,ut=[];it.forEach(ct=>{const dt=`${st}Loading${ct}`,ft=et[dt];if(ft!==void 0&&lt){ut.push(dt);const pt=nt[ot].default;switch(et[ot]={default:pt},ct){case"TimeOut":pt.maxLoadTimeMs=ft,pt.maxTimeToFirstByteMs=ft;break;case"MaxRetry":pt.errorRetry.maxNumRetry=ft,pt.timeoutRetry.maxNumRetry=ft;break;case"RetryDelay":pt.errorRetry.retryDelayMs=ft,pt.timeoutRetry.retryDelayMs=ft;break;case"MaxRetryTimeout":pt.errorRetry.maxRetryDelayMs=ft,pt.timeoutRetry.maxRetryDelayMs=ft;break}}}),ut.length&&logger.warn(`hls.js config: "${ut.join('", "')}" setting(s) are deprecated, use "${ot}": ${JSON.stringify(et[ot])}`)}),_objectSpread2(_objectSpread2({},nt),et)}function deepCpy(tt){return tt&&typeof tt=="object"?Array.isArray(tt)?tt.map(deepCpy):Object.keys(tt).reduce((et,nt)=>(et[nt]=deepCpy(tt[nt]),et),{}):tt}function enableStreamingMode(tt){const et=tt.loader;et!==FetchLoader&&et!==XhrLoader?(logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),tt.progressive=!1):fetchSupported()&&(tt.loader=FetchLoader,tt.progressive=!0,tt.enableSoftwareAES=!0,logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}let chromeOrFirefox;class LevelController extends BasePlaylistController{constructor(et,nt){super(et,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=nt,this._registerListeners()}_registerListeners(){const{hls:et}=this;et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),et.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),et.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),et.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),et.on(Events.ERROR,this.onError,this)}_unregisterListeners(){const{hls:et}=this;et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),et.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),et.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),et.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),et.off(Events.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(nt=>{nt.loadError=0,nt.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(et,nt){this.resetLevels()}onManifestLoaded(et,nt){const rt=this.hls.config.preferManagedMediaSource,it=[],st={},ot={};let lt=!1,ut=!1,ct=!1;nt.levels.forEach(dt=>{var ft,pt;const gt=dt.attrs;let{audioCodec:_r,videoCodec:Yr}=dt;((ft=_r)==null?void 0:ft.indexOf("mp4a.40.34"))!==-1&&(chromeOrFirefox||(chromeOrFirefox=/chrome|firefox/i.test(navigator.userAgent)),chromeOrFirefox&&(dt.audioCodec=_r=void 0)),_r&&(dt.audioCodec=_r=getCodecCompatibleName(_r,rt)),((pt=Yr)==null?void 0:pt.indexOf("avc1"))===0&&(Yr=dt.videoCodec=convertAVC1ToAVCOTI(Yr));const{width:mt,height:Kr,unknownCodecs:Xr}=dt;if(lt||(lt=!!(mt&&Kr)),ut||(ut=!!Yr),ct||(ct=!!_r),Xr!=null&&Xr.length||_r&&!areCodecsMediaSourceSupported(_r,"audio",rt)||Yr&&!areCodecsMediaSourceSupported(Yr,"video",rt))return;const{CODECS:Zr,"FRAME-RATE":Qr,"HDCP-LEVEL":_i,"PATHWAY-ID":rs,RESOLUTION:ns,"VIDEO-RANGE":ss}=gt,os=`${`${rs||"."}-`}${dt.bitrate}-${ns}-${Qr}-${Zr}-${ss}-${_i}`;if(st[os])if(st[os].uri!==dt.url&&!dt.attrs["PATHWAY-ID"]){const is=ot[os]+=1;dt.attrs["PATHWAY-ID"]=new Array(is+1).join(".");const cs=new Level(dt);st[os]=cs,it.push(cs)}else st[os].addGroupId("audio",gt.AUDIO),st[os].addGroupId("text",gt.SUBTITLES);else{const is=new Level(dt);st[os]=is,ot[os]=1,it.push(is)}}),this.filterAndSortMediaOptions(it,nt,lt,ut,ct)}filterAndSortMediaOptions(et,nt,rt,it,st){let ot=[],lt=[],ut=et;if((rt||it)&&st&&(ut=ut.filter(({videoCodec:_r,videoRange:Yr,width:mt,height:Kr})=>(!!_r||!!(mt&&Kr))&&isVideoRange(Yr))),ut.length===0){Promise.resolve().then(()=>{if(this.hls){nt.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(nt.levels[0].attrs)}`);const _r=new Error("no level with compatible codecs found in manifest");this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:nt.url,error:_r,reason:_r.message})}});return}if(nt.audioTracks){const{preferManagedMediaSource:_r}=this.hls.config;ot=nt.audioTracks.filter(Yr=>!Yr.audioCodec||areCodecsMediaSourceSupported(Yr.audioCodec,"audio",_r)),assignTrackIdsByGroup(ot)}nt.subtitles&&(lt=nt.subtitles,assignTrackIdsByGroup(lt));const ct=ut.slice(0);ut.sort((_r,Yr)=>{if(_r.attrs["HDCP-LEVEL"]!==Yr.attrs["HDCP-LEVEL"])return(_r.attrs["HDCP-LEVEL"]||"")>(Yr.attrs["HDCP-LEVEL"]||"")?1:-1;if(rt&&_r.height!==Yr.height)return _r.height-Yr.height;if(_r.frameRate!==Yr.frameRate)return _r.frameRate-Yr.frameRate;if(_r.videoRange!==Yr.videoRange)return VideoRangeValues.indexOf(_r.videoRange)-VideoRangeValues.indexOf(Yr.videoRange);if(_r.videoCodec!==Yr.videoCodec){const mt=videoCodecPreferenceValue(_r.videoCodec),Kr=videoCodecPreferenceValue(Yr.videoCodec);if(mt!==Kr)return Kr-mt}if(_r.uri===Yr.uri&&_r.codecSet!==Yr.codecSet){const mt=codecsSetSelectionPreferenceValue(_r.codecSet),Kr=codecsSetSelectionPreferenceValue(Yr.codecSet);if(mt!==Kr)return Kr-mt}return _r.averageBitrate!==Yr.averageBitrate?_r.averageBitrate-Yr.averageBitrate:0});let dt=ct[0];if(this.steering&&(ut=this.steering.filterParsedLevels(ut),ut.length!==ct.length)){for(let _r=0;_r<ct.length;_r++)if(ct[_r].pathwayId===ut[0].pathwayId){dt=ct[_r];break}}this._levels=ut;for(let _r=0;_r<ut.length;_r++)if(ut[_r]===dt){var ft;this._firstLevel=_r;const Yr=dt.bitrate,mt=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${ut.length} level(s) found, first bitrate: ${Yr}`),((ft=this.hls.userConfig)==null?void 0:ft.abrEwmaDefaultEstimate)===void 0){const Kr=Math.min(Yr,this.hls.config.abrEwmaDefaultEstimateMax);Kr>mt&&mt===hlsDefaultConfig.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=Kr)}break}const pt=st&&!it,gt={levels:ut,audioTracks:ot,subtitleTracks:lt,sessionData:nt.sessionData,sessionKeys:nt.sessionKeys,firstLevel:this._firstLevel,stats:nt.stats,audio:st,video:it,altAudio:!pt&&ot.some(_r=>!!_r.url)};this.hls.trigger(Events.MANIFEST_PARSED,gt),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(et){const nt=this._levels;if(nt.length===0)return;if(et<0||et>=nt.length){const dt=new Error("invalid level idx"),ft=et<0;if(this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.LEVEL_SWITCH_ERROR,level:et,fatal:ft,error:dt,reason:dt.message}),ft)return;et=Math.min(et,nt.length-1)}const rt=this.currentLevelIndex,it=this.currentLevel,st=it?it.attrs["PATHWAY-ID"]:void 0,ot=nt[et],lt=ot.attrs["PATHWAY-ID"];if(this.currentLevelIndex=et,this.currentLevel=ot,rt===et&&ot.details&&it&&st===lt)return;this.log(`Switching to level ${et} (${ot.height?ot.height+"p ":""}${ot.videoRange?ot.videoRange+" ":""}${ot.codecSet?ot.codecSet+" ":""}@${ot.bitrate})${lt?" with Pathway "+lt:""} from level ${rt}${st?" with Pathway "+st:""}`);const ut={level:et,attrs:ot.attrs,details:ot.details,bitrate:ot.bitrate,averageBitrate:ot.averageBitrate,maxBitrate:ot.maxBitrate,realBitrate:ot.realBitrate,width:ot.width,height:ot.height,codecSet:ot.codecSet,audioCodec:ot.audioCodec,videoCodec:ot.videoCodec,audioGroups:ot.audioGroups,subtitleGroups:ot.subtitleGroups,loaded:ot.loaded,loadError:ot.loadError,fragmentError:ot.fragmentError,name:ot.name,id:ot.id,uri:ot.uri,url:ot.url,urlId:0,audioGroupIds:ot.audioGroupIds,textGroupIds:ot.textGroupIds};this.hls.trigger(Events.LEVEL_SWITCHING,ut);const ct=ot.details;if(!ct||ct.live){const dt=this.switchParams(ot.uri,it==null?void 0:it.details);this.loadPlaylist(dt)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(et){this.manualLevelIndex=et,this._startLevel===void 0&&(this._startLevel=et),et!==-1&&(this.level=et)}get firstLevel(){return this._firstLevel}set firstLevel(et){this._firstLevel=et}get startLevel(){if(this._startLevel===void 0){const et=this.hls.config.startLevel;return et!==void 0?et:this.hls.firstAutoLevel}return this._startLevel}set startLevel(et){this._startLevel=et}onError(et,nt){nt.fatal||!nt.context||nt.context.type===PlaylistContextType.LEVEL&&nt.context.level===this.level&&this.checkRetry(nt)}onFragBuffered(et,{frag:nt}){if(nt!==void 0&&nt.type===PlaylistLevelType.MAIN){const rt=nt.elementaryStreams;if(!Object.keys(rt).some(st=>!!rt[st]))return;const it=this._levels[nt.level];it!=null&&it.loadError&&(this.log(`Resetting level error count of ${it.loadError} on frag buffered`),it.loadError=0)}}onLevelLoaded(et,nt){var rt;const{level:it,details:st}=nt,ot=this._levels[it];if(!ot){var lt;this.warn(`Invalid level index ${it}`),(lt=nt.deliveryDirectives)!=null&&lt.skip&&(st.deltaUpdateFailed=!0);return}it===this.currentLevelIndex?(ot.fragmentError===0&&(ot.loadError=0),this.playlistLoaded(it,nt,ot.details)):(rt=nt.deliveryDirectives)!=null&&rt.skip&&(st.deltaUpdateFailed=!0)}loadPlaylist(et){super.loadPlaylist();const nt=this.currentLevelIndex,rt=this.currentLevel;if(rt&&this.shouldLoadPlaylist(rt)){let it=rt.uri;if(et)try{it=et.addDirectives(it)}catch(ot){this.warn(`Could not construct new URL with HLS Delivery Directives: ${ot}`)}const st=rt.attrs["PATHWAY-ID"];this.log(`Loading level index ${nt}${(et==null?void 0:et.msn)!==void 0?" at sn "+et.msn+" part "+et.part:""} with${st?" Pathway "+st:""} ${it}`),this.clearTimer(),this.hls.trigger(Events.LEVEL_LOADING,{url:it,level:nt,pathwayId:rt.attrs["PATHWAY-ID"],id:0,deliveryDirectives:et||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(et){this.level=et,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=et)}removeLevel(et){var nt;const rt=this._levels.filter((it,st)=>st!==et?!0:(this.steering&&this.steering.removeLevel(it),it===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,it.details&&it.details.fragments.forEach(ot=>ot.level=-1)),!1));reassignFragmentLevelIndexes(rt),this._levels=rt,this.currentLevelIndex>-1&&(nt=this.currentLevel)!=null&&nt.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(Events.LEVELS_UPDATED,{levels:rt})}onLevelsUpdated(et,{levels:nt}){this._levels=nt}checkMaxAutoUpdated(){const{autoLevelCapping:et,maxAutoLevel:nt,maxHdcpLevel:rt}=this.hls;this._maxAutoLevel!==nt&&(this._maxAutoLevel=nt,this.hls.trigger(Events.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:et,levels:this.levels,maxAutoLevel:nt,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:rt}))}}function assignTrackIdsByGroup(tt){const et={};tt.forEach(nt=>{const rt=nt.groupId||"";nt.id=et[rt]=et[rt]||0,et[rt]++})}class KeyLoader{constructor(et){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=et}abort(et){for(const rt in this.keyUriToKeyInfo){const it=this.keyUriToKeyInfo[rt].loader;if(it){var nt;if(et&&et!==((nt=it.context)==null?void 0:nt.frag.type))return;it.abort()}}}detach(){for(const et in this.keyUriToKeyInfo){const nt=this.keyUriToKeyInfo[et];(nt.mediaKeySessionContext||nt.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[et]}}destroy(){this.detach();for(const et in this.keyUriToKeyInfo){const nt=this.keyUriToKeyInfo[et].loader;nt&&nt.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(et,nt=ErrorDetails.KEY_LOAD_ERROR,rt,it,st){return new LoadError({type:ErrorTypes.NETWORK_ERROR,details:nt,fatal:!1,frag:et,response:st,error:rt,networkDetails:it})}loadClear(et,nt){if(this.emeController&&this.config.emeEnabled){const{sn:rt,cc:it}=et;for(let st=0;st<nt.length;st++){const ot=nt[st];if(it<=ot.cc&&(rt==="initSegment"||ot.sn==="initSegment"||rt<ot.sn)){this.emeController.selectKeySystemFormat(ot).then(lt=>{ot.setKeyFormat(lt)});break}}}}load(et){return!et.decryptdata&&et.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(et).then(nt=>this.loadInternal(et,nt)):this.loadInternal(et)}loadInternal(et,nt){var rt,it;nt&&et.setKeyFormat(nt);const st=et.decryptdata;if(!st){const ct=new Error(nt?`Expected frag.decryptdata to be defined after setting format ${nt}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(et,ErrorDetails.KEY_LOAD_ERROR,ct))}const ot=st.uri;if(!ot)return Promise.reject(this.createKeyLoadError(et,ErrorDetails.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${ot}"`)));let lt=this.keyUriToKeyInfo[ot];if((rt=lt)!=null&&rt.decryptdata.key)return st.key=lt.decryptdata.key,Promise.resolve({frag:et,keyInfo:lt});if((it=lt)!=null&&it.keyLoadPromise){var ut;switch((ut=lt.mediaKeySessionContext)==null?void 0:ut.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return lt.keyLoadPromise.then(ct=>(st.key=ct.keyInfo.decryptdata.key,{frag:et,keyInfo:lt}))}}switch(lt=this.keyUriToKeyInfo[ot]={decryptdata:st,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},st.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return st.keyFormat==="identity"?this.loadKeyHTTP(lt,et):this.loadKeyEME(lt,et);case"AES-128":return this.loadKeyHTTP(lt,et);default:return Promise.reject(this.createKeyLoadError(et,ErrorDetails.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${st.method}"`)))}}loadKeyEME(et,nt){const rt={frag:nt,keyInfo:et};if(this.emeController&&this.config.emeEnabled){const it=this.emeController.loadKey(rt);if(it)return(et.keyLoadPromise=it.then(st=>(et.mediaKeySessionContext=st,rt))).catch(st=>{throw et.keyLoadPromise=null,st})}return Promise.resolve(rt)}loadKeyHTTP(et,nt){const rt=this.config,it=rt.loader,st=new it(rt);return nt.keyLoader=et.loader=st,et.keyLoadPromise=new Promise((ot,lt)=>{const ut={keyInfo:et,frag:nt,responseType:"arraybuffer",url:et.decryptdata.uri},ct=rt.keyLoadPolicy.default,dt={loadPolicy:ct,timeout:ct.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},ft={onSuccess:(pt,gt,_r,Yr)=>{const{frag:mt,keyInfo:Kr,url:Xr}=_r;if(!mt.decryptdata||Kr!==this.keyUriToKeyInfo[Xr])return lt(this.createKeyLoadError(mt,ErrorDetails.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),Yr));Kr.decryptdata.key=mt.decryptdata.key=new Uint8Array(pt.data),mt.keyLoader=null,Kr.loader=null,ot({frag:mt,keyInfo:Kr})},onError:(pt,gt,_r,Yr)=>{this.resetLoader(gt),lt(this.createKeyLoadError(nt,ErrorDetails.KEY_LOAD_ERROR,new Error(`HTTP Error ${pt.code} loading key ${pt.text}`),_r,_objectSpread2({url:ut.url,data:void 0},pt)))},onTimeout:(pt,gt,_r)=>{this.resetLoader(gt),lt(this.createKeyLoadError(nt,ErrorDetails.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),_r))},onAbort:(pt,gt,_r)=>{this.resetLoader(gt),lt(this.createKeyLoadError(nt,ErrorDetails.INTERNAL_ABORTED,new Error("key loading aborted"),_r))}};st.load(ut,dt,ft)})}resetLoader(et){const{frag:nt,keyInfo:rt,url:it}=et,st=rt.loader;nt.keyLoader===st&&(nt.keyLoader=null,rt.loader=null),delete this.keyUriToKeyInfo[it],st&&st.destroy()}}function getSourceBuffer(){return self.SourceBuffer||self.WebKitSourceBuffer}function isMSESupported(){if(!getMediaSource())return!1;const et=getSourceBuffer();return!et||et.prototype&&typeof et.prototype.appendBuffer=="function"&&typeof et.prototype.remove=="function"}function isSupported(){if(!isMSESupported())return!1;const tt=getMediaSource();return typeof(tt==null?void 0:tt.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(et=>tt.isTypeSupported(mimeTypeForCodec(et,"video")))||["mp4a.40.2","fLaC"].some(et=>tt.isTypeSupported(mimeTypeForCodec(et,"audio"))))}function changeTypeSupported(){var tt;const et=getSourceBuffer();return typeof(et==null||(tt=et.prototype)==null?void 0:tt.changeType)=="function"}const STALL_MINIMUM_DURATION_MS=250,MAX_START_GAP_JUMP=2,SKIP_BUFFER_HOLE_STEP_SECONDS=.1,SKIP_BUFFER_RANGE_START=.05;class GapController{constructor(et,nt,rt,it){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=et,this.media=nt,this.fragmentTracker=rt,this.hls=it}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(et,nt){const{config:rt,media:it,stalled:st}=this;if(it===null)return;const{currentTime:ot,seeking:lt}=it,ut=this.seeking&&!lt,ct=!this.seeking&&lt;if(this.seeking=lt,ot!==et){if(this.moved=!0,lt||(this.nudgeRetry=0),st!==null){if(this.stallReported){const mt=self.performance.now()-st;logger.warn(`playback not stuck anymore @${ot}, after ${Math.round(mt)}ms`),this.stallReported=!1}this.stalled=null}return}if(ct||ut){this.stalled=null;return}if(it.paused&&!lt||it.ended||it.playbackRate===0||!BufferHelper.getBuffered(it).length){this.nudgeRetry=0;return}const dt=BufferHelper.bufferInfo(it,ot,0),ft=dt.nextStart||0;if(lt){const mt=dt.len>MAX_START_GAP_JUMP,Kr=!ft||nt&&nt.start<=ot||ft-ot>MAX_START_GAP_JUMP&&!this.fragmentTracker.getPartialFragment(ot);if(mt||Kr)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var pt;if(!(dt.len>0)&&!ft)return;const Kr=Math.max(ft,dt.start||0)-ot,Xr=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,Qr=(Xr==null||(pt=Xr.details)==null?void 0:pt.live)?Xr.details.targetduration*2:MAX_START_GAP_JUMP,_i=this.fragmentTracker.getPartialFragment(ot);if(Kr>0&&(Kr<=Qr||_i)){it.paused||this._trySkipBufferHole(_i);return}}const gt=self.performance.now();if(st===null){this.stalled=gt;return}const _r=gt-st;if(!lt&&_r>=STALL_MINIMUM_DURATION_MS&&(this._reportStall(dt),!this.media))return;const Yr=BufferHelper.bufferInfo(it,ot,rt.maxBufferHole);this._tryFixBufferStall(Yr,_r)}_tryFixBufferStall(et,nt){const{config:rt,fragmentTracker:it,media:st}=this;if(st===null)return;const ot=st.currentTime,lt=it.getPartialFragment(ot);lt&&(this._trySkipBufferHole(lt)||!this.media)||(et.len>rt.maxBufferHole||et.nextStart&&et.nextStart-ot<rt.maxBufferHole)&&nt>rt.highBufferWatchdogPeriod*1e3&&(logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(et){const{hls:nt,media:rt,stallReported:it}=this;if(!it&&rt){this.stallReported=!0;const st=new Error(`Playback stalling at @${rt.currentTime} due to low buffer (${JSON.stringify(et)})`);logger.warn(st.message),nt.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,error:st,buffer:et.len})}}_trySkipBufferHole(et){const{config:nt,hls:rt,media:it}=this;if(it===null)return 0;const st=it.currentTime,ot=BufferHelper.bufferInfo(it,st,0),lt=st<ot.start?ot.start:ot.nextStart;if(lt){const ut=ot.len<=nt.maxBufferHole,ct=ot.len>0&&ot.len<1&&it.readyState<3,dt=lt-st;if(dt>0&&(ut||ct)){if(dt>nt.maxBufferHole){const{fragmentTracker:pt}=this;let gt=!1;if(st===0){const _r=pt.getAppendedFrag(0,PlaylistLevelType.MAIN);_r&&lt<_r.end&&(gt=!0)}if(!gt){const _r=et||pt.getAppendedFrag(st,PlaylistLevelType.MAIN);if(_r){let Yr=!1,mt=_r.end;for(;mt<lt;){const Kr=pt.getPartialFragment(mt);if(Kr)mt+=Kr.duration;else{Yr=!0;break}}if(Yr)return 0}}}const ft=Math.max(lt+SKIP_BUFFER_RANGE_START,st+SKIP_BUFFER_HOLE_STEP_SECONDS);if(logger.warn(`skipping hole, adjusting currentTime from ${st} to ${ft}`),this.moved=!0,this.stalled=null,it.currentTime=ft,et&&!et.gap){const pt=new Error(`fragment loaded with buffer holes, seeking from ${st} to ${ft}`);rt.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:pt,reason:pt.message,frag:et})}return ft}}return 0}_tryNudgeBuffer(){const{config:et,hls:nt,media:rt,nudgeRetry:it}=this;if(rt===null)return;const st=rt.currentTime;if(this.nudgeRetry++,it<et.nudgeMaxRetry){const ot=st+(it+1)*et.nudgeOffset,lt=new Error(`Nudging 'currentTime' from ${st} to ${ot}`);logger.warn(lt.message),rt.currentTime=ot,nt.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_NUDGE_ON_STALL,error:lt,fatal:!1})}else{const ot=new Error(`Playhead still not moving while enough data buffered @${st} after ${et.nudgeMaxRetry} nudges`);logger.error(ot.message),nt.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,error:ot,fatal:!0})}}}const TICK_INTERVAL=100;class StreamController extends BaseStreamController{constructor(et,nt,rt){super(et,nt,rt,"[stream-controller]",PlaylistLevelType.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:et}=this;et.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.on(Events.LEVEL_LOADING,this.onLevelLoading,this),et.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),et.on(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),et.on(Events.ERROR,this.onError,this),et.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),et.on(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),et.on(Events.BUFFER_CREATED,this.onBufferCreated,this),et.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),et.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),et.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:et}=this;et.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),et.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),et.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),et.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),et.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),et.off(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),et.off(Events.ERROR,this.onError,this),et.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),et.off(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),et.off(Events.BUFFER_CREATED,this.onBufferCreated,this),et.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),et.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),et.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying()}startLoad(et){if(this.levels){const{lastCurrentTime:nt,hls:rt}=this;if(this.stopLoad(),this.setInterval(TICK_INTERVAL),this.level=-1,!this.startFragRequested){let it=rt.startLevel;it===-1&&(rt.config.testBandwidth&&this.levels.length>1?(it=0,this.bitrateTest=!0):it=rt.firstAutoLevel),rt.nextLoadLevel=it,this.level=rt.loadLevel,this.loadedmetadata=!1}nt>0&&et===-1&&(this.log(`Override startPosition with lastCurrentTime @${nt.toFixed(3)}`),et=nt),this.state=State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=et,this.tick()}else this._forceStartLoad=!0,this.state=State.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case State.WAITING_LEVEL:{const{levels:nt,level:rt}=this,it=nt==null?void 0:nt[rt],st=it==null?void 0:it.details;if(st&&(!st.live||this.levelLastLoaded===it)){if(this.waitForCdnTuneIn(st))break;this.state=State.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=State.IDLE;break}break}case State.FRAG_LOADING_WAITING_RETRY:{var et;const nt=self.performance.now(),rt=this.retryDate;if(!rt||nt>=rt||(et=this.media)!=null&&et.seeking){const{levels:it,level:st}=this,ot=it==null?void 0:it[st];this.resetStartWhenNotLoaded(ot||null),this.state=State.IDLE}}break}this.state===State.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:et,levelLastLoaded:nt,levels:rt,media:it}=this;if(nt===null||!it&&(this.startFragRequested||!et.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const st=et.nextLoadLevel;if(!(rt!=null&&rt[st]))return;const ot=rt[st],lt=this.getMainFwdBufferInfo();if(lt===null)return;const ut=this.getLevelDetails();if(ut&&this._streamEnded(lt,ut)){const Yr={};this.altAudio&&(Yr.type="video"),this.hls.trigger(Events.BUFFER_EOS,Yr),this.state=State.ENDED;return}et.loadLevel!==st&&et.manualLevel===-1&&this.log(`Adapting to level ${st} from level ${this.level}`),this.level=et.nextLoadLevel=st;const ct=ot.details;if(!ct||this.state===State.WAITING_LEVEL||ct.live&&this.levelLastLoaded!==ot){this.level=st,this.state=State.WAITING_LEVEL;return}const dt=lt.len,ft=this.getMaxBufferLength(ot.maxBitrate);if(dt>=ft)return;this.backtrackFragment&&this.backtrackFragment.start>lt.end&&(this.backtrackFragment=null);const pt=this.backtrackFragment?this.backtrackFragment.start:lt.end;let gt=this.getNextFragment(pt,ct);if(this.couldBacktrack&&!this.fragPrevious&&gt&&gt.sn!=="initSegment"&&this.fragmentTracker.getState(gt)!==FragmentState.OK){var _r;const mt=((_r=this.backtrackFragment)!=null?_r:gt).sn-ct.startSN,Kr=ct.fragments[mt-1];Kr&&gt.cc===Kr.cc&&(gt=Kr,this.fragmentTracker.removeFragment(Kr))}else this.backtrackFragment&&lt.len&&(this.backtrackFragment=null);if(gt&&this.isLoopLoading(gt,pt)){if(!gt.gap){const mt=this.audioOnly&&!this.altAudio?ElementaryStreamTypes.AUDIO:ElementaryStreamTypes.VIDEO,Kr=(mt===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;Kr&&this.afterBufferFlushed(Kr,mt,PlaylistLevelType.MAIN)}gt=this.getNextFragmentLoopLoading(gt,ct,lt,PlaylistLevelType.MAIN,ft)}gt&&(gt.initSegment&&!gt.initSegment.data&&!this.bitrateTest&&(gt=gt.initSegment),this.loadFragment(gt,ot,pt))}loadFragment(et,nt,rt){const it=this.fragmentTracker.getState(et);this.fragCurrent=et,it===FragmentState.NOT_LOADED||it===FragmentState.PARTIAL?et.sn==="initSegment"?this._loadInitSegment(et,nt):this.bitrateTest?(this.log(`Fragment ${et.sn} of level ${et.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(et,nt)):(this.startFragRequested=!0,super.loadFragment(et,nt,rt)):this.clearTrackerIfNeeded(et)}getBufferedFrag(et){return this.fragmentTracker.getBufferedFrag(et,PlaylistLevelType.MAIN)}followingBufferedFrag(et){return et?this.getBufferedFrag(et.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:et,media:nt}=this;if(nt!=null&&nt.readyState){let rt;const it=this.getAppendedFrag(nt.currentTime);it&&it.start>1&&this.flushMainBuffer(0,it.start-1);const st=this.getLevelDetails();if(st!=null&&st.live){const lt=this.getMainFwdBufferInfo();if(!lt||lt.len<st.targetduration*2)return}if(!nt.paused&&et){const lt=this.hls.nextLoadLevel,ut=et[lt],ct=this.fragLastKbps;ct&&this.fragCurrent?rt=this.fragCurrent.duration*ut.maxBitrate/(1e3*ct)+1:rt=0}else rt=0;const ot=this.getBufferedFrag(nt.currentTime+rt);if(ot){const lt=this.followingBufferedFrag(ot);if(lt){this.abortCurrentFrag();const ut=lt.maxStartPTS?lt.maxStartPTS:lt.start,ct=lt.duration,dt=Math.max(ot.end,ut+Math.min(Math.max(ct-this.config.maxFragLookUpTolerance,ct*(this.couldBacktrack?.5:.125)),ct*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(dt,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const et=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,et&&(et.abortRequests(),this.fragmentTracker.removeFragment(et)),this.state){case State.KEY_LOADING:case State.FRAG_LOADING:case State.FRAG_LOADING_WAITING_RETRY:case State.PARSING:case State.PARSED:this.state=State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(et,nt){super.flushMainBuffer(et,nt,this.altAudio?"video":null)}onMediaAttached(et,nt){super.onMediaAttached(et,nt);const rt=nt.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),rt.addEventListener("playing",this.onvplaying),rt.addEventListener("seeked",this.onvseeked),this.gapController=new GapController(this.config,rt,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:et}=this;et&&this.onvplaying&&this.onvseeked&&(et.removeEventListener("playing",this.onvplaying),et.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const et=this.media,nt=et?et.currentTime:null;isFiniteNumber(nt)&&this.log(`Media seeked to ${nt.toFixed(3)}`);const rt=this.getMainFwdBufferInfo();if(rt===null||rt.len===0){this.warn(`Main forward buffer length on "seeked" event ${rt?rt.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}onManifestParsed(et,nt){let rt=!1,it=!1;nt.levels.forEach(st=>{const ot=st.audioCodec;ot&&(rt=rt||ot.indexOf("mp4a.40.2")!==-1,it=it||ot.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=rt&&it&&!changeTypeSupported(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=nt.levels,this.startFragRequested=!1}onLevelLoading(et,nt){const{levels:rt}=this;if(!rt||this.state!==State.IDLE)return;const it=rt[nt.level];(!it.details||it.details.live&&this.levelLastLoaded!==it||this.waitForCdnTuneIn(it.details))&&(this.state=State.WAITING_LEVEL)}onLevelLoaded(et,nt){var rt;const{levels:it}=this,st=nt.level,ot=nt.details,lt=ot.totalduration;if(!it){this.warn(`Levels were reset while loading level ${st}`);return}this.log(`Level ${st} loaded [${ot.startSN},${ot.endSN}]${ot.lastPartSn?`[part-${ot.lastPartSn}-${ot.lastPartIndex}]`:""}, cc [${ot.startCC}, ${ot.endCC}] duration:${lt}`);const ut=it[st],ct=this.fragCurrent;ct&&(this.state===State.FRAG_LOADING||this.state===State.FRAG_LOADING_WAITING_RETRY)&&ct.level!==nt.level&&ct.loader&&this.abortCurrentFrag();let dt=0;if(ot.live||(rt=ut.details)!=null&&rt.live){var ft;if(this.checkLiveUpdate(ot),ot.deltaUpdateFailed)return;dt=this.alignPlaylists(ot,ut.details,(ft=this.levelLastLoaded)==null?void 0:ft.details)}if(ut.details=ot,this.levelLastLoaded=ut,this.hls.trigger(Events.LEVEL_UPDATED,{details:ot,level:st}),this.state===State.WAITING_LEVEL){if(this.waitForCdnTuneIn(ot))return;this.state=State.IDLE}this.startFragRequested?ot.live&&this.synchronizeToLiveEdge(ot):this.setStartPosition(ot,dt),this.tick()}_handleFragmentLoadProgress(et){var nt;const{frag:rt,part:it,payload:st}=et,{levels:ot}=this;if(!ot){this.warn(`Levels were reset while fragment load was in progress. Fragment ${rt.sn} of level ${rt.level} will not be buffered`);return}const lt=ot[rt.level],ut=lt.details;if(!ut){this.warn(`Dropping fragment ${rt.sn} of level ${rt.level} after level details were reset`),this.fragmentTracker.removeFragment(rt);return}const ct=lt.videoCodec,dt=ut.PTSKnown||!ut.live,ft=(nt=rt.initSegment)==null?void 0:nt.data,pt=this._getAudioCodec(lt),gt=this.transmuxer=this.transmuxer||new TransmuxerInterface(this.hls,PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),_r=it?it.index:-1,Yr=_r!==-1,mt=new ChunkMetadata(rt.level,rt.sn,rt.stats.chunkCount,st.byteLength,_r,Yr),Kr=this.initPTS[rt.cc];gt.push(st,ft,pt,ct,rt,it,ut.totalduration,dt,mt,Kr)}onAudioTrackSwitching(et,nt){const rt=this.altAudio;if(!!!nt.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const ot=this.fragCurrent;ot&&(this.log("Switching to main audio track, cancel main fragment load"),ot.abortRequests(),this.fragmentTracker.removeFragment(ot)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const st=this.hls;rt&&(st.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),st.trigger(Events.AUDIO_TRACK_SWITCHED,nt)}}onAudioTrackSwitched(et,nt){const rt=nt.id,it=!!this.hls.audioTracks[rt].url;if(it){const st=this.videoBuffer;st&&this.mediaBuffer!==st&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=st)}this.altAudio=it,this.tick()}onBufferCreated(et,nt){const rt=nt.tracks;let it,st,ot=!1;for(const lt in rt){const ut=rt[lt];if(ut.id==="main"){if(st=lt,it=ut,lt==="video"){const ct=rt[lt];ct&&(this.videoBuffer=ct.buffer)}}else ot=!0}ot&&it?(this.log(`Alternate track found, use ${st}.buffered to schedule main fragment loading`),this.mediaBuffer=it.buffer):this.mediaBuffer=this.media}onFragBuffered(et,nt){const{frag:rt,part:it}=nt;if(rt&&rt.type!==PlaylistLevelType.MAIN)return;if(this.fragContextChanged(rt)){this.warn(`Fragment ${rt.sn}${it?" p: "+it.index:""} of level ${rt.level} finished buffering, but was aborted. state: ${this.state}`),this.state===State.PARSED&&(this.state=State.IDLE);return}const st=it?it.stats:rt.stats;this.fragLastKbps=Math.round(8*st.total/(st.buffering.end-st.loading.first)),rt.sn!=="initSegment"&&(this.fragPrevious=rt),this.fragBufferedComplete(rt,it)}onError(et,nt){var rt;if(nt.fatal){this.state=State.ERROR;return}switch(nt.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.MAIN,nt);break;case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:!nt.levelRetry&&this.state===State.WAITING_LEVEL&&((rt=nt.context)==null?void 0:rt.type)===PlaylistContextType.LEVEL&&(this.state=State.IDLE);break;case ErrorDetails.BUFFER_APPEND_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:if(!nt.parent||nt.parent!=="main")return;if(nt.details===ErrorDetails.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(nt)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(nt);break}}checkBuffer(){const{media:et,gapController:nt}=this;if(!(!et||!nt||!et.readyState)){if(this.loadedmetadata||!BufferHelper.getBuffered(et).length){const rt=this.state!==State.IDLE?this.fragCurrent:null;nt.poll(this.lastCurrentTime,rt)}this.lastCurrentTime=et.currentTime}}onFragLoadEmergencyAborted(){this.state=State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(et,{type:nt}){if(nt!==ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){const rt=(nt===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(rt,nt,PlaylistLevelType.MAIN),this.tick()}}onLevelsUpdated(et,nt){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=nt.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:et}=this;if(!et)return;const nt=et.currentTime;let rt=this.startPosition;if(rt>=0&&nt<rt){if(et.seeking){this.log(`could not seek to ${rt}, already seeking at ${nt}`);return}const it=BufferHelper.getBuffered(et),ot=(it.length?it.start(0):0)-rt;ot>0&&(ot<this.config.maxBufferHole||ot<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${ot} to match buffer start`),rt+=ot,this.startPosition=rt),this.log(`seek to target start position ${rt} from current time ${nt}`),et.currentTime=rt}}_getAudioCodec(et){let nt=this.config.defaultAudioCodec||et.audioCodec;return this.audioCodecSwap&&nt&&(this.log("Swapping audio codec"),nt.indexOf("mp4a.40.5")!==-1?nt="mp4a.40.2":nt="mp4a.40.5"),nt}_loadBitrateTestFrag(et,nt){et.bitrateTest=!0,this._doFragLoad(et,nt).then(rt=>{const{hls:it}=this;if(!rt||this.fragContextChanged(et))return;nt.fragmentError=0,this.state=State.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const st=et.stats;st.parsing.start=st.parsing.end=st.buffering.start=st.buffering.end=self.performance.now(),it.trigger(Events.FRAG_LOADED,rt),et.bitrateTest=!1})}_handleTransmuxComplete(et){var nt;const rt="main",{hls:it}=this,{remuxResult:st,chunkMeta:ot}=et,lt=this.getCurrentContext(ot);if(!lt){this.resetWhenMissingContext(ot);return}const{frag:ut,part:ct,level:dt}=lt,{video:ft,text:pt,id3:gt,initSegment:_r}=st,{details:Yr}=dt,mt=this.altAudio?void 0:st.audio;if(this.fragContextChanged(ut)){this.fragmentTracker.removeFragment(ut);return}if(this.state=State.PARSING,_r){if(_r!=null&&_r.tracks){const Zr=ut.initSegment||ut;this._bufferInitSegment(dt,_r.tracks,Zr,ot),it.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:Zr,id:rt,tracks:_r.tracks})}const Kr=_r.initPTS,Xr=_r.timescale;isFiniteNumber(Kr)&&(this.initPTS[ut.cc]={baseTime:Kr,timescale:Xr},it.trigger(Events.INIT_PTS_FOUND,{frag:ut,id:rt,initPTS:Kr,timescale:Xr}))}if(ft&&Yr&&ut.sn!=="initSegment"){const Kr=Yr.fragments[ut.sn-1-Yr.startSN],Xr=ut.sn===Yr.startSN,Zr=!Kr||ut.cc>Kr.cc;if(st.independent!==!1){const{startPTS:Qr,endPTS:_i,startDTS:rs,endDTS:ns}=ft;if(ct)ct.elementaryStreams[ft.type]={startPTS:Qr,endPTS:_i,startDTS:rs,endDTS:ns};else if(ft.firstKeyFrame&&ft.independent&&ot.id===1&&!Zr&&(this.couldBacktrack=!0),ft.dropped&&ft.independent){const ss=this.getMainFwdBufferInfo(),fs=(ss?ss.end:this.getLoadPosition())+this.config.maxBufferHole,os=ft.firstKeyFramePTS?ft.firstKeyFramePTS:Qr;if(!Xr&&fs<os-this.config.maxBufferHole&&!Zr){this.backtrack(ut);return}else Zr&&(ut.gap=!0);ut.setElementaryStreamInfo(ft.type,ut.start,_i,ut.start,ns,!0)}else Xr&&Qr>MAX_START_GAP_JUMP&&(ut.gap=!0);ut.setElementaryStreamInfo(ft.type,Qr,_i,rs,ns),this.backtrackFragment&&(this.backtrackFragment=ut),this.bufferFragmentData(ft,ut,ct,ot,Xr||Zr)}else if(Xr||Zr)ut.gap=!0;else{this.backtrack(ut);return}}if(mt){const{startPTS:Kr,endPTS:Xr,startDTS:Zr,endDTS:Qr}=mt;ct&&(ct.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:Kr,endPTS:Xr,startDTS:Zr,endDTS:Qr}),ut.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,Kr,Xr,Zr,Qr),this.bufferFragmentData(mt,ut,ct,ot)}if(Yr&&gt!=null&&(nt=gt.samples)!=null&&nt.length){const Kr={id:rt,frag:ut,details:Yr,samples:gt.samples};it.trigger(Events.FRAG_PARSING_METADATA,Kr)}if(Yr&&pt){const Kr={id:rt,frag:ut,details:Yr,samples:pt.samples};it.trigger(Events.FRAG_PARSING_USERDATA,Kr)}}_bufferInitSegment(et,nt,rt,it){if(this.state!==State.PARSING)return;this.audioOnly=!!nt.audio&&!nt.video,this.altAudio&&!this.audioOnly&&delete nt.audio;const{audio:st,video:ot,audiovideo:lt}=nt;if(st){let ut=et.audioCodec;const ct=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(ut&&(ut.indexOf("mp4a.40.5")!==-1?ut="mp4a.40.2":ut="mp4a.40.5"),st.metadata.channelCount!==1&&ct.indexOf("firefox")===-1&&(ut="mp4a.40.5")),ut&&ut.indexOf("mp4a.40.5")!==-1&&ct.indexOf("android")!==-1&&st.container!=="audio/mpeg"&&(ut="mp4a.40.2",this.log(`Android: force audio codec to ${ut}`)),et.audioCodec&&et.audioCodec!==ut&&this.log(`Swapping manifest audio codec "${et.audioCodec}" for "${ut}"`),st.levelCodec=ut,st.id="main",this.log(`Init audio buffer, container:${st.container}, codecs[selected/level/parsed]=[${ut||""}/${et.audioCodec||""}/${st.codec}]`)}ot&&(ot.levelCodec=et.videoCodec,ot.id="main",this.log(`Init video buffer, container:${ot.container}, codecs[level/parsed]=[${et.videoCodec||""}/${ot.codec}]`)),lt&&this.log(`Init audiovideo buffer, container:${lt.container}, codecs[level/parsed]=[${et.codecs}/${lt.codec}]`),this.hls.trigger(Events.BUFFER_CODECS,nt),Object.keys(nt).forEach(ut=>{const dt=nt[ut].initSegment;dt!=null&&dt.byteLength&&this.hls.trigger(Events.BUFFER_APPENDING,{type:ut,data:dt,frag:rt,part:null,chunkMeta:it,parent:rt.type})}),this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,PlaylistLevelType.MAIN)}backtrack(et){this.couldBacktrack=!0,this.backtrackFragment=et,this.resetTransmuxer(),this.flushBufferGap(et),this.fragmentTracker.removeFragment(et),this.fragPrevious=null,this.nextLoadPosition=et.start,this.state=State.IDLE}checkFragmentChanged(){const et=this.media;let nt=null;if(et&&et.readyState>1&&et.seeking===!1){const rt=et.currentTime;if(BufferHelper.isBuffered(et,rt)?nt=this.getAppendedFrag(rt):BufferHelper.isBuffered(et,rt+.1)&&(nt=this.getAppendedFrag(rt+.1)),nt){this.backtrackFragment=null;const it=this.fragPlaying,st=nt.level;(!it||nt.sn!==it.sn||it.level!==st)&&(this.fragPlaying=nt,this.hls.trigger(Events.FRAG_CHANGED,{frag:nt}),(!it||it.level!==st)&&this.hls.trigger(Events.LEVEL_SWITCHED,{level:st}))}}}get nextLevel(){const et=this.nextBufferedFrag;return et?et.level:-1}get currentFrag(){const et=this.media;return et?this.fragPlaying||this.getAppendedFrag(et.currentTime):null}get currentProgramDateTime(){const et=this.media;if(et){const nt=et.currentTime,rt=this.currentFrag;if(rt&&isFiniteNumber(nt)&&isFiniteNumber(rt.programDateTime)){const it=rt.programDateTime+(nt-rt.start)*1e3;return new Date(it)}}return null}get currentLevel(){const et=this.currentFrag;return et?et.level:-1}get nextBufferedFrag(){const et=this.currentFrag;return et?this.followingBufferedFrag(et):null}get forceStartLoad(){return this._forceStartLoad}}class Hls{static get version(){return"1.5.6"}static isMSESupported(){return isMSESupported()}static isSupported(){return isSupported()}static getMediaSource(){return getMediaSource()}static get Events(){return Events}static get ErrorTypes(){return ErrorTypes}static get ErrorDetails(){return ErrorDetails}static get DefaultConfig(){return Hls.defaultConfig?Hls.defaultConfig:hlsDefaultConfig}static set DefaultConfig(et){Hls.defaultConfig=et}constructor(et={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new EventEmitter,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,enableLogs(et.debug||!1,"Hls instance");const nt=this.config=mergeConfig(Hls.DefaultConfig,et);this.userConfig=et,nt.progressive&&enableStreamingMode(nt);const{abrController:rt,bufferController:it,capLevelController:st,errorController:ot,fpsController:lt}=nt,ut=new ot(this),ct=this.abrController=new rt(this),dt=this.bufferController=new it(this),ft=this.capLevelController=new st(this),pt=new lt(this),gt=new PlaylistLoader(this),_r=new ID3TrackController(this),Yr=nt.contentSteeringController,mt=Yr?new Yr(this):null,Kr=this.levelController=new LevelController(this,mt),Xr=new FragmentTracker(this),Zr=new KeyLoader(this.config),Qr=this.streamController=new StreamController(this,Xr,Zr);ft.setStreamController(Qr),pt.setStreamController(Qr);const _i=[gt,Kr,Qr];mt&&_i.splice(1,0,mt),this.networkControllers=_i;const rs=[ct,dt,ft,pt,_r,Xr];this.audioTrackController=this.createController(nt.audioTrackController,_i);const ns=nt.audioStreamController;ns&&_i.push(new ns(this,Xr,Zr)),this.subtitleTrackController=this.createController(nt.subtitleTrackController,_i);const ss=nt.subtitleStreamController;ss&&_i.push(new ss(this,Xr,Zr)),this.createController(nt.timelineController,rs),Zr.emeController=this.emeController=this.createController(nt.emeController,rs),this.cmcdController=this.createController(nt.cmcdController,rs),this.latencyController=this.createController(LatencyController,rs),this.coreComponents=rs,_i.push(ut);const fs=ut.onErrorOut;typeof fs=="function"&&this.on(Events.ERROR,fs,ut)}createController(et,nt){if(et){const rt=new et(this);return nt&&nt.push(rt),rt}return null}on(et,nt,rt=this){this._emitter.on(et,nt,rt)}once(et,nt,rt=this){this._emitter.once(et,nt,rt)}removeAllListeners(et){this._emitter.removeAllListeners(et)}off(et,nt,rt=this,it){this._emitter.off(et,nt,rt,it)}listeners(et){return this._emitter.listeners(et)}emit(et,nt,rt){return this._emitter.emit(et,nt,rt)}trigger(et,nt){if(this.config.debug)return this.emit(et,et,nt);try{return this.emit(et,et,nt)}catch(rt){if(logger.error("An internal error happened while handling event "+et+'. Error message: "'+rt.message+'". Here is a stacktrace:',rt),!this.triggeringException){this.triggeringException=!0;const it=et===Events.ERROR;this.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:it,event:et,error:rt}),this.triggeringException=!1}}return!1}listenerCount(et){return this._emitter.listenerCount(et)}destroy(){logger.log("destroy"),this.trigger(Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(nt=>nt.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(nt=>nt.destroy()),this.coreComponents.length=0;const et=this.config;et.xhrSetup=et.fetchSetup=void 0,this.userConfig=null}attachMedia(et){logger.log("attachMedia"),this._media=et,this.trigger(Events.MEDIA_ATTACHING,{media:et})}detachMedia(){logger.log("detachMedia"),this.trigger(Events.MEDIA_DETACHING,void 0),this._media=null}loadSource(et){this.stopLoad();const nt=this.media,rt=this.url,it=this.url=urlToolkitExports.buildAbsoluteURL(self.location.href,et,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,logger.log(`loadSource:${it}`),nt&&rt&&(rt!==it||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(nt)),this.trigger(Events.MANIFEST_LOADING,{url:et})}startLoad(et=-1){logger.log(`startLoad(${et})`),this.started=!0,this.networkControllers.forEach(nt=>{nt.startLoad(et)})}stopLoad(){logger.log("stopLoad"),this.started=!1,this.networkControllers.forEach(et=>{et.stopLoad()})}resumeBuffering(){this.started&&this.networkControllers.forEach(et=>{"fragmentLoader"in et&&et.startLoad(-1)})}pauseBuffering(){this.networkControllers.forEach(et=>{"fragmentLoader"in et&&et.stopLoad()})}swapAudioCodec(){logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){logger.log("recoverMediaError");const et=this._media;this.detachMedia(),et&&this.attachMedia(et)}removeLevel(et){this.levelController.removeLevel(et)}get levels(){const et=this.levelController.levels;return et||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(et){logger.log(`set currentLevel:${et}`),this.levelController.manualLevel=et,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(et){logger.log(`set nextLevel:${et}`),this.levelController.manualLevel=et,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(et){logger.log(`set loadLevel:${et}`),this.levelController.manualLevel=et}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(et){this.levelController.nextLoadLevel=et}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(et){logger.log(`set firstLevel:${et}`),this.levelController.firstLevel=et}get startLevel(){const et=this.levelController.startLevel;return et===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:et}set startLevel(et){logger.log(`set startLevel:${et}`),et!==-1&&(et=Math.max(et,this.minAutoLevel)),this.levelController.startLevel=et}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(et){const nt=!!et;nt!==this.config.capLevelToPlayerSize&&(nt?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=nt)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:et}=this.abrController;return et?et.getEstimate():NaN}set bandwidthEstimate(et){this.abrController.resetEstimator(et)}get ttfbEstimate(){const{bwEstimator:et}=this.abrController;return et?et.getEstimateTTFB():NaN}set autoLevelCapping(et){this._autoLevelCapping!==et&&(logger.log(`set autoLevelCapping:${et}`),this._autoLevelCapping=et,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(et){isHdcpLevel(et)&&this._maxHdcpLevel!==et&&(this._maxHdcpLevel=et,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:et,config:{minAutoBitrate:nt}}=this;if(!et)return 0;const rt=et.length;for(let it=0;it<rt;it++)if(et[it].maxBitrate>=nt)return it;return 0}get maxAutoLevel(){const{levels:et,autoLevelCapping:nt,maxHdcpLevel:rt}=this;let it;if(nt===-1&&et!=null&&et.length?it=et.length-1:it=nt,rt)for(let st=it;st--;){const ot=et[st].attrs["HDCP-LEVEL"];if(ot&&ot<=rt)return st}return it}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(et){this.abrController.nextAutoLevel=et}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}setAudioOption(et){var nt;return(nt=this.audioTrackController)==null?void 0:nt.setAudioOption(et)}setSubtitleOption(et){var nt;return(nt=this.subtitleTrackController)==null||nt.setSubtitleOption(et),null}get allAudioTracks(){const et=this.audioTrackController;return et?et.allAudioTracks:[]}get audioTracks(){const et=this.audioTrackController;return et?et.audioTracks:[]}get audioTrack(){const et=this.audioTrackController;return et?et.audioTrack:-1}set audioTrack(et){const nt=this.audioTrackController;nt&&(nt.audioTrack=et)}get allSubtitleTracks(){const et=this.subtitleTrackController;return et?et.allSubtitleTracks:[]}get subtitleTracks(){const et=this.subtitleTrackController;return et?et.subtitleTracks:[]}get subtitleTrack(){const et=this.subtitleTrackController;return et?et.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(et){const nt=this.subtitleTrackController;nt&&(nt.subtitleTrack=et)}get subtitleDisplay(){const et=this.subtitleTrackController;return et?et.subtitleDisplay:!1}set subtitleDisplay(et){const nt=this.subtitleTrackController;nt&&(nt.subtitleDisplay=et)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(et){this.config.lowLatencyMode=et}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}Hls.defaultConfig=void 0;let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}const byteToHex=[];for(let tt=0;tt<256;++tt)byteToHex.push((tt+256).toString(16).slice(1));function unsafeStringify(tt,et=0){return byteToHex[tt[et+0]]+byteToHex[tt[et+1]]+byteToHex[tt[et+2]]+byteToHex[tt[et+3]]+"-"+byteToHex[tt[et+4]]+byteToHex[tt[et+5]]+"-"+byteToHex[tt[et+6]]+byteToHex[tt[et+7]]+"-"+byteToHex[tt[et+8]]+byteToHex[tt[et+9]]+"-"+byteToHex[tt[et+10]]+byteToHex[tt[et+11]]+byteToHex[tt[et+12]]+byteToHex[tt[et+13]]+byteToHex[tt[et+14]]+byteToHex[tt[et+15]]}const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(tt,et,nt){if(native.randomUUID&&!et&&!tt)return native.randomUUID();tt=tt||{};const rt=tt.random||(tt.rng||rng)();if(rt[6]=rt[6]&15|64,rt[8]=rt[8]&63|128,et){nt=nt||0;for(let it=0;it<16;++it)et[nt+it]=rt[it];return et}return unsafeStringify(rt)}function $db6c3485150b8e66$export$1ab7ae714698c4b8(tt){const[et,nt]=p$3(void 0);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(tt){nt({width:tt.offsetWidth,height:tt.offsetHeight});const rt=new ResizeObserver(it=>{if(!Array.isArray(it)||!it.length)return;const st=it[0];let ot,lt;if("borderBoxSize"in st){const ut=st.borderBoxSize,ct=Array.isArray(ut)?ut[0]:ut;ot=ct.inlineSize,lt=ct.blockSize}else ot=tt.offsetWidth,lt=tt.offsetHeight;nt({width:ot,height:lt})});return rt.observe(tt,{box:"border-box"}),()=>rt.unobserve(tt)}else nt(void 0)},[tt]),et}function $010c2913dbd2fe3d$export$5cae361ad82dce8b(tt){const et=F$2({value:tt,previous:tt});return q$2(()=>(et.current.value!==tt&&(et.current.previous=et.current.value,et.current.value=tt),et.current.previous),[tt])}const $ce77a8961b41be9e$var$RADIO_NAME="Radio",[$ce77a8961b41be9e$var$createRadioContext,$ce77a8961b41be9e$export$67d2296460f1b002]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($ce77a8961b41be9e$var$RADIO_NAME),[$ce77a8961b41be9e$var$RadioProvider,$ce77a8961b41be9e$var$useRadioContext]=$ce77a8961b41be9e$var$createRadioContext($ce77a8961b41be9e$var$RADIO_NAME),$ce77a8961b41be9e$export$d7b12c4107be0d61=N$3((tt,et)=>{const{__scopeRadio:nt,name:rt,checked:it=!1,required:st,disabled:ot,value:lt="on",onCheck:ut,...ct}=tt,[dt,ft]=p$3(null),pt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,Yr=>ft(Yr)),gt=F$2(!1),_r=dt?!!dt.closest("form"):!0;return y$3($ce77a8961b41be9e$var$RadioProvider,{scope:nt,checked:it,disabled:ot},y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"radio","aria-checked":it,"data-state":$ce77a8961b41be9e$var$getState(it),"data-disabled":ot?"":void 0,disabled:ot,value:lt},ct,{ref:pt,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onClick,Yr=>{it||ut==null||ut(),_r&&(gt.current=Yr.isPropagationStopped(),gt.current||Yr.stopPropagation())})})),_r&&y$3($ce77a8961b41be9e$var$BubbleInput,{control:dt,bubbles:!gt.current,name:rt,value:lt,checked:it,required:st,disabled:ot,style:{transform:"translateX(-100%)"}}))}),$ce77a8961b41be9e$var$BubbleInput=tt=>{const{control:et,checked:nt,bubbles:rt=!0,...it}=tt,st=F$2(null),ot=$010c2913dbd2fe3d$export$5cae361ad82dce8b(nt),lt=$db6c3485150b8e66$export$1ab7ae714698c4b8(et);return _$1(()=>{const ut=st.current,ct=window.HTMLInputElement.prototype,ft=Object.getOwnPropertyDescriptor(ct,"checked").set;if(ot!==nt&&ft){const pt=new Event("click",{bubbles:rt});ft.call(ut,nt),ut.dispatchEvent(pt)}},[ot,nt,rt]),y$3("input",_extends$1({type:"radio","aria-hidden":!0,defaultChecked:nt},it,{tabIndex:-1,ref:st,style:{...tt.style,...lt,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function $ce77a8961b41be9e$var$getState(tt){return tt?"checked":"unchecked"}const $f99a8c78507165f7$var$ARROW_KEYS=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],$f99a8c78507165f7$var$RADIO_GROUP_NAME="RadioGroup",[$f99a8c78507165f7$var$createRadioGroupContext,$f99a8c78507165f7$export$c547093f11b76da2]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($f99a8c78507165f7$var$RADIO_GROUP_NAME,[$d7bdfb9eb0fdf311$export$c7109489551a4f4,$ce77a8961b41be9e$export$67d2296460f1b002]),$f99a8c78507165f7$var$useRovingFocusGroupScope=$d7bdfb9eb0fdf311$export$c7109489551a4f4(),$f99a8c78507165f7$var$useRadioScope=$ce77a8961b41be9e$export$67d2296460f1b002(),[$f99a8c78507165f7$var$RadioGroupProvider,$f99a8c78507165f7$var$useRadioGroupContext]=$f99a8c78507165f7$var$createRadioGroupContext($f99a8c78507165f7$var$RADIO_GROUP_NAME),$f99a8c78507165f7$export$a98f0dcb43a68a25=N$3((tt,et)=>{const{__scopeRadioGroup:nt,name:rt,defaultValue:it,value:st,required:ot=!1,disabled:lt=!1,orientation:ut,dir:ct,loop:dt=!0,onValueChange:ft,...pt}=tt,gt=$f99a8c78507165f7$var$useRovingFocusGroupScope(nt),_r=$f631663db3294ace$export$b39126d51d94e6f3(ct),[Yr,mt]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:st,defaultProp:it,onChange:ft});return y$3($f99a8c78507165f7$var$RadioGroupProvider,{scope:nt,name:rt,required:ot,disabled:lt,value:Yr,onValueChange:mt},y$3($d7bdfb9eb0fdf311$export$be92b6f5f03c0fe9,_extends$1({asChild:!0},gt,{orientation:ut,dir:_r,loop:dt}),y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"radiogroup","aria-required":ot,"aria-orientation":ut,"data-disabled":lt?"":void 0,dir:_r},pt,{ref:et}))))}),$f99a8c78507165f7$var$ITEM_NAME="RadioGroupItem",$f99a8c78507165f7$export$9f866c100ef519e4=N$3((tt,et)=>{const{__scopeRadioGroup:nt,disabled:rt,...it}=tt,st=$f99a8c78507165f7$var$useRadioGroupContext($f99a8c78507165f7$var$ITEM_NAME,nt),ot=st.disabled||rt,lt=$f99a8c78507165f7$var$useRovingFocusGroupScope(nt),ut=$f99a8c78507165f7$var$useRadioScope(nt),ct=F$2(null),dt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,ct),ft=st.value===it.value,pt=F$2(!1);return _$1(()=>{const gt=Yr=>{$f99a8c78507165f7$var$ARROW_KEYS.includes(Yr.key)&&(pt.current=!0)},_r=()=>pt.current=!1;return document.addEventListener("keydown",gt),document.addEventListener("keyup",_r),()=>{document.removeEventListener("keydown",gt),document.removeEventListener("keyup",_r)}},[]),y$3($d7bdfb9eb0fdf311$export$6d08773d2e66f8f2,_extends$1({asChild:!0},lt,{focusable:!ot,active:ft}),y$3($ce77a8961b41be9e$export$d7b12c4107be0d61,_extends$1({disabled:ot,required:st.required,checked:ft},ut,it,{name:st.name,ref:dt,onCheck:()=>st.onValueChange(it.value),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(gt=>{gt.key==="Enter"&&gt.preventDefault()}),onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(it.onFocus,()=>{var gt;pt.current&&((gt=ct.current)===null||gt===void 0||gt.click())})})))}),$f99a8c78507165f7$export$be92b6f5f03c0fe9=$f99a8c78507165f7$export$a98f0dcb43a68a25,$f99a8c78507165f7$export$6d08773d2e66f8f2=$f99a8c78507165f7$export$9f866c100ef519e4;function ParserError(tt,et){this.message=tt,this.error=et}ParserError.prototype=Object.create(Error.prototype);const TIMESTAMP_REGEXP=/([0-9]+)?:?([0-9]{2}):([0-9]{2}\.[0-9]{2,3})/;function parse$3(tt,et){et||(et={});const{meta:nt=!1,strict:rt=!0}=et;if(typeof tt!="string")throw new ParserError("Input must be a string");tt=tt.trim(),tt=tt.replace(/\r\n/g,`
`),tt=tt.replace(/\r/g,`
`);const it=tt.split(`

`),st=it.shift();if(!st.startsWith("WEBVTT"))throw new ParserError('Must start with "WEBVTT"');const ot=st.split(`
`),lt=ot[0].replace("WEBVTT","");if(lt.length>0&&lt[0]!==" "&&lt[0]!=="	")throw new ParserError("Header comment must start with space or tab");if(it.length===0&&ot.length===1)return{valid:!0,strict:rt,cues:[],errors:[]};if(!nt&&ot.length>1&&ot[1]!=="")throw new ParserError("Missing blank line after signature");const{cues:ut,errors:ct}=parseCues(it,rt);if(rt&&ct.length>0)throw ct[0];const dt=nt?parseMeta(ot):null,ft={valid:ct.length===0,strict:rt,cues:ut,errors:ct};return nt&&(ft.meta=dt),ft}function parseMeta(tt){const et={};return tt.slice(1).forEach(nt=>{const rt=nt.indexOf(":"),it=nt.slice(0,rt).trim(),st=nt.slice(rt+1).trim();et[it]=st}),Object.keys(et).length>0?et:null}function parseCues(tt,et){const nt=[];return{cues:tt.map((it,st)=>{try{return parseCue(it,st,et)}catch(ot){return nt.push(ot),null}}).filter(Boolean),errors:nt}}function parseCue(tt,et,nt){let rt="",it=0,st=.01,ot="",lt="";const ut=tt.split(`
`).filter(Boolean);if(ut.length>0&&ut[0].trim().startsWith("NOTE"))return null;if(ut.length===1&&!ut[0].includes("-->"))throw new ParserError(`Cue identifier cannot be standalone (cue #${et})`);if(ut.length>1&&!(ut[0].includes("-->")||ut[1].includes("-->"))){const dt=`Cue identifier needs to be followed by timestamp (cue #${et})`;throw new ParserError(dt)}ut.length>1&&ut[1].includes("-->")&&(rt=ut.shift());const ct=typeof ut[0]=="string"&&ut[0].split(" --> ");if(ct.length!==2||!validTimestamp(ct[0])||!validTimestamp(ct[1]))throw new ParserError(`Invalid cue timestamp (cue #${et})`);if(it=parseTimestamp(ct[0]),st=parseTimestamp(ct[1]),nt){if(it>st)throw new ParserError(`Start timestamp greater than end (cue #${et})`);if(st<=it)throw new ParserError(`End must be greater than start (cue #${et})`)}if(!nt&&st<it)throw new ParserError(`End must be greater or equal to start when not strict (cue #${et})`);return lt=ct[1].replace(TIMESTAMP_REGEXP,"").trim(),ut.shift(),ot=ut.join(`
`),ot?{identifier:rt,start:it,end:st,text:ot,styles:lt}:!1}function validTimestamp(tt){return TIMESTAMP_REGEXP.test(tt)}function parseTimestamp(tt){const et=tt.match(TIMESTAMP_REGEXP);let nt=parseFloat(et[1]||0)*60*60;return nt+=parseFloat(et[2])*60,nt+=parseFloat(et[3]),nt}var parser={ParserError,parse:parse$3};function CompilerError(tt,et){this.message=tt,this.error=et}CompilerError.prototype=Object.create(Error.prototype);function compile$1(tt){if(!tt)throw new CompilerError("Input must be non-null");if(typeof tt!="object")throw new CompilerError("Input must be an object");if(Array.isArray(tt))throw new CompilerError("Input cannot be array");if(!tt.valid)throw new CompilerError("Input must be valid");let et=`WEBVTT
`;if(tt.meta){if(typeof tt.meta!="object"||Array.isArray(tt.meta))throw new CompilerError("Metadata must be an object");Object.entries(tt.meta).forEach(rt=>{if(typeof rt[1]!="string")throw new CompilerError(`Metadata value for "${rt[0]}" must be string`);et+=`${rt[0]}: ${rt[1]}
`})}let nt=null;return tt.cues.forEach((rt,it)=>{if(nt&&nt>rt.start)throw new CompilerError(`Cue number ${it} is not in chronological order`);nt=rt.start,et+=`
`,et+=compileCue(rt),et+=`
`}),et}function compileCue(tt){if(typeof tt!="object")throw new CompilerError("Cue malformed: not of type object");if(typeof tt.identifier!="string"&&typeof tt.identifier!="number"&&tt.identifier!==null)throw new CompilerError(`Cue malformed: identifier value is not a string.
    ${JSON.stringify(tt)}`);if(isNaN(tt.start))throw new CompilerError(`Cue malformed: null start value.
    ${JSON.stringify(tt)}`);if(isNaN(tt.end))throw new CompilerError(`Cue malformed: null end value.
    ${JSON.stringify(tt)}`);if(tt.start>=tt.end)throw new CompilerError(`Cue malformed: start timestamp greater than end
    ${JSON.stringify(tt)}`);if(typeof tt.text!="string")throw new CompilerError(`Cue malformed: null text value.
    ${JSON.stringify(tt)}`);if(typeof tt.styles!="string")throw new CompilerError(`Cue malformed: null styles value.
    ${JSON.stringify(tt)}`);let et="";tt.identifier.length>0&&(et+=`${tt.identifier}
`);const nt=convertTimestamp(tt.start),rt=convertTimestamp(tt.end);return et+=`${nt} --> ${rt}`,et+=tt.styles?` ${tt.styles}`:"",et+=`
${tt.text}`,et}function convertTimestamp(tt){const et=pad$1(calculateHours(tt),2),nt=pad$1(calculateMinutes(tt),2),rt=pad$1(calculateSeconds(tt),2),it=pad$1(calculateMs(tt),3);return`${et}:${nt}:${rt}.${it}`}function pad$1(tt,et){let nt=`${tt}`;for(;nt.length<et;)nt=`0${nt}`;return nt}function calculateHours(tt){return Math.floor(tt/60/60)}function calculateMinutes(tt){return Math.floor(tt/60)%60}function calculateSeconds(tt){return Math.floor(tt%60)}function calculateMs(tt){return Math.floor((tt%1).toFixed(4)*1e3)}var compiler={CompilerError,compile:compile$1};const parse$2=parser.parse;function segment$2(tt,et){et=et||10;const nt=parse$2(tt),rt=[];let it=[],st=null,ot=0,lt=0;return nt.cues.forEach((ut,ct)=>{const dt=ct===0,ft=ct===nt.cues.length-1,pt=ut.start,gt=ut.end,_r=ft?1/0:nt.cues[ct+1].start,Yr=dt?gt:gt-pt,mt=dt?0:pt-nt.cues[ct-1].end;ot=ot+Yr+mt,`${ct}`,rt.length+1,st&&(it.push(st),ot+=st.end-lt,st=null),it.push(ut);let Kr=_r-gt<et&&mt<et&&ot>et;if(shouldSegment(lt,et,_r,mt)){const Xr=segmentDuration(ft,gt,et,ot,lt);rt.push({duration:Xr,cues:it}),lt+=Xr,ot=0,it=[]}else Kr=!1;Kr&&(st=ut)}),rt}function shouldSegment(tt,et,nt,rt){const it=alignToSegmentLength(rt,et);return(rt<=et||it+tt<nt)&&nt-tt>=et}function segmentDuration(tt,et,nt,rt,it){let st=nt;return rt>nt&&(st=alignToSegmentLength(rt-nt,nt)),tt?st=parseFloat((et-it).toFixed(2)):st=Math.round(st),st}function alignToSegmentLength(tt,et){return tt+=et-tt%et,tt}function debug(tt){}var segmenter={segment:segment$2};const segment$1=segmenter.segment;function hlsSegment(tt,et,nt){typeof nt>"u"&&(nt="900000");const rt=segment$1(tt,et),it=[];return rt.forEach((st,ot)=>{const lt=`WEBVTT
X-TIMESTAMP-MAP=MPEGTS:${nt},LOCAL:00:00:00.000

${printableCues(st.cues)}
`,ut=generateSegmentFilename(ot);it.push({filename:ut,content:lt})}),it}function hlsSegmentPlaylist(tt,et){const nt=segment$1(tt,et),rt=printableSegments(nt);return`#EXTM3U
#EXT-X-TARGETDURATION:${Math.round(findLongestSegment(nt))}
#EXT-X-VERSION:3
#EXT-X-MEDIA-SEQUENCE:0
#EXT-X-PLAYLIST-TYPE:VOD
${rt}
#EXT-X-ENDLIST
`}function pad(tt,et){return`${"0".repeat(Math.max(0,et-tt.toString().length))}${tt}`}function generateSegmentFilename(tt){return`${tt}.vtt`}function printableSegments(tt){const et=[];return tt.forEach((nt,rt)=>{et.push(`#EXTINF:${nt.duration.toFixed(5)},
${generateSegmentFilename(rt)}`)}),et.join(`
`)}function findLongestSegment(tt){let et=0;return tt.forEach(nt=>{nt.duration>et&&(et=nt.duration)}),et}function printableCues(tt){const et=[];return tt.forEach(nt=>{et.push(printableCue(nt))}),et.join(`

`)}function printableCue(tt){const et=[];tt.identifier&&et.push(tt.identifier);const nt=printableTimestamp(tt.start),rt=printableTimestamp(tt.end),it=tt.styles?`${tt.styles}`:"";return et.push(`${nt} --> ${rt} ${it}`),et.push(tt.text),et.join(`
`)}function printableTimestamp(tt){const et=(tt%1).toFixed(3);tt=Math.round(tt-et);const nt=Math.floor(tt/3600),rt=Math.floor((tt-nt*3600)/60),it=tt-nt*3600-rt*60;return`${`${pad(nt,2)}:`}${pad(rt,2)}:${pad(it,2)}.${pad(et*1e3,3)}`}var hls$1={hlsSegment,hlsSegmentPlaylist};const parse$1=parser.parse,compile=compiler.compile,segment=segmenter.segment,hls=hls$1;var nodeWebvtt={parse:parse$1,compile,segment,hls};function $addc16e1bbe58fd0$export$3a72a57244d6e765(tt,et=globalThis==null?void 0:globalThis.document){const nt=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(tt);_$1(()=>{const rt=it=>{it.key==="Escape"&&nt(it)};return et.addEventListener("keydown",rt),()=>et.removeEventListener("keydown",rt)},[nt,et])}const $5cb92bef7577960e$var$CONTEXT_UPDATE="dismissableLayer.update",$5cb92bef7577960e$var$POINTER_DOWN_OUTSIDE="dismissableLayer.pointerDownOutside",$5cb92bef7577960e$var$FOCUS_OUTSIDE="dismissableLayer.focusOutside";let $5cb92bef7577960e$var$originalBodyPointerEvents;const $5cb92bef7577960e$var$DismissableLayerContext=G$3({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),$5cb92bef7577960e$export$177fb62ff3ec1f22=N$3((tt,et)=>{var nt;const{disableOutsidePointerEvents:rt=!1,onEscapeKeyDown:it,onPointerDownOutside:st,onFocusOutside:ot,onInteractOutside:lt,onDismiss:ut,...ct}=tt,dt=P$3($5cb92bef7577960e$var$DismissableLayerContext),[ft,pt]=p$3(null),gt=(nt=ft==null?void 0:ft.ownerDocument)!==null&&nt!==void 0?nt:globalThis==null?void 0:globalThis.document,[,_r]=p$3({}),Yr=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,ss=>pt(ss)),mt=Array.from(dt.layers),[Kr]=[...dt.layersWithOutsidePointerEventsDisabled].slice(-1),Xr=mt.indexOf(Kr),Zr=ft?mt.indexOf(ft):-1,Qr=dt.layersWithOutsidePointerEventsDisabled.size>0,_i=Zr>=Xr,rs=$5cb92bef7577960e$var$usePointerDownOutside(ss=>{const fs=ss.target,os=[...dt.branches].some(is=>is.contains(fs));!_i||os||(st==null||st(ss),lt==null||lt(ss),ss.defaultPrevented||ut==null||ut())},gt),ns=$5cb92bef7577960e$var$useFocusOutside(ss=>{const fs=ss.target;[...dt.branches].some(is=>is.contains(fs))||(ot==null||ot(ss),lt==null||lt(ss),ss.defaultPrevented||ut==null||ut())},gt);return $addc16e1bbe58fd0$export$3a72a57244d6e765(ss=>{Zr===dt.layers.size-1&&(it==null||it(ss),!ss.defaultPrevented&&ut&&(ss.preventDefault(),ut()))},gt),_$1(()=>{if(ft)return rt&&(dt.layersWithOutsidePointerEventsDisabled.size===0&&($5cb92bef7577960e$var$originalBodyPointerEvents=gt.body.style.pointerEvents,gt.body.style.pointerEvents="none"),dt.layersWithOutsidePointerEventsDisabled.add(ft)),dt.layers.add(ft),$5cb92bef7577960e$var$dispatchUpdate(),()=>{rt&&dt.layersWithOutsidePointerEventsDisabled.size===1&&(gt.body.style.pointerEvents=$5cb92bef7577960e$var$originalBodyPointerEvents)}},[ft,gt,rt,dt]),_$1(()=>()=>{ft&&(dt.layers.delete(ft),dt.layersWithOutsidePointerEventsDisabled.delete(ft),$5cb92bef7577960e$var$dispatchUpdate())},[ft,dt]),_$1(()=>{const ss=()=>_r({});return document.addEventListener($5cb92bef7577960e$var$CONTEXT_UPDATE,ss),()=>document.removeEventListener($5cb92bef7577960e$var$CONTEXT_UPDATE,ss)},[]),y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},ct,{ref:Yr,style:{pointerEvents:Qr?_i?"auto":"none":void 0,...tt.style},onFocusCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onFocusCapture,ns.onFocusCapture),onBlurCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onBlurCapture,ns.onBlurCapture),onPointerDownCapture:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onPointerDownCapture,rs.onPointerDownCapture)}))});function $5cb92bef7577960e$var$usePointerDownOutside(tt,et=globalThis==null?void 0:globalThis.document){const nt=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(tt),rt=F$2(!1),it=F$2(()=>{});return _$1(()=>{const st=lt=>{if(lt.target&&!rt.current){let ct=function(){$5cb92bef7577960e$var$handleAndDispatchCustomEvent($5cb92bef7577960e$var$POINTER_DOWN_OUTSIDE,nt,ut,{discrete:!0})};const ut={originalEvent:lt};lt.pointerType==="touch"?(et.removeEventListener("click",it.current),it.current=ct,et.addEventListener("click",it.current,{once:!0})):ct()}else et.removeEventListener("click",it.current);rt.current=!1},ot=window.setTimeout(()=>{et.addEventListener("pointerdown",st)},0);return()=>{window.clearTimeout(ot),et.removeEventListener("pointerdown",st),et.removeEventListener("click",it.current)}},[et,nt]),{onPointerDownCapture:()=>rt.current=!0}}function $5cb92bef7577960e$var$useFocusOutside(tt,et=globalThis==null?void 0:globalThis.document){const nt=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(tt),rt=F$2(!1);return _$1(()=>{const it=st=>{st.target&&!rt.current&&$5cb92bef7577960e$var$handleAndDispatchCustomEvent($5cb92bef7577960e$var$FOCUS_OUTSIDE,nt,{originalEvent:st},{discrete:!1})};return et.addEventListener("focusin",it),()=>et.removeEventListener("focusin",it)},[et,nt]),{onFocusCapture:()=>rt.current=!0,onBlurCapture:()=>rt.current=!1}}function $5cb92bef7577960e$var$dispatchUpdate(){const tt=new CustomEvent($5cb92bef7577960e$var$CONTEXT_UPDATE);document.dispatchEvent(tt)}function $5cb92bef7577960e$var$handleAndDispatchCustomEvent(tt,et,nt,{discrete:rt}){const it=nt.originalEvent.target,st=new CustomEvent(tt,{bubbles:!1,cancelable:!0,detail:nt});et&&it.addEventListener(tt,et,{once:!0}),rt?$8927f6f2acc4f386$export$6d1a0317bde7de7f(it,st):it.dispatchEvent(st)}let $3db38b7d1fb3fe6a$var$count=0;function $3db38b7d1fb3fe6a$export$b7ece24a22aeda8c(){_$1(()=>{var tt,et;const nt=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",(tt=nt[0])!==null&&tt!==void 0?tt:$3db38b7d1fb3fe6a$var$createFocusGuard()),document.body.insertAdjacentElement("beforeend",(et=nt[1])!==null&&et!==void 0?et:$3db38b7d1fb3fe6a$var$createFocusGuard()),$3db38b7d1fb3fe6a$var$count++,()=>{$3db38b7d1fb3fe6a$var$count===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(rt=>rt.remove()),$3db38b7d1fb3fe6a$var$count--}},[])}function $3db38b7d1fb3fe6a$var$createFocusGuard(){const tt=document.createElement("span");return tt.setAttribute("data-radix-focus-guard",""),tt.tabIndex=0,tt.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",tt}const $d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT="focusScope.autoFocusOnMount",$d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT="focusScope.autoFocusOnUnmount",$d3863c46a17e8a28$var$EVENT_OPTIONS={bubbles:!1,cancelable:!0},$d3863c46a17e8a28$export$20e40289641fbbb6=N$3((tt,et)=>{const{loop:nt=!1,trapped:rt=!1,onMountAutoFocus:it,onUnmountAutoFocus:st,...ot}=tt,[lt,ut]=p$3(null),ct=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(it),dt=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(st),ft=F$2(null),pt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,Yr=>ut(Yr)),gt=F$2({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;_$1(()=>{if(rt){let Yr=function(Zr){if(gt.paused||!lt)return;const Qr=Zr.target;lt.contains(Qr)?ft.current=Qr:$d3863c46a17e8a28$var$focus(ft.current,{select:!0})},mt=function(Zr){if(gt.paused||!lt)return;const Qr=Zr.relatedTarget;Qr!==null&&(lt.contains(Qr)||$d3863c46a17e8a28$var$focus(ft.current,{select:!0}))},Kr=function(Zr){if(document.activeElement===document.body)for(const _i of Zr)_i.removedNodes.length>0&&$d3863c46a17e8a28$var$focus(lt)};document.addEventListener("focusin",Yr),document.addEventListener("focusout",mt);const Xr=new MutationObserver(Kr);return lt&&Xr.observe(lt,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",Yr),document.removeEventListener("focusout",mt),Xr.disconnect()}}},[rt,lt,gt.paused]),_$1(()=>{if(lt){$d3863c46a17e8a28$var$focusScopesStack.add(gt);const Yr=document.activeElement;if(!lt.contains(Yr)){const Kr=new CustomEvent($d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT,$d3863c46a17e8a28$var$EVENT_OPTIONS);lt.addEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT,ct),lt.dispatchEvent(Kr),Kr.defaultPrevented||($d3863c46a17e8a28$var$focusFirst($d3863c46a17e8a28$var$removeLinks($d3863c46a17e8a28$var$getTabbableCandidates(lt)),{select:!0}),document.activeElement===Yr&&$d3863c46a17e8a28$var$focus(lt))}return()=>{lt.removeEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_MOUNT,ct),setTimeout(()=>{const Kr=new CustomEvent($d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT,$d3863c46a17e8a28$var$EVENT_OPTIONS);lt.addEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT,dt),lt.dispatchEvent(Kr),Kr.defaultPrevented||$d3863c46a17e8a28$var$focus(Yr??document.body,{select:!0}),lt.removeEventListener($d3863c46a17e8a28$var$AUTOFOCUS_ON_UNMOUNT,dt),$d3863c46a17e8a28$var$focusScopesStack.remove(gt)},0)}}},[lt,ct,dt,gt]);const _r=x$3(Yr=>{if(!nt&&!rt||gt.paused)return;const mt=Yr.key==="Tab"&&!Yr.altKey&&!Yr.ctrlKey&&!Yr.metaKey,Kr=document.activeElement;if(mt&&Kr){const Xr=Yr.currentTarget,[Zr,Qr]=$d3863c46a17e8a28$var$getTabbableEdges(Xr);Zr&&Qr?!Yr.shiftKey&&Kr===Qr?(Yr.preventDefault(),nt&&$d3863c46a17e8a28$var$focus(Zr,{select:!0})):Yr.shiftKey&&Kr===Zr&&(Yr.preventDefault(),nt&&$d3863c46a17e8a28$var$focus(Qr,{select:!0})):Kr===Xr&&Yr.preventDefault()}},[nt,rt,gt.paused]);return y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({tabIndex:-1},ot,{ref:pt,onKeyDown:_r}))});function $d3863c46a17e8a28$var$focusFirst(tt,{select:et=!1}={}){const nt=document.activeElement;for(const rt of tt)if($d3863c46a17e8a28$var$focus(rt,{select:et}),document.activeElement!==nt)return}function $d3863c46a17e8a28$var$getTabbableEdges(tt){const et=$d3863c46a17e8a28$var$getTabbableCandidates(tt),nt=$d3863c46a17e8a28$var$findVisible(et,tt),rt=$d3863c46a17e8a28$var$findVisible(et.reverse(),tt);return[nt,rt]}function $d3863c46a17e8a28$var$getTabbableCandidates(tt){const et=[],nt=document.createTreeWalker(tt,NodeFilter.SHOW_ELEMENT,{acceptNode:rt=>{const it=rt.tagName==="INPUT"&&rt.type==="hidden";return rt.disabled||rt.hidden||it?NodeFilter.FILTER_SKIP:rt.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;nt.nextNode();)et.push(nt.currentNode);return et}function $d3863c46a17e8a28$var$findVisible(tt,et){for(const nt of tt)if(!$d3863c46a17e8a28$var$isHidden(nt,{upTo:et}))return nt}function $d3863c46a17e8a28$var$isHidden(tt,{upTo:et}){if(getComputedStyle(tt).visibility==="hidden")return!0;for(;tt;){if(et!==void 0&&tt===et)return!1;if(getComputedStyle(tt).display==="none")return!0;tt=tt.parentElement}return!1}function $d3863c46a17e8a28$var$isSelectableInput(tt){return tt instanceof HTMLInputElement&&"select"in tt}function $d3863c46a17e8a28$var$focus(tt,{select:et=!1}={}){if(tt&&tt.focus){const nt=document.activeElement;tt.focus({preventScroll:!0}),tt!==nt&&$d3863c46a17e8a28$var$isSelectableInput(tt)&&et&&tt.select()}}const $d3863c46a17e8a28$var$focusScopesStack=$d3863c46a17e8a28$var$createFocusScopesStack();function $d3863c46a17e8a28$var$createFocusScopesStack(){let tt=[];return{add(et){const nt=tt[0];et!==nt&&(nt==null||nt.pause()),tt=$d3863c46a17e8a28$var$arrayRemove(tt,et),tt.unshift(et)},remove(et){var nt;tt=$d3863c46a17e8a28$var$arrayRemove(tt,et),(nt=tt[0])===null||nt===void 0||nt.resume()}}}function $d3863c46a17e8a28$var$arrayRemove(tt,et){const nt=[...tt],rt=nt.indexOf(et);return rt!==-1&&nt.splice(rt,1),nt}function $d3863c46a17e8a28$var$removeLinks(tt){return tt.filter(et=>et.tagName!=="A")}const sides=["top","right","bottom","left"],min=Math.min,max=Math.max,round=Math.round,floor=Math.floor,createCoords=tt=>({x:tt,y:tt}),oppositeSideMap={left:"right",right:"left",bottom:"top",top:"bottom"},oppositeAlignmentMap={start:"end",end:"start"};function clamp(tt,et,nt){return max(tt,min(et,nt))}function evaluate(tt,et){return typeof tt=="function"?tt(et):tt}function getSide(tt){return tt.split("-")[0]}function getAlignment(tt){return tt.split("-")[1]}function getOppositeAxis(tt){return tt==="x"?"y":"x"}function getAxisLength(tt){return tt==="y"?"height":"width"}function getSideAxis(tt){return["top","bottom"].includes(getSide(tt))?"y":"x"}function getAlignmentAxis(tt){return getOppositeAxis(getSideAxis(tt))}function getAlignmentSides(tt,et,nt){nt===void 0&&(nt=!1);const rt=getAlignment(tt),it=getAlignmentAxis(tt),st=getAxisLength(it);let ot=it==="x"?rt===(nt?"end":"start")?"right":"left":rt==="start"?"bottom":"top";return et.reference[st]>et.floating[st]&&(ot=getOppositePlacement(ot)),[ot,getOppositePlacement(ot)]}function getExpandedPlacements(tt){const et=getOppositePlacement(tt);return[getOppositeAlignmentPlacement(tt),et,getOppositeAlignmentPlacement(et)]}function getOppositeAlignmentPlacement(tt){return tt.replace(/start|end/g,et=>oppositeAlignmentMap[et])}function getSideList(tt,et,nt){const rt=["left","right"],it=["right","left"],st=["top","bottom"],ot=["bottom","top"];switch(tt){case"top":case"bottom":return nt?et?it:rt:et?rt:it;case"left":case"right":return et?st:ot;default:return[]}}function getOppositeAxisPlacements(tt,et,nt,rt){const it=getAlignment(tt);let st=getSideList(getSide(tt),nt==="start",rt);return it&&(st=st.map(ot=>ot+"-"+it),et&&(st=st.concat(st.map(getOppositeAlignmentPlacement)))),st}function getOppositePlacement(tt){return tt.replace(/left|right|bottom|top/g,et=>oppositeSideMap[et])}function expandPaddingObject(tt){return{top:0,right:0,bottom:0,left:0,...tt}}function getPaddingObject(tt){return typeof tt!="number"?expandPaddingObject(tt):{top:tt,right:tt,bottom:tt,left:tt}}function rectToClientRect(tt){return{...tt,top:tt.y,left:tt.x,right:tt.x+tt.width,bottom:tt.y+tt.height}}function computeCoordsFromPlacement(tt,et,nt){let{reference:rt,floating:it}=tt;const st=getSideAxis(et),ot=getAlignmentAxis(et),lt=getAxisLength(ot),ut=getSide(et),ct=st==="y",dt=rt.x+rt.width/2-it.width/2,ft=rt.y+rt.height/2-it.height/2,pt=rt[lt]/2-it[lt]/2;let gt;switch(ut){case"top":gt={x:dt,y:rt.y-it.height};break;case"bottom":gt={x:dt,y:rt.y+rt.height};break;case"right":gt={x:rt.x+rt.width,y:ft};break;case"left":gt={x:rt.x-it.width,y:ft};break;default:gt={x:rt.x,y:rt.y}}switch(getAlignment(et)){case"start":gt[ot]-=pt*(nt&&ct?-1:1);break;case"end":gt[ot]+=pt*(nt&&ct?-1:1);break}return gt}const computePosition$1=async(tt,et,nt)=>{const{placement:rt="bottom",strategy:it="absolute",middleware:st=[],platform:ot}=nt,lt=st.filter(Boolean),ut=await(ot.isRTL==null?void 0:ot.isRTL(et));let ct=await ot.getElementRects({reference:tt,floating:et,strategy:it}),{x:dt,y:ft}=computeCoordsFromPlacement(ct,rt,ut),pt=rt,gt={},_r=0;for(let Yr=0;Yr<lt.length;Yr++){const{name:mt,fn:Kr}=lt[Yr],{x:Xr,y:Zr,data:Qr,reset:_i}=await Kr({x:dt,y:ft,initialPlacement:rt,placement:pt,strategy:it,middlewareData:gt,rects:ct,platform:ot,elements:{reference:tt,floating:et}});dt=Xr??dt,ft=Zr??ft,gt={...gt,[mt]:{...gt[mt],...Qr}},_i&&_r<=50&&(_r++,typeof _i=="object"&&(_i.placement&&(pt=_i.placement),_i.rects&&(ct=_i.rects===!0?await ot.getElementRects({reference:tt,floating:et,strategy:it}):_i.rects),{x:dt,y:ft}=computeCoordsFromPlacement(ct,pt,ut)),Yr=-1)}return{x:dt,y:ft,placement:pt,strategy:it,middlewareData:gt}};async function detectOverflow(tt,et){var nt;et===void 0&&(et={});const{x:rt,y:it,platform:st,rects:ot,elements:lt,strategy:ut}=tt,{boundary:ct="clippingAncestors",rootBoundary:dt="viewport",elementContext:ft="floating",altBoundary:pt=!1,padding:gt=0}=evaluate(et,tt),_r=getPaddingObject(gt),mt=lt[pt?ft==="floating"?"reference":"floating":ft],Kr=rectToClientRect(await st.getClippingRect({element:(nt=await(st.isElement==null?void 0:st.isElement(mt)))==null||nt?mt:mt.contextElement||await(st.getDocumentElement==null?void 0:st.getDocumentElement(lt.floating)),boundary:ct,rootBoundary:dt,strategy:ut})),Xr=ft==="floating"?{...ot.floating,x:rt,y:it}:ot.reference,Zr=await(st.getOffsetParent==null?void 0:st.getOffsetParent(lt.floating)),Qr=await(st.isElement==null?void 0:st.isElement(Zr))?await(st.getScale==null?void 0:st.getScale(Zr))||{x:1,y:1}:{x:1,y:1},_i=rectToClientRect(st.convertOffsetParentRelativeRectToViewportRelativeRect?await st.convertOffsetParentRelativeRectToViewportRelativeRect({elements:lt,rect:Xr,offsetParent:Zr,strategy:ut}):Xr);return{top:(Kr.top-_i.top+_r.top)/Qr.y,bottom:(_i.bottom-Kr.bottom+_r.bottom)/Qr.y,left:(Kr.left-_i.left+_r.left)/Qr.x,right:(_i.right-Kr.right+_r.right)/Qr.x}}const arrow$2=tt=>({name:"arrow",options:tt,async fn(et){const{x:nt,y:rt,placement:it,rects:st,platform:ot,elements:lt,middlewareData:ut}=et,{element:ct,padding:dt=0}=evaluate(tt,et)||{};if(ct==null)return{};const ft=getPaddingObject(dt),pt={x:nt,y:rt},gt=getAlignmentAxis(it),_r=getAxisLength(gt),Yr=await ot.getDimensions(ct),mt=gt==="y",Kr=mt?"top":"left",Xr=mt?"bottom":"right",Zr=mt?"clientHeight":"clientWidth",Qr=st.reference[_r]+st.reference[gt]-pt[gt]-st.floating[_r],_i=pt[gt]-st.reference[gt],rs=await(ot.getOffsetParent==null?void 0:ot.getOffsetParent(ct));let ns=rs?rs[Zr]:0;(!ns||!await(ot.isElement==null?void 0:ot.isElement(rs)))&&(ns=lt.floating[Zr]||st.floating[_r]);const ss=Qr/2-_i/2,fs=ns/2-Yr[_r]/2-1,os=min(ft[Kr],fs),is=min(ft[Xr],fs),cs=os,ps=ns-Yr[_r]-is,vs=ns/2-Yr[_r]/2+ss,ls=clamp(cs,vs,ps),gs=!ut.arrow&&getAlignment(it)!=null&&vs!==ls&&st.reference[_r]/2-(vs<cs?os:is)-Yr[_r]/2<0,us=gs?vs<cs?vs-cs:vs-ps:0;return{[gt]:pt[gt]+us,data:{[gt]:ls,centerOffset:vs-ls-us,...gs&&{alignmentOffset:us}},reset:gs}}}),flip$1=function(tt){return tt===void 0&&(tt={}),{name:"flip",options:tt,async fn(et){var nt,rt;const{placement:it,middlewareData:st,rects:ot,initialPlacement:lt,platform:ut,elements:ct}=et,{mainAxis:dt=!0,crossAxis:ft=!0,fallbackPlacements:pt,fallbackStrategy:gt="bestFit",fallbackAxisSideDirection:_r="none",flipAlignment:Yr=!0,...mt}=evaluate(tt,et);if((nt=st.arrow)!=null&&nt.alignmentOffset)return{};const Kr=getSide(it),Xr=getSide(lt)===lt,Zr=await(ut.isRTL==null?void 0:ut.isRTL(ct.floating)),Qr=pt||(Xr||!Yr?[getOppositePlacement(lt)]:getExpandedPlacements(lt));!pt&&_r!=="none"&&Qr.push(...getOppositeAxisPlacements(lt,Yr,_r,Zr));const _i=[lt,...Qr],rs=await detectOverflow(et,mt),ns=[];let ss=((rt=st.flip)==null?void 0:rt.overflows)||[];if(dt&&ns.push(rs[Kr]),ft){const cs=getAlignmentSides(it,ot,Zr);ns.push(rs[cs[0]],rs[cs[1]])}if(ss=[...ss,{placement:it,overflows:ns}],!ns.every(cs=>cs<=0)){var fs,os;const cs=(((fs=st.flip)==null?void 0:fs.index)||0)+1,ps=_i[cs];if(ps)return{data:{index:cs,overflows:ss},reset:{placement:ps}};let vs=(os=ss.filter(ls=>ls.overflows[0]<=0).sort((ls,gs)=>ls.overflows[1]-gs.overflows[1])[0])==null?void 0:os.placement;if(!vs)switch(gt){case"bestFit":{var is;const ls=(is=ss.map(gs=>[gs.placement,gs.overflows.filter(us=>us>0).reduce((us,ms)=>us+ms,0)]).sort((gs,us)=>gs[1]-us[1])[0])==null?void 0:is[0];ls&&(vs=ls);break}case"initialPlacement":vs=lt;break}if(it!==vs)return{reset:{placement:vs}}}return{}}}};function getSideOffsets(tt,et){return{top:tt.top-et.height,right:tt.right-et.width,bottom:tt.bottom-et.height,left:tt.left-et.width}}function isAnySideFullyClipped(tt){return sides.some(et=>tt[et]>=0)}const hide$1=function(tt){return tt===void 0&&(tt={}),{name:"hide",options:tt,async fn(et){const{rects:nt}=et,{strategy:rt="referenceHidden",...it}=evaluate(tt,et);switch(rt){case"referenceHidden":{const st=await detectOverflow(et,{...it,elementContext:"reference"}),ot=getSideOffsets(st,nt.reference);return{data:{referenceHiddenOffsets:ot,referenceHidden:isAnySideFullyClipped(ot)}}}case"escaped":{const st=await detectOverflow(et,{...it,altBoundary:!0}),ot=getSideOffsets(st,nt.floating);return{data:{escapedOffsets:ot,escaped:isAnySideFullyClipped(ot)}}}default:return{}}}}};async function convertValueToCoords(tt,et){const{placement:nt,platform:rt,elements:it}=tt,st=await(rt.isRTL==null?void 0:rt.isRTL(it.floating)),ot=getSide(nt),lt=getAlignment(nt),ut=getSideAxis(nt)==="y",ct=["left","top"].includes(ot)?-1:1,dt=st&&ut?-1:1,ft=evaluate(et,tt);let{mainAxis:pt,crossAxis:gt,alignmentAxis:_r}=typeof ft=="number"?{mainAxis:ft,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...ft};return lt&&typeof _r=="number"&&(gt=lt==="end"?_r*-1:_r),ut?{x:gt*dt,y:pt*ct}:{x:pt*ct,y:gt*dt}}const offset=function(tt){return tt===void 0&&(tt=0),{name:"offset",options:tt,async fn(et){var nt,rt;const{x:it,y:st,placement:ot,middlewareData:lt}=et,ut=await convertValueToCoords(et,tt);return ot===((nt=lt.offset)==null?void 0:nt.placement)&&(rt=lt.arrow)!=null&&rt.alignmentOffset?{}:{x:it+ut.x,y:st+ut.y,data:{...ut,placement:ot}}}}},shift$1=function(tt){return tt===void 0&&(tt={}),{name:"shift",options:tt,async fn(et){const{x:nt,y:rt,placement:it}=et,{mainAxis:st=!0,crossAxis:ot=!1,limiter:lt={fn:mt=>{let{x:Kr,y:Xr}=mt;return{x:Kr,y:Xr}}},...ut}=evaluate(tt,et),ct={x:nt,y:rt},dt=await detectOverflow(et,ut),ft=getSideAxis(getSide(it)),pt=getOppositeAxis(ft);let gt=ct[pt],_r=ct[ft];if(st){const mt=pt==="y"?"top":"left",Kr=pt==="y"?"bottom":"right",Xr=gt+dt[mt],Zr=gt-dt[Kr];gt=clamp(Xr,gt,Zr)}if(ot){const mt=ft==="y"?"top":"left",Kr=ft==="y"?"bottom":"right",Xr=_r+dt[mt],Zr=_r-dt[Kr];_r=clamp(Xr,_r,Zr)}const Yr=lt.fn({...et,[pt]:gt,[ft]:_r});return{...Yr,data:{x:Yr.x-nt,y:Yr.y-rt}}}}},limitShift$1=function(tt){return tt===void 0&&(tt={}),{options:tt,fn(et){const{x:nt,y:rt,placement:it,rects:st,middlewareData:ot}=et,{offset:lt=0,mainAxis:ut=!0,crossAxis:ct=!0}=evaluate(tt,et),dt={x:nt,y:rt},ft=getSideAxis(it),pt=getOppositeAxis(ft);let gt=dt[pt],_r=dt[ft];const Yr=evaluate(lt,et),mt=typeof Yr=="number"?{mainAxis:Yr,crossAxis:0}:{mainAxis:0,crossAxis:0,...Yr};if(ut){const Zr=pt==="y"?"height":"width",Qr=st.reference[pt]-st.floating[Zr]+mt.mainAxis,_i=st.reference[pt]+st.reference[Zr]-mt.mainAxis;gt<Qr?gt=Qr:gt>_i&&(gt=_i)}if(ct){var Kr,Xr;const Zr=pt==="y"?"width":"height",Qr=["top","left"].includes(getSide(it)),_i=st.reference[ft]-st.floating[Zr]+(Qr&&((Kr=ot.offset)==null?void 0:Kr[ft])||0)+(Qr?0:mt.crossAxis),rs=st.reference[ft]+st.reference[Zr]+(Qr?0:((Xr=ot.offset)==null?void 0:Xr[ft])||0)-(Qr?mt.crossAxis:0);_r<_i?_r=_i:_r>rs&&(_r=rs)}return{[pt]:gt,[ft]:_r}}}},size$1=function(tt){return tt===void 0&&(tt={}),{name:"size",options:tt,async fn(et){const{placement:nt,rects:rt,platform:it,elements:st}=et,{apply:ot=()=>{},...lt}=evaluate(tt,et),ut=await detectOverflow(et,lt),ct=getSide(nt),dt=getAlignment(nt),ft=getSideAxis(nt)==="y",{width:pt,height:gt}=rt.floating;let _r,Yr;ct==="top"||ct==="bottom"?(_r=ct,Yr=dt===(await(it.isRTL==null?void 0:it.isRTL(st.floating))?"start":"end")?"left":"right"):(Yr=ct,_r=dt==="end"?"top":"bottom");const mt=gt-ut[_r],Kr=pt-ut[Yr],Xr=!et.middlewareData.shift;let Zr=mt,Qr=Kr;if(ft){const rs=pt-ut.left-ut.right;Qr=dt||Xr?min(Kr,rs):rs}else{const rs=gt-ut.top-ut.bottom;Zr=dt||Xr?min(mt,rs):rs}if(Xr&&!dt){const rs=max(ut.left,0),ns=max(ut.right,0),ss=max(ut.top,0),fs=max(ut.bottom,0);ft?Qr=pt-2*(rs!==0||ns!==0?rs+ns:max(ut.left,ut.right)):Zr=gt-2*(ss!==0||fs!==0?ss+fs:max(ut.top,ut.bottom))}await ot({...et,availableWidth:Qr,availableHeight:Zr});const _i=await it.getDimensions(st.floating);return pt!==_i.width||gt!==_i.height?{reset:{rects:!0}}:{}}}};function getNodeName(tt){return isNode(tt)?(tt.nodeName||"").toLowerCase():"#document"}function getWindow(tt){var et;return(tt==null||(et=tt.ownerDocument)==null?void 0:et.defaultView)||window}function getDocumentElement(tt){var et;return(et=(isNode(tt)?tt.ownerDocument:tt.document)||window.document)==null?void 0:et.documentElement}function isNode(tt){return tt instanceof Node||tt instanceof getWindow(tt).Node}function isElement(tt){return tt instanceof Element||tt instanceof getWindow(tt).Element}function isHTMLElement(tt){return tt instanceof HTMLElement||tt instanceof getWindow(tt).HTMLElement}function isShadowRoot(tt){return typeof ShadowRoot>"u"?!1:tt instanceof ShadowRoot||tt instanceof getWindow(tt).ShadowRoot}function isOverflowElement(tt){const{overflow:et,overflowX:nt,overflowY:rt,display:it}=getComputedStyle$1(tt);return/auto|scroll|overlay|hidden|clip/.test(et+rt+nt)&&!["inline","contents"].includes(it)}function isTableElement(tt){return["table","td","th"].includes(getNodeName(tt))}function isContainingBlock(tt){const et=isWebKit(),nt=getComputedStyle$1(tt);return nt.transform!=="none"||nt.perspective!=="none"||(nt.containerType?nt.containerType!=="normal":!1)||!et&&(nt.backdropFilter?nt.backdropFilter!=="none":!1)||!et&&(nt.filter?nt.filter!=="none":!1)||["transform","perspective","filter"].some(rt=>(nt.willChange||"").includes(rt))||["paint","layout","strict","content"].some(rt=>(nt.contain||"").includes(rt))}function getContainingBlock(tt){let et=getParentNode(tt);for(;isHTMLElement(et)&&!isLastTraversableNode(et);){if(isContainingBlock(et))return et;et=getParentNode(et)}return null}function isWebKit(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function isLastTraversableNode(tt){return["html","body","#document"].includes(getNodeName(tt))}function getComputedStyle$1(tt){return getWindow(tt).getComputedStyle(tt)}function getNodeScroll(tt){return isElement(tt)?{scrollLeft:tt.scrollLeft,scrollTop:tt.scrollTop}:{scrollLeft:tt.pageXOffset,scrollTop:tt.pageYOffset}}function getParentNode(tt){if(getNodeName(tt)==="html")return tt;const et=tt.assignedSlot||tt.parentNode||isShadowRoot(tt)&&tt.host||getDocumentElement(tt);return isShadowRoot(et)?et.host:et}function getNearestOverflowAncestor(tt){const et=getParentNode(tt);return isLastTraversableNode(et)?tt.ownerDocument?tt.ownerDocument.body:tt.body:isHTMLElement(et)&&isOverflowElement(et)?et:getNearestOverflowAncestor(et)}function getOverflowAncestors(tt,et,nt){var rt;et===void 0&&(et=[]),nt===void 0&&(nt=!0);const it=getNearestOverflowAncestor(tt),st=it===((rt=tt.ownerDocument)==null?void 0:rt.body),ot=getWindow(it);return st?et.concat(ot,ot.visualViewport||[],isOverflowElement(it)?it:[],ot.frameElement&&nt?getOverflowAncestors(ot.frameElement):[]):et.concat(it,getOverflowAncestors(it,[],nt))}function getCssDimensions(tt){const et=getComputedStyle$1(tt);let nt=parseFloat(et.width)||0,rt=parseFloat(et.height)||0;const it=isHTMLElement(tt),st=it?tt.offsetWidth:nt,ot=it?tt.offsetHeight:rt,lt=round(nt)!==st||round(rt)!==ot;return lt&&(nt=st,rt=ot),{width:nt,height:rt,$:lt}}function unwrapElement(tt){return isElement(tt)?tt:tt.contextElement}function getScale(tt){const et=unwrapElement(tt);if(!isHTMLElement(et))return createCoords(1);const nt=et.getBoundingClientRect(),{width:rt,height:it,$:st}=getCssDimensions(et);let ot=(st?round(nt.width):nt.width)/rt,lt=(st?round(nt.height):nt.height)/it;return(!ot||!Number.isFinite(ot))&&(ot=1),(!lt||!Number.isFinite(lt))&&(lt=1),{x:ot,y:lt}}const noOffsets=createCoords(0);function getVisualOffsets(tt){const et=getWindow(tt);return!isWebKit()||!et.visualViewport?noOffsets:{x:et.visualViewport.offsetLeft,y:et.visualViewport.offsetTop}}function shouldAddVisualOffsets(tt,et,nt){return et===void 0&&(et=!1),!nt||et&&nt!==getWindow(tt)?!1:et}function getBoundingClientRect(tt,et,nt,rt){et===void 0&&(et=!1),nt===void 0&&(nt=!1);const it=tt.getBoundingClientRect(),st=unwrapElement(tt);let ot=createCoords(1);et&&(rt?isElement(rt)&&(ot=getScale(rt)):ot=getScale(tt));const lt=shouldAddVisualOffsets(st,nt,rt)?getVisualOffsets(st):createCoords(0);let ut=(it.left+lt.x)/ot.x,ct=(it.top+lt.y)/ot.y,dt=it.width/ot.x,ft=it.height/ot.y;if(st){const pt=getWindow(st),gt=rt&&isElement(rt)?getWindow(rt):rt;let _r=pt,Yr=_r.frameElement;for(;Yr&&rt&&gt!==_r;){const mt=getScale(Yr),Kr=Yr.getBoundingClientRect(),Xr=getComputedStyle$1(Yr),Zr=Kr.left+(Yr.clientLeft+parseFloat(Xr.paddingLeft))*mt.x,Qr=Kr.top+(Yr.clientTop+parseFloat(Xr.paddingTop))*mt.y;ut*=mt.x,ct*=mt.y,dt*=mt.x,ft*=mt.y,ut+=Zr,ct+=Qr,_r=getWindow(Yr),Yr=_r.frameElement}}return rectToClientRect({width:dt,height:ft,x:ut,y:ct})}const topLayerSelectors=[":popover-open",":modal"];function isTopLayer(tt){return topLayerSelectors.some(et=>{try{return tt.matches(et)}catch{return!1}})}function convertOffsetParentRelativeRectToViewportRelativeRect(tt){let{elements:et,rect:nt,offsetParent:rt,strategy:it}=tt;const st=it==="fixed",ot=getDocumentElement(rt),lt=et?isTopLayer(et.floating):!1;if(rt===ot||lt&&st)return nt;let ut={scrollLeft:0,scrollTop:0},ct=createCoords(1);const dt=createCoords(0),ft=isHTMLElement(rt);if((ft||!ft&&!st)&&((getNodeName(rt)!=="body"||isOverflowElement(ot))&&(ut=getNodeScroll(rt)),isHTMLElement(rt))){const pt=getBoundingClientRect(rt);ct=getScale(rt),dt.x=pt.x+rt.clientLeft,dt.y=pt.y+rt.clientTop}return{width:nt.width*ct.x,height:nt.height*ct.y,x:nt.x*ct.x-ut.scrollLeft*ct.x+dt.x,y:nt.y*ct.y-ut.scrollTop*ct.y+dt.y}}function getClientRects(tt){return Array.from(tt.getClientRects())}function getWindowScrollBarX(tt){return getBoundingClientRect(getDocumentElement(tt)).left+getNodeScroll(tt).scrollLeft}function getDocumentRect(tt){const et=getDocumentElement(tt),nt=getNodeScroll(tt),rt=tt.ownerDocument.body,it=max(et.scrollWidth,et.clientWidth,rt.scrollWidth,rt.clientWidth),st=max(et.scrollHeight,et.clientHeight,rt.scrollHeight,rt.clientHeight);let ot=-nt.scrollLeft+getWindowScrollBarX(tt);const lt=-nt.scrollTop;return getComputedStyle$1(rt).direction==="rtl"&&(ot+=max(et.clientWidth,rt.clientWidth)-it),{width:it,height:st,x:ot,y:lt}}function getViewportRect(tt,et){const nt=getWindow(tt),rt=getDocumentElement(tt),it=nt.visualViewport;let st=rt.clientWidth,ot=rt.clientHeight,lt=0,ut=0;if(it){st=it.width,ot=it.height;const ct=isWebKit();(!ct||ct&&et==="fixed")&&(lt=it.offsetLeft,ut=it.offsetTop)}return{width:st,height:ot,x:lt,y:ut}}function getInnerBoundingClientRect(tt,et){const nt=getBoundingClientRect(tt,!0,et==="fixed"),rt=nt.top+tt.clientTop,it=nt.left+tt.clientLeft,st=isHTMLElement(tt)?getScale(tt):createCoords(1),ot=tt.clientWidth*st.x,lt=tt.clientHeight*st.y,ut=it*st.x,ct=rt*st.y;return{width:ot,height:lt,x:ut,y:ct}}function getClientRectFromClippingAncestor(tt,et,nt){let rt;if(et==="viewport")rt=getViewportRect(tt,nt);else if(et==="document")rt=getDocumentRect(getDocumentElement(tt));else if(isElement(et))rt=getInnerBoundingClientRect(et,nt);else{const it=getVisualOffsets(tt);rt={...et,x:et.x-it.x,y:et.y-it.y}}return rectToClientRect(rt)}function hasFixedPositionAncestor(tt,et){const nt=getParentNode(tt);return nt===et||!isElement(nt)||isLastTraversableNode(nt)?!1:getComputedStyle$1(nt).position==="fixed"||hasFixedPositionAncestor(nt,et)}function getClippingElementAncestors(tt,et){const nt=et.get(tt);if(nt)return nt;let rt=getOverflowAncestors(tt,[],!1).filter(lt=>isElement(lt)&&getNodeName(lt)!=="body"),it=null;const st=getComputedStyle$1(tt).position==="fixed";let ot=st?getParentNode(tt):tt;for(;isElement(ot)&&!isLastTraversableNode(ot);){const lt=getComputedStyle$1(ot),ut=isContainingBlock(ot);!ut&&lt.position==="fixed"&&(it=null),(st?!ut&&!it:!ut&&lt.position==="static"&&!!it&&["absolute","fixed"].includes(it.position)||isOverflowElement(ot)&&!ut&&hasFixedPositionAncestor(tt,ot))?rt=rt.filter(dt=>dt!==ot):it=lt,ot=getParentNode(ot)}return et.set(tt,rt),rt}function getClippingRect(tt){let{element:et,boundary:nt,rootBoundary:rt,strategy:it}=tt;const ot=[...nt==="clippingAncestors"?getClippingElementAncestors(et,this._c):[].concat(nt),rt],lt=ot[0],ut=ot.reduce((ct,dt)=>{const ft=getClientRectFromClippingAncestor(et,dt,it);return ct.top=max(ft.top,ct.top),ct.right=min(ft.right,ct.right),ct.bottom=min(ft.bottom,ct.bottom),ct.left=max(ft.left,ct.left),ct},getClientRectFromClippingAncestor(et,lt,it));return{width:ut.right-ut.left,height:ut.bottom-ut.top,x:ut.left,y:ut.top}}function getDimensions(tt){const{width:et,height:nt}=getCssDimensions(tt);return{width:et,height:nt}}function getRectRelativeToOffsetParent(tt,et,nt){const rt=isHTMLElement(et),it=getDocumentElement(et),st=nt==="fixed",ot=getBoundingClientRect(tt,!0,st,et);let lt={scrollLeft:0,scrollTop:0};const ut=createCoords(0);if(rt||!rt&&!st)if((getNodeName(et)!=="body"||isOverflowElement(it))&&(lt=getNodeScroll(et)),rt){const ft=getBoundingClientRect(et,!0,st,et);ut.x=ft.x+et.clientLeft,ut.y=ft.y+et.clientTop}else it&&(ut.x=getWindowScrollBarX(it));const ct=ot.left+lt.scrollLeft-ut.x,dt=ot.top+lt.scrollTop-ut.y;return{x:ct,y:dt,width:ot.width,height:ot.height}}function getTrueOffsetParent(tt,et){return!isHTMLElement(tt)||getComputedStyle$1(tt).position==="fixed"?null:et?et(tt):tt.offsetParent}function getOffsetParent(tt,et){const nt=getWindow(tt);if(!isHTMLElement(tt)||isTopLayer(tt))return nt;let rt=getTrueOffsetParent(tt,et);for(;rt&&isTableElement(rt)&&getComputedStyle$1(rt).position==="static";)rt=getTrueOffsetParent(rt,et);return rt&&(getNodeName(rt)==="html"||getNodeName(rt)==="body"&&getComputedStyle$1(rt).position==="static"&&!isContainingBlock(rt))?nt:rt||getContainingBlock(tt)||nt}const getElementRects=async function(tt){const et=this.getOffsetParent||getOffsetParent,nt=this.getDimensions;return{reference:getRectRelativeToOffsetParent(tt.reference,await et(tt.floating),tt.strategy),floating:{x:0,y:0,...await nt(tt.floating)}}};function isRTL(tt){return getComputedStyle$1(tt).direction==="rtl"}const platform={convertOffsetParentRelativeRectToViewportRelativeRect,getDocumentElement,getClippingRect,getOffsetParent,getElementRects,getClientRects,getDimensions,getScale,isElement,isRTL};function observeMove(tt,et){let nt=null,rt;const it=getDocumentElement(tt);function st(){var lt;clearTimeout(rt),(lt=nt)==null||lt.disconnect(),nt=null}function ot(lt,ut){lt===void 0&&(lt=!1),ut===void 0&&(ut=1),st();const{left:ct,top:dt,width:ft,height:pt}=tt.getBoundingClientRect();if(lt||et(),!ft||!pt)return;const gt=floor(dt),_r=floor(it.clientWidth-(ct+ft)),Yr=floor(it.clientHeight-(dt+pt)),mt=floor(ct),Xr={rootMargin:-gt+"px "+-_r+"px "+-Yr+"px "+-mt+"px",threshold:max(0,min(1,ut))||1};let Zr=!0;function Qr(_i){const rs=_i[0].intersectionRatio;if(rs!==ut){if(!Zr)return ot();rs?ot(!1,rs):rt=setTimeout(()=>{ot(!1,1e-7)},100)}Zr=!1}try{nt=new IntersectionObserver(Qr,{...Xr,root:it.ownerDocument})}catch{nt=new IntersectionObserver(Qr,Xr)}nt.observe(tt)}return ot(!0),st}function autoUpdate(tt,et,nt,rt){rt===void 0&&(rt={});const{ancestorScroll:it=!0,ancestorResize:st=!0,elementResize:ot=typeof ResizeObserver=="function",layoutShift:lt=typeof IntersectionObserver=="function",animationFrame:ut=!1}=rt,ct=unwrapElement(tt),dt=it||st?[...ct?getOverflowAncestors(ct):[],...getOverflowAncestors(et)]:[];dt.forEach(Kr=>{it&&Kr.addEventListener("scroll",nt,{passive:!0}),st&&Kr.addEventListener("resize",nt)});const ft=ct&&lt?observeMove(ct,nt):null;let pt=-1,gt=null;ot&&(gt=new ResizeObserver(Kr=>{let[Xr]=Kr;Xr&&Xr.target===ct&&gt&&(gt.unobserve(et),cancelAnimationFrame(pt),pt=requestAnimationFrame(()=>{var Zr;(Zr=gt)==null||Zr.observe(et)})),nt()}),ct&&!ut&&gt.observe(ct),gt.observe(et));let _r,Yr=ut?getBoundingClientRect(tt):null;ut&&mt();function mt(){const Kr=getBoundingClientRect(tt);Yr&&(Kr.x!==Yr.x||Kr.y!==Yr.y||Kr.width!==Yr.width||Kr.height!==Yr.height)&&nt(),Yr=Kr,_r=requestAnimationFrame(mt)}return nt(),()=>{var Kr;dt.forEach(Xr=>{it&&Xr.removeEventListener("scroll",nt),st&&Xr.removeEventListener("resize",nt)}),ft==null||ft(),(Kr=gt)==null||Kr.disconnect(),gt=null,ut&&cancelAnimationFrame(_r)}}const shift=shift$1,flip=flip$1,size=size$1,hide=hide$1,arrow$1=arrow$2,limitShift=limitShift$1,computePosition=(tt,et,nt)=>{const rt=new Map,it={platform,...nt},st={...it.platform,_c:rt};return computePosition$1(tt,et,{...it,platform:st})},arrow=tt=>{function et(nt){return{}.hasOwnProperty.call(nt,"current")}return{name:"arrow",options:tt,fn(nt){const{element:rt,padding:it}=typeof tt=="function"?tt(nt):tt;return rt&&et(rt)?rt.current!=null?arrow$1({element:rt.current,padding:it}).fn(nt):{}:rt?arrow$1({element:rt,padding:it}).fn(nt):{}}}};var index=typeof document<"u"?A$3:_$1;function deepEqual(tt,et){if(tt===et)return!0;if(typeof tt!=typeof et)return!1;if(typeof tt=="function"&&tt.toString()===et.toString())return!0;let nt,rt,it;if(tt&&et&&typeof tt=="object"){if(Array.isArray(tt)){if(nt=tt.length,nt!==et.length)return!1;for(rt=nt;rt--!==0;)if(!deepEqual(tt[rt],et[rt]))return!1;return!0}if(it=Object.keys(tt),nt=it.length,nt!==Object.keys(et).length)return!1;for(rt=nt;rt--!==0;)if(!{}.hasOwnProperty.call(et,it[rt]))return!1;for(rt=nt;rt--!==0;){const st=it[rt];if(!(st==="_owner"&&tt.$$typeof)&&!deepEqual(tt[st],et[st]))return!1}return!0}return tt!==tt&&et!==et}function getDPR(tt){return typeof window>"u"?1:(tt.ownerDocument.defaultView||window).devicePixelRatio||1}function roundByDPR(tt,et){const nt=getDPR(tt);return Math.round(et*nt)/nt}function useLatestRef(tt){const et=F$2(tt);return index(()=>{et.current=tt}),et}function useFloating(tt){tt===void 0&&(tt={});const{placement:et="bottom",strategy:nt="absolute",middleware:rt=[],platform:it,elements:{reference:st,floating:ot}={},transform:lt=!0,whileElementsMounted:ut,open:ct}=tt,[dt,ft]=p$3({x:0,y:0,strategy:nt,placement:et,middlewareData:{},isPositioned:!1}),[pt,gt]=p$3(rt);deepEqual(pt,rt)||gt(rt);const[_r,Yr]=p$3(null),[mt,Kr]=p$3(null),Xr=x$3(us=>{us!==rs.current&&(rs.current=us,Yr(us))},[]),Zr=x$3(us=>{us!==ns.current&&(ns.current=us,Kr(us))},[]),Qr=st||_r,_i=ot||mt,rs=F$2(null),ns=F$2(null),ss=F$2(dt),fs=ut!=null,os=useLatestRef(ut),is=useLatestRef(it),cs=x$3(()=>{if(!rs.current||!ns.current)return;const us={placement:et,strategy:nt,middleware:pt};is.current&&(us.platform=is.current),computePosition(rs.current,ns.current,us).then(ms=>{const ys={...ms,isPositioned:!0};ps.current&&!deepEqual(ss.current,ys)&&(ss.current=ys,reactDomExports.flushSync(()=>{ft(ys)}))})},[pt,et,nt,is]);index(()=>{ct===!1&&ss.current.isPositioned&&(ss.current.isPositioned=!1,ft(us=>({...us,isPositioned:!1})))},[ct]);const ps=F$2(!1);index(()=>(ps.current=!0,()=>{ps.current=!1}),[]),index(()=>{if(Qr&&(rs.current=Qr),_i&&(ns.current=_i),Qr&&_i){if(os.current)return os.current(Qr,_i,cs);cs()}},[Qr,_i,cs,os,fs]);const vs=q$2(()=>({reference:rs,floating:ns,setReference:Xr,setFloating:Zr}),[Xr,Zr]),ls=q$2(()=>({reference:Qr,floating:_i}),[Qr,_i]),gs=q$2(()=>{const us={position:nt,left:0,top:0};if(!ls.floating)return us;const ms=roundByDPR(ls.floating,dt.x),ys=roundByDPR(ls.floating,dt.y);return lt?{...us,transform:"translate("+ms+"px, "+ys+"px)",...getDPR(ls.floating)>=1.5&&{willChange:"transform"}}:{position:nt,left:ms,top:ys}},[nt,lt,ls.floating,dt.x,dt.y]);return q$2(()=>({...dt,update:cs,refs:vs,elements:ls,floatingStyles:gs}),[dt,cs,vs,ls,gs])}const $7e8f5cd07187803e$export$21b07c8f274aebd5=N$3((tt,et)=>{const{children:nt,width:rt=10,height:it=5,...st}=tt;return y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.svg,_extends$1({},st,{ref:et,width:rt,height:it,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),tt.asChild?nt:y$3("polygon",{points:"0,0 30,0 15,10"}))}),$7e8f5cd07187803e$export$be92b6f5f03c0fe9=$7e8f5cd07187803e$export$21b07c8f274aebd5,$cf1ac5d9fe0e8206$var$POPPER_NAME="Popper",[$cf1ac5d9fe0e8206$var$createPopperContext,$cf1ac5d9fe0e8206$export$722aac194ae923]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($cf1ac5d9fe0e8206$var$POPPER_NAME),[$cf1ac5d9fe0e8206$var$PopperProvider,$cf1ac5d9fe0e8206$var$usePopperContext]=$cf1ac5d9fe0e8206$var$createPopperContext($cf1ac5d9fe0e8206$var$POPPER_NAME),$cf1ac5d9fe0e8206$export$badac9ada3a0bdf9=tt=>{const{__scopePopper:et,children:nt}=tt,[rt,it]=p$3(null);return y$3($cf1ac5d9fe0e8206$var$PopperProvider,{scope:et,anchor:rt,onAnchorChange:it},nt)},$cf1ac5d9fe0e8206$var$ANCHOR_NAME="PopperAnchor",$cf1ac5d9fe0e8206$export$ecd4e1ccab6ed6d=N$3((tt,et)=>{const{__scopePopper:nt,virtualRef:rt,...it}=tt,st=$cf1ac5d9fe0e8206$var$usePopperContext($cf1ac5d9fe0e8206$var$ANCHOR_NAME,nt),ot=F$2(null),lt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,ot);return _$1(()=>{st.onAnchorChange((rt==null?void 0:rt.current)||ot.current)}),rt?null:y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},it,{ref:lt}))}),$cf1ac5d9fe0e8206$var$CONTENT_NAME="PopperContent",[$cf1ac5d9fe0e8206$var$PopperContentProvider,$cf1ac5d9fe0e8206$var$useContentContext]=$cf1ac5d9fe0e8206$var$createPopperContext($cf1ac5d9fe0e8206$var$CONTENT_NAME),$cf1ac5d9fe0e8206$export$bc4ae5855d3c4fc=N$3((tt,et)=>{var nt,rt,it,st,ot,lt,ut,ct;const{__scopePopper:dt,side:ft="bottom",sideOffset:pt=0,align:gt="center",alignOffset:_r=0,arrowPadding:Yr=0,avoidCollisions:mt=!0,collisionBoundary:Kr=[],collisionPadding:Xr=0,sticky:Zr="partial",hideWhenDetached:Qr=!1,updatePositionStrategy:_i="optimized",onPlaced:rs,...ns}=tt,ss=$cf1ac5d9fe0e8206$var$usePopperContext($cf1ac5d9fe0e8206$var$CONTENT_NAME,dt),[fs,os]=p$3(null),is=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,bs=>os(bs)),[cs,ps]=p$3(null),vs=$db6c3485150b8e66$export$1ab7ae714698c4b8(cs),ls=(nt=vs==null?void 0:vs.width)!==null&&nt!==void 0?nt:0,gs=(rt=vs==null?void 0:vs.height)!==null&&rt!==void 0?rt:0,us=ft+(gt!=="center"?"-"+gt:""),ms=typeof Xr=="number"?Xr:{top:0,right:0,bottom:0,left:0,...Xr},ys=Array.isArray(Kr)?Kr:[Kr],Es=ys.length>0,Ts={padding:ms,boundary:ys.filter($cf1ac5d9fe0e8206$var$isNotNull),altBoundary:Es},{refs:Ss,floatingStyles:Ds,placement:Cs,isPositioned:Is,middlewareData:ks}=useFloating({strategy:"fixed",placement:us,whileElementsMounted:(...bs)=>autoUpdate(...bs,{animationFrame:_i==="always"}),elements:{reference:ss.anchor},middleware:[offset({mainAxis:pt+gs,alignmentAxis:_r}),mt&&shift({mainAxis:!0,crossAxis:!1,limiter:Zr==="partial"?limitShift():void 0,...Ts}),mt&&flip({...Ts}),size({...Ts,apply:({elements:bs,rects:xs,availableWidth:ws,availableHeight:Bs})=>{const{width:Ps,height:qs}=xs.reference,Ks=bs.floating.style;Ks.setProperty("--radix-popper-available-width",`${ws}px`),Ks.setProperty("--radix-popper-available-height",`${Bs}px`),Ks.setProperty("--radix-popper-anchor-width",`${Ps}px`),Ks.setProperty("--radix-popper-anchor-height",`${qs}px`)}}),cs&&arrow({element:cs,padding:Yr}),$cf1ac5d9fe0e8206$var$transformOrigin({arrowWidth:ls,arrowHeight:gs}),Qr&&hide({strategy:"referenceHidden",...Ts})]}),[_s,Os]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(Cs),Ys=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(rs);$9f79659886946c16$export$e5c5a5f917a5871c(()=>{Is&&(Ys==null||Ys())},[Is,Ys]);const Vs=(it=ks.arrow)===null||it===void 0?void 0:it.x,js=(st=ks.arrow)===null||st===void 0?void 0:st.y,Ws=((ot=ks.arrow)===null||ot===void 0?void 0:ot.centerOffset)!==0,[Jr,as]=p$3();return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{fs&&as(window.getComputedStyle(fs).zIndex)},[fs]),y$3("div",{ref:Ss.setFloating,"data-radix-popper-content-wrapper":"",style:{...Ds,transform:Is?Ds.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Jr,"--radix-popper-transform-origin":[(lt=ks.transformOrigin)===null||lt===void 0?void 0:lt.x,(ut=ks.transformOrigin)===null||ut===void 0?void 0:ut.y].join(" ")},dir:tt.dir},y$3($cf1ac5d9fe0e8206$var$PopperContentProvider,{scope:dt,placedSide:_s,onArrowChange:ps,arrowX:Vs,arrowY:js,shouldHideArrow:Ws},y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-side":_s,"data-align":Os},ns,{ref:is,style:{...ns.style,animation:Is?void 0:"none",opacity:(ct=ks.hide)!==null&&ct!==void 0&&ct.referenceHidden?0:void 0}}))))}),$cf1ac5d9fe0e8206$var$ARROW_NAME="PopperArrow",$cf1ac5d9fe0e8206$var$OPPOSITE_SIDE={top:"bottom",right:"left",bottom:"top",left:"right"},$cf1ac5d9fe0e8206$export$79d62cd4e10a3fd0=N$3(function(et,nt){const{__scopePopper:rt,...it}=et,st=$cf1ac5d9fe0e8206$var$useContentContext($cf1ac5d9fe0e8206$var$ARROW_NAME,rt),ot=$cf1ac5d9fe0e8206$var$OPPOSITE_SIDE[st.placedSide];return y$3("span",{ref:st.onArrowChange,style:{position:"absolute",left:st.arrowX,top:st.arrowY,[ot]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[st.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[st.placedSide],visibility:st.shouldHideArrow?"hidden":void 0}},y$3($7e8f5cd07187803e$export$be92b6f5f03c0fe9,_extends$1({},it,{ref:nt,style:{...it.style,display:"block"}})))});function $cf1ac5d9fe0e8206$var$isNotNull(tt){return tt!==null}const $cf1ac5d9fe0e8206$var$transformOrigin=tt=>({name:"transformOrigin",options:tt,fn(et){var nt,rt,it,st,ot;const{placement:lt,rects:ut,middlewareData:ct}=et,ft=((nt=ct.arrow)===null||nt===void 0?void 0:nt.centerOffset)!==0,pt=ft?0:tt.arrowWidth,gt=ft?0:tt.arrowHeight,[_r,Yr]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(lt),mt={start:"0%",center:"50%",end:"100%"}[Yr],Kr=((rt=(it=ct.arrow)===null||it===void 0?void 0:it.x)!==null&&rt!==void 0?rt:0)+pt/2,Xr=((st=(ot=ct.arrow)===null||ot===void 0?void 0:ot.y)!==null&&st!==void 0?st:0)+gt/2;let Zr="",Qr="";return _r==="bottom"?(Zr=ft?mt:`${Kr}px`,Qr=`${-gt}px`):_r==="top"?(Zr=ft?mt:`${Kr}px`,Qr=`${ut.floating.height+gt}px`):_r==="right"?(Zr=`${-gt}px`,Qr=ft?mt:`${Xr}px`):_r==="left"&&(Zr=`${ut.floating.width+gt}px`,Qr=ft?mt:`${Xr}px`),{data:{x:Zr,y:Qr}}}});function $cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(tt){const[et,nt="center"]=tt.split("-");return[et,nt]}const $cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9=$cf1ac5d9fe0e8206$export$badac9ada3a0bdf9,$cf1ac5d9fe0e8206$export$b688253958b8dfe7=$cf1ac5d9fe0e8206$export$ecd4e1ccab6ed6d,$cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2=$cf1ac5d9fe0e8206$export$bc4ae5855d3c4fc,$cf1ac5d9fe0e8206$export$21b07c8f274aebd5=$cf1ac5d9fe0e8206$export$79d62cd4e10a3fd0,$f1701beae083dbae$export$602eac185826482c=N$3((tt,et)=>{var nt;const{container:rt=globalThis==null||(nt=globalThis.document)===null||nt===void 0?void 0:nt.body,...it}=tt;return rt?$7SXl2$reactdom.createPortal(y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},it,{ref:et})),rt):null});var getDefaultParent=function(tt){if(typeof document>"u")return null;var et=Array.isArray(tt)?tt[0]:tt;return et.ownerDocument.body},counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={},lockCount=0,unwrapHost=function(tt){return tt&&(tt.host||unwrapHost(tt.parentNode))},correctTargets=function(tt,et){return et.map(function(nt){if(tt.contains(nt))return nt;var rt=unwrapHost(nt);return rt&&tt.contains(rt)?rt:(console.error("aria-hidden",nt,"in not contained inside",tt,". Doing nothing"),null)}).filter(function(nt){return!!nt})},applyAttributeToOthers=function(tt,et,nt,rt){var it=correctTargets(et,Array.isArray(tt)?tt:[tt]);markerMap[nt]||(markerMap[nt]=new WeakMap);var st=markerMap[nt],ot=[],lt=new Set,ut=new Set(it),ct=function(ft){!ft||lt.has(ft)||(lt.add(ft),ct(ft.parentNode))};it.forEach(ct);var dt=function(ft){!ft||ut.has(ft)||Array.prototype.forEach.call(ft.children,function(pt){if(lt.has(pt))dt(pt);else{var gt=pt.getAttribute(rt),_r=gt!==null&&gt!=="false",Yr=(counterMap.get(pt)||0)+1,mt=(st.get(pt)||0)+1;counterMap.set(pt,Yr),st.set(pt,mt),ot.push(pt),Yr===1&&_r&&uncontrolledNodes.set(pt,!0),mt===1&&pt.setAttribute(nt,"true"),_r||pt.setAttribute(rt,"true")}})};return dt(et),lt.clear(),lockCount++,function(){ot.forEach(function(ft){var pt=counterMap.get(ft)-1,gt=st.get(ft)-1;counterMap.set(ft,pt),st.set(ft,gt),pt||(uncontrolledNodes.has(ft)||ft.removeAttribute(rt),uncontrolledNodes.delete(ft)),gt||ft.removeAttribute(nt)}),lockCount--,lockCount||(counterMap=new WeakMap,counterMap=new WeakMap,uncontrolledNodes=new WeakMap,markerMap={})}},hideOthers=function(tt,et,nt){nt===void 0&&(nt="data-aria-hidden");var rt=Array.from(Array.isArray(tt)?tt:[tt]),it=et||getDefaultParent(tt);return it?(rt.push.apply(rt,Array.from(it.querySelectorAll("[aria-live]"))),applyAttributeToOthers(rt,it,nt,"aria-hidden")):function(){return null}},__assign=function(){return __assign=Object.assign||function(et){for(var nt,rt=1,it=arguments.length;rt<it;rt++){nt=arguments[rt];for(var st in nt)Object.prototype.hasOwnProperty.call(nt,st)&&(et[st]=nt[st])}return et},__assign.apply(this,arguments)};function __rest(tt,et){var nt={};for(var rt in tt)Object.prototype.hasOwnProperty.call(tt,rt)&&et.indexOf(rt)<0&&(nt[rt]=tt[rt]);if(tt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var it=0,rt=Object.getOwnPropertySymbols(tt);it<rt.length;it++)et.indexOf(rt[it])<0&&Object.prototype.propertyIsEnumerable.call(tt,rt[it])&&(nt[rt[it]]=tt[rt[it]]);return nt}function __spreadArray(tt,et,nt){if(nt||arguments.length===2)for(var rt=0,it=et.length,st;rt<it;rt++)(st||!(rt in et))&&(st||(st=Array.prototype.slice.call(et,0,rt)),st[rt]=et[rt]);return tt.concat(st||Array.prototype.slice.call(et))}typeof SuppressedError=="function"&&SuppressedError;var zeroRightClassName="right-scroll-bar-position",fullWidthClassName="width-before-scroll-bar",noScrollbarsClassName="with-scroll-bars-hidden",removedBarSizeVariable="--removed-body-scroll-bar-size";function assignRef(tt,et){return typeof tt=="function"?tt(et):tt&&(tt.current=et),tt}function useCallbackRef(tt,et){var nt=p$3(function(){return{value:tt,callback:et,facade:{get current(){return nt.value},set current(rt){var it=nt.value;it!==rt&&(nt.value=rt,nt.callback(rt,it))}}}})[0];return nt.callback=et,nt.facade}var currentValues=new WeakMap;function useMergeRefs(tt,et){var nt=useCallbackRef(et||null,function(rt){return tt.forEach(function(it){return assignRef(it,rt)})});return A$3(function(){var rt=currentValues.get(nt);if(rt){var it=new Set(rt),st=new Set(tt),ot=nt.current;it.forEach(function(lt){st.has(lt)||assignRef(lt,null)}),st.forEach(function(lt){it.has(lt)||assignRef(lt,ot)})}currentValues.set(nt,tt)},[tt]),nt}function ItoI(tt){return tt}function innerCreateMedium(tt,et){et===void 0&&(et=ItoI);var nt=[],rt=!1,it={read:function(){if(rt)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return nt.length?nt[nt.length-1]:tt},useMedium:function(st){var ot=et(st,rt);return nt.push(ot),function(){nt=nt.filter(function(lt){return lt!==ot})}},assignSyncMedium:function(st){for(rt=!0;nt.length;){var ot=nt;nt=[],ot.forEach(st)}nt={push:function(lt){return st(lt)},filter:function(){return nt}}},assignMedium:function(st){rt=!0;var ot=[];if(nt.length){var lt=nt;nt=[],lt.forEach(st),ot=nt}var ut=function(){var dt=ot;ot=[],dt.forEach(st)},ct=function(){return Promise.resolve().then(ut)};ct(),nt={push:function(dt){ot.push(dt),ct()},filter:function(dt){return ot=ot.filter(dt),nt}}}};return it}function createSidecarMedium(tt){tt===void 0&&(tt={});var et=innerCreateMedium(null);return et.options=__assign({async:!0,ssr:!1},tt),et}var SideCar$1=function(tt){var et=tt.sideCar,nt=__rest(tt,["sideCar"]);if(!et)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var rt=et.read();if(!rt)throw new Error("Sidecar medium not found");return y$3(rt,__assign({},nt))};SideCar$1.isSideCarExport=!0;function exportSidecar(tt,et){return tt.useMedium(et),SideCar$1}var effectCar=createSidecarMedium(),nothing=function(){},RemoveScroll=N$3(function(tt,et){var nt=F$2(null),rt=p$3({onScrollCapture:nothing,onWheelCapture:nothing,onTouchMoveCapture:nothing}),it=rt[0],st=rt[1],ot=tt.forwardProps,lt=tt.children,ut=tt.className,ct=tt.removeScrollBar,dt=tt.enabled,ft=tt.shards,pt=tt.sideCar,gt=tt.noIsolation,_r=tt.inert,Yr=tt.allowPinchZoom,mt=tt.as,Kr=mt===void 0?"div":mt,Xr=__rest(tt,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),Zr=pt,Qr=useMergeRefs([nt,et]),_i=__assign(__assign({},Xr),it);return y$3(g$3,null,dt&&y$3(Zr,{sideCar:effectCar,removeScrollBar:ct,shards:ft,noIsolation:gt,inert:_r,setCallbacks:st,allowPinchZoom:!!Yr,lockRef:nt}),ot?sn$1(A$2.only(lt),__assign(__assign({},_i),{ref:Qr})):y$3(Kr,__assign({},_i,{className:ut,ref:Qr}),lt))});RemoveScroll.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},RemoveScroll.classNames={fullWidth:fullWidthClassName,zeroRight:zeroRightClassName};var getNonce=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function makeStyleTag(){if(!document)return null;var tt=document.createElement("style");tt.type="text/css";var et=getNonce();return et&&tt.setAttribute("nonce",et),tt}function injectStyles(tt,et){tt.styleSheet?tt.styleSheet.cssText=et:tt.appendChild(document.createTextNode(et))}function insertStyleTag(tt){var et=document.head||document.getElementsByTagName("head")[0];et.appendChild(tt)}var stylesheetSingleton=function(){var tt=0,et=null;return{add:function(nt){tt==0&&(et=makeStyleTag())&&(injectStyles(et,nt),insertStyleTag(et)),tt++},remove:function(){tt--,!tt&&et&&(et.parentNode&&et.parentNode.removeChild(et),et=null)}}},styleHookSingleton=function(){var tt=stylesheetSingleton();return function(et,nt){_$1(function(){return tt.add(et),function(){tt.remove()}},[et&&nt])}},styleSingleton=function(){var tt=styleHookSingleton(),et=function(nt){var rt=nt.styles,it=nt.dynamic;return tt(rt,it),null};return et},zeroGap={left:0,top:0,right:0,gap:0},parse=function(tt){return parseInt(tt||"",10)||0},getOffset=function(tt){var et=window.getComputedStyle(document.body),nt=et[tt==="padding"?"paddingLeft":"marginLeft"],rt=et[tt==="padding"?"paddingTop":"marginTop"],it=et[tt==="padding"?"paddingRight":"marginRight"];return[parse(nt),parse(rt),parse(it)]},getGapWidth=function(tt){if(tt===void 0&&(tt="margin"),typeof window>"u")return zeroGap;var et=getOffset(tt),nt=document.documentElement.clientWidth,rt=window.innerWidth;return{left:et[0],top:et[1],right:et[2],gap:Math.max(0,rt-nt+et[2]-et[0])}},Style=styleSingleton(),lockAttribute="data-scroll-locked",getStyles=function(tt,et,nt,rt){var it=tt.left,st=tt.top,ot=tt.right,lt=tt.gap;return nt===void 0&&(nt="margin"),`
  .`.concat(noScrollbarsClassName,` {
   overflow: hidden `).concat(rt,`;
   padding-right: `).concat(lt,"px ").concat(rt,`;
  }
  body[`).concat(lockAttribute,`] {
    overflow: hidden `).concat(rt,`;
    overscroll-behavior: contain;
    `).concat([et&&"position: relative ".concat(rt,";"),nt==="margin"&&`
    padding-left: `.concat(it,`px;
    padding-top: `).concat(st,`px;
    padding-right: `).concat(ot,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(lt,"px ").concat(rt,`;
    `),nt==="padding"&&"padding-right: ".concat(lt,"px ").concat(rt,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(zeroRightClassName,` {
    right: `).concat(lt,"px ").concat(rt,`;
  }
  
  .`).concat(fullWidthClassName,` {
    margin-right: `).concat(lt,"px ").concat(rt,`;
  }
  
  .`).concat(zeroRightClassName," .").concat(zeroRightClassName,` {
    right: 0 `).concat(rt,`;
  }
  
  .`).concat(fullWidthClassName," .").concat(fullWidthClassName,` {
    margin-right: 0 `).concat(rt,`;
  }
  
  body[`).concat(lockAttribute,`] {
    `).concat(removedBarSizeVariable,": ").concat(lt,`px;
  }
`)},RemoveScrollBar=function(tt){var et=tt.noRelative,nt=tt.noImportant,rt=tt.gapMode,it=rt===void 0?"margin":rt,st=q$2(function(){return getGapWidth(it)},[it]);return _$1(function(){return document.body.setAttribute(lockAttribute,""),function(){document.body.removeAttribute(lockAttribute)}},[]),y$3(Style,{styles:getStyles(st,!et,it,nt?"":"!important")})},passiveSupported=!1;if(typeof window<"u")try{var options=Object.defineProperty({},"passive",{get:function(){return passiveSupported=!0,!0}});window.addEventListener("test",options,options),window.removeEventListener("test",options,options)}catch{passiveSupported=!1}var nonPassive=passiveSupported?{passive:!1}:!1,alwaysContainsScroll=function(tt){return tt.tagName==="TEXTAREA"},elementCanBeScrolled=function(tt,et){var nt=window.getComputedStyle(tt);return nt[et]!=="hidden"&&!(nt.overflowY===nt.overflowX&&!alwaysContainsScroll(tt)&&nt[et]==="visible")},elementCouldBeVScrolled=function(tt){return elementCanBeScrolled(tt,"overflowY")},elementCouldBeHScrolled=function(tt){return elementCanBeScrolled(tt,"overflowX")},locationCouldBeScrolled=function(tt,et){var nt=et;do{typeof ShadowRoot<"u"&&nt instanceof ShadowRoot&&(nt=nt.host);var rt=elementCouldBeScrolled(tt,nt);if(rt){var it=getScrollVariables(tt,nt),st=it[1],ot=it[2];if(st>ot)return!0}nt=nt.parentNode}while(nt&&nt!==document.body);return!1},getVScrollVariables=function(tt){var et=tt.scrollTop,nt=tt.scrollHeight,rt=tt.clientHeight;return[et,nt,rt]},getHScrollVariables=function(tt){var et=tt.scrollLeft,nt=tt.scrollWidth,rt=tt.clientWidth;return[et,nt,rt]},elementCouldBeScrolled=function(tt,et){return tt==="v"?elementCouldBeVScrolled(et):elementCouldBeHScrolled(et)},getScrollVariables=function(tt,et){return tt==="v"?getVScrollVariables(et):getHScrollVariables(et)},getDirectionFactor=function(tt,et){return tt==="h"&&et==="rtl"?-1:1},handleScroll=function(tt,et,nt,rt,it){var st=getDirectionFactor(tt,window.getComputedStyle(et).direction),ot=st*rt,lt=nt.target,ut=et.contains(lt),ct=!1,dt=ot>0,ft=0,pt=0;do{var gt=getScrollVariables(tt,lt),_r=gt[0],Yr=gt[1],mt=gt[2],Kr=Yr-mt-st*_r;(_r||Kr)&&elementCouldBeScrolled(tt,lt)&&(ft+=Kr,pt+=_r),lt=lt.parentNode}while(!ut&&lt!==document.body||ut&&(et.contains(lt)||et===lt));return(dt&&(it&&ft===0||!it&&ot>ft)||!dt&&(it&&pt===0||!it&&-ot>pt))&&(ct=!0),ct},getTouchXY=function(tt){return"changedTouches"in tt?[tt.changedTouches[0].clientX,tt.changedTouches[0].clientY]:[0,0]},getDeltaXY=function(tt){return[tt.deltaX,tt.deltaY]},extractRef=function(tt){return tt&&"current"in tt?tt.current:tt},deltaCompare=function(tt,et){return tt[0]===et[0]&&tt[1]===et[1]},generateStyle=function(tt){return`
  .block-interactivity-`.concat(tt,` {pointer-events: none;}
  .allow-interactivity-`).concat(tt,` {pointer-events: all;}
`)},idCounter=0,lockStack=[];function RemoveScrollSideCar(tt){var et=F$2([]),nt=F$2([0,0]),rt=F$2(),it=p$3(idCounter++)[0],st=p$3(function(){return styleSingleton()})[0],ot=F$2(tt);_$1(function(){ot.current=tt},[tt]),_$1(function(){if(tt.inert){document.body.classList.add("block-interactivity-".concat(it));var Yr=__spreadArray([tt.lockRef.current],(tt.shards||[]).map(extractRef),!0).filter(Boolean);return Yr.forEach(function(mt){return mt.classList.add("allow-interactivity-".concat(it))}),function(){document.body.classList.remove("block-interactivity-".concat(it)),Yr.forEach(function(mt){return mt.classList.remove("allow-interactivity-".concat(it))})}}},[tt.inert,tt.lockRef.current,tt.shards]);var lt=x$3(function(Yr,mt){if("touches"in Yr&&Yr.touches.length===2)return!ot.current.allowPinchZoom;var Kr=getTouchXY(Yr),Xr=nt.current,Zr="deltaX"in Yr?Yr.deltaX:Xr[0]-Kr[0],Qr="deltaY"in Yr?Yr.deltaY:Xr[1]-Kr[1],_i,rs=Yr.target,ns=Math.abs(Zr)>Math.abs(Qr)?"h":"v";if("touches"in Yr&&ns==="h"&&rs.type==="range")return!1;var ss=locationCouldBeScrolled(ns,rs);if(!ss)return!0;if(ss?_i=ns:(_i=ns==="v"?"h":"v",ss=locationCouldBeScrolled(ns,rs)),!ss)return!1;if(!rt.current&&"changedTouches"in Yr&&(Zr||Qr)&&(rt.current=_i),!_i)return!0;var fs=rt.current||_i;return handleScroll(fs,mt,Yr,fs==="h"?Zr:Qr,!0)},[]),ut=x$3(function(Yr){var mt=Yr;if(!(!lockStack.length||lockStack[lockStack.length-1]!==st)){var Kr="deltaY"in mt?getDeltaXY(mt):getTouchXY(mt),Xr=et.current.filter(function(_i){return _i.name===mt.type&&_i.target===mt.target&&deltaCompare(_i.delta,Kr)})[0];if(Xr&&Xr.should){mt.cancelable&&mt.preventDefault();return}if(!Xr){var Zr=(ot.current.shards||[]).map(extractRef).filter(Boolean).filter(function(_i){return _i.contains(mt.target)}),Qr=Zr.length>0?lt(mt,Zr[0]):!ot.current.noIsolation;Qr&&mt.cancelable&&mt.preventDefault()}}},[]),ct=x$3(function(Yr,mt,Kr,Xr){var Zr={name:Yr,delta:mt,target:Kr,should:Xr};et.current.push(Zr),setTimeout(function(){et.current=et.current.filter(function(Qr){return Qr!==Zr})},1)},[]),dt=x$3(function(Yr){nt.current=getTouchXY(Yr),rt.current=void 0},[]),ft=x$3(function(Yr){ct(Yr.type,getDeltaXY(Yr),Yr.target,lt(Yr,tt.lockRef.current))},[]),pt=x$3(function(Yr){ct(Yr.type,getTouchXY(Yr),Yr.target,lt(Yr,tt.lockRef.current))},[]);_$1(function(){return lockStack.push(st),tt.setCallbacks({onScrollCapture:ft,onWheelCapture:ft,onTouchMoveCapture:pt}),document.addEventListener("wheel",ut,nonPassive),document.addEventListener("touchmove",ut,nonPassive),document.addEventListener("touchstart",dt,nonPassive),function(){lockStack=lockStack.filter(function(Yr){return Yr!==st}),document.removeEventListener("wheel",ut,nonPassive),document.removeEventListener("touchmove",ut,nonPassive),document.removeEventListener("touchstart",dt,nonPassive)}},[]);var gt=tt.removeScrollBar,_r=tt.inert;return y$3(g$3,null,_r?y$3(st,{styles:generateStyle(it)}):null,gt?y$3(RemoveScrollBar,{gapMode:"margin"}):null)}const SideCar=exportSidecar(effectCar,RemoveScrollSideCar);var ReactRemoveScroll=N$3(function(tt,et){return y$3(RemoveScroll,__assign({},tt,{ref:et,sideCar:SideCar}))});ReactRemoveScroll.classNames=RemoveScroll.classNames;const $01b9c$RemoveScroll=ReactRemoveScroll,$cb5cc270b50c6fcd$var$POPOVER_NAME="Popover",[$cb5cc270b50c6fcd$var$createPopoverContext,$cb5cc270b50c6fcd$export$c8393c9e73286932]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($cb5cc270b50c6fcd$var$POPOVER_NAME,[$cf1ac5d9fe0e8206$export$722aac194ae923]),$cb5cc270b50c6fcd$var$usePopperScope=$cf1ac5d9fe0e8206$export$722aac194ae923(),[$cb5cc270b50c6fcd$var$PopoverProvider,$cb5cc270b50c6fcd$var$usePopoverContext]=$cb5cc270b50c6fcd$var$createPopoverContext($cb5cc270b50c6fcd$var$POPOVER_NAME),$cb5cc270b50c6fcd$export$5b6b19405a83ff9d=tt=>{const{__scopePopover:et,children:nt,open:rt,defaultOpen:it,onOpenChange:st,modal:ot=!1}=tt,lt=$cb5cc270b50c6fcd$var$usePopperScope(et),ut=F$2(null),[ct,dt]=p$3(!1),[ft=!1,pt]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:rt,defaultProp:it,onChange:st});return y$3($cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9,lt,y$3($cb5cc270b50c6fcd$var$PopoverProvider,{scope:et,contentId:$1746a345f3d73bb7$export$f680877a34711e37(),triggerRef:ut,open:ft,onOpenChange:pt,onOpenToggle:x$3(()=>pt(gt=>!gt),[pt]),hasCustomAnchor:ct,onCustomAnchorAdd:x$3(()=>dt(!0),[]),onCustomAnchorRemove:x$3(()=>dt(!1),[]),modal:ot},nt))},$cb5cc270b50c6fcd$var$TRIGGER_NAME="PopoverTrigger",$cb5cc270b50c6fcd$export$7dacb05d26466c3=N$3((tt,et)=>{const{__scopePopover:nt,...rt}=tt,it=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$TRIGGER_NAME,nt),st=$cb5cc270b50c6fcd$var$usePopperScope(nt),ot=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,it.triggerRef),lt=y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button","aria-haspopup":"dialog","aria-expanded":it.open,"aria-controls":it.contentId,"data-state":$cb5cc270b50c6fcd$var$getState(it.open)},rt,{ref:ot,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onClick,it.onOpenToggle)}));return it.hasCustomAnchor?lt:y$3($cf1ac5d9fe0e8206$export$b688253958b8dfe7,_extends$1({asChild:!0},st),lt)}),$cb5cc270b50c6fcd$var$PORTAL_NAME="PopoverPortal",[$cb5cc270b50c6fcd$var$PortalProvider,$cb5cc270b50c6fcd$var$usePortalContext]=$cb5cc270b50c6fcd$var$createPopoverContext($cb5cc270b50c6fcd$var$PORTAL_NAME,{forceMount:void 0}),$cb5cc270b50c6fcd$var$CONTENT_NAME="PopoverContent",$cb5cc270b50c6fcd$export$d7e1f420b25549ff=N$3((tt,et)=>{const nt=$cb5cc270b50c6fcd$var$usePortalContext($cb5cc270b50c6fcd$var$CONTENT_NAME,tt.__scopePopover),{forceMount:rt=nt.forceMount,...it}=tt,st=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,tt.__scopePopover);return y$3($921a889cee6df7e8$export$99c2b779aa4e8b8b,{present:rt||st.open},st.modal?y$3($cb5cc270b50c6fcd$var$PopoverContentModal,_extends$1({},it,{ref:et})):y$3($cb5cc270b50c6fcd$var$PopoverContentNonModal,_extends$1({},it,{ref:et})))}),$cb5cc270b50c6fcd$var$PopoverContentModal=N$3((tt,et)=>{const nt=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,tt.__scopePopover),rt=F$2(null),it=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,rt),st=F$2(!1);return _$1(()=>{const ot=rt.current;if(ot)return hideOthers(ot)},[]),y$3($01b9c$RemoveScroll,{as:$5e63c961fc1ce211$export$8c6ed5c666ac1360,allowPinchZoom:!0},y$3($cb5cc270b50c6fcd$var$PopoverContentImpl,_extends$1({},tt,{ref:it,trapFocus:nt.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onCloseAutoFocus,ot=>{var lt;ot.preventDefault(),st.current||(lt=nt.triggerRef.current)===null||lt===void 0||lt.focus()}),onPointerDownOutside:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onPointerDownOutside,ot=>{const lt=ot.detail.originalEvent,ut=lt.button===0&&lt.ctrlKey===!0,ct=lt.button===2||ut;st.current=ct},{checkForDefaultPrevented:!1}),onFocusOutside:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onFocusOutside,ot=>ot.preventDefault(),{checkForDefaultPrevented:!1})})))}),$cb5cc270b50c6fcd$var$PopoverContentNonModal=N$3((tt,et)=>{const nt=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,tt.__scopePopover),rt=F$2(!1),it=F$2(!1);return y$3($cb5cc270b50c6fcd$var$PopoverContentImpl,_extends$1({},tt,{ref:et,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:st=>{var ot;if((ot=tt.onCloseAutoFocus)===null||ot===void 0||ot.call(tt,st),!st.defaultPrevented){var lt;rt.current||(lt=nt.triggerRef.current)===null||lt===void 0||lt.focus(),st.preventDefault()}rt.current=!1,it.current=!1},onInteractOutside:st=>{var ot,lt;(ot=tt.onInteractOutside)===null||ot===void 0||ot.call(tt,st),st.defaultPrevented||(rt.current=!0,st.detail.originalEvent.type==="pointerdown"&&(it.current=!0));const ut=st.target;((lt=nt.triggerRef.current)===null||lt===void 0?void 0:lt.contains(ut))&&st.preventDefault(),st.detail.originalEvent.type==="focusin"&&it.current&&st.preventDefault()}}))}),$cb5cc270b50c6fcd$var$PopoverContentImpl=N$3((tt,et)=>{const{__scopePopover:nt,trapFocus:rt,onOpenAutoFocus:it,onCloseAutoFocus:st,disableOutsidePointerEvents:ot,onEscapeKeyDown:lt,onPointerDownOutside:ut,onFocusOutside:ct,onInteractOutside:dt,...ft}=tt,pt=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CONTENT_NAME,nt),gt=$cb5cc270b50c6fcd$var$usePopperScope(nt);return $3db38b7d1fb3fe6a$export$b7ece24a22aeda8c(),y$3($d3863c46a17e8a28$export$20e40289641fbbb6,{asChild:!0,loop:!0,trapped:rt,onMountAutoFocus:it,onUnmountAutoFocus:st},y$3($5cb92bef7577960e$export$177fb62ff3ec1f22,{asChild:!0,disableOutsidePointerEvents:ot,onInteractOutside:dt,onEscapeKeyDown:lt,onPointerDownOutside:ut,onFocusOutside:ct,onDismiss:()=>pt.onOpenChange(!1)},y$3($cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2,_extends$1({"data-state":$cb5cc270b50c6fcd$var$getState(pt.open),role:"dialog",id:pt.contentId},gt,ft,{ref:et,style:{...ft.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}}))))}),$cb5cc270b50c6fcd$var$CLOSE_NAME="PopoverClose",$cb5cc270b50c6fcd$export$d6ac43ebaa40d53e=N$3((tt,et)=>{const{__scopePopover:nt,...rt}=tt,it=$cb5cc270b50c6fcd$var$usePopoverContext($cb5cc270b50c6fcd$var$CLOSE_NAME,nt);return y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button"},rt,{ref:et,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onClick,()=>it.onOpenChange(!1))}))}),$cb5cc270b50c6fcd$export$3152841115e061b2=N$3((tt,et)=>{const{__scopePopover:nt,...rt}=tt,it=$cb5cc270b50c6fcd$var$usePopperScope(nt);return y$3($cf1ac5d9fe0e8206$export$21b07c8f274aebd5,_extends$1({},it,rt,{ref:et}))});function $cb5cc270b50c6fcd$var$getState(tt){return tt?"open":"closed"}const $cb5cc270b50c6fcd$export$be92b6f5f03c0fe9=$cb5cc270b50c6fcd$export$5b6b19405a83ff9d,$cb5cc270b50c6fcd$export$41fb9f06171c75f4=$cb5cc270b50c6fcd$export$7dacb05d26466c3,$cb5cc270b50c6fcd$export$7c6e2c02157bb7d2=$cb5cc270b50c6fcd$export$d7e1f420b25549ff,$cb5cc270b50c6fcd$export$f39c2d165cd861fe=$cb5cc270b50c6fcd$export$d6ac43ebaa40d53e,$cb5cc270b50c6fcd$export$21b07c8f274aebd5=$cb5cc270b50c6fcd$export$3152841115e061b2;function $ae6933e535247d3d$export$7d15b64cf5a3a4c4(tt,[et,nt]){return Math.min(nt,Math.max(et,tt))}const $ea1ef594cf570d83$export$439d29a4e110a164=N$3((tt,et)=>y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({},tt,{ref:et,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...tt.style}}))),$cc7e05a45900e73f$var$OPEN_KEYS=[" ","Enter","ArrowUp","ArrowDown"],$cc7e05a45900e73f$var$SELECTION_KEYS=[" ","Enter"],$cc7e05a45900e73f$var$SELECT_NAME="Select",[$cc7e05a45900e73f$var$Collection,$cc7e05a45900e73f$var$useCollection,$cc7e05a45900e73f$var$createCollectionScope]=$e02a7d9cb1dc128c$export$c74125a8e3af6bb2($cc7e05a45900e73f$var$SELECT_NAME),[$cc7e05a45900e73f$var$createSelectContext,$cc7e05a45900e73f$export$286727a75dc039bd]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($cc7e05a45900e73f$var$SELECT_NAME,[$cc7e05a45900e73f$var$createCollectionScope,$cf1ac5d9fe0e8206$export$722aac194ae923]),$cc7e05a45900e73f$var$usePopperScope=$cf1ac5d9fe0e8206$export$722aac194ae923(),[$cc7e05a45900e73f$var$SelectProvider,$cc7e05a45900e73f$var$useSelectContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$SELECT_NAME),[$cc7e05a45900e73f$var$SelectNativeOptionsProvider,$cc7e05a45900e73f$var$useSelectNativeOptionsContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$SELECT_NAME),$cc7e05a45900e73f$export$ef9b1a59e592288f=tt=>{const{__scopeSelect:et,children:nt,open:rt,defaultOpen:it,onOpenChange:st,value:ot,defaultValue:lt,onValueChange:ut,dir:ct,name:dt,autoComplete:ft,disabled:pt,required:gt}=tt,_r=$cc7e05a45900e73f$var$usePopperScope(et),[Yr,mt]=p$3(null),[Kr,Xr]=p$3(null),[Zr,Qr]=p$3(!1),_i=$f631663db3294ace$export$b39126d51d94e6f3(ct),[rs=!1,ns]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:rt,defaultProp:it,onChange:st}),[ss,fs]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:ot,defaultProp:lt,onChange:ut}),os=F$2(null),is=Yr?!!Yr.closest("form"):!0,[cs,ps]=p$3(new Set),vs=Array.from(cs).map(ls=>ls.props.value).join(";");return y$3($cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9,_r,y$3($cc7e05a45900e73f$var$SelectProvider,{required:gt,scope:et,trigger:Yr,onTriggerChange:mt,valueNode:Kr,onValueNodeChange:Xr,valueNodeHasChildren:Zr,onValueNodeHasChildrenChange:Qr,contentId:$1746a345f3d73bb7$export$f680877a34711e37(),value:ss,onValueChange:fs,open:rs,onOpenChange:ns,dir:_i,triggerPointerDownPosRef:os,disabled:pt},y$3($cc7e05a45900e73f$var$Collection.Provider,{scope:et},y$3($cc7e05a45900e73f$var$SelectNativeOptionsProvider,{scope:tt.__scopeSelect,onNativeOptionAdd:x$3(ls=>{ps(gs=>new Set(gs).add(ls))},[]),onNativeOptionRemove:x$3(ls=>{ps(gs=>{const us=new Set(gs);return us.delete(ls),us})},[])},nt)),is?y$3($cc7e05a45900e73f$var$BubbleSelect,{key:vs,"aria-hidden":!0,required:gt,tabIndex:-1,name:dt,autoComplete:ft,value:ss,onChange:ls=>fs(ls.target.value),disabled:pt},ss===void 0?y$3("option",{value:""}):null,Array.from(cs)):null))},$cc7e05a45900e73f$var$TRIGGER_NAME="SelectTrigger",$cc7e05a45900e73f$export$3ac1e88a1c0b9f1=N$3((tt,et)=>{const{__scopeSelect:nt,disabled:rt=!1,...it}=tt,st=$cc7e05a45900e73f$var$usePopperScope(nt),ot=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$TRIGGER_NAME,nt),lt=ot.disabled||rt,ut=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,ot.onTriggerChange),ct=$cc7e05a45900e73f$var$useCollection(nt),[dt,ft,pt]=$cc7e05a45900e73f$var$useTypeaheadSearch(_r=>{const Yr=ct().filter(Xr=>!Xr.disabled),mt=Yr.find(Xr=>Xr.value===ot.value),Kr=$cc7e05a45900e73f$var$findNextItem(Yr,_r,mt);Kr!==void 0&&ot.onValueChange(Kr.value)}),gt=()=>{lt||(ot.onOpenChange(!0),pt())};return y$3($cf1ac5d9fe0e8206$export$b688253958b8dfe7,_extends$1({asChild:!0},st),y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"combobox","aria-controls":ot.contentId,"aria-expanded":ot.open,"aria-required":ot.required,"aria-autocomplete":"none",dir:ot.dir,"data-state":ot.open?"open":"closed",disabled:lt,"data-disabled":lt?"":void 0,"data-placeholder":$cc7e05a45900e73f$var$shouldShowPlaceholder(ot.value)?"":void 0},it,{ref:ut,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(it.onClick,_r=>{_r.currentTarget.focus()}),onPointerDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(it.onPointerDown,_r=>{const Yr=_r.target;Yr.hasPointerCapture(_r.pointerId)&&Yr.releasePointerCapture(_r.pointerId),_r.button===0&&_r.ctrlKey===!1&&(gt(),ot.triggerPointerDownPosRef.current={x:Math.round(_r.pageX),y:Math.round(_r.pageY)},_r.preventDefault())}),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(it.onKeyDown,_r=>{const Yr=dt.current!=="";!(_r.ctrlKey||_r.altKey||_r.metaKey)&&_r.key.length===1&&ft(_r.key),!(Yr&&_r.key===" ")&&$cc7e05a45900e73f$var$OPEN_KEYS.includes(_r.key)&&(gt(),_r.preventDefault())})})))}),$cc7e05a45900e73f$var$VALUE_NAME="SelectValue",$cc7e05a45900e73f$export$e288731fd71264f0=N$3((tt,et)=>{const{__scopeSelect:nt,className:rt,style:it,children:st,placeholder:ot="",...lt}=tt,ut=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$VALUE_NAME,nt),{onValueNodeHasChildrenChange:ct}=ut,dt=st!==void 0,ft=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,ut.onValueNodeChange);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{ct(dt)},[ct,dt]),y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({},lt,{ref:ft,style:{pointerEvents:"none"}}),$cc7e05a45900e73f$var$shouldShowPlaceholder(ut.value)?y$3(g$3,null,ot):st)}),$cc7e05a45900e73f$export$99b400cabb58c515=N$3((tt,et)=>{const{__scopeSelect:nt,children:rt,...it}=tt;return y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({"aria-hidden":!0},it,{ref:et}),rt||"")}),$cc7e05a45900e73f$export$b2af6c9944296213=tt=>y$3($f1701beae083dbae$export$602eac185826482c,_extends$1({asChild:!0},tt)),$cc7e05a45900e73f$var$CONTENT_NAME="SelectContent",$cc7e05a45900e73f$export$c973a4b3cb86a03d=N$3((tt,et)=>{const nt=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,tt.__scopeSelect),[rt,it]=p$3();if($9f79659886946c16$export$e5c5a5f917a5871c(()=>{it(new DocumentFragment)},[]),!nt.open){const st=rt;return st?reactDomExports.createPortal(y$3($cc7e05a45900e73f$var$SelectContentProvider,{scope:tt.__scopeSelect},y$3($cc7e05a45900e73f$var$Collection.Slot,{scope:tt.__scopeSelect},y$3("div",null,tt.children))),st):null}return y$3($cc7e05a45900e73f$var$SelectContentImpl,_extends$1({},tt,{ref:et}))}),$cc7e05a45900e73f$var$CONTENT_MARGIN=10,[$cc7e05a45900e73f$var$SelectContentProvider,$cc7e05a45900e73f$var$useSelectContentContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$CONTENT_NAME),$cc7e05a45900e73f$var$SelectContentImpl=N$3((tt,et)=>{const{__scopeSelect:nt,position:rt="item-aligned",onCloseAutoFocus:it,onEscapeKeyDown:st,onPointerDownOutside:ot,side:lt,sideOffset:ut,align:ct,alignOffset:dt,arrowPadding:ft,collisionBoundary:pt,collisionPadding:gt,sticky:_r,hideWhenDetached:Yr,avoidCollisions:mt,...Kr}=tt,Xr=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,nt),[Zr,Qr]=p$3(null),[_i,rs]=p$3(null),ns=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,_s=>Qr(_s)),[ss,fs]=p$3(null),[os,is]=p$3(null),cs=$cc7e05a45900e73f$var$useCollection(nt),[ps,vs]=p$3(!1),ls=F$2(!1);_$1(()=>{if(Zr)return hideOthers(Zr)},[Zr]),$3db38b7d1fb3fe6a$export$b7ece24a22aeda8c();const gs=x$3(_s=>{const[Os,...Ys]=cs().map(Ws=>Ws.ref.current),[Vs]=Ys.slice(-1),js=document.activeElement;for(const Ws of _s)if(Ws===js||(Ws==null||Ws.scrollIntoView({block:"nearest"}),Ws===Os&&_i&&(_i.scrollTop=0),Ws===Vs&&_i&&(_i.scrollTop=_i.scrollHeight),Ws==null||Ws.focus(),document.activeElement!==js))return},[cs,_i]),us=x$3(()=>gs([ss,Zr]),[gs,ss,Zr]);_$1(()=>{ps&&us()},[ps,us]);const{onOpenChange:ms,triggerPointerDownPosRef:ys}=Xr;_$1(()=>{if(Zr){let _s={x:0,y:0};const Os=Vs=>{var js,Ws,Jr,as;_s={x:Math.abs(Math.round(Vs.pageX)-((js=(Ws=ys.current)===null||Ws===void 0?void 0:Ws.x)!==null&&js!==void 0?js:0)),y:Math.abs(Math.round(Vs.pageY)-((Jr=(as=ys.current)===null||as===void 0?void 0:as.y)!==null&&Jr!==void 0?Jr:0))}},Ys=Vs=>{_s.x<=10&&_s.y<=10?Vs.preventDefault():Zr.contains(Vs.target)||ms(!1),document.removeEventListener("pointermove",Os),ys.current=null};return ys.current!==null&&(document.addEventListener("pointermove",Os),document.addEventListener("pointerup",Ys,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Os),document.removeEventListener("pointerup",Ys,{capture:!0})}}},[Zr,ms,ys]),_$1(()=>{const _s=()=>ms(!1);return window.addEventListener("blur",_s),window.addEventListener("resize",_s),()=>{window.removeEventListener("blur",_s),window.removeEventListener("resize",_s)}},[ms]);const[Es,Ts]=$cc7e05a45900e73f$var$useTypeaheadSearch(_s=>{const Os=cs().filter(js=>!js.disabled),Ys=Os.find(js=>js.ref.current===document.activeElement),Vs=$cc7e05a45900e73f$var$findNextItem(Os,_s,Ys);Vs&&setTimeout(()=>Vs.ref.current.focus())}),Ss=x$3((_s,Os,Ys)=>{const Vs=!ls.current&&!Ys;(Xr.value!==void 0&&Xr.value===Os||Vs)&&(fs(_s),Vs&&(ls.current=!0))},[Xr.value]),Ds=x$3(()=>Zr==null?void 0:Zr.focus(),[Zr]),Cs=x$3((_s,Os,Ys)=>{const Vs=!ls.current&&!Ys;(Xr.value!==void 0&&Xr.value===Os||Vs)&&is(_s)},[Xr.value]),Is=rt==="popper"?$cc7e05a45900e73f$var$SelectPopperPosition:$cc7e05a45900e73f$var$SelectItemAlignedPosition,ks=Is===$cc7e05a45900e73f$var$SelectPopperPosition?{side:lt,sideOffset:ut,align:ct,alignOffset:dt,arrowPadding:ft,collisionBoundary:pt,collisionPadding:gt,sticky:_r,hideWhenDetached:Yr,avoidCollisions:mt}:{};return y$3($cc7e05a45900e73f$var$SelectContentProvider,{scope:nt,content:Zr,viewport:_i,onViewportChange:rs,itemRefCallback:Ss,selectedItem:ss,onItemLeave:Ds,itemTextRefCallback:Cs,focusSelectedItem:us,selectedItemText:os,position:rt,isPositioned:ps,searchRef:Es},y$3($01b9c$RemoveScroll,{as:$5e63c961fc1ce211$export$8c6ed5c666ac1360,allowPinchZoom:!0},y$3($d3863c46a17e8a28$export$20e40289641fbbb6,{asChild:!0,trapped:Xr.open,onMountAutoFocus:_s=>{_s.preventDefault()},onUnmountAutoFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(it,_s=>{var Os;(Os=Xr.trigger)===null||Os===void 0||Os.focus({preventScroll:!0}),_s.preventDefault()})},y$3($5cb92bef7577960e$export$177fb62ff3ec1f22,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:st,onPointerDownOutside:ot,onFocusOutside:_s=>_s.preventDefault(),onDismiss:()=>Xr.onOpenChange(!1)},y$3(Is,_extends$1({role:"listbox",id:Xr.contentId,"data-state":Xr.open?"open":"closed",dir:Xr.dir,onContextMenu:_s=>_s.preventDefault()},Kr,ks,{onPlaced:()=>vs(!0),ref:ns,style:{display:"flex",flexDirection:"column",outline:"none",...Kr.style},onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(Kr.onKeyDown,_s=>{const Os=_s.ctrlKey||_s.altKey||_s.metaKey;if(_s.key==="Tab"&&_s.preventDefault(),!Os&&_s.key.length===1&&Ts(_s.key),["ArrowUp","ArrowDown","Home","End"].includes(_s.key)){let Vs=cs().filter(js=>!js.disabled).map(js=>js.ref.current);if(["ArrowUp","End"].includes(_s.key)&&(Vs=Vs.slice().reverse()),["ArrowUp","ArrowDown"].includes(_s.key)){const js=_s.target,Ws=Vs.indexOf(js);Vs=Vs.slice(Ws+1)}setTimeout(()=>gs(Vs)),_s.preventDefault()}})}))))))}),$cc7e05a45900e73f$var$SelectItemAlignedPosition=N$3((tt,et)=>{const{__scopeSelect:nt,onPlaced:rt,...it}=tt,st=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,nt),ot=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$CONTENT_NAME,nt),[lt,ut]=p$3(null),[ct,dt]=p$3(null),ft=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,ns=>dt(ns)),pt=$cc7e05a45900e73f$var$useCollection(nt),gt=F$2(!1),_r=F$2(!0),{viewport:Yr,selectedItem:mt,selectedItemText:Kr,focusSelectedItem:Xr}=ot,Zr=x$3(()=>{if(st.trigger&&st.valueNode&&lt&&ct&&Yr&&mt&&Kr){const ns=st.trigger.getBoundingClientRect(),ss=ct.getBoundingClientRect(),fs=st.valueNode.getBoundingClientRect(),os=Kr.getBoundingClientRect();if(st.dir!=="rtl"){const js=os.left-ss.left,Ws=fs.left-js,Jr=ns.left-Ws,as=ns.width+Jr,bs=Math.max(as,ss.width),xs=window.innerWidth-$cc7e05a45900e73f$var$CONTENT_MARGIN,ws=$ae6933e535247d3d$export$7d15b64cf5a3a4c4(Ws,[$cc7e05a45900e73f$var$CONTENT_MARGIN,xs-bs]);lt.style.minWidth=as+"px",lt.style.left=ws+"px"}else{const js=ss.right-os.right,Ws=window.innerWidth-fs.right-js,Jr=window.innerWidth-ns.right-Ws,as=ns.width+Jr,bs=Math.max(as,ss.width),xs=window.innerWidth-$cc7e05a45900e73f$var$CONTENT_MARGIN,ws=$ae6933e535247d3d$export$7d15b64cf5a3a4c4(Ws,[$cc7e05a45900e73f$var$CONTENT_MARGIN,xs-bs]);lt.style.minWidth=as+"px",lt.style.right=ws+"px"}const is=pt(),cs=window.innerHeight-$cc7e05a45900e73f$var$CONTENT_MARGIN*2,ps=Yr.scrollHeight,vs=window.getComputedStyle(ct),ls=parseInt(vs.borderTopWidth,10),gs=parseInt(vs.paddingTop,10),us=parseInt(vs.borderBottomWidth,10),ms=parseInt(vs.paddingBottom,10),ys=ls+gs+ps+ms+us,Es=Math.min(mt.offsetHeight*5,ys),Ts=window.getComputedStyle(Yr),Ss=parseInt(Ts.paddingTop,10),Ds=parseInt(Ts.paddingBottom,10),Cs=ns.top+ns.height/2-$cc7e05a45900e73f$var$CONTENT_MARGIN,Is=cs-Cs,ks=mt.offsetHeight/2,_s=mt.offsetTop+ks,Os=ls+gs+_s,Ys=ys-Os;if(Os<=Cs){const js=mt===is[is.length-1].ref.current;lt.style.bottom="0px";const Ws=ct.clientHeight-Yr.offsetTop-Yr.offsetHeight,Jr=Math.max(Is,ks+(js?Ds:0)+Ws+us),as=Os+Jr;lt.style.height=as+"px"}else{const js=mt===is[0].ref.current;lt.style.top="0px";const Jr=Math.max(Cs,ls+Yr.offsetTop+(js?Ss:0)+ks)+Ys;lt.style.height=Jr+"px",Yr.scrollTop=Os-Cs+Yr.offsetTop}lt.style.margin=`${$cc7e05a45900e73f$var$CONTENT_MARGIN}px 0`,lt.style.minHeight=Es+"px",lt.style.maxHeight=cs+"px",rt==null||rt(),requestAnimationFrame(()=>gt.current=!0)}},[pt,st.trigger,st.valueNode,lt,ct,Yr,mt,Kr,st.dir,rt]);$9f79659886946c16$export$e5c5a5f917a5871c(()=>Zr(),[Zr]);const[Qr,_i]=p$3();$9f79659886946c16$export$e5c5a5f917a5871c(()=>{ct&&_i(window.getComputedStyle(ct).zIndex)},[ct]);const rs=x$3(ns=>{ns&&_r.current===!0&&(Zr(),Xr==null||Xr(),_r.current=!1)},[Zr,Xr]);return y$3($cc7e05a45900e73f$var$SelectViewportProvider,{scope:nt,contentWrapper:lt,shouldExpandOnScrollRef:gt,onScrollButtonChange:rs},y$3("div",{ref:ut,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:Qr}},y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({},it,{ref:ft,style:{boxSizing:"border-box",maxHeight:"100%",...it.style}}))))}),$cc7e05a45900e73f$var$SelectPopperPosition=N$3((tt,et)=>{const{__scopeSelect:nt,align:rt="start",collisionPadding:it=$cc7e05a45900e73f$var$CONTENT_MARGIN,...st}=tt,ot=$cc7e05a45900e73f$var$usePopperScope(nt);return y$3($cf1ac5d9fe0e8206$export$7c6e2c02157bb7d2,_extends$1({},ot,st,{ref:et,align:rt,collisionPadding:it,style:{boxSizing:"border-box",...st.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}}))}),[$cc7e05a45900e73f$var$SelectViewportProvider,$cc7e05a45900e73f$var$useSelectViewportContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$CONTENT_NAME,{}),$cc7e05a45900e73f$var$VIEWPORT_NAME="SelectViewport",$cc7e05a45900e73f$export$9ed6e7b40248d36d=N$3((tt,et)=>{const{__scopeSelect:nt,...rt}=tt,it=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$VIEWPORT_NAME,nt),st=$cc7e05a45900e73f$var$useSelectViewportContext($cc7e05a45900e73f$var$VIEWPORT_NAME,nt),ot=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,it.onViewportChange),lt=F$2(0);return y$3(g$3,null,y$3("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"}}),y$3($cc7e05a45900e73f$var$Collection.Slot,{scope:nt},y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"data-radix-select-viewport":"",role:"presentation"},rt,{ref:ot,style:{position:"relative",flex:1,overflow:"auto",...rt.style},onScroll:$e42e1063c40fb3ef$export$b9ecd428b558ff10(rt.onScroll,ut=>{const ct=ut.currentTarget,{contentWrapper:dt,shouldExpandOnScrollRef:ft}=st;if(ft!=null&&ft.current&&dt){const pt=Math.abs(lt.current-ct.scrollTop);if(pt>0){const gt=window.innerHeight-$cc7e05a45900e73f$var$CONTENT_MARGIN*2,_r=parseFloat(dt.style.minHeight),Yr=parseFloat(dt.style.height),mt=Math.max(_r,Yr);if(mt<gt){const Kr=mt+pt,Xr=Math.min(gt,Kr),Zr=Kr-Xr;dt.style.height=Xr+"px",dt.style.bottom==="0px"&&(ct.scrollTop=Zr>0?Zr:0,dt.style.justifyContent="flex-end")}}}lt.current=ct.scrollTop})}))))}),$cc7e05a45900e73f$var$GROUP_NAME="SelectGroup",[$cc7e05a45900e73f$var$SelectGroupContextProvider,$cc7e05a45900e73f$var$useSelectGroupContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$GROUP_NAME),$cc7e05a45900e73f$export$ee25a334c55de1f4=N$3((tt,et)=>{const{__scopeSelect:nt,...rt}=tt,it=$1746a345f3d73bb7$export$f680877a34711e37();return y$3($cc7e05a45900e73f$var$SelectGroupContextProvider,{scope:nt,id:it},y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"group","aria-labelledby":it},rt,{ref:et})))}),$cc7e05a45900e73f$var$LABEL_NAME="SelectLabel",$cc7e05a45900e73f$export$f67338d29bd972f8=N$3((tt,et)=>{const{__scopeSelect:nt,...rt}=tt,it=$cc7e05a45900e73f$var$useSelectGroupContext($cc7e05a45900e73f$var$LABEL_NAME,nt);return y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({id:it.id},rt,{ref:et}))}),$cc7e05a45900e73f$var$ITEM_NAME="SelectItem",[$cc7e05a45900e73f$var$SelectItemContextProvider,$cc7e05a45900e73f$var$useSelectItemContext]=$cc7e05a45900e73f$var$createSelectContext($cc7e05a45900e73f$var$ITEM_NAME),$cc7e05a45900e73f$export$13ef48a934230896=N$3((tt,et)=>{const{__scopeSelect:nt,value:rt,disabled:it=!1,textValue:st,...ot}=tt,lt=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$ITEM_NAME,nt),ut=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$ITEM_NAME,nt),ct=lt.value===rt,[dt,ft]=p$3(st??""),[pt,gt]=p$3(!1),_r=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,Kr=>{var Xr;return(Xr=ut.itemRefCallback)===null||Xr===void 0?void 0:Xr.call(ut,Kr,rt,it)}),Yr=$1746a345f3d73bb7$export$f680877a34711e37(),mt=()=>{it||(lt.onValueChange(rt),lt.onOpenChange(!1))};if(rt==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return y$3($cc7e05a45900e73f$var$SelectItemContextProvider,{scope:nt,value:rt,disabled:it,textId:Yr,isSelected:ct,onItemTextChange:x$3(Kr=>{ft(Xr=>{var Zr;return Xr||((Zr=Kr==null?void 0:Kr.textContent)!==null&&Zr!==void 0?Zr:"").trim()})},[])},y$3($cc7e05a45900e73f$var$Collection.ItemSlot,{scope:nt,value:rt,disabled:it,textValue:dt},y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({role:"option","aria-labelledby":Yr,"data-highlighted":pt?"":void 0,"aria-selected":ct&&pt,"data-state":ct?"checked":"unchecked","aria-disabled":it||void 0,"data-disabled":it?"":void 0,tabIndex:it?void 0:-1},ot,{ref:_r,onFocus:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ot.onFocus,()=>gt(!0)),onBlur:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ot.onBlur,()=>gt(!1)),onPointerUp:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ot.onPointerUp,mt),onPointerMove:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ot.onPointerMove,Kr=>{if(it){var Xr;(Xr=ut.onItemLeave)===null||Xr===void 0||Xr.call(ut)}else Kr.currentTarget.focus({preventScroll:!0})}),onPointerLeave:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ot.onPointerLeave,Kr=>{if(Kr.currentTarget===document.activeElement){var Xr;(Xr=ut.onItemLeave)===null||Xr===void 0||Xr.call(ut)}}),onKeyDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(ot.onKeyDown,Kr=>{var Xr;((Xr=ut.searchRef)===null||Xr===void 0?void 0:Xr.current)!==""&&Kr.key===" "||($cc7e05a45900e73f$var$SELECTION_KEYS.includes(Kr.key)&&mt(),Kr.key===" "&&Kr.preventDefault())})}))))}),$cc7e05a45900e73f$var$ITEM_TEXT_NAME="SelectItemText",$cc7e05a45900e73f$export$3572fb0fb821ff49=N$3((tt,et)=>{const{__scopeSelect:nt,className:rt,style:it,...st}=tt,ot=$cc7e05a45900e73f$var$useSelectContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,nt),lt=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,nt),ut=$cc7e05a45900e73f$var$useSelectItemContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,nt),ct=$cc7e05a45900e73f$var$useSelectNativeOptionsContext($cc7e05a45900e73f$var$ITEM_TEXT_NAME,nt),[dt,ft]=p$3(null),pt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,Kr=>ft(Kr),ut.onItemTextChange,Kr=>{var Xr;return(Xr=lt.itemTextRefCallback)===null||Xr===void 0?void 0:Xr.call(lt,Kr,ut.value,ut.disabled)}),gt=dt==null?void 0:dt.textContent,_r=q$2(()=>y$3("option",{key:ut.value,value:ut.value,disabled:ut.disabled},gt),[ut.disabled,ut.value,gt]),{onNativeOptionAdd:Yr,onNativeOptionRemove:mt}=ct;return $9f79659886946c16$export$e5c5a5f917a5871c(()=>(Yr(_r),()=>mt(_r)),[Yr,mt,_r]),y$3(g$3,null,y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({id:ut.textId},st,{ref:pt})),ut.isSelected&&ot.valueNode&&!ot.valueNodeHasChildren?reactDomExports.createPortal(st.children,ot.valueNode):null)}),$cc7e05a45900e73f$var$ITEM_INDICATOR_NAME="SelectItemIndicator",$cc7e05a45900e73f$export$6b9198de19accfe6=N$3((tt,et)=>{const{__scopeSelect:nt,...rt}=tt;return $cc7e05a45900e73f$var$useSelectItemContext($cc7e05a45900e73f$var$ITEM_INDICATOR_NAME,nt).isSelected?y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({"aria-hidden":!0},rt,{ref:et})):null}),$cc7e05a45900e73f$var$SCROLL_UP_BUTTON_NAME="SelectScrollUpButton",$cc7e05a45900e73f$export$d8117927658af6d7=N$3((tt,et)=>{const nt=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$SCROLL_UP_BUTTON_NAME,tt.__scopeSelect),rt=$cc7e05a45900e73f$var$useSelectViewportContext($cc7e05a45900e73f$var$SCROLL_UP_BUTTON_NAME,tt.__scopeSelect),[it,st]=p$3(!1),ot=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,rt.onScrollButtonChange);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(nt.viewport&&nt.isPositioned){let ut=function(){const ct=lt.scrollTop>0;st(ct)};const lt=nt.viewport;return ut(),lt.addEventListener("scroll",ut),()=>lt.removeEventListener("scroll",ut)}},[nt.viewport,nt.isPositioned]),it?y$3($cc7e05a45900e73f$var$SelectScrollButtonImpl,_extends$1({},tt,{ref:ot,onAutoScroll:()=>{const{viewport:lt,selectedItem:ut}=nt;lt&&ut&&(lt.scrollTop=lt.scrollTop-ut.offsetHeight)}})):null}),$cc7e05a45900e73f$var$SCROLL_DOWN_BUTTON_NAME="SelectScrollDownButton",$cc7e05a45900e73f$export$ff951e476c12189=N$3((tt,et)=>{const nt=$cc7e05a45900e73f$var$useSelectContentContext($cc7e05a45900e73f$var$SCROLL_DOWN_BUTTON_NAME,tt.__scopeSelect),rt=$cc7e05a45900e73f$var$useSelectViewportContext($cc7e05a45900e73f$var$SCROLL_DOWN_BUTTON_NAME,tt.__scopeSelect),[it,st]=p$3(!1),ot=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,rt.onScrollButtonChange);return $9f79659886946c16$export$e5c5a5f917a5871c(()=>{if(nt.viewport&&nt.isPositioned){let ut=function(){const ct=lt.scrollHeight-lt.clientHeight,dt=Math.ceil(lt.scrollTop)<ct;st(dt)};const lt=nt.viewport;return ut(),lt.addEventListener("scroll",ut),()=>lt.removeEventListener("scroll",ut)}},[nt.viewport,nt.isPositioned]),it?y$3($cc7e05a45900e73f$var$SelectScrollButtonImpl,_extends$1({},tt,{ref:ot,onAutoScroll:()=>{const{viewport:lt,selectedItem:ut}=nt;lt&&ut&&(lt.scrollTop=lt.scrollTop+ut.offsetHeight)}})):null}),$cc7e05a45900e73f$var$SelectScrollButtonImpl=N$3((tt,et)=>{const{__scopeSelect:nt,onAutoScroll:rt,...it}=tt,st=$cc7e05a45900e73f$var$useSelectContentContext("SelectScrollButton",nt),ot=F$2(null),lt=$cc7e05a45900e73f$var$useCollection(nt),ut=x$3(()=>{ot.current!==null&&(window.clearInterval(ot.current),ot.current=null)},[]);return _$1(()=>()=>ut(),[ut]),$9f79659886946c16$export$e5c5a5f917a5871c(()=>{var ct;const dt=lt().find(ft=>ft.ref.current===document.activeElement);dt==null||(ct=dt.ref.current)===null||ct===void 0||ct.scrollIntoView({block:"nearest"})},[lt]),y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.div,_extends$1({"aria-hidden":!0},it,{ref:et,style:{flexShrink:0,...it.style},onPointerDown:$e42e1063c40fb3ef$export$b9ecd428b558ff10(it.onPointerDown,()=>{ot.current===null&&(ot.current=window.setInterval(rt,50))}),onPointerMove:$e42e1063c40fb3ef$export$b9ecd428b558ff10(it.onPointerMove,()=>{var ct;(ct=st.onItemLeave)===null||ct===void 0||ct.call(st),ot.current===null&&(ot.current=window.setInterval(rt,50))}),onPointerLeave:$e42e1063c40fb3ef$export$b9ecd428b558ff10(it.onPointerLeave,()=>{ut()})}))});function $cc7e05a45900e73f$var$shouldShowPlaceholder(tt){return tt===""||tt===void 0}const $cc7e05a45900e73f$var$BubbleSelect=N$3((tt,et)=>{const{value:nt,...rt}=tt,it=F$2(null),st=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,it),ot=$010c2913dbd2fe3d$export$5cae361ad82dce8b(nt);return _$1(()=>{const lt=it.current,ut=window.HTMLSelectElement.prototype,dt=Object.getOwnPropertyDescriptor(ut,"value").set;if(ot!==nt&&dt){const ft=new Event("change",{bubbles:!0});dt.call(lt,nt),lt.dispatchEvent(ft)}},[ot,nt]),y$3($ea1ef594cf570d83$export$439d29a4e110a164,{asChild:!0},y$3("select",_extends$1({},rt,{ref:st,defaultValue:nt})))});$cc7e05a45900e73f$var$BubbleSelect.displayName="BubbleSelect";function $cc7e05a45900e73f$var$useTypeaheadSearch(tt){const et=$b1b2314f5f9a1d84$export$25bec8c6f54ee79a(tt),nt=F$2(""),rt=F$2(0),it=x$3(ot=>{const lt=nt.current+ot;et(lt),function ut(ct){nt.current=ct,window.clearTimeout(rt.current),ct!==""&&(rt.current=window.setTimeout(()=>ut(""),1e3))}(lt)},[et]),st=x$3(()=>{nt.current="",window.clearTimeout(rt.current)},[]);return _$1(()=>()=>window.clearTimeout(rt.current),[]),[nt,it,st]}function $cc7e05a45900e73f$var$findNextItem(tt,et,nt){const it=et.length>1&&Array.from(et).every(ct=>ct===et[0])?et[0]:et,st=nt?tt.indexOf(nt):-1;let ot=$cc7e05a45900e73f$var$wrapArray(tt,Math.max(st,0));it.length===1&&(ot=ot.filter(ct=>ct!==nt));const ut=ot.find(ct=>ct.textValue.toLowerCase().startsWith(it.toLowerCase()));return ut!==nt?ut:void 0}function $cc7e05a45900e73f$var$wrapArray(tt,et){return tt.map((nt,rt)=>tt[(et+rt)%tt.length])}const $cc7e05a45900e73f$export$be92b6f5f03c0fe9=$cc7e05a45900e73f$export$ef9b1a59e592288f,$cc7e05a45900e73f$export$41fb9f06171c75f4=$cc7e05a45900e73f$export$3ac1e88a1c0b9f1,$cc7e05a45900e73f$export$7c6e2c02157bb7d2=$cc7e05a45900e73f$export$c973a4b3cb86a03d,$cc7e05a45900e73f$export$b04be29aa201d4f5=$cc7e05a45900e73f$export$f67338d29bd972f8,$cc7e05a45900e73f$export$6d08773d2e66f8f2=$cc7e05a45900e73f$export$13ef48a934230896;var openseadragon={exports:{}};(function(module){//! openseadragon 2.4.2
//! Built on 2020-03-05
//! Git commit: v2.4.2-0-c450749
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
function OpenSeadragon(tt){return new OpenSeadragon.Viewer(tt)}(function(tt){tt.version={versionStr:"2.4.2",major:parseInt("2",10),minor:parseInt("4",10),revision:parseInt("2",10)};var et={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},nt=Object.prototype.toString,rt=Object.prototype.hasOwnProperty;tt.isFunction=function(it){return tt.type(it)==="function"},tt.isArray=Array.isArray||function(it){return tt.type(it)==="array"},tt.isWindow=function(it){return it&&typeof it=="object"&&"setInterval"in it},tt.type=function(it){return it==null?String(it):et[nt.call(it)]||"object"},tt.isPlainObject=function(it){if(!it||OpenSeadragon.type(it)!=="object"||it.nodeType||tt.isWindow(it)||it.constructor&&!rt.call(it,"constructor")&&!rt.call(it.constructor.prototype,"isPrototypeOf"))return!1;var st;for(var ot in it)st=ot;return st===void 0||rt.call(it,st)},tt.isEmptyObject=function(it){for(var st in it)return!1;return!0},tt.freezeObject=function(it){return Object.freeze?tt.freezeObject=Object.freeze:tt.freezeObject=function(st){return st},tt.freezeObject(it)},tt.supportsCanvas=function(){var it=document.createElement("canvas");return!!(tt.isFunction(it.getContext)&&it.getContext("2d"))}(),tt.isCanvasTainted=function(it){var st=!1;try{it.getContext("2d").getImageData(0,0,1,1)}catch{st=!0}return st},tt.pixelDensityRatio=function(){if(tt.supportsCanvas){var it=document.createElement("canvas").getContext("2d"),st=window.devicePixelRatio||1,ot=it.webkitBackingStorePixelRatio||it.mozBackingStorePixelRatio||it.msBackingStorePixelRatio||it.oBackingStorePixelRatio||it.backingStorePixelRatio||1;return Math.max(st,1)/ot}else return 1}()})(OpenSeadragon),function($){$.extend=function(){var tt,et,nt,rt,it,st,ot=arguments[0]||{},lt=arguments.length,ut=!1,ct=1;for(typeof ot=="boolean"&&(ut=ot,ot=arguments[1]||{},ct=2),typeof ot!="object"&&!OpenSeadragon.isFunction(ot)&&(ot={}),lt===ct&&(ot=this,--ct);ct<lt;ct++)if(tt=arguments[ct],tt!==null||tt!==void 0)for(et in tt)nt=ot[et],rt=tt[et],ot!==rt&&(ut&&rt&&(OpenSeadragon.isPlainObject(rt)||(it=OpenSeadragon.isArray(rt)))?(it?(it=!1,st=nt&&OpenSeadragon.isArray(nt)?nt:[]):st=nt&&OpenSeadragon.isPlainObject(nt)?nt:{},ot[et]=OpenSeadragon.extend(ut,st,rt)):rt!==void 0&&(ot[et]=rt));return ot};var isIOSDevice=function(){if(typeof navigator!="object")return!1;var tt=navigator.userAgent;return typeof tt!="string"?!1:tt.indexOf("iPhone")!==-1||tt.indexOf("iPad")!==-1||tt.indexOf("iPod")!==-1};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(tt,et){return function(){var nt=arguments;return nt===void 0&&(nt=[]),et.apply(tt,nt)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(tt){return typeof tt=="string"&&(tt=document.getElementById(tt)),tt},getElementPosition:function(tt){var et=new $.Point,nt,rt;for(tt=$.getElement(tt),nt=$.getElementStyle(tt).position=="fixed",rt=getOffsetParent(tt,nt);rt;)et.x+=tt.offsetLeft,et.y+=tt.offsetTop,nt&&(et=et.plus($.getPageScroll())),tt=rt,nt=$.getElementStyle(tt).position=="fixed",rt=getOffsetParent(tt,nt);return et},getElementOffset:function(tt){tt=$.getElement(tt);var et=tt&&tt.ownerDocument,nt,rt,it={top:0,left:0};return et?(nt=et.documentElement,typeof tt.getBoundingClientRect<"u"&&(it=tt.getBoundingClientRect()),rt=et==et.window?et:et.nodeType===9?et.defaultView||et.parentWindow:!1,new $.Point(it.left+(rt.pageXOffset||nt.scrollLeft)-(nt.clientLeft||0),it.top+(rt.pageYOffset||nt.scrollTop)-(nt.clientTop||0))):new $.Point},getElementSize:function(tt){return tt=$.getElement(tt),new $.Point(tt.clientWidth,tt.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(tt){return tt=$.getElement(tt),tt.currentStyle}:function(tt){return tt=$.getElement(tt),window.getComputedStyle(tt,"")},getCssPropertyWithVendorPrefix:function(tt){var et={};return $.getCssPropertyWithVendorPrefix=function(nt){if(et[nt]!==void 0)return et[nt];var rt=document.createElement("div").style,it=null;if(rt[nt]!==void 0)it=nt;else for(var st=["Webkit","Moz","MS","O","webkit","moz","ms","o"],ot=$.capitalizeFirstLetter(nt),lt=0;lt<st.length;lt++){var ut=st[lt]+ot;if(rt[ut]!==void 0){it=ut;break}}return et[nt]=it,it},$.getCssPropertyWithVendorPrefix(tt)},capitalizeFirstLetter:function(tt){return tt.charAt(0).toUpperCase()+tt.slice(1)},positiveModulo:function(tt,et){var nt=tt%et;return nt<0&&(nt+=et),nt},pointInElement:function(tt,et){tt=$.getElement(tt);var nt=$.getElementOffset(tt),rt=$.getElementSize(tt);return et.x>=nt.x&&et.x<nt.x+rt.x&&et.y<nt.y+rt.y&&et.y>=nt.y},getEvent:function(tt){return tt?$.getEvent=function(et){return et}:$.getEvent=function(){return window.event},$.getEvent(tt)},getMousePosition:function(tt){if(typeof tt.pageX=="number")$.getMousePosition=function(et){var nt=new $.Point;return et=$.getEvent(et),nt.x=et.pageX,nt.y=et.pageY,nt};else if(typeof tt.clientX=="number")$.getMousePosition=function(et){var nt=new $.Point;return et=$.getEvent(et),nt.x=et.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,nt.y=et.clientY+document.body.scrollTop+document.documentElement.scrollTop,nt};else throw new Error("Unknown event mouse position, no known technique.");return $.getMousePosition(tt)},getPageScroll:function(){var tt=document.documentElement||{},et=document.body||{};if(typeof window.pageXOffset=="number")$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(et.scrollLeft||et.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else if(tt.scrollLeft||tt.scrollTop)$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)};else return new $.Point(0,0);return $.getPageScroll()},setPageScroll:function(tt){if(typeof window.scrollTo<"u")$.setPageScroll=function(rt){window.scrollTo(rt.x,rt.y)};else{var et=$.getPageScroll();if(et.x===tt.x&&et.y===tt.y)return;document.body.scrollLeft=tt.x,document.body.scrollTop=tt.y;var nt=$.getPageScroll();if(nt.x!==et.x&&nt.y!==et.y){$.setPageScroll=function(rt){document.body.scrollLeft=rt.x,document.body.scrollTop=rt.y};return}if(document.documentElement.scrollLeft=tt.x,document.documentElement.scrollTop=tt.y,nt=$.getPageScroll(),nt.x!==et.x&&nt.y!==et.y){$.setPageScroll=function(rt){document.documentElement.scrollLeft=rt.x,document.documentElement.scrollTop=rt.y};return}$.setPageScroll=function(rt){}}return $.setPageScroll(tt)},getWindowSize:function(){var tt=document.documentElement||{},et=document.body||{};if(typeof window.innerWidth=="number")$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(tt.clientWidth||tt.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(et.clientWidth||et.clientHeight)$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)};else throw new Error("Unknown window size, no known technique.");return $.getWindowSize()},makeCenteredNode:function(tt){tt=$.getElement(tt);var et=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(et[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(et[1].style,{display:"table-row"}),$.extend(et[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),et[0].appendChild(et[1]),et[1].appendChild(et[2]),et[2].appendChild(tt),et[0]},makeNeutralElement:function(tt){var et=document.createElement(tt),nt=et.style;return nt.background="transparent none",nt.border="none",nt.margin="0px",nt.padding="0px",nt.position="static",et},now:function(){return Date.now?$.now=Date.now:$.now=function(){return new Date().getTime()},$.now()},makeTransparentImage:function(tt){return $.makeTransparentImage=function(et){var nt=$.makeNeutralElement("img");return nt.src=et,nt},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(et){var nt=$.makeNeutralElement("img"),rt=null;return rt=$.makeNeutralElement("span"),rt.style.display="inline-block",nt.onload=function(){rt.style.width=rt.style.width||nt.width+"px",rt.style.height=rt.style.height||nt.height+"px",nt.onload=null,nt=null},nt.src=et,rt.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+et+"', sizingMethod='scale')",rt}),$.makeTransparentImage(tt)},setElementOpacity:function(tt,et,nt){var rt,it;tt=$.getElement(tt),nt&&!$.Browser.alpha&&(et=Math.round(et)),$.Browser.opacity?tt.style.opacity=et<1?et:"":et<1?(rt=Math.round(100*et),it="alpha(opacity="+rt+")",tt.style.filter=it):tt.style.filter=""},setElementTouchActionNone:function(tt){tt=$.getElement(tt),typeof tt.style.touchAction<"u"?tt.style.touchAction="none":typeof tt.style.msTouchAction<"u"&&(tt.style.msTouchAction="none")},addClass:function(tt,et){tt=$.getElement(tt),tt.className?(" "+tt.className+" ").indexOf(" "+et+" ")===-1&&(tt.className+=" "+et):tt.className=et},indexOf:function(tt,et,nt){return Array.prototype.indexOf?this.indexOf=function(rt,it,st){return rt.indexOf(it,st)}:this.indexOf=function(rt,it,st){var ot,lt=st||0,ut;if(!rt)throw new TypeError;if(ut=rt.length,ut===0||lt>=ut)return-1;for(lt<0&&(lt=ut-Math.abs(lt)),ot=lt;ot<ut;ot++)if(rt[ot]===it)return ot;return-1},this.indexOf(tt,et,nt)},removeClass:function(tt,et){var nt,rt=[],it;for(tt=$.getElement(tt),nt=tt.className.split(/\s+/),it=0;it<nt.length;it++)nt[it]&&nt[it]!==et&&rt.push(nt[it]);tt.className=rt.join(" ")},addEvent:function(){if(window.addEventListener)return function(tt,et,nt,rt){tt=$.getElement(tt),tt.addEventListener(et,nt,rt)};if(window.attachEvent)return function(tt,et,nt,rt){tt=$.getElement(tt),tt.attachEvent("on"+et,nt)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(tt,et,nt,rt){tt=$.getElement(tt),tt.removeEventListener(et,nt,rt)};if(window.detachEvent)return function(tt,et,nt,rt){tt=$.getElement(tt),tt.detachEvent("on"+et,nt)};throw new Error("No known event model.")}(),cancelEvent:function(tt){tt=$.getEvent(tt),tt.preventDefault?$.cancelEvent=function(et){et.preventDefault()}:$.cancelEvent=function(et){et=$.getEvent(et),et.cancel=!0,et.returnValue=!1},$.cancelEvent(tt)},stopEvent:function(tt){tt=$.getEvent(tt),tt.stopPropagation?$.stopEvent=function(et){et.stopPropagation()}:$.stopEvent=function(et){et=$.getEvent(et),et.cancelBubble=!0},$.stopEvent(tt)},createCallback:function(tt,et){var nt=[],rt;for(rt=2;rt<arguments.length;rt++)nt.push(arguments[rt]);return function(){var it=nt.concat([]),st;for(st=0;st<arguments.length;st++)it.push(arguments[st]);return et.apply(tt,it)}},getUrlParameter:function(tt){var et=URLPARAMS[tt];return et||null},getUrlProtocol:function(tt){var et=tt.match(/^([a-z]+:)\/\//i);return et===null?window.location.protocol:et[1].toLowerCase()},createAjaxRequest:function(tt){var et;try{et=!!new ActiveXObject("Microsoft.XMLHTTP")}catch{et=!1}if(et)window.XMLHttpRequest?$.createAjaxRequest=function(nt){return nt?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else if(window.XMLHttpRequest)$.createAjaxRequest=function(){return new XMLHttpRequest};else throw new Error("Browser doesn't support XMLHttpRequest.");return $.createAjaxRequest(tt)},makeAjaxRequest:function(tt,et,nt){var rt,it,st;$.isPlainObject(tt)&&(et=tt.success,nt=tt.error,rt=tt.withCredentials,it=tt.headers,st=tt.responseType||null,tt=tt.url);var ot=$.getUrlProtocol(tt),lt=$.createAjaxRequest(ot==="file:");if(!$.isFunction(et))throw new Error("makeAjaxRequest requires a success callback");lt.onreadystatechange=function(){lt.readyState==4&&(lt.onreadystatechange=function(){},lt.status>=200&&lt.status<300||lt.status===0&&ot!=="http:"&&ot!=="https:"?et(lt):($.console.log("AJAX request returned %d: %s",lt.status,tt),$.isFunction(nt)&&nt(lt)))};try{if(lt.open("GET",tt,!0),st&&(lt.responseType=st),it)for(var ut in it)Object.prototype.hasOwnProperty.call(it,ut)&&it[ut]&&lt.setRequestHeader(ut,it[ut]);rt&&(lt.withCredentials=!0),lt.send(null)}catch(pt){var ct=pt.message,dt=$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10;if(dt&&typeof pt.number<"u"&&pt.number==-2147024891&&(ct+=`
See http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain`),$.console.log("%s while making AJAX request: %s",pt.name,ct),lt.onreadystatechange=function(){},window.XDomainRequest){var ft=new window.XDomainRequest;if(ft){ft.onload=function(gt){$.isFunction(et)&&et({responseText:ft.responseText,status:200,statusText:"OK"})},ft.onerror=function(gt){$.isFunction(nt)&&nt({responseText:ft.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{ft.open("GET",tt),ft.send()}catch{$.isFunction(nt)&&nt(lt,pt)}}}else $.isFunction(nt)&&nt(lt,pt)}return lt},jsonp:function(tt){var et,nt=tt.url,rt=document.head||document.getElementsByTagName("head")[0]||document.documentElement,it=tt.callbackName||"openseadragon"+$.now(),st=window[it],ot="$1"+it+"$2",lt=tt.param||"callback",ut=tt.callback;nt=nt.replace(/(\=)\?(&|$)|\?\?/i,ot),nt+=(/\?/.test(nt)?"&":"?")+lt+"="+it,window[it]=function(ct){if(st)window[it]=st;else try{delete window[it]}catch{}ut&&$.isFunction(ut)&&ut(ct)},et=document.createElement("script"),(tt.async!==void 0||tt.async!==!1)&&(et.async="async"),tt.scriptCharset&&(et.charset=tt.scriptCharset),et.src=nt,et.onload=et.onreadystatechange=function(ct,dt){(dt||!et.readyState||/loaded|complete/.test(et.readyState))&&(et.onload=et.onreadystatechange=null,rt&&et.parentNode&&rt.removeChild(et),et=void 0)},rt.insertBefore(et,rt.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(tt){if(window.DOMParser)$.parseXml=function(et){var nt=null,rt;return rt=new DOMParser,nt=rt.parseFromString(et,"text/xml"),nt};else if(window.ActiveXObject)$.parseXml=function(et){var nt=null;return nt=new ActiveXObject("Microsoft.XMLDOM"),nt.async=!1,nt.loadXML(et),nt};else throw new Error("Browser doesn't support XML DOM.");return $.parseXml(tt)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(tt){return tt=tt||"",!!FILEFORMATS[tt.toLowerCase()]}});var nullfunction=function(tt){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};(function(){var tt=navigator.appVersion,et=navigator.userAgent,nt;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(et.substring(et.indexOf("MSIE")+5,et.indexOf(";",et.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(et.indexOf("Firefox")>=0?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(et.substring(et.indexOf("Firefox")+8))):et.indexOf("Safari")>=0?($.Browser.vendor=et.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(et.substring(et.substring(0,et.indexOf("Safari")).lastIndexOf("/")+1,et.indexOf("Safari")))):(nt=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),nt.exec(et)!==null&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(tt);break}var rt=window.location.search.substring(1),it=rt.split("&"),st,ot,lt;for(lt=0;lt<it.length;lt++)if(st=it[lt],ot=st.indexOf("="),ot>0){var ut=st.substring(0,ot),ct=st.substring(ot+1);try{URLPARAMS[ut]=decodeURIComponent(ct)}catch{$.console.error("Ignoring malformed URL parameter: %s=%s",ut,ct)}}$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)})(),function(tt){var et=tt.requestAnimationFrame||tt.mozRequestAnimationFrame||tt.webkitRequestAnimationFrame||tt.msRequestAnimationFrame,nt=tt.cancelAnimationFrame||tt.mozCancelAnimationFrame||tt.webkitCancelAnimationFrame||tt.msCancelAnimationFrame;if(et&&nt)$.requestAnimationFrame=function(){return et.apply(tt,arguments)},$.cancelAnimationFrame=function(){return nt.apply(tt,arguments)};else{var rt=[],it=[],st=0,ot;$.requestAnimationFrame=function(lt){return rt.push([++st,lt]),ot||(ot=setInterval(function(){if(rt.length){var ut=$.now(),ct=it;for(it=rt,rt=ct;it.length;)it.shift()[1](ut)}else clearInterval(ot),ot=void 0},1e3/50)),st},$.cancelAnimationFrame=function(lt){var ut,ct;for(ut=0,ct=rt.length;ut<ct;ut+=1)if(rt[ut][0]===lt){rt.splice(ut,1);return}for(ut=0,ct=it.length;ut<ct;ut+=1)if(it[ut][0]===lt){it.splice(ut,1);return}}}}(window);function getOffsetParent(tt,et){return et&&tt!=document.body?document.body:tt.offsetParent}}(OpenSeadragon),function(tt,et){module.exports?module.exports=et():tt.OpenSeadragon=et()}(commonjsGlobal,function(){return OpenSeadragon}),function(tt){var et={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(et.supportsFullScreen=!0,et.getFullScreenElement=function(){return document.fullscreenElement},et.requestFullScreen=function(nt){return nt.requestFullscreen()},et.exitFullScreen=function(){document.exitFullscreen()},et.fullScreenEventName="fullscreenchange",et.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(et.supportsFullScreen=!0,et.getFullScreenElement=function(){return document.msFullscreenElement},et.requestFullScreen=function(nt){return nt.msRequestFullscreen()},et.exitFullScreen=function(){document.msExitFullscreen()},et.fullScreenEventName="MSFullscreenChange",et.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(et.supportsFullScreen=!0,et.getFullScreenElement=function(){return document.webkitFullscreenElement},et.requestFullScreen=function(nt){return nt.webkitRequestFullscreen()},et.exitFullScreen=function(){document.webkitExitFullscreen()},et.fullScreenEventName="webkitfullscreenchange",et.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(et.supportsFullScreen=!0,et.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},et.requestFullScreen=function(nt){return nt.webkitRequestFullScreen()},et.exitFullScreen=function(){document.webkitCancelFullScreen()},et.fullScreenEventName="webkitfullscreenchange",et.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(et.supportsFullScreen=!0,et.getFullScreenElement=function(){return document.mozFullScreenElement},et.requestFullScreen=function(nt){return nt.mozRequestFullScreen()},et.exitFullScreen=function(){document.mozCancelFullScreen()},et.fullScreenEventName="mozfullscreenchange",et.fullScreenErrorEventName="mozfullscreenerror"),et.isFullScreen=function(){return et.getFullScreenElement()!==null},et.cancelFullScreen=function(){tt.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),et.exitFullScreen()},tt.extend(tt,et)}(OpenSeadragon),function(tt){tt.EventSource=function(){this.events={}},tt.EventSource.prototype={addOnceHandler:function(et,nt,rt,it){var st=this;it=it||1;var ot=0,lt=function(ut){ot++,ot===it&&st.removeHandler(et,lt),nt(ut)};this.addHandler(et,lt,rt)},addHandler:function(et,nt,rt){var it=this.events[et];it||(this.events[et]=it=[]),nt&&tt.isFunction(nt)&&(it[it.length]={handler:nt,userData:rt||null})},removeHandler:function(et,nt){var rt=this.events[et],it=[],st;if(rt&&tt.isArray(rt)){for(st=0;st<rt.length;st++)rt[st].handler!==nt&&it.push(rt[st]);this.events[et]=it}},removeAllHandlers:function(et){if(et)this.events[et]=[];else for(var nt in this.events)this.events[nt]=[]},getHandler:function(et){var nt=this.events[et];return!nt||!nt.length?null:(nt=nt.length===1?[nt[0]]:Array.apply(null,nt),function(rt,it){var st,ot=nt.length;for(st=0;st<ot;st++)nt[st]&&(it.eventSource=rt,it.userData=nt[st].userData,nt[st].handler(it))})},raiseEvent:function(et,nt){var rt=this.getHandler(et);rt&&(nt||(nt={}),rt(this,nt))}}}(OpenSeadragon),function(tt){var et=[],nt={};tt.MouseTracker=function(ts){et.push(this);var es=arguments;tt.isPlainObject(ts)||(ts={element:es[0],clickTimeThreshold:es[1],clickDistThreshold:es[2]}),this.hash=Math.random(),this.element=tt.getElement(ts.element),this.clickTimeThreshold=ts.clickTimeThreshold||tt.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=ts.clickDistThreshold||tt.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=ts.dblClickTimeThreshold||tt.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=ts.dblClickDistThreshold||tt.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=ts.userData||null,this.stopDelay=ts.stopDelay||50,this.enterHandler=ts.enterHandler||null,this.exitHandler=ts.exitHandler||null,this.pressHandler=ts.pressHandler||null,this.nonPrimaryPressHandler=ts.nonPrimaryPressHandler||null,this.releaseHandler=ts.releaseHandler||null,this.nonPrimaryReleaseHandler=ts.nonPrimaryReleaseHandler||null,this.moveHandler=ts.moveHandler||null,this.scrollHandler=ts.scrollHandler||null,this.clickHandler=ts.clickHandler||null,this.dblClickHandler=ts.dblClickHandler||null,this.dragHandler=ts.dragHandler||null,this.dragEndHandler=ts.dragEndHandler||null,this.pinchHandler=ts.pinchHandler||null,this.stopHandler=ts.stopHandler||null,this.keyDownHandler=ts.keyDownHandler||null,this.keyUpHandler=ts.keyUpHandler||null,this.keyHandler=ts.keyHandler||null,this.focusHandler=ts.focusHandler||null,this.blurHandler=ts.blurHandler||null;var ds=this;nt[this.hash]={click:function(hs){_r(ds,hs)},dblclick:function(hs){Yr(ds,hs)},keydown:function(hs){mt(ds,hs)},keyup:function(hs){Kr(ds,hs)},keypress:function(hs){Xr(ds,hs)},focus:function(hs){Zr(ds,hs)},blur:function(hs){Qr(ds,hs)},wheel:function(hs){_i(ds,hs)},mousewheel:function(hs){rs(ds,hs)},DOMMouseScroll:function(hs){rs(ds,hs)},MozMousePixelScroll:function(hs){rs(ds,hs)},mouseenter:function(hs){fs(ds,hs)},mouseleave:function(hs){cs(ds,hs)},mouseover:function(hs){os(ds,hs)},mouseout:function(hs){ps(ds,hs)},mousedown:function(hs){gs(ds,hs)},mouseup:function(hs){us(ds,hs)},mouseupcaptured:function(hs){ms(ds,hs)},mousemove:function(hs){Es(ds,hs)},mousemovecaptured:function(hs){Ts(ds,hs)},touchstart:function(hs){Cs(ds,hs)},touchend:function(hs){Is(ds,hs)},touchendcaptured:function(hs){ks(ds,hs)},touchmove:function(hs){Os(ds,hs)},touchmovecaptured:function(hs){Ys(ds,hs)},touchcancel:function(hs){js(ds,hs)},gesturestart:function(hs){Ws(ds,hs)},gesturechange:function(hs){Jr(ds,hs)},pointerover:function(hs){as(ds,hs)},MSPointerOver:function(hs){as(ds,hs)},pointerout:function(hs){bs(ds,hs)},MSPointerOut:function(hs){bs(ds,hs)},pointerdown:function(hs){xs(ds,hs)},MSPointerDown:function(hs){xs(ds,hs)},pointerup:function(hs){ws(ds,hs)},MSPointerUp:function(hs){ws(ds,hs)},pointermove:function(hs){qs(ds,hs)},MSPointerMove:function(hs){qs(ds,hs)},pointercancel:function(hs){Ns(ds,hs)},MSPointerCancel:function(hs){Ns(ds,hs)},pointerupcaptured:function(hs){Bs(ds,hs)},pointermovecaptured:function(hs){Ks(ds,hs)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},ts.startDisabled||this.setTracking(!0)},tt.MouseTracker.prototype={destroy:function(){var ts;for(st(this),this.element=null,ts=0;ts<et.length;ts++)if(et[ts]===this){et.splice(ts,1);break}nt[this.hash]=null,delete nt[this.hash]},isTracking:function(){return nt[this.hash].tracking},setTracking:function(ts){return ts?it(this):st(this),this},getActivePointersListsExceptType:function(ts){for(var es=nt[this.hash],ds=[],hs=0;hs<es.activePointersLists.length;++hs)es.activePointersLists[hs].type!==ts&&ds.push(es.activePointersLists[hs]);return ds},getActivePointersListByType:function(ts){var es=nt[this.hash],ds,hs=es.activePointersLists.length,$s;for(ds=0;ds<hs;ds++)if(es.activePointersLists[ds].type===ts)return es.activePointersLists[ds];return $s=new tt.MouseTracker.GesturePointList(ts),es.activePointersLists.push($s),$s},getActivePointerCount:function(){var ts=nt[this.hash],es,ds=ts.activePointersLists.length,hs=0;for(es=0;es<ds;es++)hs+=ts.activePointersLists[es].getLength();return hs},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},tt.MouseTracker.resetAllMouseTrackers=function(){for(var ts=0;ts<et.length;ts++)et[ts].isTracking()&&(et[ts].setTracking(!1),et[ts].setTracking(!0))},tt.MouseTracker.gesturePointVelocityTracker=function(){var ts=[],es=0,ds=0,hs=function(As,Ms){return As.hash.toString()+Ms.type+Ms.id.toString()},$s=function(){var As,Ms=ts.length,Us,Hs,Xs=tt.now(),Fs,no,io;for(Fs=Xs-ds,ds=Xs,As=0;As<Ms;As++)Us=ts[As],Hs=Us.gPoint,Hs.direction=Math.atan2(Hs.currentPos.y-Us.lastPos.y,Hs.currentPos.x-Us.lastPos.x),no=Us.lastPos.distanceTo(Hs.currentPos),Us.lastPos=Hs.currentPos,io=1e3*no/(Fs+1),Hs.speed=.75*io+.25*Hs.speed},Ls=function(As,Ms){var Us=hs(As,Ms);ts.push({guid:Us,gPoint:Ms,lastPos:Ms.currentPos}),ts.length===1&&(ds=tt.now(),es=window.setInterval($s,50))},Rs=function(As,Ms){var Us=hs(As,Ms),Hs,Xs=ts.length;for(Hs=0;Hs<Xs;Hs++)if(ts[Hs].guid===Us){ts.splice(Hs,1),Xs--,Xs===0&&window.clearInterval(es);break}};return{addPoint:Ls,removePoint:Rs}}(),tt.MouseTracker.captureElement=document,tt.MouseTracker.wheelEventName=tt.Browser.vendor==tt.BROWSERS.IE&&tt.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll",tt.MouseTracker.supportsMouseCapture=function(){var ts=document.createElement("div");return tt.isFunction(ts.setCapture)&&tt.isFunction(ts.releaseCapture)}(),tt.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",tt.MouseTracker.wheelEventName],tt.MouseTracker.wheelEventName=="DOMMouseScroll"&&tt.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||tt.Browser.vendor!==tt.BROWSERS.IE)?(tt.MouseTracker.havePointerEvents=!0,tt.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),tt.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?tt.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:tt.MouseTracker.maxTouchPoints=0,tt.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(tt.MouseTracker.havePointerEvents=!0,tt.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),tt.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?tt.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:tt.MouseTracker.maxTouchPoints=0,tt.MouseTracker.haveMouseEnter=!1):(tt.MouseTracker.havePointerEvents=!1,tt.Browser.vendor===tt.BROWSERS.IE&&tt.Browser.version<9?(tt.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),tt.MouseTracker.haveMouseEnter=!0):(tt.MouseTracker.subscribeEvents.push("mouseover","mouseout"),tt.MouseTracker.haveMouseEnter=!1),tt.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&tt.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&tt.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),tt.MouseTracker.mousePointerId="legacy-mouse",tt.MouseTracker.maxTouchPoints=10),tt.MouseTracker.GesturePointList=function(ts){this._gPoints=[],this.type=ts,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},tt.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(ts){return this._gPoints.push(ts)},removeById:function(ts){var es,ds=this._gPoints.length;for(es=0;es<ds;es++)if(this._gPoints[es].id===ts){this._gPoints.splice(es,1);break}return this._gPoints.length},getByIndex:function(ts){return ts<this._gPoints.length?this._gPoints[ts]:null},getById:function(ts){var es,ds=this._gPoints.length;for(es=0;es<ds;es++)if(this._gPoints[es].id===ts)return this._gPoints[es];return null},getPrimary:function(ts){var es,ds=this._gPoints.length;for(es=0;es<ds;es++)if(this._gPoints[es].isPrimary)return this._gPoints[es];return null},addContact:function(){++this.contacts,this.contacts>1&&(this.type==="mouse"||this.type==="pen")&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};function rt(ts){var es=nt[ts.hash],ds,hs=es.activePointersLists.length;for(ds=0;ds<hs;ds++)es.activePointersLists[ds].captureCount>0&&(tt.removeEvent(tt.MouseTracker.captureElement,"mousemove",es.mousemovecaptured,!0),tt.removeEvent(tt.MouseTracker.captureElement,"mouseup",es.mouseupcaptured,!0),tt.removeEvent(tt.MouseTracker.captureElement,tt.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",es.pointermovecaptured,!0),tt.removeEvent(tt.MouseTracker.captureElement,tt.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",es.pointerupcaptured,!0),tt.removeEvent(tt.MouseTracker.captureElement,"touchmove",es.touchmovecaptured,!0),tt.removeEvent(tt.MouseTracker.captureElement,"touchend",es.touchendcaptured,!0),es.activePointersLists[ds].captureCount=0);for(ds=0;ds<hs;ds++)es.activePointersLists.pop()}function it(ts){var es=nt[ts.hash],ds,hs;if(!es.tracking){for(hs=0;hs<tt.MouseTracker.subscribeEvents.length;hs++)ds=tt.MouseTracker.subscribeEvents[hs],tt.addEvent(ts.element,ds,es[ds],!1);rt(ts),es.tracking=!0}}function st(ts){var es=nt[ts.hash],ds,hs;if(es.tracking){for(hs=0;hs<tt.MouseTracker.subscribeEvents.length;hs++)ds=tt.MouseTracker.subscribeEvents[hs],tt.removeEvent(ts.element,ds,es[ds],!1);rt(ts),es.tracking=!1}}function ot(ts,es){var ds=nt[ts.hash];if(es==="pointerevent")return{upName:tt.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:ds.pointerupcaptured,moveName:tt.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:ds.pointermovecaptured};if(es==="mouse")return{upName:"mouseup",upHandler:ds.mouseupcaptured,moveName:"mousemove",moveHandler:ds.mousemovecaptured};if(es==="touch")return{upName:"touchend",upHandler:ds.touchendcaptured,moveName:"touchmove",moveHandler:ds.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function lt(ts,es,ds){var hs=ts.getActivePointersListByType(es),$s;hs.captureCount+=ds||1,hs.captureCount===1&&(tt.Browser.vendor===tt.BROWSERS.IE&&tt.Browser.version<9?ts.element.setCapture(!0):($s=ot(ts,tt.MouseTracker.havePointerEvents?"pointerevent":es),co&&fo(window.top)&&tt.addEvent(window.top,$s.upName,$s.upHandler,!0),tt.addEvent(tt.MouseTracker.captureElement,$s.upName,$s.upHandler,!0),tt.addEvent(tt.MouseTracker.captureElement,$s.moveName,$s.moveHandler,!0)))}function ut(ts,es,ds){var hs=ts.getActivePointersListByType(es),$s;hs.captureCount-=ds||1,hs.captureCount===0&&(tt.Browser.vendor===tt.BROWSERS.IE&&tt.Browser.version<9?ts.element.releaseCapture():($s=ot(ts,tt.MouseTracker.havePointerEvents?"pointerevent":es),co&&fo(window.top)&&tt.removeEvent(window.top,$s.upName,$s.upHandler,!0),tt.removeEvent(tt.MouseTracker.captureElement,$s.moveName,$s.moveHandler,!0),tt.removeEvent(tt.MouseTracker.captureElement,$s.upName,$s.upHandler,!0)))}function ct(ts){var es;if(tt.MouseTracker.unprefixedPointerEvents)es=ts.pointerType;else switch(ts.pointerType){case 2:es="touch";break;case 3:es="pen";break;case 4:es="mouse";break;default:es=""}return es}function dt(ts){return tt.getMousePosition(ts)}function ft(ts,es){return pt(dt(ts),es)}function pt(ts,es){var ds=tt.getElementOffset(es);return ts.minus(ds)}function gt(ts,es){return new tt.Point((ts.x+es.x)/2,(ts.y+es.y)/2)}function _r(ts,es){ts.clickHandler&&tt.cancelEvent(es)}function Yr(ts,es){ts.dblClickHandler&&tt.cancelEvent(es)}function mt(ts,es){var ds;ts.keyDownHandler&&(es=tt.getEvent(es),ds=ts.keyDownHandler({eventSource:ts,keyCode:es.keyCode?es.keyCode:es.charCode,ctrl:es.ctrlKey,shift:es.shiftKey,alt:es.altKey,meta:es.metaKey,originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),ds||tt.cancelEvent(es))}function Kr(ts,es){var ds;ts.keyUpHandler&&(es=tt.getEvent(es),ds=ts.keyUpHandler({eventSource:ts,keyCode:es.keyCode?es.keyCode:es.charCode,ctrl:es.ctrlKey,shift:es.shiftKey,alt:es.altKey,meta:es.metaKey,originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),ds||tt.cancelEvent(es))}function Xr(ts,es){var ds;ts.keyHandler&&(es=tt.getEvent(es),ds=ts.keyHandler({eventSource:ts,keyCode:es.keyCode?es.keyCode:es.charCode,ctrl:es.ctrlKey,shift:es.shiftKey,alt:es.altKey,meta:es.metaKey,originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),ds||tt.cancelEvent(es))}function Zr(ts,es){var ds;ts.focusHandler&&(es=tt.getEvent(es),ds=ts.focusHandler({eventSource:ts,originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),ds===!1&&tt.cancelEvent(es))}function Qr(ts,es){var ds;ts.blurHandler&&(es=tt.getEvent(es),ds=ts.blurHandler({eventSource:ts,originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),ds===!1&&tt.cancelEvent(es))}function _i(ts,es){ns(ts,es,es)}function rs(ts,es){es=tt.getEvent(es);var ds={target:es.target||es.srcElement,type:"wheel",shiftKey:es.shiftKey||!1,clientX:es.clientX,clientY:es.clientY,pageX:es.pageX?es.pageX:es.clientX,pageY:es.pageY?es.pageY:es.clientY,deltaMode:es.type=="MozMousePixelScroll"?0:1,deltaX:0,deltaZ:0};tt.MouseTracker.wheelEventName=="mousewheel"?ds.deltaY=-es.wheelDelta/tt.DEFAULT_SETTINGS.pixelsPerWheelLine:ds.deltaY=es.detail,ns(ts,ds,es)}function ns(ts,es,ds){var hs=0,$s;hs=es.deltaY<0?1:-1,ts.scrollHandler&&($s=ts.scrollHandler({eventSource:ts,pointerType:"mouse",position:ft(es,ts.element),scroll:hs,shift:es.shiftKey,isTouchEvent:!1,originalEvent:ds,preventDefaultAction:!1,userData:ts.userData}),$s===!1&&tt.cancelEvent(ds))}function ss(ts,es){if(ts===es)return!1;for(;es&&es!==ts;)es=es.parentNode;return es===ts}function fs(ts,es){es=tt.getEvent(es),is(ts,es)}function os(ts,es){es=tt.getEvent(es),!(es.currentTarget===es.relatedTarget||ss(es.currentTarget,es.relatedTarget))&&is(ts,es)}function is(ts,es){var ds={id:tt.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:dt(es),currentTime:tt.now()};Qs(ts,es,[ds])}function cs(ts,es){es=tt.getEvent(es),vs(ts,es)}function ps(ts,es){es=tt.getEvent(es),!(es.currentTarget===es.relatedTarget||ss(es.currentTarget,es.relatedTarget))&&vs(ts,es)}function vs(ts,es){var ds={id:tt.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:dt(es),currentTime:tt.now()};Js(ts,es,[ds])}function ls(ts){return tt.Browser.vendor===tt.BROWSERS.IE&&tt.Browser.version<9?ts===1?0:ts===2?2:ts===4?1:-1:ts}function gs(ts,es){var ds;es=tt.getEvent(es),ds={id:tt.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:dt(es),currentTime:tt.now()},so(ts,es,[ds],ls(es.button))&&(tt.stopEvent(es),lt(ts,"mouse")),(ts.clickHandler||ts.dblClickHandler||ts.pressHandler||ts.dragHandler||ts.dragEndHandler)&&tt.cancelEvent(es)}function us(ts,es){ys(ts,es)}function ms(ts,es){ys(ts,es),tt.stopEvent(es)}function ys(ts,es){var ds;es=tt.getEvent(es),ds={id:tt.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:dt(es),currentTime:tt.now()},to(ts,es,[ds],ls(es.button))&&ut(ts,"mouse")}function Es(ts,es){Ss(ts,es)}function Ts(ts,es){Ss(ts,es),tt.stopEvent(es)}function Ss(ts,es){var ds;es=tt.getEvent(es),ds={id:tt.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:dt(es),currentTime:tt.now()},lo(ts,es,[ds])}function Ds(ts,es,ds){var hs,$s=ds.getLength(),Ls=[];if(ds.type==="touch"||ds.contacts>0){for(hs=0;hs<$s;hs++)Ls.push(ds.getByIndex(hs));Ls.length>0&&(to(ts,es,Ls,0),ds.captureCount=1,ut(ts,ds.type),Js(ts,es,Ls))}}function Cs(ts,es){var ds,hs,$s,Ls=es.changedTouches.length,Rs=[],As,Ms=ts.getActivePointersListByType("touch");for(ds=tt.now(),Ms.getLength()>es.touches.length-Ls&&(tt.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),Ds(ts,es,Ms)),hs=0;hs<Ls;hs++)Rs.push({id:es.changedTouches[hs].identifier,type:"touch",currentPos:dt(es.changedTouches[hs]),currentTime:ds});for(Qs(ts,es,Rs),hs=0;hs<et.length;hs++)if(et[hs]!==ts&&et[hs].isTracking()&&ss(et[hs].element,ts.element)){for(As=[],$s=0;$s<Ls;$s++)As.push({id:es.changedTouches[$s].identifier,type:"touch",currentPos:dt(es.changedTouches[$s]),currentTime:ds});Qs(et[hs],es,As)}so(ts,es,Rs,0)&&(tt.stopEvent(es),lt(ts,"touch",Ls)),tt.cancelEvent(es)}function Is(ts,es){_s(ts,es)}function ks(ts,es){_s(ts,es),tt.stopEvent(es)}function _s(ts,es){var ds,hs,$s,Ls=es.changedTouches.length,Rs=[],As;for(ds=tt.now(),hs=0;hs<Ls;hs++)Rs.push({id:es.changedTouches[hs].identifier,type:"touch",currentPos:dt(es.changedTouches[hs]),currentTime:ds});for(to(ts,es,Rs,0)&&ut(ts,"touch",Ls),Js(ts,es,Rs),hs=0;hs<et.length;hs++)if(et[hs]!==ts&&et[hs].isTracking()&&ss(et[hs].element,ts.element)){for(As=[],$s=0;$s<Ls;$s++)As.push({id:es.changedTouches[$s].identifier,type:"touch",currentPos:dt(es.changedTouches[$s]),currentTime:ds});Js(et[hs],es,As)}tt.cancelEvent(es)}function Os(ts,es){Vs(ts,es)}function Ys(ts,es){Vs(ts,es),tt.stopEvent(es)}function Vs(ts,es){var ds,hs=es.changedTouches.length,$s=[];for(ds=0;ds<hs;ds++)$s.push({id:es.changedTouches[ds].identifier,type:"touch",currentPos:dt(es.changedTouches[ds]),currentTime:tt.now()});lo(ts,es,$s),tt.cancelEvent(es)}function js(ts,es){var ds=ts.getActivePointersListByType("touch");Ds(ts,es,ds)}function Ws(ts,es){return es.stopPropagation(),es.preventDefault(),!1}function Jr(ts,es){return es.stopPropagation(),es.preventDefault(),!1}function as(ts,es){var ds;es.currentTarget===es.relatedTarget||ss(es.currentTarget,es.relatedTarget)||(ds={id:es.pointerId,type:ct(es),isPrimary:es.isPrimary,currentPos:dt(es),currentTime:tt.now()},Qs(ts,es,[ds]))}function bs(ts,es){var ds;es.currentTarget===es.relatedTarget||ss(es.currentTarget,es.relatedTarget)||(ds={id:es.pointerId,type:ct(es),isPrimary:es.isPrimary,currentPos:dt(es),currentTime:tt.now()},Js(ts,es,[ds]))}function xs(ts,es){var ds;ds={id:es.pointerId,type:ct(es),isPrimary:es.isPrimary,currentPos:dt(es),currentTime:tt.now()},so(ts,es,[ds],es.button)&&(tt.stopEvent(es),lt(ts,ds.type)),(ts.clickHandler||ts.dblClickHandler||ts.pressHandler||ts.dragHandler||ts.dragEndHandler||ts.pinchHandler)&&tt.cancelEvent(es)}function ws(ts,es){Ps(ts,es)}function Bs(ts,es){var ds=ts.getActivePointersListByType(ct(es));ds.getById(es.pointerId)&&Ps(ts,es),tt.stopEvent(es)}function Ps(ts,es){var ds;ds={id:es.pointerId,type:ct(es),isPrimary:es.isPrimary,currentPos:dt(es),currentTime:tt.now()},to(ts,es,[ds],es.button)&&ut(ts,ds.type)}function qs(ts,es){zs(ts,es)}function Ks(ts,es){var ds=ts.getActivePointersListByType(ct(es));ds.getById(es.pointerId)&&zs(ts,es),tt.stopEvent(es)}function zs(ts,es){var ds;ds={id:es.pointerId,type:ct(es),isPrimary:es.isPrimary,currentPos:dt(es),currentTime:tt.now()},lo(ts,es,[ds])}function Ns(ts,es){var ds;ds={id:es.pointerId,type:ct(es)},mo(ts,es,[ds])}function Zs(ts,es){return Object.prototype.hasOwnProperty.call(es,"isPrimary")||(ts.getLength()===0?es.isPrimary=!0:es.isPrimary=!1),es.speed=0,es.direction=0,es.contactPos=es.currentPos,es.contactTime=es.currentTime,es.lastPos=es.currentPos,es.lastTime=es.currentTime,ts.add(es)}function Gs(ts,es){var ds,hs;return ts.getById(es.id)?(ds=ts.removeById(es.id),Object.prototype.hasOwnProperty.call(es,"isPrimary")||(hs=ts.getPrimary(),hs||(hs=ts.getByIndex(0),hs&&(hs.isPrimary=!0)))):ds=ts.getLength(),ds}function Qs(ts,es,ds){var hs=ts.getActivePointersListByType(ds[0].type),$s,Ls=ds.length,Rs,As,Ms;for($s=0;$s<Ls;$s++)Rs=ds[$s],As=hs.getById(Rs.id),As?(As.insideElement=!0,As.lastPos=As.currentPos,As.lastTime=As.currentTime,As.currentPos=Rs.currentPos,As.currentTime=Rs.currentTime,Rs=As):(Rs.captured=!1,Rs.insideElementPressed=!1,Rs.insideElement=!0,Zs(hs,Rs)),ts.enterHandler&&(Ms=ts.enterHandler({eventSource:ts,pointerType:Rs.type,position:pt(Rs.currentPos,ts.element),buttons:hs.buttons,pointers:ts.getActivePointerCount(),insideElementPressed:Rs.insideElementPressed,buttonDownAny:hs.buttons!==0,isTouchEvent:Rs.type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Ms===!1&&tt.cancelEvent(es))}function Js(ts,es,ds){var hs=ts.getActivePointersListByType(ds[0].type),$s,Ls=ds.length,Rs,As,Ms;for($s=0;$s<Ls;$s++)Rs=ds[$s],As=hs.getById(Rs.id),As&&(As.captured?(As.insideElement=!1,As.lastPos=As.currentPos,As.lastTime=As.currentTime,As.currentPos=Rs.currentPos,As.currentTime=Rs.currentTime):Gs(hs,As),Rs=As),ts.exitHandler&&(Ms=ts.exitHandler({eventSource:ts,pointerType:Rs.type,position:Rs.currentPos&&pt(Rs.currentPos,ts.element),buttons:hs.buttons,pointers:ts.getActivePointerCount(),insideElementPressed:As?As.insideElementPressed:!1,buttonDownAny:hs.buttons!==0,isTouchEvent:Rs.type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Ms===!1&&tt.cancelEvent(es))}function so(ts,es,ds,hs){var $s=nt[ts.hash],Ls,Rs=ts.getActivePointersListByType(ds[0].type),As,Ms=ds.length,Us,Hs;typeof es.buttons<"u"?Rs.buttons=es.buttons:tt.Browser.vendor===tt.BROWSERS.IE&&tt.Browser.version<9?hs===0?Rs.buttons+=1:hs===1?Rs.buttons+=4:hs===2?Rs.buttons+=2:hs===3?Rs.buttons+=8:hs===4?Rs.buttons+=16:hs===5&&(Rs.buttons+=32):hs===0?Rs.buttons|=1:hs===1?Rs.buttons|=4:hs===2?Rs.buttons|=2:hs===3?Rs.buttons|=8:hs===4?Rs.buttons|=16:hs===5&&(Rs.buttons|=32);var Xs=ts.getActivePointersListsExceptType(ds[0].type);for(As=0;As<Xs.length;As++)Ds(ts,es,Xs[As]);if(hs!==0)return ts.nonPrimaryPressHandler&&(Ls=ts.nonPrimaryPressHandler({eventSource:ts,pointerType:ds[0].type,position:pt(ds[0].currentPos,ts.element),button:hs,buttons:Rs.buttons,isTouchEvent:ds[0].type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Ls===!1&&tt.cancelEvent(es)),!1;for(As=0;As<Ms;As++)Us=ds[As],Hs=Rs.getById(Us.id),Hs?(Hs.captured=!0,Hs.insideElementPressed=!0,Hs.insideElement=!0,Hs.contactPos=Us.currentPos,Hs.contactTime=Us.currentTime,Hs.lastPos=Hs.currentPos,Hs.lastTime=Hs.currentTime,Hs.currentPos=Us.currentPos,Hs.currentTime=Us.currentTime,Us=Hs):(Us.captured=!0,Us.insideElementPressed=!0,Us.insideElement=!0,Zs(Rs,Us)),Rs.addContact(),(ts.dragHandler||ts.dragEndHandler||ts.pinchHandler)&&tt.MouseTracker.gesturePointVelocityTracker.addPoint(ts,Us),Rs.contacts===1?ts.pressHandler&&(Ls=ts.pressHandler({eventSource:ts,pointerType:Us.type,position:pt(Us.contactPos,ts.element),buttons:Rs.buttons,isTouchEvent:Us.type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Ls===!1&&tt.cancelEvent(es)):Rs.contacts===2&&ts.pinchHandler&&Us.type==="touch"&&($s.pinchGPoints=Rs.asArray(),$s.lastPinchDist=$s.currentPinchDist=$s.pinchGPoints[0].currentPos.distanceTo($s.pinchGPoints[1].currentPos),$s.lastPinchCenter=$s.currentPinchCenter=gt($s.pinchGPoints[0].currentPos,$s.pinchGPoints[1].currentPos));return!0}function to(ts,es,ds,hs){var $s=nt[ts.hash],Ls=ts.getActivePointersListByType(ds[0].type),Rs,As,Ms,Us,Hs=ds.length,Xs,Fs,no=!1,io=!1,uo;if(typeof es.buttons<"u"?Ls.buttons=es.buttons:tt.Browser.vendor===tt.BROWSERS.IE&&tt.Browser.version<9?hs===0?Ls.buttons-=1:hs===1?Ls.buttons-=4:hs===2?Ls.buttons-=2:hs===3?Ls.buttons-=8:hs===4?Ls.buttons-=16:hs===5&&(Ls.buttons-=32):hs===0?Ls.buttons^=-2:hs===1?Ls.buttons^=-5:hs===2?Ls.buttons^=-3:hs===3?Ls.buttons^=-9:hs===4?Ls.buttons^=-17:hs===5&&(Ls.buttons^=-33),hs!==0){ts.nonPrimaryReleaseHandler&&(Rs=ts.nonPrimaryReleaseHandler({eventSource:ts,pointerType:ds[0].type,position:pt(ds[0].currentPos,ts.element),button:hs,buttons:Ls.buttons,isTouchEvent:ds[0].type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Rs===!1&&tt.cancelEvent(es));var yo=ts.getActivePointersListByType("mouse");return Ds(ts,es,yo),!1}if(typeof ds[0].currentPos>"u")return Ds(ts,es,Ls),!1;for(Us=0;Us<Hs;Us++)Xs=ds[Us],Fs=Ls.getById(Xs.id),Fs&&(Fs.captured&&(Fs.captured=!1,no=!0,io=!0),Fs.lastPos=Fs.currentPos,Fs.lastTime=Fs.currentTime,Fs.currentPos=Xs.currentPos,Fs.currentTime=Xs.currentTime,Fs.insideElement||Gs(Ls,Fs),As=Fs.currentPos,Ms=Fs.currentTime,io?(Ls.removeContact(),(ts.dragHandler||ts.dragEndHandler||ts.pinchHandler)&&tt.MouseTracker.gesturePointVelocityTracker.removePoint(ts,Fs),Ls.contacts===0?(ts.releaseHandler&&(Rs=ts.releaseHandler({eventSource:ts,pointerType:Fs.type,position:pt(As,ts.element),buttons:Ls.buttons,insideElementPressed:Fs.insideElementPressed,insideElementReleased:Fs.insideElement,isTouchEvent:Fs.type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Rs===!1&&tt.cancelEvent(es)),ts.dragEndHandler&&!Fs.currentPos.equals(Fs.contactPos)&&(Rs=ts.dragEndHandler({eventSource:ts,pointerType:Fs.type,position:pt(Fs.currentPos,ts.element),speed:Fs.speed,direction:Fs.direction,shift:es.shiftKey,isTouchEvent:Fs.type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Rs===!1&&tt.cancelEvent(es)),(ts.clickHandler||ts.dblClickHandler)&&Fs.insideElement&&(uo=Ms-Fs.contactTime<=ts.clickTimeThreshold&&Fs.contactPos.distanceTo(As)<=ts.clickDistThreshold,ts.clickHandler&&(Rs=ts.clickHandler({eventSource:ts,pointerType:Fs.type,position:pt(Fs.currentPos,ts.element),quick:uo,shift:es.shiftKey,isTouchEvent:Fs.type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Rs===!1&&tt.cancelEvent(es)),ts.dblClickHandler&&uo&&(Ls.clicks++,Ls.clicks===1?($s.lastClickPos=As,$s.dblClickTimeOut=setTimeout(function(){Ls.clicks=0},ts.dblClickTimeThreshold)):Ls.clicks===2&&(clearTimeout($s.dblClickTimeOut),Ls.clicks=0,$s.lastClickPos.distanceTo(As)<=ts.dblClickDistThreshold&&(Rs=ts.dblClickHandler({eventSource:ts,pointerType:Fs.type,position:pt(Fs.currentPos,ts.element),shift:es.shiftKey,isTouchEvent:Fs.type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Rs===!1&&tt.cancelEvent(es)),$s.lastClickPos=null)))):Ls.contacts===2&&ts.pinchHandler&&Fs.type==="touch"&&($s.pinchGPoints=Ls.asArray(),$s.lastPinchDist=$s.currentPinchDist=$s.pinchGPoints[0].currentPos.distanceTo($s.pinchGPoints[1].currentPos),$s.lastPinchCenter=$s.currentPinchCenter=gt($s.pinchGPoints[0].currentPos,$s.pinchGPoints[1].currentPos))):ts.releaseHandler&&(Rs=ts.releaseHandler({eventSource:ts,pointerType:Fs.type,position:pt(As,ts.element),buttons:Ls.buttons,insideElementPressed:Fs.insideElementPressed,insideElementReleased:Fs.insideElement,isTouchEvent:Fs.type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Rs===!1&&tt.cancelEvent(es)));return no}function lo(ts,es,ds){var hs=nt[ts.hash],$s=ts.getActivePointersListByType(ds[0].type),Ls,Rs=ds.length,As,Ms,Us,Hs,Xs;for(typeof es.buttons<"u"&&($s.buttons=es.buttons),Ls=0;Ls<Rs;Ls++)As=ds[Ls],Ms=$s.getById(As.id),Ms?(Object.prototype.hasOwnProperty.call(As,"isPrimary")&&(Ms.isPrimary=As.isPrimary),Ms.lastPos=Ms.currentPos,Ms.lastTime=Ms.currentTime,Ms.currentPos=As.currentPos,Ms.currentTime=As.currentTime):(As.captured=!1,As.insideElementPressed=!1,As.insideElement=!0,Zs($s,As));ts.stopHandler&&ds[0].type==="mouse"&&(clearTimeout(ts.stopTimeOut),ts.stopTimeOut=setTimeout(function(){vo(ts,es,ds[0].type)},ts.stopDelay)),$s.contacts===0?ts.moveHandler&&(Xs=ts.moveHandler({eventSource:ts,pointerType:ds[0].type,position:pt(ds[0].currentPos,ts.element),buttons:$s.buttons,isTouchEvent:ds[0].type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Xs===!1&&tt.cancelEvent(es)):$s.contacts===1?(ts.moveHandler&&(Ms=$s.asArray()[0],Xs=ts.moveHandler({eventSource:ts,pointerType:Ms.type,position:pt(Ms.currentPos,ts.element),buttons:$s.buttons,isTouchEvent:Ms.type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Xs===!1&&tt.cancelEvent(es)),ts.dragHandler&&(Ms=$s.asArray()[0],Hs=Ms.currentPos.minus(Ms.lastPos),Xs=ts.dragHandler({eventSource:ts,pointerType:Ms.type,position:pt(Ms.currentPos,ts.element),buttons:$s.buttons,delta:Hs,speed:Ms.speed,direction:Ms.direction,shift:es.shiftKey,isTouchEvent:Ms.type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Xs===!1&&tt.cancelEvent(es))):$s.contacts===2&&(ts.moveHandler&&(Us=$s.asArray(),Xs=ts.moveHandler({eventSource:ts,pointerType:Us[0].type,position:pt(gt(Us[0].currentPos,Us[1].currentPos),ts.element),buttons:$s.buttons,isTouchEvent:Us[0].type==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Xs===!1&&tt.cancelEvent(es)),ts.pinchHandler&&ds[0].type==="touch"&&(Hs=hs.pinchGPoints[0].currentPos.distanceTo(hs.pinchGPoints[1].currentPos),Hs!=hs.currentPinchDist&&(hs.lastPinchDist=hs.currentPinchDist,hs.currentPinchDist=Hs,hs.lastPinchCenter=hs.currentPinchCenter,hs.currentPinchCenter=gt(hs.pinchGPoints[0].currentPos,hs.pinchGPoints[1].currentPos),Xs=ts.pinchHandler({eventSource:ts,pointerType:"touch",gesturePoints:hs.pinchGPoints,lastCenter:pt(hs.lastPinchCenter,ts.element),center:pt(hs.currentPinchCenter,ts.element),lastDistance:hs.lastPinchDist,distance:hs.currentPinchDist,shift:es.shiftKey,originalEvent:es,preventDefaultAction:!1,userData:ts.userData}),Xs===!1&&tt.cancelEvent(es))))}function mo(ts,es,ds){to(ts,es,ds,0),Js(ts,es,ds)}function vo(ts,es,ds){ts.stopHandler&&ts.stopHandler({eventSource:ts,pointerType:ds,position:ft(es,ts.element),buttons:ts.getActivePointersListByType(ds).buttons,isTouchEvent:ds==="touch",originalEvent:es,preventDefaultAction:!1,userData:ts.userData})}var co=function(){try{return window.self!==window.top}catch{return!0}}();function fo(ts){try{return ts.addEventListener&&ts.removeEventListener}catch{return!1}}}(OpenSeadragon),function(tt){tt.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},tt.Control=function(et,nt,rt){var it=et.parentNode;typeof nt=="number"&&(tt.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),nt={anchor:nt}),nt.attachToViewer=typeof nt.attachToViewer>"u"?!0:nt.attachToViewer,this.autoFade=typeof nt.autoFade>"u"?!0:nt.autoFade,this.element=et,this.anchor=nt.anchor,this.container=rt,this.anchor==tt.ControlAnchor.ABSOLUTE?(this.wrapper=tt.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top=typeof nt.top=="number"?nt.top+"px":nt.top,this.wrapper.style.left=typeof nt.left=="number"?nt.left+"px":nt.left,this.wrapper.style.height=typeof nt.height=="number"?nt.height+"px":nt.height,this.wrapper.style.width=typeof nt.width=="number"?nt.width+"px":nt.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=tt.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==tt.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),nt.attachToViewer?this.anchor==tt.ControlAnchor.TOP_RIGHT||this.anchor==tt.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):it.appendChild(this.wrapper)},tt.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!="none"},setVisible:function(et){this.wrapper.style.display=et?this.anchor==tt.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(et){this.element[tt.SIGNAL]&&tt.Browser.vendor==tt.BROWSERS.IE?tt.setElementOpacity(this.element,et,!0):tt.setElementOpacity(this.wrapper,et,!0)}}}(OpenSeadragon),function(tt){tt.ControlDock=function(nt){var rt=["topleft","topright","bottomright","bottomleft"],it,st;for(tt.extend(!0,this,{id:"controldock-"+tt.now()+"-"+Math.floor(Math.random()*1e6),container:tt.makeNeutralElement("div"),controls:[]},nt),this.container.onsubmit=function(){return!1},this.element&&(this.element=tt.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),st=0;st<rt.length;st++)it=rt[st],this.controls[it]=tt.makeNeutralElement("div"),this.controls[it].style.position="absolute",it.match("left")&&(this.controls[it].style.left="0px"),it.match("right")&&(this.controls[it].style.right="0px"),it.match("top")&&(this.controls[it].style.top="0px"),it.match("bottom")&&(this.controls[it].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},tt.ControlDock.prototype={addControl:function(nt,rt){nt=tt.getElement(nt);var it=null;if(!(et(this,nt)>=0)){switch(rt.anchor){case tt.ControlAnchor.TOP_RIGHT:it=this.controls.topright,nt.style.position="relative",nt.style.paddingRight="0px",nt.style.paddingTop="0px";break;case tt.ControlAnchor.BOTTOM_RIGHT:it=this.controls.bottomright,nt.style.position="relative",nt.style.paddingRight="0px",nt.style.paddingBottom="0px";break;case tt.ControlAnchor.BOTTOM_LEFT:it=this.controls.bottomleft,nt.style.position="relative",nt.style.paddingLeft="0px",nt.style.paddingBottom="0px";break;case tt.ControlAnchor.TOP_LEFT:it=this.controls.topleft,nt.style.position="relative",nt.style.paddingLeft="0px",nt.style.paddingTop="0px";break;case tt.ControlAnchor.ABSOLUTE:it=this.container,nt.style.margin="0px",nt.style.padding="0px";break;default:case tt.ControlAnchor.NONE:it=this.container,nt.style.margin="0px",nt.style.padding="0px";break}this.controls.push(new tt.Control(nt,rt,it)),nt.style.display="inline-block"}},removeControl:function(nt){nt=tt.getElement(nt);var rt=et(this,nt);return rt>=0&&(this.controls[rt].destroy(),this.controls.splice(rt,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var nt;for(nt=this.controls.length-1;nt>=0;nt--)if(this.controls[nt].isVisible())return!0;return!1},setControlsEnabled:function(nt){var rt;for(rt=this.controls.length-1;rt>=0;rt--)this.controls[rt].setVisible(nt);return this}};function et(nt,rt){var it=nt.controls,st;for(st=it.length-1;st>=0;st--)if(it[st].element==rt)return st;return-1}}(OpenSeadragon),function(tt){tt.Placement=tt.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function(tt){var et={},nt=1;tt.Viewer=function(Jr){var as=arguments,bs=this,xs;if(tt.isPlainObject(Jr)||(Jr={id:as[0],xmlPath:as.length>1?as[1]:void 0,prefixUrl:as.length>2?as[2]:void 0,controls:as.length>3?as[3]:void 0,overlays:as.length>4?as[4]:void 0}),Jr.config&&(tt.extend(!0,Jr,Jr.config),delete Jr.config),tt.extend(!0,this,{id:Jr.id,hash:Jr.hash||nt++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},tt.DEFAULT_SETTINGS,Jr),typeof this.hash>"u")throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(typeof et[this.hash]<"u"&&tt.console.warn("Hash "+this.hash+" has already been used."),et[this.hash]={fsBoundsDelta:new tt.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=tt.now(),tt.EventSource.call(this),this.addHandler("open-failed",function(ws){var Bs=tt.getString("Errors.OpenFailed",ws.eventSource,ws.message);bs._showMessage(Bs)}),tt.ControlDock.call(this,Jr),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=tt.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(ws){ws.width="100%",ws.height="100%",ws.overflow="hidden",ws.position="absolute",ws.top="0px",ws.left="0px"}(this.canvas.style),tt.setElementTouchActionNone(this.canvas),Jr.tabIndex!==""&&(this.canvas.tabIndex=Jr.tabIndex===void 0?0:Jr.tabIndex),this.container.className="openseadragon-container",function(ws){ws.width="100%",ws.height="100%",ws.position="relative",ws.overflow="hidden",ws.left="0px",ws.top="0px",ws.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new tt.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:tt.delegate(this,_r),keyHandler:tt.delegate(this,Yr),clickHandler:tt.delegate(this,mt),dblClickHandler:tt.delegate(this,Kr),dragHandler:tt.delegate(this,Xr),dragEndHandler:tt.delegate(this,Zr),enterHandler:tt.delegate(this,Qr),exitHandler:tt.delegate(this,_i),pressHandler:tt.delegate(this,rs),releaseHandler:tt.delegate(this,ns),nonPrimaryPressHandler:tt.delegate(this,ss),nonPrimaryReleaseHandler:tt.delegate(this,fs),scrollHandler:tt.delegate(this,is),pinchHandler:tt.delegate(this,os)}),this.outerTracker=new tt.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:tt.delegate(this,cs),exitHandler:tt.delegate(this,ps)}),this.toolbar&&(this.toolbar=new tt.ControlDock({element:this.toolbar})),this.bindStandardControls(),et[this.hash].prevContainerSize=rt(this.container),this.world=new tt.World({viewer:this}),this.world.addHandler("add-item",function(ws){bs.source=bs.world.getItemAt(0).source,et[bs.hash].forceRedraw=!0,bs._updateRequestId||(bs._updateRequestId=lt(bs,vs))}),this.world.addHandler("remove-item",function(ws){bs.world.getItemCount()?bs.source=bs.world.getItemAt(0).source:bs.source=null,et[bs.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(ws){bs.viewport&&bs.viewport._setContentBounds(bs.world.getHomeBounds(),bs.world.getContentFactor())}),this.world.addHandler("item-index-change",function(ws){bs.source=bs.world.getItemAt(0).source}),this.viewport=new tt.Viewport({containerSize:et[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new tt.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:Jr.timeout}),this.tileCache=new tt.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new tt.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=tt.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(xs=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(xs,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(xs=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(xs,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new tt.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),xs=0;xs<this.customControls.length;xs++)this.addControl(this.customControls[xs].id,{anchor:this.customControls[xs].anchor});tt.requestAnimationFrame(function(){ct(bs)}),this.imageSmoothingEnabled!==void 0&&!this.imageSmoothingEnabled&&this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled)},tt.extend(tt.Viewer.prototype,tt.EventSource.prototype,tt.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(Jr){return tt.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(Jr)},openTileSource:function(Jr){return tt.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(Jr)},open:function(Jr,as){var bs=this;if(this.close(),!!Jr){if(this.sequenceMode&&tt.isArray(Jr)){this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),typeof as<"u"&&!isNaN(as)&&(this.initialPage=as),this.tileSources=Jr,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex);return}if(tt.isArray(Jr)||(Jr=[Jr]),!!Jr.length){this._opening=!0;for(var xs=Jr.length,ws=0,Bs=0,Ps,qs=function(){if(ws+Bs===xs)if(ws){(bs._firstOpen||!bs.preserveViewport)&&(bs.viewport.goHome(!0),bs.viewport.update()),bs._firstOpen=!1;var Ns=Jr[0];if(Ns.tileSource&&(Ns=Ns.tileSource),bs.overlays&&!bs.preserveOverlays)for(var Zs=0;Zs<bs.overlays.length;Zs++)bs.currentOverlays[Zs]=st(bs,bs.overlays[Zs]);bs._drawOverlays(),bs._opening=!1,bs.raiseEvent("open",{source:Ns})}else bs._opening=!1,bs.raiseEvent("open-failed",Ps)},Ks=function(Ns){(!tt.isPlainObject(Ns)||!Ns.tileSource)&&(Ns={tileSource:Ns}),Ns.index!==void 0&&(tt.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete Ns.index),Ns.collectionImmediately===void 0&&(Ns.collectionImmediately=!0);var Zs=Ns.success;Ns.success=function(Qs){if(ws++,Ns.tileSource.overlays)for(var Js=0;Js<Ns.tileSource.overlays.length;Js++)bs.addOverlay(Ns.tileSource.overlays[Js]);Zs&&Zs(Qs),qs()};var Gs=Ns.error;Ns.error=function(Qs){Bs++,Ps||(Ps=Qs),Gs&&Gs(Qs),qs()},bs.addTiledImage(Ns)},zs=0;zs<Jr.length;zs++)Ks(Jr[zs]);return this}}},close:function(){return et[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),et[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(et[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this._updateRequestId!==null&&(tt.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),et[this.hash]=null,delete et[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(Jr){return this.innerTracker.setTracking(Jr),this.outerTracker.setTracking(Jr),this.raiseEvent("mouse-enabled",{enabled:Jr}),this},areControlsEnabled:function(){var Jr=this.controls.length,as;for(as=0;as<this.controls.length;as++)Jr=Jr&&this.controls[as].isVisible();return Jr},setControlsEnabled:function(Jr){return Jr?ft(this):ct(this),this.raiseEvent("controls-enabled",{enabled:Jr}),this},setDebugMode:function(Jr){for(var as=0;as<this.world.getItemCount();as++)this.world.getItemAt(as).debugMode=Jr;this.debugMode=Jr,this.forceRedraw()},isFullPage:function(){return et[this.hash].fullPage},setFullPage:function(Jr){var as=document.body,bs=as.style,xs=document.documentElement.style,ws=this,Bs,Ps;if(Jr==this.isFullPage())return this;var qs={fullPage:Jr,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",qs),qs.preventDefaultAction)return this;if(Jr){for(this.elementSize=tt.getElementSize(this.element),this.pageScroll=tt.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=bs.margin,this.docMargin=xs.margin,bs.margin="0",xs.margin="0",this.bodyPadding=bs.padding,this.docPadding=xs.padding,bs.padding="0",xs.padding="0",this.bodyWidth=bs.width,this.docWidth=xs.width,bs.width="100%",xs.width="100%",this.bodyHeight=bs.height,this.docHeight=xs.height,bs.height="100%",xs.height="100%",this.previousBody=[],et[this.hash].prevElementParent=this.element.parentNode,et[this.hash].prevNextSibling=this.element.nextSibling,et[this.hash].prevElementWidth=this.element.style.width,et[this.hash].prevElementHeight=this.element.style.height,Bs=as.childNodes.length,Ps=0;Ps<Bs;Ps++)this.previousBody.push(as.childNodes[0]),as.removeChild(as.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,as.appendChild(this.toolbar.element),tt.addClass(this.toolbar.element,"fullpage")),tt.addClass(this.element,"fullpage"),as.appendChild(this.element),this.element.style.height=tt.getWindowSize().y+"px",this.element.style.width=tt.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=tt.getElementSize(this.element).y-tt.getElementSize(this.toolbar.element).y+"px"),et[this.hash].fullPage=!0,tt.delegate(this,cs)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,bs.margin=this.bodyMargin,xs.margin=this.docMargin,bs.padding=this.bodyPadding,xs.padding=this.docPadding,bs.width=this.bodyWidth,xs.width=this.docWidth,bs.height=this.bodyHeight,xs.height=this.docHeight,as.removeChild(this.element),Bs=this.previousBody.length,Ps=0;Ps<Bs;Ps++)as.appendChild(this.previousBody.shift());tt.removeClass(this.element,"fullpage"),et[this.hash].prevElementParent.insertBefore(this.element,et[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(as.removeChild(this.toolbar.element),tt.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=et[this.hash].prevElementWidth,this.element.style.height=et[this.hash].prevElementHeight;var Ks=0,zs=function(){tt.setPageScroll(ws.pageScroll);var Ns=tt.getPageScroll();Ks++,Ks<10&&(Ns.x!==ws.pageScroll.x||Ns.y!==ws.pageScroll.y)&&tt.requestAnimationFrame(zs)};tt.requestAnimationFrame(zs),et[this.hash].fullPage=!1,tt.delegate(this,ps)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:Jr}),this},setFullScreen:function(Jr){var as=this;if(!tt.supportsFullScreen)return this.setFullPage(Jr);if(tt.isFullScreen()===Jr)return this;var bs={fullScreen:Jr,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",bs),bs.preventDefaultAction)return this;if(Jr){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var xs=function(){var ws=tt.isFullScreen();ws||(tt.removeEvent(document,tt.fullScreenEventName,xs),tt.removeEvent(document,tt.fullScreenErrorEventName,xs),as.setFullPage(!1),as.isFullPage()&&(as.element.style.width=as.fullPageStyleWidth,as.element.style.height=as.fullPageStyleHeight)),as.navigator&&as.viewport&&setTimeout(function(){as.navigator.update(as.viewport)}),as.raiseEvent("full-screen",{fullScreen:ws})};tt.addEvent(document,tt.fullScreenEventName,xs),tt.addEvent(document,tt.fullScreenErrorEventName,xs),tt.requestFullScreen(document.body)}else tt.exitFullScreen();return this},isVisible:function(){return this.container.style.visibility!="hidden"},setVisible:function(Jr){return this.container.style.visibility=Jr?"":"hidden",this.raiseEvent("visible",{visible:Jr}),this},addTiledImage:function(Jr){tt.console.assert(Jr,"[Viewer.addTiledImage] options is required"),tt.console.assert(Jr.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),tt.console.assert(!Jr.replace||Jr.index>-1&&Jr.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var as=this;Jr.replace&&(Jr.replaceItem=as.world.getItemAt(Jr.index)),this._hideMessage(),Jr.placeholderFillStyle===void 0&&(Jr.placeholderFillStyle=this.placeholderFillStyle),Jr.opacity===void 0&&(Jr.opacity=this.opacity),Jr.preload===void 0&&(Jr.preload=this.preload),Jr.compositeOperation===void 0&&(Jr.compositeOperation=this.compositeOperation),Jr.crossOriginPolicy===void 0&&(Jr.crossOriginPolicy=Jr.tileSource.crossOriginPolicy!==void 0?Jr.tileSource.crossOriginPolicy:this.crossOriginPolicy),Jr.ajaxWithCredentials===void 0&&(Jr.ajaxWithCredentials=this.ajaxWithCredentials),Jr.loadTilesWithAjax===void 0&&(Jr.loadTilesWithAjax=this.loadTilesWithAjax),Jr.ajaxHeaders===void 0||Jr.ajaxHeaders===null?Jr.ajaxHeaders=this.ajaxHeaders:tt.isPlainObject(Jr.ajaxHeaders)&&tt.isPlainObject(this.ajaxHeaders)&&(Jr.ajaxHeaders=tt.extend({},this.ajaxHeaders,Jr.ajaxHeaders));var bs={options:Jr};function xs(Ps){for(var qs=0;qs<as._loadQueue.length;qs++)if(as._loadQueue[qs]===bs){as._loadQueue.splice(qs,1);break}as._loadQueue.length===0&&ws(bs),as.raiseEvent("add-item-failed",Ps),Jr.error&&Jr.error(Ps)}function ws(Ps){as.collectionMode&&(as.world.arrange({immediately:Ps.options.collectionImmediately,rows:as.collectionRows,columns:as.collectionColumns,layout:as.collectionLayout,tileSize:as.collectionTileSize,tileMargin:as.collectionTileMargin}),as.world.setAutoRefigureSizes(!0))}if(tt.isArray(Jr.tileSource)){setTimeout(function(){xs({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:Jr.tileSource,options:Jr})});return}this._loadQueue.push(bs);function Bs(){for(var Ps,qs,Ks;as._loadQueue.length&&(Ps=as._loadQueue[0],!!Ps.tileSource);){if(as._loadQueue.splice(0,1),Ps.options.replace){var zs=as.world.getIndexOfItem(Ps.options.replaceItem);zs!=-1&&(Ps.options.index=zs),as.world.removeItem(Ps.options.replaceItem)}qs=new tt.TiledImage({viewer:as,source:Ps.tileSource,viewport:as.viewport,drawer:as.drawer,tileCache:as.tileCache,imageLoader:as.imageLoader,x:Ps.options.x,y:Ps.options.y,width:Ps.options.width,height:Ps.options.height,fitBounds:Ps.options.fitBounds,fitBoundsPlacement:Ps.options.fitBoundsPlacement,clip:Ps.options.clip,placeholderFillStyle:Ps.options.placeholderFillStyle,opacity:Ps.options.opacity,preload:Ps.options.preload,degrees:Ps.options.degrees,compositeOperation:Ps.options.compositeOperation,springStiffness:as.springStiffness,animationTime:as.animationTime,minZoomImageRatio:as.minZoomImageRatio,wrapHorizontal:as.wrapHorizontal,wrapVertical:as.wrapVertical,immediateRender:as.immediateRender,blendTime:as.blendTime,alwaysBlend:as.alwaysBlend,minPixelRatio:as.minPixelRatio,smoothTileEdgesMinZoom:as.smoothTileEdgesMinZoom,iOSDevice:as.iOSDevice,crossOriginPolicy:Ps.options.crossOriginPolicy,ajaxWithCredentials:Ps.options.ajaxWithCredentials,loadTilesWithAjax:Ps.options.loadTilesWithAjax,ajaxHeaders:Ps.options.ajaxHeaders,debugMode:as.debugMode}),as.collectionMode&&as.world.setAutoRefigureSizes(!1),as.world.addItem(qs,{index:Ps.options.index}),as._loadQueue.length===0&&ws(Ps),as.world.getItemCount()===1&&!as.preserveViewport&&as.viewport.goHome(!0),as.navigator&&(Ks=tt.extend({},Ps.options,{replace:!1,originalTiledImage:qs,tileSource:Ps.tileSource}),as.navigator.addTiledImage(Ks)),Ps.options.success&&Ps.options.success({item:qs})}}it(this,Jr.tileSource,Jr,function(Ps){bs.tileSource=Ps,Bs()},function(Ps){Ps.options=Jr,xs(Ps),Bs()})},addSimpleImage:function(Jr){tt.console.assert(Jr,"[Viewer.addSimpleImage] options is required"),tt.console.assert(Jr.url,"[Viewer.addSimpleImage] options.url is required");var as=tt.extend({},Jr,{tileSource:{type:"image",url:Jr.url}});delete as.url,this.addTiledImage(as)},addLayer:function(Jr){var as=this;tt.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var bs=tt.extend({},Jr,{success:function(xs){as.raiseEvent("add-layer",{options:Jr,drawer:xs.item})},error:function(xs){as.raiseEvent("add-layer-failed",xs)}});return this.addTiledImage(bs),this},getLayerAtLevel:function(Jr){return tt.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(Jr)},getLevelOfLayer:function(Jr){return tt.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(Jr)},getLayersCount:function(){return tt.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(Jr,as){return tt.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(Jr,as)},removeLayer:function(Jr){return tt.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(Jr)},forceRedraw:function(){return et[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var Jr=tt.delegate(this,pt),as=tt.delegate(this,gt),bs=tt.delegate(this,Ws),xs=tt.delegate(this,js),ws=this.navImages,Bs=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(Bs=!1),this.previousButton=new tt.Button({element:this.previousButton?tt.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:tt.getString("Tooltips.PreviousPage"),srcRest:us(this.prefixUrl,ws.previous.REST),srcGroup:us(this.prefixUrl,ws.previous.GROUP),srcHover:us(this.prefixUrl,ws.previous.HOVER),srcDown:us(this.prefixUrl,ws.previous.DOWN),onRelease:xs,onFocus:Jr,onBlur:as}),this.nextButton=new tt.Button({element:this.nextButton?tt.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:tt.getString("Tooltips.NextPage"),srcRest:us(this.prefixUrl,ws.next.REST),srcGroup:us(this.prefixUrl,ws.next.GROUP),srcHover:us(this.prefixUrl,ws.next.HOVER),srcDown:us(this.prefixUrl,ws.next.DOWN),onRelease:bs,onFocus:Jr,onBlur:as}),this.navPrevNextWrap||this.previousButton.disable(),(!this.tileSources||!this.tileSources.length)&&this.nextButton.disable(),Bs&&(this.paging=new tt.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:tt.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||tt.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var Jr=tt.delegate(this,ms),as=tt.delegate(this,Es),bs=tt.delegate(this,Ds),xs=tt.delegate(this,ys),ws=tt.delegate(this,Cs),Bs=tt.delegate(this,ks),Ps=tt.delegate(this,_s),qs=tt.delegate(this,Os),Ks=tt.delegate(this,Ys),zs=tt.delegate(this,Vs),Ns=tt.delegate(this,pt),Zs=tt.delegate(this,gt),Gs=this.navImages,Qs=[],Js=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(Js=!1),this.showZoomControl&&(Qs.push(this.zoomInButton=new tt.Button({element:this.zoomInButton?tt.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:tt.getString("Tooltips.ZoomIn"),srcRest:us(this.prefixUrl,Gs.zoomIn.REST),srcGroup:us(this.prefixUrl,Gs.zoomIn.GROUP),srcHover:us(this.prefixUrl,Gs.zoomIn.HOVER),srcDown:us(this.prefixUrl,Gs.zoomIn.DOWN),onPress:Jr,onRelease:as,onClick:bs,onEnter:Jr,onExit:as,onFocus:Ns,onBlur:Zs})),Qs.push(this.zoomOutButton=new tt.Button({element:this.zoomOutButton?tt.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:tt.getString("Tooltips.ZoomOut"),srcRest:us(this.prefixUrl,Gs.zoomOut.REST),srcGroup:us(this.prefixUrl,Gs.zoomOut.GROUP),srcHover:us(this.prefixUrl,Gs.zoomOut.HOVER),srcDown:us(this.prefixUrl,Gs.zoomOut.DOWN),onPress:xs,onRelease:as,onClick:ws,onEnter:xs,onExit:as,onFocus:Ns,onBlur:Zs}))),this.showHomeControl&&Qs.push(this.homeButton=new tt.Button({element:this.homeButton?tt.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:tt.getString("Tooltips.Home"),srcRest:us(this.prefixUrl,Gs.home.REST),srcGroup:us(this.prefixUrl,Gs.home.GROUP),srcHover:us(this.prefixUrl,Gs.home.HOVER),srcDown:us(this.prefixUrl,Gs.home.DOWN),onRelease:Bs,onFocus:Ns,onBlur:Zs})),this.showFullPageControl&&Qs.push(this.fullPageButton=new tt.Button({element:this.fullPageButton?tt.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:tt.getString("Tooltips.FullPage"),srcRest:us(this.prefixUrl,Gs.fullpage.REST),srcGroup:us(this.prefixUrl,Gs.fullpage.GROUP),srcHover:us(this.prefixUrl,Gs.fullpage.HOVER),srcDown:us(this.prefixUrl,Gs.fullpage.DOWN),onRelease:Ps,onFocus:Ns,onBlur:Zs})),this.showRotationControl&&(Qs.push(this.rotateLeftButton=new tt.Button({element:this.rotateLeftButton?tt.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:tt.getString("Tooltips.RotateLeft"),srcRest:us(this.prefixUrl,Gs.rotateleft.REST),srcGroup:us(this.prefixUrl,Gs.rotateleft.GROUP),srcHover:us(this.prefixUrl,Gs.rotateleft.HOVER),srcDown:us(this.prefixUrl,Gs.rotateleft.DOWN),onRelease:qs,onFocus:Ns,onBlur:Zs})),Qs.push(this.rotateRightButton=new tt.Button({element:this.rotateRightButton?tt.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:tt.getString("Tooltips.RotateRight"),srcRest:us(this.prefixUrl,Gs.rotateright.REST),srcGroup:us(this.prefixUrl,Gs.rotateright.GROUP),srcHover:us(this.prefixUrl,Gs.rotateright.HOVER),srcDown:us(this.prefixUrl,Gs.rotateright.DOWN),onRelease:Ks,onFocus:Ns,onBlur:Zs}))),this.showFlipControl&&Qs.push(this.flipButton=new tt.Button({element:this.flipButton?tt.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:tt.getString("Tooltips.Flip"),srcRest:us(this.prefixUrl,Gs.flip.REST),srcGroup:us(this.prefixUrl,Gs.flip.GROUP),srcHover:us(this.prefixUrl,Gs.flip.HOVER),srcDown:us(this.prefixUrl,Gs.flip.DOWN),onRelease:zs,onFocus:Ns,onBlur:Zs})),Js&&(this.buttons=new tt.ButtonGroup({buttons:Qs,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",tt.delegate(this,Is)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||tt.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||tt.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(Jr){return this.tileSources&&Jr>=0&&Jr<this.tileSources.length&&(this._sequenceIndex=Jr,this._updateSequenceButtons(Jr),this.open(this.tileSources[Jr]),this.referenceStrip&&this.referenceStrip.setFocus(Jr),this.raiseEvent("page",{page:Jr})),this},addOverlay:function(Jr,as,bs,xs){var ws;if(tt.isPlainObject(Jr)?ws=Jr:ws={element:Jr,location:as,placement:bs,onDraw:xs},Jr=tt.getElement(ws.element),ot(this.currentOverlays,Jr)>=0)return this;var Bs=st(this,ws);return this.currentOverlays.push(Bs),Bs.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:Jr,location:ws.location,placement:ws.placement}),this},updateOverlay:function(Jr,as,bs){var xs;return Jr=tt.getElement(Jr),xs=ot(this.currentOverlays,Jr),xs>=0&&(this.currentOverlays[xs].update(as,bs),et[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:Jr,location:as,placement:bs})),this},removeOverlay:function(Jr){var as;return Jr=tt.getElement(Jr),as=ot(this.currentOverlays,Jr),as>=0&&(this.currentOverlays[as].destroy(),this.currentOverlays.splice(as,1),et[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:Jr})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return et[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(Jr){var as;return Jr=tt.getElement(Jr),as=ot(this.currentOverlays,Jr),as>=0?this.currentOverlays[as]:null},_updateSequenceButtons:function(Jr){this.nextButton&&(!this.tileSources||this.tileSources.length-1===Jr?this.navPrevNextWrap||this.nextButton.disable():this.nextButton.enable()),this.previousButton&&(Jr>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(Jr){this._hideMessage();var as=tt.makeNeutralElement("div");as.appendChild(document.createTextNode(Jr)),this.messageDiv=tt.makeCenteredNode(as),tt.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var Jr=this.messageDiv;Jr&&(Jr.parentNode.removeChild(Jr),delete this.messageDiv)},gestureSettingsByDeviceType:function(Jr){switch(Jr){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var Jr,as=this.currentOverlays.length;for(Jr=0;Jr<as;Jr++)this.currentOverlays[Jr].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new tt.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else tt.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}});function rt(Jr){return Jr=tt.getElement(Jr),new tt.Point(Jr.clientWidth===0?1:Jr.clientWidth,Jr.clientHeight===0?1:Jr.clientHeight)}function it(Jr,as,bs,xs,ws){var Bs=Jr;if(tt.type(as)=="string"){if(as.match(/^\s*<.*>\s*$/))as=tt.parseXml(as);else if(as.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var Ps=tt.parseJSON(as);as=Ps}catch{}}function qs(Ks,zs){Ks.ready?xs(Ks):(Ks.addHandler("ready",function(){xs(Ks)}),Ks.addHandler("open-failed",function(Ns){ws({message:Ns.message,source:zs})}))}setTimeout(function(){if(tt.type(as)=="string")as=new tt.TileSource({url:as,crossOriginPolicy:bs.crossOriginPolicy!==void 0?bs.crossOriginPolicy:Jr.crossOriginPolicy,ajaxWithCredentials:Jr.ajaxWithCredentials,ajaxHeaders:Jr.ajaxHeaders,useCanvas:Jr.useCanvas,success:function(Zs){xs(Zs.tileSource)}}),as.addHandler("open-failed",function(Zs){ws(Zs)});else if(tt.isPlainObject(as)||as.nodeType)if(as.crossOriginPolicy===void 0&&(bs.crossOriginPolicy!==void 0||Jr.crossOriginPolicy!==void 0)&&(as.crossOriginPolicy=bs.crossOriginPolicy!==void 0?bs.crossOriginPolicy:Jr.crossOriginPolicy),as.ajaxWithCredentials===void 0&&(as.ajaxWithCredentials=Jr.ajaxWithCredentials),as.useCanvas===void 0&&(as.useCanvas=Jr.useCanvas),tt.isFunction(as.getTileUrl)){var Ks=new tt.TileSource(as);Ks.getTileUrl=as.getTileUrl,xs(Ks)}else{var zs=tt.TileSource.determineType(Bs,as);if(!zs){ws({message:"Unable to load TileSource",source:as});return}var Ns=zs.prototype.configure.apply(Bs,[as]);qs(new zs(Ns),as)}else qs(as,as)})}function st(Jr,as){if(as instanceof tt.Overlay)return as;var bs=null;if(as.element)bs=tt.getElement(as.element);else{var xs=as.id?as.id:"openseadragon-overlay-"+Math.floor(Math.random()*1e7);bs=tt.getElement(as.id),bs||(bs=document.createElement("a"),bs.href="#/overlay/"+xs),bs.id=xs,tt.addClass(bs,as.className?as.className:"openseadragon-overlay")}var ws=as.location,Bs=as.width,Ps=as.height;if(!ws){var qs=as.x,Ks=as.y;if(as.px!==void 0){var zs=Jr.viewport.imageToViewportRectangle(new tt.Rect(as.px,as.py,Bs||0,Ps||0));qs=zs.x,Ks=zs.y,Bs=Bs!==void 0?zs.width:void 0,Ps=Ps!==void 0?zs.height:void 0}ws=new tt.Point(qs,Ks)}var Ns=as.placement;return Ns&&tt.type(Ns)==="string"&&(Ns=tt.Placement[as.placement.toUpperCase()]),new tt.Overlay({element:bs,location:ws,placement:Ns,onDraw:as.onDraw,checkResize:as.checkResize,width:Bs,height:Ps,rotationMode:as.rotationMode})}function ot(Jr,as){var bs;for(bs=Jr.length-1;bs>=0;bs--)if(Jr[bs].element===as)return bs;return-1}function lt(Jr,as){return tt.requestAnimationFrame(function(){as(Jr)})}function ut(Jr){tt.requestAnimationFrame(function(){dt(Jr)})}function ct(Jr){Jr.autoHideControls&&(Jr.controlsShouldFade=!0,Jr.controlsFadeBeginTime=tt.now()+Jr.controlsFadeDelay,window.setTimeout(function(){ut(Jr)},Jr.controlsFadeDelay))}function dt(Jr){var as,bs,xs,ws;if(Jr.controlsShouldFade){for(as=tt.now(),bs=as-Jr.controlsFadeBeginTime,xs=1-bs/Jr.controlsFadeLength,xs=Math.min(1,xs),xs=Math.max(0,xs),ws=Jr.controls.length-1;ws>=0;ws--)Jr.controls[ws].autoFade&&Jr.controls[ws].setOpacity(xs);xs>0&&ut(Jr)}}function ft(Jr){var as;for(Jr.controlsShouldFade=!1,as=Jr.controls.length-1;as>=0;as--)Jr.controls[as].setOpacity(1)}function pt(){ft(this)}function gt(){ct(this)}function _r(Jr){var as={originalEvent:Jr.originalEvent,preventDefaultAction:Jr.preventDefaultAction,preventVerticalPan:Jr.preventVerticalPan,preventHorizontalPan:Jr.preventHorizontalPan};if(this.raiseEvent("canvas-key",as),!as.preventDefaultAction&&!Jr.ctrl&&!Jr.alt&&!Jr.meta)switch(Jr.keyCode){case 38:return as.preventVerticalPan||(Jr.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new tt.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return as.preventVerticalPan||(Jr.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new tt.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return as.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new tt.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return as.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new tt.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}else return!0}function Yr(Jr){var as={originalEvent:Jr.originalEvent,preventDefaultAction:Jr.preventDefaultAction,preventVerticalPan:Jr.preventVerticalPan,preventHorizontalPan:Jr.preventHorizontalPan};if(this.raiseEvent("canvas-key",as),!as.preventDefaultAction&&!Jr.ctrl&&!Jr.alt&&!Jr.meta)switch(Jr.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return as.preventVerticalPan||(Jr.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new tt.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return as.preventVerticalPan||(Jr.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new tt.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return as.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new tt.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return as.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new tt.Point(40,0))),this.viewport.applyConstraints()),!1;case 114:return this.viewport.flipped?this.viewport.setRotation(tt.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(tt.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 82:return this.viewport.flipped?this.viewport.setRotation(tt.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(tt.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 102:return this.viewport.toggleFlip(),!1;default:return!0}else return!0}function mt(Jr){var as,bs=document.activeElement==this.canvas;bs||this.canvas.focus(),this.viewport.flipped&&(Jr.position.x=this.viewport.getContainerSize().x-Jr.position.x);var xs={tracker:Jr.eventSource,position:Jr.position,quick:Jr.quick,shift:Jr.shift,originalEvent:Jr.originalEvent,preventDefaultAction:Jr.preventDefaultAction};this.raiseEvent("canvas-click",xs),!xs.preventDefaultAction&&this.viewport&&Jr.quick&&(as=this.gestureSettingsByDeviceType(Jr.pointerType),as.clickToZoom&&(this.viewport.zoomBy(Jr.shift?1/this.zoomPerClick:this.zoomPerClick,as.zoomToRefPoint?this.viewport.pointFromPixel(Jr.position,!0):null),this.viewport.applyConstraints()))}function Kr(Jr){var as,bs={tracker:Jr.eventSource,position:Jr.position,shift:Jr.shift,originalEvent:Jr.originalEvent,preventDefaultAction:Jr.preventDefaultAction};this.raiseEvent("canvas-double-click",bs),!bs.preventDefaultAction&&this.viewport&&(as=this.gestureSettingsByDeviceType(Jr.pointerType),as.dblClickToZoom&&(this.viewport.zoomBy(Jr.shift?1/this.zoomPerClick:this.zoomPerClick,as.zoomToRefPoint?this.viewport.pointFromPixel(Jr.position,!0):null),this.viewport.applyConstraints()))}function Xr(Jr){var as,bs={tracker:Jr.eventSource,position:Jr.position,delta:Jr.delta,speed:Jr.speed,direction:Jr.direction,shift:Jr.shift,originalEvent:Jr.originalEvent,preventDefaultAction:Jr.preventDefaultAction};if(this.raiseEvent("canvas-drag",bs),!bs.preventDefaultAction&&this.viewport){if(as=this.gestureSettingsByDeviceType(Jr.pointerType),this.panHorizontal||(Jr.delta.x=0),this.panVertical||(Jr.delta.y=0),this.viewport.flipped&&(Jr.delta.x=-Jr.delta.x),this.constrainDuringPan){var xs=this.viewport.deltaPointsFromPixels(Jr.delta.negate());this.viewport.centerSpringX.target.value+=xs.x,this.viewport.centerSpringY.target.value+=xs.y;var ws=this.viewport.getBounds(),Bs=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=xs.x,this.viewport.centerSpringY.target.value-=xs.y,ws.x!=Bs.x&&(Jr.delta.x=0),ws.y!=Bs.y&&(Jr.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(Jr.delta.negate()),as.flickEnabled&&!this.constrainDuringPan)}}function Zr(Jr){if(!Jr.preventDefaultAction&&this.viewport){var as=this.gestureSettingsByDeviceType(Jr.pointerType);if(as.flickEnabled&&Jr.speed>=as.flickMinSpeed){var bs=0;this.panHorizontal&&(bs=as.flickMomentum*Jr.speed*Math.cos(Jr.direction));var xs=0;this.panVertical&&(xs=as.flickMomentum*Jr.speed*Math.sin(Jr.direction));var ws=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),Bs=this.viewport.pointFromPixel(new tt.Point(ws.x-bs,ws.y-xs));this.viewport.panTo(Bs,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:Jr.eventSource,position:Jr.position,speed:Jr.speed,direction:Jr.direction,shift:Jr.shift,originalEvent:Jr.originalEvent})}function Qr(Jr){this.raiseEvent("canvas-enter",{tracker:Jr.eventSource,pointerType:Jr.pointerType,position:Jr.position,buttons:Jr.buttons,pointers:Jr.pointers,insideElementPressed:Jr.insideElementPressed,buttonDownAny:Jr.buttonDownAny,originalEvent:Jr.originalEvent})}function _i(Jr){window.location!=window.parent.location&&tt.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:Jr.eventSource,pointerType:Jr.pointerType,position:Jr.position,buttons:Jr.buttons,pointers:Jr.pointers,insideElementPressed:Jr.insideElementPressed,buttonDownAny:Jr.buttonDownAny,originalEvent:Jr.originalEvent})}function rs(Jr){this.raiseEvent("canvas-press",{tracker:Jr.eventSource,pointerType:Jr.pointerType,position:Jr.position,insideElementPressed:Jr.insideElementPressed,insideElementReleased:Jr.insideElementReleased,originalEvent:Jr.originalEvent})}function ns(Jr){this.raiseEvent("canvas-release",{tracker:Jr.eventSource,pointerType:Jr.pointerType,position:Jr.position,insideElementPressed:Jr.insideElementPressed,insideElementReleased:Jr.insideElementReleased,originalEvent:Jr.originalEvent})}function ss(Jr){this.raiseEvent("canvas-nonprimary-press",{tracker:Jr.eventSource,position:Jr.position,pointerType:Jr.pointerType,button:Jr.button,buttons:Jr.buttons,originalEvent:Jr.originalEvent})}function fs(Jr){this.raiseEvent("canvas-nonprimary-release",{tracker:Jr.eventSource,position:Jr.position,pointerType:Jr.pointerType,button:Jr.button,buttons:Jr.buttons,originalEvent:Jr.originalEvent})}function os(Jr){var as,bs,xs,ws;if(!Jr.preventDefaultAction&&this.viewport&&(as=this.gestureSettingsByDeviceType(Jr.pointerType),as.pinchToZoom&&(bs=this.viewport.pointFromPixel(Jr.center,!0),xs=this.viewport.pointFromPixel(Jr.lastCenter,!0),ws=xs.minus(bs),this.panHorizontal||(ws.x=0),this.panVertical||(ws.y=0),this.viewport.zoomBy(Jr.distance/Jr.lastDistance,bs,!0),as.zoomToRefPoint&&this.viewport.panBy(ws,!0),this.viewport.applyConstraints()),as.pinchRotate)){var Bs=Math.atan2(Jr.gesturePoints[0].currentPos.y-Jr.gesturePoints[1].currentPos.y,Jr.gesturePoints[0].currentPos.x-Jr.gesturePoints[1].currentPos.x),Ps=Math.atan2(Jr.gesturePoints[0].lastPos.y-Jr.gesturePoints[1].lastPos.y,Jr.gesturePoints[0].lastPos.x-Jr.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(Bs-Ps)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:Jr.eventSource,gesturePoints:Jr.gesturePoints,lastCenter:Jr.lastCenter,center:Jr.center,lastDistance:Jr.lastDistance,distance:Jr.distance,shift:Jr.shift,originalEvent:Jr.originalEvent}),!1}function is(Jr){var as,bs,xs,ws;if(xs=tt.now(),ws=xs-this._lastScrollTime,ws>this.minScrollDeltaTime){if(this._lastScrollTime=xs,this.viewport.flipped&&(Jr.position.x=this.viewport.getContainerSize().x-Jr.position.x),!Jr.preventDefaultAction&&this.viewport&&(as=this.gestureSettingsByDeviceType(Jr.pointerType),as.scrollToZoom&&(bs=Math.pow(this.zoomPerScroll,Jr.scroll),this.viewport.zoomBy(bs,as.zoomToRefPoint?this.viewport.pointFromPixel(Jr.position,!0):null),this.viewport.applyConstraints())),this.raiseEvent("canvas-scroll",{tracker:Jr.eventSource,position:Jr.position,scroll:Jr.scroll,shift:Jr.shift,originalEvent:Jr.originalEvent}),as&&as.scrollToZoom)return!1}else if(as=this.gestureSettingsByDeviceType(Jr.pointerType),as&&as.scrollToZoom)return!1}function cs(Jr){et[this.hash].mouseInside=!0,ft(this),this.raiseEvent("container-enter",{tracker:Jr.eventSource,position:Jr.position,buttons:Jr.buttons,pointers:Jr.pointers,insideElementPressed:Jr.insideElementPressed,buttonDownAny:Jr.buttonDownAny,originalEvent:Jr.originalEvent})}function ps(Jr){Jr.pointers<1&&(et[this.hash].mouseInside=!1,et[this.hash].animating||ct(this)),this.raiseEvent("container-exit",{tracker:Jr.eventSource,position:Jr.position,buttons:Jr.buttons,pointers:Jr.pointers,insideElementPressed:Jr.insideElementPressed,buttonDownAny:Jr.buttonDownAny,originalEvent:Jr.originalEvent})}function vs(Jr){ls(Jr),Jr.isOpen()?Jr._updateRequestId=lt(Jr,vs):Jr._updateRequestId=!1}function ls(Jr){if(!Jr._opening){if(Jr.autoResize){var as=rt(Jr.container),bs=et[Jr.hash].prevContainerSize;if(!as.equals(bs)){var xs=Jr.viewport;if(Jr.preserveImageSizeOnResize){var ws=bs.x/as.x,Bs=xs.getZoom()*ws,Ps=xs.getCenter();xs.resize(as,!1),xs.zoomTo(Bs,null,!0),xs.panTo(Ps,!0)}else{var qs=xs.getBounds();xs.resize(as,!0),xs.fitBoundsWithConstraints(qs,!0)}et[Jr.hash].prevContainerSize=as,et[Jr.hash].forceRedraw=!0}}var Ks=Jr.viewport.update(),zs=Jr.world.update()||Ks;Ks&&Jr.raiseEvent("viewport-change"),Jr.referenceStrip&&(zs=Jr.referenceStrip.update(Jr.viewport)||zs),!et[Jr.hash].animating&&zs&&(Jr.raiseEvent("animation-start"),ft(Jr)),(zs||et[Jr.hash].forceRedraw||Jr.world.needsDraw())&&(gs(Jr),Jr._drawOverlays(),Jr.navigator&&Jr.navigator.update(Jr.viewport),et[Jr.hash].forceRedraw=!1,zs&&Jr.raiseEvent("animation")),et[Jr.hash].animating&&!zs&&(Jr.raiseEvent("animation-finish"),et[Jr.hash].mouseInside||ct(Jr)),et[Jr.hash].animating=zs}}function gs(Jr){Jr.imageLoader.clear(),Jr.drawer.clear(),Jr.world.draw(),Jr.raiseEvent("update-viewport",{})}function us(Jr,as){return Jr?Jr+as:as}function ms(){et[this.hash].lastZoomTime=tt.now(),et[this.hash].zoomFactor=this.zoomPerSecond,et[this.hash].zooming=!0,Ts(this)}function ys(){et[this.hash].lastZoomTime=tt.now(),et[this.hash].zoomFactor=1/this.zoomPerSecond,et[this.hash].zooming=!0,Ts(this)}function Es(){et[this.hash].zooming=!1}function Ts(Jr){tt.requestAnimationFrame(tt.delegate(Jr,Ss))}function Ss(){var Jr,as,bs;et[this.hash].zooming&&this.viewport&&(Jr=tt.now(),as=Jr-et[this.hash].lastZoomTime,bs=Math.pow(et[this.hash].zoomFactor,as/1e3),this.viewport.zoomBy(bs),this.viewport.applyConstraints(),et[this.hash].lastZoomTime=Jr,Ts(this))}function Ds(){this.viewport&&(et[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function Cs(){this.viewport&&(et[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function Is(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function ks(){this.viewport&&this.viewport.goHome()}function _s(){this.isFullPage()&&!tt.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function Os(){if(this.viewport){var Jr=this.viewport.getRotation();this.viewport.flipped?Jr=tt.positiveModulo(Jr+this.rotationIncrement,360):Jr=tt.positiveModulo(Jr-this.rotationIncrement,360),this.viewport.setRotation(Jr)}}function Ys(){if(this.viewport){var Jr=this.viewport.getRotation();this.viewport.flipped?Jr=tt.positiveModulo(Jr-this.rotationIncrement,360):Jr=tt.positiveModulo(Jr+this.rotationIncrement,360),this.viewport.setRotation(Jr)}}function Vs(){this.viewport.toggleFlip()}function js(){var Jr=this._sequenceIndex-1;this.navPrevNextWrap&&Jr<0&&(Jr+=this.tileSources.length),this.goToPage(Jr)}function Ws(){var Jr=this._sequenceIndex+1;this.navPrevNextWrap&&Jr>=this.tileSources.length&&(Jr=0),this.goToPage(Jr)}}(OpenSeadragon),function(tt){tt.Navigator=function(lt){var ut=lt.viewer,ct=this,dt,ft;lt.id?(this.element=document.getElementById(lt.id),lt.controlOptions={anchor:tt.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(lt.id="navigator-"+tt.now(),this.element=tt.makeNeutralElement("div"),lt.controlOptions={anchor:tt.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:lt.autoFade},lt.position&&(lt.position=="BOTTOM_RIGHT"?lt.controlOptions.anchor=tt.ControlAnchor.BOTTOM_RIGHT:lt.position=="BOTTOM_LEFT"?lt.controlOptions.anchor=tt.ControlAnchor.BOTTOM_LEFT:lt.position=="TOP_RIGHT"?lt.controlOptions.anchor=tt.ControlAnchor.TOP_RIGHT:lt.position=="TOP_LEFT"?lt.controlOptions.anchor=tt.ControlAnchor.TOP_LEFT:lt.position=="ABSOLUTE"&&(lt.controlOptions.anchor=tt.ControlAnchor.ABSOLUTE,lt.controlOptions.top=lt.top,lt.controlOptions.left=lt.left,lt.controlOptions.height=lt.height,lt.controlOptions.width=lt.width))),this.element.id=lt.id,this.element.className+=" navigator",lt=tt.extend(!0,{sizeRatio:tt.DEFAULT_SETTINGS.navigatorSizeRatio},lt,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:lt.autoResize,minZoomImageRatio:1,background:lt.background,opacity:lt.opacity,borderColor:lt.borderColor,displayRegionColor:lt.displayRegionColor}),lt.minPixelRatio=this.minPixelRatio=ut.minPixelRatio,tt.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new tt.Point(1,1),this.totalBorderWidths=new tt.Point(this.borderWidth*2,this.borderWidth*2).minus(this.fudge),lt.controlOptions.anchor!=tt.ControlAnchor.NONE&&function(_r,Yr){_r.margin="0px",_r.border=Yr+"px solid "+lt.borderColor,_r.padding="0px",_r.background=lt.background,_r.opacity=lt.opacity,_r.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=tt.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(_r,Yr){_r.position="relative",_r.top="0px",_r.left="0px",_r.fontSize="0px",_r.overflow="hidden",_r.border=Yr+"px solid "+lt.displayRegionColor,_r.margin="0px",_r.padding="0px",_r.background="transparent",_r.float="left",_r.cssFloat="left",_r.styleFloat="left",_r.zIndex=999999999,_r.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=tt.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",ut.addControl(this.element,lt.controlOptions),this._resizeWithViewer=lt.controlOptions.anchor!=tt.ControlAnchor.ABSOLUTE&&lt.controlOptions.anchor!=tt.ControlAnchor.NONE,lt.width&&lt.height?(this.setWidth(lt.width),this.setHeight(lt.height)):this._resizeWithViewer&&(dt=tt.getElementSize(ut.element),this.element.style.height=Math.round(dt.y*lt.sizeRatio)+"px",this.element.style.width=Math.round(dt.x*lt.sizeRatio)+"px",this.oldViewerSize=dt,ft=tt.getElementSize(this.element),this.elementArea=ft.x*ft.y),this.oldContainerSize=new tt.Point(0,0),tt.Viewer.apply(this,[lt]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer);function pt(_r){st(ct.displayRegionContainer,_r),st(ct.displayRegion,-_r),ct.viewport.setRotation(_r)}if(lt.navigatorRotate){var gt=lt.viewer.viewport?lt.viewer.viewport.getRotation():lt.viewer.degrees||0;pt(gt),lt.viewer.addHandler("rotate",function(_r){pt(_r.degrees)})}this.innerTracker.destroy(),this.innerTracker=new tt.MouseTracker({element:this.element,dragHandler:tt.delegate(this,nt),clickHandler:tt.delegate(this,et),releaseHandler:tt.delegate(this,rt),scrollHandler:tt.delegate(this,it)}),this.addHandler("reset-size",function(){ct.viewport&&ct.viewport.goHome(!0)}),ut.world.addHandler("item-index-change",function(_r){window.setTimeout(function(){var Yr=ct.world.getItemAt(_r.previousIndex);ct.world.setItemIndex(Yr,_r.newIndex)},1)}),ut.world.addHandler("remove-item",function(_r){var Yr=_r.item,mt=ct._getMatchingItem(Yr);mt&&ct.world.removeItem(mt)}),this.update(ut.viewport)},tt.extend(tt.Navigator.prototype,tt.EventSource.prototype,tt.Viewer.prototype,{updateSize:function(){if(this.viewport){var lt=new tt.Point(this.container.clientWidth===0?1:this.container.clientWidth,this.container.clientHeight===0?1:this.container.clientHeight);lt.equals(this.oldContainerSize)||(this.viewport.resize(lt,!0),this.viewport.goHome(!0),this.oldContainerSize=lt,this.drawer.clear(),this.world.draw())}},setWidth:function(lt){this.width=lt,this.element.style.width=typeof lt=="number"?lt+"px":lt,this._resizeWithViewer=!1},setHeight:function(lt){this.height=lt,this.element.style.height=typeof lt=="number"?lt+"px":lt,this._resizeWithViewer=!1},setFlip:function(lt){return this.viewport.setFlip(lt),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(lt){ot(this.displayRegion,lt),ot(this.canvas,lt),ot(this.element,lt)},update:function(lt){var ut,ct,dt,ft,pt,gt;if(ut=tt.getElementSize(this.viewer.element),this._resizeWithViewer&&ut.x&&ut.y&&!ut.equals(this.oldViewerSize)&&(this.oldViewerSize=ut,this.maintainSizeRatio||!this.elementArea?(ct=ut.x*this.sizeRatio,dt=ut.y*this.sizeRatio):(ct=Math.sqrt(this.elementArea*(ut.x/ut.y)),dt=this.elementArea/ct),this.element.style.width=Math.round(ct)+"px",this.element.style.height=Math.round(dt)+"px",this.elementArea||(this.elementArea=ct*dt),this.updateSize()),lt&&this.viewport){ft=lt.getBoundsNoRotate(!0),pt=this.viewport.pixelFromPointNoRotate(ft.getTopLeft(),!1),gt=this.viewport.pixelFromPointNoRotate(ft.getBottomRight(),!1).minus(this.totalBorderWidths);var _r=this.displayRegion.style;_r.display=this.world.getItemCount()?"block":"none",_r.top=Math.round(pt.y)+"px",_r.left=Math.round(pt.x)+"px";var Yr=Math.abs(pt.x-gt.x),mt=Math.abs(pt.y-gt.y);_r.width=Math.round(Math.max(Yr,0))+"px",_r.height=Math.round(Math.max(mt,0))+"px"}},addTiledImage:function(lt){var ut=this,ct=lt.originalTiledImage;delete lt.original;var dt=tt.extend({},lt,{success:function(ft){var pt=ft.item;pt._originalForNavigator=ct,ut._matchBounds(pt,ct,!0);function gt(){ut._matchBounds(pt,ct)}function _r(){ut._matchOpacity(pt,ct)}function Yr(){ut._matchCompositeOperation(pt,ct)}ct.addHandler("bounds-change",gt),ct.addHandler("clip-change",gt),ct.addHandler("opacity-change",_r),ct.addHandler("composite-operation-change",Yr)}});return tt.Viewer.prototype.addTiledImage.apply(this,[dt])},_getMatchingItem:function(lt){for(var ut=this.world.getItemCount(),ct,dt=0;dt<ut;dt++)if(ct=this.world.getItemAt(dt),ct._originalForNavigator===lt)return ct;return null},_matchBounds:function(lt,ut,ct){var dt=ut.getBoundsNoRotate();lt.setPosition(dt.getTopLeft(),ct),lt.setWidth(dt.width,ct),lt.setRotation(ut.getRotation(),ct),lt.setClip(ut.getClip())},_matchOpacity:function(lt,ut){lt.setOpacity(ut.opacity)},_matchCompositeOperation:function(lt,ut){lt.setCompositeOperation(ut.compositeOperation)}});function et(lt){var ut={tracker:lt.eventSource,position:lt.position,quick:lt.quick,shift:lt.shift,originalEvent:lt.originalEvent,preventDefaultAction:lt.preventDefaultAction};if(this.viewer.raiseEvent("navigator-click",ut),!ut.preventDefaultAction&&lt.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(lt.position.x=this.viewport.getContainerSize().x-lt.position.x);var ct=this.viewport.pointFromPixel(lt.position);this.panVertical?this.panHorizontal||(ct.x=this.viewer.viewport.getCenter(!0).x):ct.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(ct),this.viewer.viewport.applyConstraints()}}function nt(lt){var ut={tracker:lt.eventSource,position:lt.position,delta:lt.delta,speed:lt.speed,direction:lt.direction,shift:lt.shift,originalEvent:lt.originalEvent,preventDefaultAction:lt.preventDefaultAction};this.viewer.raiseEvent("navigator-drag",ut),!ut.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(lt.delta.x=0),this.panVertical||(lt.delta.y=0),this.viewer.viewport.flipped&&(lt.delta.x=-lt.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(lt.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function rt(lt){lt.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function it(lt){return this.viewer.raiseEvent("navigator-scroll",{tracker:lt.eventSource,position:lt.position,scroll:lt.scroll,shift:lt.shift,originalEvent:lt.originalEvent}),!1}function st(lt,ut){ot(lt,"rotate("+ut+"deg)")}function ot(lt,ut){lt.style.webkitTransform=ut,lt.style.mozTransform=ut,lt.style.msTransform=ut,lt.style.oTransform=ut,lt.style.transform=ut}}(OpenSeadragon),function(tt){var et={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};tt.extend(tt,{getString:function(nt){var rt=nt.split("."),it=null,st=arguments,ot=et,lt;for(lt=0;lt<rt.length-1;lt++)ot=ot[rt[lt]]||{};return it=ot[rt[lt]],typeof it!="string"&&(tt.console.log("Untranslated source string:",nt),it=""),it.replace(/\{\d+\}/g,function(ut){var ct=parseInt(ut.match(/\d+/),10)+1;return ct<st.length?st[ct]:""})},setString:function(nt,rt){var it=nt.split("."),st=et,ot;for(ot=0;ot<it.length-1;ot++)st[it[ot]]||(st[it[ot]]={}),st=st[it[ot]];st[it[ot]]=rt}})}(OpenSeadragon),function(tt){tt.Point=function(et,nt){this.x=typeof et=="number"?et:0,this.y=typeof nt=="number"?nt:0},tt.Point.prototype={clone:function(){return new tt.Point(this.x,this.y)},plus:function(et){return new tt.Point(this.x+et.x,this.y+et.y)},minus:function(et){return new tt.Point(this.x-et.x,this.y-et.y)},times:function(et){return new tt.Point(this.x*et,this.y*et)},divide:function(et){return new tt.Point(this.x/et,this.y/et)},negate:function(){return new tt.Point(-this.x,-this.y)},distanceTo:function(et){return Math.sqrt(Math.pow(this.x-et.x,2)+Math.pow(this.y-et.y,2))},squaredDistanceTo:function(et){return Math.pow(this.x-et.x,2)+Math.pow(this.y-et.y,2)},apply:function(et){return new tt.Point(et(this.x),et(this.y))},equals:function(et){return et instanceof tt.Point&&this.x===et.x&&this.y===et.y},rotate:function(et,nt){nt=nt||new tt.Point(0,0);var rt,it;if(et%90===0){var st=tt.positiveModulo(et,360);switch(st){case 0:rt=1,it=0;break;case 90:rt=0,it=1;break;case 180:rt=-1,it=0;break;case 270:rt=0,it=-1;break}}else{var ot=et*Math.PI/180;rt=Math.cos(ot),it=Math.sin(ot)}var lt=rt*(this.x-nt.x)-it*(this.y-nt.y)+nt.x,ut=it*(this.x-nt.x)+rt*(this.y-nt.y)+nt.y;return new tt.Point(lt,ut)},toString:function(){return"("+Math.round(this.x*100)/100+","+Math.round(this.y*100)/100+")"}}}(OpenSeadragon),function(tt){tt.TileSource=function(nt,rt,it,st,ot,lt){var ut=this,ct=arguments,dt,ft;if(tt.isPlainObject(nt)?dt=nt:dt={width:ct[0],height:ct[1],tileSize:ct[2],tileOverlap:ct[3],minLevel:ct[4],maxLevel:ct[5]},tt.EventSource.call(this),tt.extend(!0,this,dt),!this.success){for(ft=0;ft<arguments.length;ft++)if(tt.isFunction(arguments[ft])){this.success=arguments[ft];break}}this.success&&this.addHandler("ready",function(pt){ut.success(pt)}),tt.type(arguments[0])=="string"&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new tt.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=dt.width&&dt.height?dt.width/dt.height:1,this.dimensions=new tt.Point(dt.width,dt.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=dt.tileOverlap?dt.tileOverlap:0,this.minLevel=dt.minLevel?dt.minLevel:0,this.maxLevel=dt.maxLevel!==void 0&&dt.maxLevel!==null?dt.maxLevel:dt.width&&dt.height?Math.ceil(Math.log(Math.max(dt.width,dt.height))/Math.log(2)):0,this.success&&tt.isFunction(this.success)&&this.success(this))},tt.TileSource.prototype={getTileSize:function(nt){return tt.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(nt){return this._tileWidth?this._tileWidth:this.getTileSize(nt)},getTileHeight:function(nt){return this._tileHeight?this._tileHeight:this.getTileSize(nt)},getLevelScale:function(nt){var rt={},it;for(it=0;it<=this.maxLevel;it++)rt[it]=1/Math.pow(2,this.maxLevel-it);return this.getLevelScale=function(st){return rt[st]},this.getLevelScale(nt)},getNumTiles:function(nt){var rt=this.getLevelScale(nt),it=Math.ceil(rt*this.dimensions.x/this.getTileWidth(nt)),st=Math.ceil(rt*this.dimensions.y/this.getTileHeight(nt));return new tt.Point(it,st)},getPixelRatio:function(nt){var rt=this.dimensions.times(this.getLevelScale(nt)),it=1/rt.x,st=1/rt.y;return new tt.Point(it,st)},getClosestLevel:function(){var nt,rt;for(nt=this.minLevel+1;nt<=this.maxLevel&&(rt=this.getNumTiles(nt),!(rt.x>1||rt.y>1));nt++);return nt-1},getTileAtPoint:function(nt,rt){var it=rt.x>=0&&rt.x<=1&&rt.y>=0&&rt.y<=1/this.aspectRatio;tt.console.assert(it,"[TileSource.getTileAtPoint] must be called with a valid point.");var st=this.dimensions.x*this.getLevelScale(nt),ot=rt.x*st,lt=rt.y*st,ut=Math.floor(ot/this.getTileWidth(nt)),ct=Math.floor(lt/this.getTileHeight(nt));rt.x>=1&&(ut=this.getNumTiles(nt).x-1);var dt=1e-15;return rt.y>=1/this.aspectRatio-dt&&(ct=this.getNumTiles(nt).y-1),new tt.Point(ut,ct)},getTileBounds:function(nt,rt,it,st){var ot=this.dimensions.times(this.getLevelScale(nt)),lt=this.getTileWidth(nt),ut=this.getTileHeight(nt),ct=rt===0?0:lt*rt-this.tileOverlap,dt=it===0?0:ut*it-this.tileOverlap,ft=lt+(rt===0?1:2)*this.tileOverlap,pt=ut+(it===0?1:2)*this.tileOverlap,gt=1/ot.x;return ft=Math.min(ft,ot.x-ct),pt=Math.min(pt,ot.y-dt),st?new tt.Rect(0,0,ft,pt):new tt.Rect(ct*gt,dt*gt,ft*gt,pt*gt)},getImageInfo:function(nt){var rt=this,it,st,ot,lt,ut,ct,dt;nt&&(ut=nt.split("/"),ct=ut[ut.length-1],dt=ct.lastIndexOf("."),dt>-1&&(ut[ut.length-1]=ct.slice(0,dt))),st=function(ft){typeof ft=="string"&&(ft=tt.parseXml(ft));var pt=tt.TileSource.determineType(rt,ft,nt);if(!pt){rt.raiseEvent("open-failed",{message:"Unable to load TileSource",source:nt});return}lt=pt.prototype.configure.apply(rt,[ft,nt]),lt.ajaxWithCredentials===void 0&&(lt.ajaxWithCredentials=rt.ajaxWithCredentials),ot=new pt(lt),rt.ready=!0,rt.raiseEvent("ready",{tileSource:ot})},nt.match(/\.js$/)?(it=nt.split("/").pop().replace(".js",""),tt.jsonp({url:nt,async:!1,callbackName:it,callback:st})):tt.makeAjaxRequest({url:nt,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(ft){var pt=et(ft);st(pt)},error:function(ft,pt){var gt;try{gt="HTTP "+ft.status+" attempting to load TileSource"}catch{var _r;typeof pt>"u"||!pt.toString?_r="Unknown error":_r=pt.toString(),gt=_r+" attempting to load TileSource"}rt.raiseEvent("open-failed",{message:gt,source:nt})}})},supports:function(nt,rt){return!1},configure:function(nt,rt){throw new Error("Method not implemented.")},getTileUrl:function(nt,rt,it){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(nt,rt,it){return{}},tileExists:function(nt,rt,it){var st=this.getNumTiles(nt);return nt>=this.minLevel&&nt<=this.maxLevel&&rt>=0&&it>=0&&rt<st.x&&it<st.y}},tt.extend(!0,tt.TileSource.prototype,tt.EventSource.prototype);function et(nt){var rt=nt.responseText,it=nt.status,st,ot;if(nt){if(nt.status!==200&&nt.status!==0)throw it=nt.status,st=it==404?"Not Found":nt.statusText,new Error(tt.getString("Errors.Status",it,st))}else throw new Error(tt.getString("Errors.Security"));if(rt.match(/\s*<.*/))try{ot=nt.responseXML&&nt.responseXML.documentElement?nt.responseXML:tt.parseXml(rt)}catch{ot=nt.responseText}else if(rt.match(/\s*[\{\[].*/))try{ot=tt.parseJSON(rt)}catch{ot=rt}else ot=rt;return ot}tt.TileSource.determineType=function(nt,rt,it){var st;for(st in OpenSeadragon)if(st.match(/.+TileSource$/)&&tt.isFunction(OpenSeadragon[st])&&tt.isFunction(OpenSeadragon[st].prototype.supports)&&OpenSeadragon[st].prototype.supports.call(nt,rt,it))return OpenSeadragon[st];tt.console.error("No TileSource was able to open %s %s",it,rt)}}(OpenSeadragon),function(tt){tt.DziTileSource=function(rt,it,st,ot,lt,ut,ct,dt,ft){var pt,gt,_r,Yr;if(tt.isPlainObject(rt)?Yr=rt:Yr={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=Yr.tilesUrl,this.fileFormat=Yr.fileFormat,this.displayRects=Yr.displayRects,this.displayRects)for(pt=this.displayRects.length-1;pt>=0;pt--)for(gt=this.displayRects[pt],_r=gt.minLevel;_r<=gt.maxLevel;_r++)this._levelRects[_r]||(this._levelRects[_r]=[]),this._levelRects[_r].push(gt);tt.TileSource.apply(this,[Yr])},tt.extend(tt.DziTileSource.prototype,tt.TileSource.prototype,{supports:function(rt,it){var st;return rt.Image?st=rt.Image.xmlns:rt.documentElement&&(rt.documentElement.localName=="Image"||rt.documentElement.tagName=="Image")&&(st=rt.documentElement.namespaceURI),st=(st||"").toLowerCase(),st.indexOf("schemas.microsoft.com/deepzoom/2008")!==-1||st.indexOf("schemas.microsoft.com/deepzoom/2009")!==-1},configure:function(rt,it){var st;return tt.isPlainObject(rt)?st=nt(this,rt):st=et(this,rt),it&&!st.tilesUrl&&(st.tilesUrl=it.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),it.search(/\.(dzi|xml|js)\?/)!=-1?st.queryParams=it.match(/\?.*/):st.queryParams=""),st},getTileUrl:function(rt,it,st){return[this.tilesUrl,rt,"/",it,"_",st,".",this.fileFormat,this.queryParams].join("")},tileExists:function(rt,it,st){var ot=this._levelRects[rt],lt,ut,ct,dt,ft,pt,gt;if(this.minLevel&&rt<this.minLevel||this.maxLevel&&rt>this.maxLevel)return!1;if(!ot||!ot.length)return!0;for(gt=ot.length-1;gt>=0;gt--)if(lt=ot[gt],!(rt<lt.minLevel||rt>lt.maxLevel)&&(ut=this.getLevelScale(rt),ct=lt.x*ut,dt=lt.y*ut,ft=ct+lt.width*ut,pt=dt+lt.height*ut,ct=Math.floor(ct/this._tileWidth),dt=Math.floor(dt/this._tileWidth),ft=Math.ceil(ft/this._tileWidth),pt=Math.ceil(pt/this._tileWidth),ct<=it&&it<ft&&dt<=st&&st<pt))return!0;return!1}});function et(rt,it){if(!it||!it.documentElement)throw new Error(tt.getString("Errors.Xml"));var st=it.documentElement,ot=st.localName||st.tagName,lt=it.documentElement.namespaceURI,ut=null,ct=[],dt,ft,pt,gt,_r;if(ot=="Image")try{if(gt=st.getElementsByTagName("Size")[0],gt===void 0&&(gt=st.getElementsByTagNameNS(lt,"Size")[0]),ut={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:st.getAttribute("Url"),Format:st.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(st.getAttribute("Overlap"),10),TileSize:parseInt(st.getAttribute("TileSize"),10),Size:{Height:parseInt(gt.getAttribute("Height"),10),Width:parseInt(gt.getAttribute("Width"),10)}}},!tt.imageFormatSupported(ut.Image.Format))throw new Error(tt.getString("Errors.ImageFormat",ut.Image.Format.toUpperCase()));for(dt=st.getElementsByTagName("DisplayRect"),dt===void 0&&(dt=st.getElementsByTagNameNS(lt,"DisplayRect")[0]),_r=0;_r<dt.length;_r++)ft=dt[_r],pt=ft.getElementsByTagName("Rect")[0],pt===void 0&&(pt=ft.getElementsByTagNameNS(lt,"Rect")[0]),ct.push({Rect:{X:parseInt(pt.getAttribute("X"),10),Y:parseInt(pt.getAttribute("Y"),10),Width:parseInt(pt.getAttribute("Width"),10),Height:parseInt(pt.getAttribute("Height"),10),MinLevel:parseInt(ft.getAttribute("MinLevel"),10),MaxLevel:parseInt(ft.getAttribute("MaxLevel"),10)}});return ct.length&&(ut.Image.DisplayRect=ct),nt(rt,ut)}catch(Kr){throw Kr instanceof Error?Kr:new Error(tt.getString("Errors.Dzi"))}else{if(ot=="Collection")throw new Error(tt.getString("Errors.Dzc"));if(ot=="Error"){var Yr=st.getElementsByTagName("Message")[0],mt=Yr.firstChild.nodeValue;throw new Error(mt)}}throw new Error(tt.getString("Errors.Dzi"))}function nt(rt,it){var st=it.Image,ot=st.Url,lt=st.Format,ut=st.Size,ct=st.DisplayRect||[],dt=parseInt(ut.Width,10),ft=parseInt(ut.Height,10),pt=parseInt(st.TileSize,10),gt=parseInt(st.Overlap,10),_r=[],Yr,mt;for(mt=0;mt<ct.length;mt++)Yr=ct[mt].Rect,_r.push(new tt.DisplayRect(parseInt(Yr.X,10),parseInt(Yr.Y,10),parseInt(Yr.Width,10),parseInt(Yr.Height,10),parseInt(Yr.MinLevel,10),parseInt(Yr.MaxLevel,10)));return tt.extend(!0,{width:dt,height:ft,tileSize:pt,tileOverlap:gt,minLevel:null,maxLevel:null,tilesUrl:ot,fileFormat:lt,displayRects:_r},it)}}(OpenSeadragon),function(tt){tt.IIIFTileSource=function(st){if(tt.extend(!0,this,st),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(st.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=st.version,this.tile_width&&this.tile_height)st.tileWidth=this.tile_width,st.tileHeight=this.tile_height;else if(this.tile_width)st.tileSize=this.tile_width;else if(this.tile_height)st.tileSize=this.tile_height;else if(this.tiles)if(this.tiles.length==1)st.tileWidth=this.tiles[0].width,st.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var ot=0;ot<this.tiles.length;ot++)for(var lt=0;lt<this.tiles[ot].scaleFactors.length;lt++){var ut=this.tiles[ot].scaleFactors[lt];this.scale_factors.push(ut),st.tileSizePerScaleFactor[ut]={width:this.tiles[ot].width,height:this.tiles[ot].height||this.tiles[ot].width}}}else if(et(st)){for(var ct=Math.min(this.height,this.width),dt=[256,512,1024],ft=[],pt=0;pt<dt.length;pt++)dt[pt]<=ct&&ft.push(dt[pt]);ft.length>0?st.tileSize=Math.max.apply(null,ft):st.tileSize=ct}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,st.levels=nt(this),tt.extend(!0,st,{width:st.levels[st.levels.length-1].width,height:st.levels[st.levels.length-1].height,tileSize:Math.max(st.height,st.width),tileOverlap:0,minLevel:0,maxLevel:st.levels.length-1}),this.levels=st.levels):tt.console.error("Nothing in the info.json to construct image pyramids from");if(!st.maxLevel&&!this.emulateLegacyImagePyramid)if(!this.scale_factors)st.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));else{var gt=Math.max.apply(null,this.scale_factors);st.maxLevel=Math.round(Math.log(gt)*Math.LOG2E)}tt.TileSource.apply(this,[st])},tt.extend(tt.IIIFTileSource.prototype,tt.TileSource.prototype,{supports:function(st,ot){return st.protocol&&st.protocol=="http://iiif.io/api/image"||st["@context"]&&(st["@context"]=="http://library.stanford.edu/iiif/image-api/1.1/context.json"||st["@context"]=="http://iiif.io/api/image/1/context.json")||st.profile&&st.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")===0||st.identifier&&st.width&&st.height?!0:!!(st.documentElement&&st.documentElement.tagName=="info"&&st.documentElement.namespaceURI=="http://library.stanford.edu/iiif/image-api/ns/")},configure:function(st,ot){if(tt.isPlainObject(st)){if(!st["@context"])st["@context"]="http://iiif.io/api/image/1.0/context.json",st["@id"]=ot.replace("/info.json",""),st.version=1;else{var ut=st["@context"];if(Array.isArray(ut)){for(var ct=0;ct<ut.length;ct++)if(typeof ut[ct]=="string"&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(ut[ct])||ut[ct]==="http://library.stanford.edu/iiif/image-api/1.1/context.json")){ut=ut[ct];break}}switch(ut){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":st.version=1;break;case"http://iiif.io/api/image/2/context.json":st.version=2;break;case"http://iiif.io/api/image/3/context.json":st.version=3;break;default:tt.console.error("Data has a @context property which contains no known IIIF context URI.")}}if(!st["@id"]&&st.id&&(st["@id"]=st.id),st.preferredFormats){for(var dt=0;dt<st.preferredFormats.length;dt++)if(OpenSeadragon.imageFormatSupported(st.preferredFormats[dt])){st.tileFormat=st.preferredFormats[dt];break}}return st}else{var lt=rt(st);return lt["@context"]="http://iiif.io/api/image/1.0/context.json",lt["@id"]=ot.replace("/info.xml",""),lt.version=1,lt}},getTileWidth:function(st){if(this.emulateLegacyImagePyramid)return tt.TileSource.prototype.getTileWidth.call(this,st);var ot=Math.pow(2,this.maxLevel-st);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[ot]?this.tileSizePerScaleFactor[ot].width:this._tileWidth},getTileHeight:function(st){if(this.emulateLegacyImagePyramid)return tt.TileSource.prototype.getTileHeight.call(this,st);var ot=Math.pow(2,this.maxLevel-st);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[ot]?this.tileSizePerScaleFactor[ot].height:this._tileHeight},getLevelScale:function(st){if(this.emulateLegacyImagePyramid){var ot=NaN;return this.levels.length>0&&st>=this.minLevel&&st<=this.maxLevel&&(ot=this.levels[st].width/this.levels[this.maxLevel].width),ot}return tt.TileSource.prototype.getLevelScale.call(this,st)},getNumTiles:function(st){if(this.emulateLegacyImagePyramid){var ot=this.getLevelScale(st);return ot?new tt.Point(1,1):new tt.Point(0,0)}return tt.TileSource.prototype.getNumTiles.call(this,st)},getTileAtPoint:function(st,ot){return this.emulateLegacyImagePyramid?new tt.Point(0,0):tt.TileSource.prototype.getTileAtPoint.call(this,st,ot)},getTileUrl:function(st,ot,lt){if(this.emulateLegacyImagePyramid){var ut=null;return this.levels.length>0&&st>=this.minLevel&&st<=this.maxLevel&&(ut=this.levels[st].url),ut}var ct="0",dt=Math.pow(.5,this.maxLevel-st),ft=Math.ceil(this.width*dt),pt=Math.ceil(this.height*dt),gt,_r,Yr,mt,Kr,Xr,Zr,Qr,_i,rs,ns,ss,fs,os;return gt=this.getTileWidth(st),_r=this.getTileHeight(st),Yr=Math.ceil(gt/dt),mt=Math.ceil(_r/dt),this.version===1?fs="native."+this.tileFormat:fs="default."+this.tileFormat,ft<gt&&pt<_r?(this.version===2&&ft===this.width||this.version===3&&ft===this.width&&pt===this.height?rs="max":this.version===3?rs=ft+","+pt:rs=ft+",",Kr="full"):(Xr=ot*Yr,Zr=lt*mt,Qr=Math.min(Yr,this.width-Xr),_i=Math.min(mt,this.height-Zr),ot===0&&lt===0&&Qr===this.width&&_i===this.height?Kr="full":Kr=[Xr,Zr,Qr,_i].join(","),ns=Math.ceil(Qr*dt),ss=Math.ceil(_i*dt),this.version===2&&ns===this.width||this.version===3&&ns===this.width&&ss===this.height?rs="max":this.version===3?rs=ns+","+ss:rs=ns+","),os=[this["@id"],Kr,rs,ct,fs].join("/"),os},__testonly__:{canBeTiled:et,constructLevels:nt}});function et(st){var ot=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"],lt=Array.isArray(st.profile)?st.profile[0]:st.profile,ut=ot.indexOf(lt)!==-1,ct=!1;return st.version===2&&st.profile.length>1&&st.profile[1].supports&&(ct=st.profile[1].supports.indexOf("sizeByW")!==-1),st.version===3&&st.extraFeatures&&(ct=st.extraFeatures.indexOf("sizeByWh")!==-1),!ut||ct}function nt(st){for(var ot=[],lt=0;lt<st.sizes.length;lt++)ot.push({url:st["@id"]+"/full/"+st.sizes[lt].width+","+(st.version===3?st.sizes[lt].height:"")+"/0/default."+st.tileFormat,width:st.sizes[lt].width,height:st.sizes[lt].height});return ot.sort(function(ut,ct){return ut.width-ct.width})}function rt(st){if(!st||!st.documentElement)throw new Error(tt.getString("Errors.Xml"));var ot=st.documentElement,lt=ot.tagName,ut=null;if(lt=="info")try{return ut={},it(ot,ut),ut}catch(ct){throw ct instanceof Error?ct:new Error(tt.getString("Errors.IIIF"))}throw new Error(tt.getString("Errors.IIIF"))}function it(st,ot,lt){var ut,ct;if(st.nodeType==3&&lt)ct=st.nodeValue.trim(),ct.match(/^\d*$/)&&(ct=Number(ct)),ot[lt]?(tt.isArray(ot[lt])||(ot[lt]=[ot[lt]]),ot[lt].push(ct)):ot[lt]=ct;else if(st.nodeType==1)for(ut=0;ut<st.childNodes.length;ut++)it(st.childNodes[ut],ot,st.nodeName)}}(OpenSeadragon),function(tt){tt.OsmTileSource=function(et,nt,rt,it,st){var ot;tt.isPlainObject(et)?ot=et:ot={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},(!ot.width||!ot.height)&&(ot.width=65572864,ot.height=65572864),ot.tileSize||(ot.tileSize=256,ot.tileOverlap=0),ot.tilesUrl||(ot.tilesUrl="http://tile.openstreetmap.org/"),ot.minLevel=8,tt.TileSource.apply(this,[ot])},tt.extend(tt.OsmTileSource.prototype,tt.TileSource.prototype,{supports:function(et,nt){return et.type&&et.type=="openstreetmaps"},configure:function(et,nt){return et},getTileUrl:function(et,nt,rt){return this.tilesUrl+(et-8)+"/"+nt+"/"+rt+".png"}})}(OpenSeadragon),function(tt){tt.TmsTileSource=function(et,nt,rt,it,st){var ot;tt.isPlainObject(et)?ot=et:ot={width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var lt=Math.ceil(ot.width/256)*256,ut=Math.ceil(ot.height/256)*256,ct;lt>ut?ct=lt/256:ct=ut/256,ot.maxLevel=Math.ceil(Math.log(ct)/Math.log(2))-1,ot.tileSize=256,ot.width=lt,ot.height=ut,tt.TileSource.apply(this,[ot])},tt.extend(tt.TmsTileSource.prototype,tt.TileSource.prototype,{supports:function(et,nt){return et.type&&et.type=="tiledmapservice"},configure:function(et,nt){return et},getTileUrl:function(et,nt,rt){var it=this.getNumTiles(et).y-1;return this.tilesUrl+et+"/"+nt+"/"+(it-rt)+".png"}})}(OpenSeadragon),function(tt){tt.ZoomifyTileSource=function(et){et.tileSize=256;var nt={x:et.width,y:et.height};for(et.imageSizes=[{x:et.width,y:et.height}],et.gridSize=[this._getGridSize(et.width,et.height,et.tileSize)];parseInt(nt.x,10)>et.tileSize||parseInt(nt.y,10)>et.tileSize;)nt.x=Math.floor(nt.x/2),nt.y=Math.floor(nt.y/2),et.imageSizes.push({x:nt.x,y:nt.y}),et.gridSize.push(this._getGridSize(nt.x,nt.y,et.tileSize));et.imageSizes.reverse(),et.gridSize.reverse(),et.minLevel=0,et.maxLevel=et.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[et])},tt.extend(tt.ZoomifyTileSource.prototype,tt.TileSource.prototype,{_getGridSize:function(et,nt,rt){return{x:Math.ceil(et/rt),y:Math.ceil(nt/rt)}},_calculateAbsoluteTileNumber:function(et,nt,rt){for(var it=0,st={},ot=0;ot<et;ot++)st=this.gridSize[ot],it+=st.x*st.y;return st=this.gridSize[et],it+=st.x*rt+nt,it},supports:function(et,nt){return et.type&&et.type=="zoomifytileservice"},configure:function(et,nt){return et},getTileUrl:function(et,nt,rt){var it=0,st=this._calculateAbsoluteTileNumber(et,nt,rt);return it=Math.floor(st/256),this.tilesUrl+"TileGroup"+it+"/"+et+"-"+nt+"-"+rt+".jpg"}})}(OpenSeadragon),function(tt){tt.LegacyTileSource=function(it){var st,ot,lt;tt.isArray(it)&&(st={type:"legacy-image-pyramid",levels:it}),st.levels=et(st.levels),st.levels.length>0?(ot=st.levels[st.levels.length-1].width,lt=st.levels[st.levels.length-1].height):(ot=0,lt=0,tt.console.error("No supported image formats found")),tt.extend(!0,st,{width:ot,height:lt,tileSize:Math.max(lt,ot),tileOverlap:0,minLevel:0,maxLevel:st.levels.length>0?st.levels.length-1:0}),tt.TileSource.apply(this,[st]),this.levels=st.levels},tt.extend(tt.LegacyTileSource.prototype,tt.TileSource.prototype,{supports:function(it,st){return it.type&&it.type=="legacy-image-pyramid"||it.documentElement&&it.documentElement.getAttribute("type")=="legacy-image-pyramid"},configure:function(it,st){var ot;return tt.isPlainObject(it)?ot=rt(this,it):ot=nt(this,it),ot},getLevelScale:function(it){var st=NaN;return this.levels.length>0&&it>=this.minLevel&&it<=this.maxLevel&&(st=this.levels[it].width/this.levels[this.maxLevel].width),st},getNumTiles:function(it){var st=this.getLevelScale(it);return st?new tt.Point(1,1):new tt.Point(0,0)},getTileUrl:function(it,st,ot){var lt=null;return this.levels.length>0&&it>=this.minLevel&&it<=this.maxLevel&&(lt=this.levels[it].url),lt}});function et(it){var st=[],ot,lt;for(lt=0;lt<it.length;lt++)ot=it[lt],ot.height&&ot.width&&ot.url?st.push({url:ot.url,width:Number(ot.width),height:Number(ot.height)}):tt.console.error("Unsupported image format: %s",ot.url?ot.url:"<no URL>");return st.sort(function(ut,ct){return ut.height-ct.height})}function nt(it,st){if(!st||!st.documentElement)throw new Error(tt.getString("Errors.Xml"));var ot=st.documentElement,lt=ot.tagName,ut=null,ct=[],dt,ft;if(lt=="image")try{for(ut={type:ot.getAttribute("type"),levels:[]},ct=ot.getElementsByTagName("level"),ft=0;ft<ct.length;ft++)dt=ct[ft],ut.levels.push({url:dt.getAttribute("url"),width:parseInt(dt.getAttribute("width"),10),height:parseInt(dt.getAttribute("height"),10)});return rt(it,ut)}catch(pt){throw pt instanceof Error?pt:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if(lt=="collection")throw new Error("Legacy Image Pyramid Collections not yet supported.");if(lt=="error")throw new Error("Error: "+st)}throw new Error("Unknown element "+lt)}function rt(it,st){return st.levels}}(OpenSeadragon),function(tt){tt.ImageTileSource=function(et){et=tt.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},et),tt.TileSource.apply(this,[et])},tt.extend(tt.ImageTileSource.prototype,tt.TileSource.prototype,{supports:function(et,nt){return et.type&&et.type==="image"},configure:function(et,nt){return et},getImageInfo:function(et){var nt=this._image=new Image,rt=this;this.crossOriginPolicy&&(nt.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(nt.useCredentials=this.ajaxWithCredentials),tt.addEvent(nt,"load",function(){rt.width=Object.prototype.hasOwnProperty.call(nt,"naturalWidth")?nt.naturalWidth:nt.width,rt.height=Object.prototype.hasOwnProperty.call(nt,"naturalHeight")?nt.naturalHeight:nt.height,rt.aspectRatio=rt.width/rt.height,rt.dimensions=new tt.Point(rt.width,rt.height),rt._tileWidth=rt.width,rt._tileHeight=rt.height,rt.tileOverlap=0,rt.minLevel=0,rt.levels=rt._buildLevels(),rt.maxLevel=rt.levels.length-1,rt.ready=!0,rt.raiseEvent("ready",{tileSource:rt})}),tt.addEvent(nt,"error",function(){rt.raiseEvent("open-failed",{message:"Error loading image at "+et,source:et})}),nt.src=et},getLevelScale:function(et){var nt=NaN;return et>=this.minLevel&&et<=this.maxLevel&&(nt=this.levels[et].width/this.levels[this.maxLevel].width),nt},getNumTiles:function(et){var nt=this.getLevelScale(et);return nt?new tt.Point(1,1):new tt.Point(0,0)},getTileUrl:function(et,nt,rt){var it=null;return et>=this.minLevel&&et<=this.maxLevel&&(it=this.levels[et].url),it},getContext2D:function(et,nt,rt){var it=null;return et>=this.minLevel&&et<=this.maxLevel&&(it=this.levels[et].context2D),it},_buildLevels:function(){var et=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!tt.supportsCanvas||!this.useCanvas)return delete this._image,et;var nt=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,rt=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,it=document.createElement("canvas"),st=it.getContext("2d");if(it.width=nt,it.height=rt,st.drawImage(this._image,0,0,nt,rt),et[0].context2D=st,delete this._image,tt.isCanvasTainted(it))return et;for(;nt>=2&&rt>=2;){nt=Math.floor(nt/2),rt=Math.floor(rt/2);var ot=document.createElement("canvas"),lt=ot.getContext("2d");ot.width=nt,ot.height=rt,lt.drawImage(it,0,0,nt,rt),et.splice(0,0,{context2D:lt,width:nt,height:rt}),it=ot,st=lt}return et}})}(OpenSeadragon),function(tt){tt.TileSourceCollection=function(et,nt,rt,it){tt.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(tt){tt.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},tt.Button=function(lt){var ut=this;tt.EventSource.call(this),tt.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:tt.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:tt.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},lt),this.element=lt.element||tt.makeNeutralElement("div"),lt.element||(this.imgRest=tt.makeTransparentImage(this.srcRest),this.imgGroup=tt.makeTransparentImage(this.srcGroup),this.imgHover=tt.makeTransparentImage(this.srcHover),this.imgDown=tt.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",tt.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",tt.Browser.vendor==tt.BROWSERS.FIREFOX&&tt.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=tt.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new tt.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(ct){ct.insideElementPressed?(st(ut,tt.ButtonState.DOWN),ut.raiseEvent("enter",{originalEvent:ct.originalEvent})):ct.buttonDownAny||st(ut,tt.ButtonState.HOVER)},focusHandler:function(ct){this.enterHandler(ct),ut.raiseEvent("focus",{originalEvent:ct.originalEvent})},exitHandler:function(ct){ot(ut,tt.ButtonState.GROUP),ct.insideElementPressed&&ut.raiseEvent("exit",{originalEvent:ct.originalEvent})},blurHandler:function(ct){this.exitHandler(ct),ut.raiseEvent("blur",{originalEvent:ct.originalEvent})},pressHandler:function(ct){st(ut,tt.ButtonState.DOWN),ut.raiseEvent("press",{originalEvent:ct.originalEvent})},releaseHandler:function(ct){ct.insideElementPressed&&ct.insideElementReleased?(ot(ut,tt.ButtonState.HOVER),ut.raiseEvent("release",{originalEvent:ct.originalEvent})):ct.insideElementPressed?ot(ut,tt.ButtonState.GROUP):st(ut,tt.ButtonState.HOVER)},clickHandler:function(ct){ct.quick&&ut.raiseEvent("click",{originalEvent:ct.originalEvent})},keyHandler:function(ct){return ct.keyCode===13?(ut.raiseEvent("click",{originalEvent:ct.originalEvent}),ut.raiseEvent("release",{originalEvent:ct.originalEvent}),!1):!0}}),ot(this,tt.ButtonState.REST)},tt.extend(tt.Button.prototype,tt.EventSource.prototype,{notifyGroupEnter:function(){st(this,tt.ButtonState.GROUP)},notifyGroupExit:function(){ot(this,tt.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,tt.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,tt.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}});function et(lt){tt.requestAnimationFrame(function(){nt(lt)})}function nt(lt){var ut,ct,dt;lt.shouldFade&&(ut=tt.now(),ct=ut-lt.fadeBeginTime,dt=1-ct/lt.fadeLength,dt=Math.min(1,dt),dt=Math.max(0,dt),lt.imgGroup&&tt.setElementOpacity(lt.imgGroup,dt,!0),dt>0&&et(lt))}function rt(lt){lt.shouldFade=!0,lt.fadeBeginTime=tt.now()+lt.fadeDelay,window.setTimeout(function(){et(lt)},lt.fadeDelay)}function it(lt){lt.shouldFade=!1,lt.imgGroup&&tt.setElementOpacity(lt.imgGroup,1,!0)}function st(lt,ut){lt.element.disabled||(ut>=tt.ButtonState.GROUP&&lt.currentState==tt.ButtonState.REST&&(it(lt),lt.currentState=tt.ButtonState.GROUP),ut>=tt.ButtonState.HOVER&&lt.currentState==tt.ButtonState.GROUP&&(lt.imgHover&&(lt.imgHover.style.visibility=""),lt.currentState=tt.ButtonState.HOVER),ut>=tt.ButtonState.DOWN&&lt.currentState==tt.ButtonState.HOVER&&(lt.imgDown&&(lt.imgDown.style.visibility=""),lt.currentState=tt.ButtonState.DOWN))}function ot(lt,ut){lt.element.disabled||(ut<=tt.ButtonState.HOVER&&lt.currentState==tt.ButtonState.DOWN&&(lt.imgDown&&(lt.imgDown.style.visibility="hidden"),lt.currentState=tt.ButtonState.HOVER),ut<=tt.ButtonState.GROUP&&lt.currentState==tt.ButtonState.HOVER&&(lt.imgHover&&(lt.imgHover.style.visibility="hidden"),lt.currentState=tt.ButtonState.GROUP),ut<=tt.ButtonState.REST&&lt.currentState==tt.ButtonState.GROUP&&(rt(lt),lt.currentState=tt.ButtonState.REST))}}(OpenSeadragon),function(tt){tt.ButtonGroup=function(et){tt.extend(!0,this,{buttons:[],clickTimeThreshold:tt.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:tt.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},et);var nt=this.buttons.concat([]),rt=this,it;if(this.element=et.element||tt.makeNeutralElement("div"),!et.group)for(this.element.style.display="inline-block",it=0;it<nt.length;it++)this.element.appendChild(nt[it].element);tt.setElementTouchActionNone(this.element),this.tracker=new tt.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(st){var ot;for(ot=0;ot<rt.buttons.length;ot++)rt.buttons[ot].notifyGroupEnter()},exitHandler:function(st){var ot;if(!st.insideElementPressed)for(ot=0;ot<rt.buttons.length;ot++)rt.buttons[ot].notifyGroupExit()}})},tt.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(tt){tt.Rect=function(et,nt,rt,it,st){this.x=typeof et=="number"?et:0,this.y=typeof nt=="number"?nt:0,this.width=typeof rt=="number"?rt:0,this.height=typeof it=="number"?it:0,this.degrees=typeof st=="number"?st:0,this.degrees=tt.positiveModulo(this.degrees,360);var ot,lt;this.degrees>=270?(ot=this.getTopRight(),this.x=ot.x,this.y=ot.y,lt=this.height,this.height=this.width,this.width=lt,this.degrees-=270):this.degrees>=180?(ot=this.getBottomRight(),this.x=ot.x,this.y=ot.y,this.degrees-=180):this.degrees>=90&&(ot=this.getBottomLeft(),this.x=ot.x,this.y=ot.y,lt=this.height,this.height=this.width,this.width=lt,this.degrees-=90)},tt.Rect.fromSummits=function(et,nt,rt){var it=et.distanceTo(nt),st=et.distanceTo(rt),ot=nt.minus(et),lt=Math.atan(ot.y/ot.x);return ot.x<0?lt+=Math.PI:ot.y<0&&(lt+=2*Math.PI),new tt.Rect(et.x,et.y,it,st,lt/Math.PI*180)},tt.Rect.prototype={clone:function(){return new tt.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new tt.Point(this.x,this.y)},getBottomRight:function(){return new tt.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new tt.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new tt.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new tt.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new tt.Point(this.width,this.height)},equals:function(et){return et instanceof tt.Rect&&this.x===et.x&&this.y===et.y&&this.width===et.width&&this.height===et.height&&this.degrees===et.degrees},times:function(et){return new tt.Rect(this.x*et,this.y*et,this.width*et,this.height*et,this.degrees)},translate:function(et){return new tt.Rect(this.x+et.x,this.y+et.y,this.width,this.height,this.degrees)},union:function(et){var nt=this.getBoundingBox(),rt=et.getBoundingBox(),it=Math.min(nt.x,rt.x),st=Math.min(nt.y,rt.y),ot=Math.max(nt.x+nt.width,rt.x+rt.width),lt=Math.max(nt.y+nt.height,rt.y+rt.height);return new tt.Rect(it,st,ot-it,lt-st)},intersection:function(et){var nt=1e-10,rt=[],it=this.getTopLeft();et.containsPoint(it,nt)&&rt.push(it);var st=this.getTopRight();et.containsPoint(st,nt)&&rt.push(st);var ot=this.getBottomLeft();et.containsPoint(ot,nt)&&rt.push(ot);var lt=this.getBottomRight();et.containsPoint(lt,nt)&&rt.push(lt);var ut=et.getTopLeft();this.containsPoint(ut,nt)&&rt.push(ut);var ct=et.getTopRight();this.containsPoint(ct,nt)&&rt.push(ct);var dt=et.getBottomLeft();this.containsPoint(dt,nt)&&rt.push(dt);var ft=et.getBottomRight();this.containsPoint(ft,nt)&&rt.push(ft);for(var pt=this._getSegments(),gt=et._getSegments(),_r=0;_r<pt.length;_r++)for(var Yr=pt[_r],mt=0;mt<gt.length;mt++){var Kr=gt[mt],Xr=Zr(Yr[0],Yr[1],Kr[0],Kr[1]);Xr&&rt.push(Xr)}function Zr(os,is,cs,ps){var vs=is.minus(os),ls=ps.minus(cs),gs=-ls.x*vs.y+vs.x*ls.y;if(gs===0)return null;var us=(vs.x*(os.y-cs.y)-vs.y*(os.x-cs.x))/gs,ms=(ls.x*(os.y-cs.y)-ls.y*(os.x-cs.x))/gs;return-nt<=us&&us<=1-nt&&-nt<=ms&&ms<=1-nt?new tt.Point(os.x+ms*vs.x,os.y+ms*vs.y):null}if(rt.length===0)return null;for(var Qr=rt[0].x,_i=rt[0].x,rs=rt[0].y,ns=rt[0].y,ss=1;ss<rt.length;ss++){var fs=rt[ss];fs.x<Qr&&(Qr=fs.x),fs.x>_i&&(_i=fs.x),fs.y<rs&&(rs=fs.y),fs.y>ns&&(ns=fs.y)}return new tt.Rect(Qr,rs,_i-Qr,ns-rs)},_getSegments:function(){var et=this.getTopLeft(),nt=this.getTopRight(),rt=this.getBottomLeft(),it=this.getBottomRight();return[[et,nt],[nt,it],[it,rt],[rt,et]]},rotate:function(et,nt){if(et=tt.positiveModulo(et,360),et===0)return this.clone();nt=nt||this.getCenter();var rt=this.getTopLeft().rotate(et,nt),it=this.getTopRight().rotate(et,nt),st=it.minus(rt);st=st.apply(function(lt){var ut=1e-15;return Math.abs(lt)<ut?0:lt});var ot=Math.atan(st.y/st.x);return st.x<0?ot+=Math.PI:st.y<0&&(ot+=2*Math.PI),new tt.Rect(rt.x,rt.y,this.width,this.height,ot/Math.PI*180)},getBoundingBox:function(){if(this.degrees===0)return this.clone();var et=this.getTopLeft(),nt=this.getTopRight(),rt=this.getBottomLeft(),it=this.getBottomRight(),st=Math.min(et.x,nt.x,rt.x,it.x),ot=Math.max(et.x,nt.x,rt.x,it.x),lt=Math.min(et.y,nt.y,rt.y,it.y),ut=Math.max(et.y,nt.y,rt.y,it.y);return new tt.Rect(st,lt,ot-st,ut-lt)},getIntegerBoundingBox:function(){var et=this.getBoundingBox(),nt=Math.floor(et.x),rt=Math.floor(et.y),it=Math.ceil(et.width+et.x-nt),st=Math.ceil(et.height+et.y-rt);return new tt.Rect(nt,rt,it,st)},containsPoint:function(et,nt){nt=nt||0;var rt=this.getTopLeft(),it=this.getTopRight(),st=this.getBottomLeft(),ot=it.minus(rt),lt=st.minus(rt);return(et.x-rt.x)*ot.x+(et.y-rt.y)*ot.y>=-nt&&(et.x-it.x)*ot.x+(et.y-it.y)*ot.y<=nt&&(et.x-rt.x)*lt.x+(et.y-rt.y)*lt.y>=-nt&&(et.x-st.x)*lt.x+(et.y-st.y)*lt.y<=nt},toString:function(){return"["+Math.round(this.x*100)/100+", "+Math.round(this.y*100)/100+", "+Math.round(this.width*100)/100+"x"+Math.round(this.height*100)/100+", "+Math.round(this.degrees*100)/100+"deg]"}}}(OpenSeadragon),function(tt){var et={};tt.ReferenceStrip=function(ct){var dt=this,ft=ct.viewer,pt=tt.getElementSize(ft.element),gt,_r,Yr;for(ct.id||(ct.id="referencestrip-"+tt.now(),this.element=tt.makeNeutralElement("div"),this.element.id=ct.id,this.element.className="referencestrip"),ct=tt.extend(!0,{sizeRatio:tt.DEFAULT_SETTINGS.referenceStripSizeRatio,position:tt.DEFAULT_SETTINGS.referenceStripPosition,scroll:tt.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:tt.DEFAULT_SETTINGS.clickTimeThreshold},ct,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),tt.extend(this,ct),et[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,_r=this.element.style,_r.marginTop="0px",_r.marginRight="0px",_r.marginBottom="0px",_r.marginLeft="0px",_r.left="0px",_r.bottom="0px",_r.border="0px",_r.background="#000",_r.position="relative",tt.setElementTouchActionNone(this.element),tt.setElementOpacity(this.element,.8),this.viewer=ft,this.innerTracker=new tt.MouseTracker({element:this.element,dragHandler:tt.delegate(this,nt),scrollHandler:tt.delegate(this,rt),enterHandler:tt.delegate(this,st),exitHandler:tt.delegate(this,ot),keyDownHandler:tt.delegate(this,lt),keyHandler:tt.delegate(this,ut)}),ct.width&&ct.height?(this.element.style.width=ct.width+"px",this.element.style.height=ct.height+"px",ft.addControl(this.element,{anchor:tt.ControlAnchor.BOTTOM_LEFT})):ct.scroll=="horizontal"?(this.element.style.width=pt.x*ct.sizeRatio*ft.tileSources.length+12*ft.tileSources.length+"px",this.element.style.height=pt.y*ct.sizeRatio+"px",ft.addControl(this.element,{anchor:tt.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=pt.y*ct.sizeRatio*ft.tileSources.length+12*ft.tileSources.length+"px",this.element.style.width=pt.x*ct.sizeRatio+"px",ft.addControl(this.element,{anchor:tt.ControlAnchor.TOP_LEFT})),this.panelWidth=pt.x*this.sizeRatio+8,this.panelHeight=pt.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},Yr=0;Yr<ft.tileSources.length;Yr++)gt=tt.makeNeutralElement("div"),gt.id=this.element.id+"-"+Yr,gt.style.width=dt.panelWidth+"px",gt.style.height=dt.panelHeight+"px",gt.style.display="inline",gt.style.float="left",gt.style.cssFloat="left",gt.style.styleFloat="left",gt.style.padding="2px",tt.setElementTouchActionNone(gt),gt.innerTracker=new tt.MouseTracker({element:gt,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(mt){mt.eventSource.dragging=tt.now()},releaseHandler:function(mt){var Kr=mt.eventSource,Xr=Kr.element.id,Zr=Number(Xr.split("-")[2]),Qr=tt.now();mt.insideElementPressed&&mt.insideElementReleased&&Kr.dragging&&Qr-Kr.dragging<Kr.clickTimeThreshold&&(Kr.dragging=null,ft.goToPage(Zr))}}),this.element.appendChild(gt),gt.activePanel=!1,this.panels.push(gt);it(this,this.scroll=="vertical"?pt.y:pt.x,0),this.setFocus(0)},tt.extend(tt.ReferenceStrip.prototype,tt.EventSource.prototype,tt.Viewer.prototype,{setFocus:function(ct){var dt=this.element.querySelector("#"+this.element.id+"-"+ct),ft=tt.getElementSize(this.viewer.canvas),pt=Number(this.element.style.width.replace("px","")),gt=Number(this.element.style.height.replace("px","")),_r=-Number(this.element.style.marginLeft.replace("px","")),Yr=-Number(this.element.style.marginTop.replace("px","")),mt;this.currentSelected!==dt&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=dt,this.currentSelected.style.background="#999",this.scroll=="horizontal"?(mt=Number(ct)*(this.panelWidth+3),mt>_r+ft.x-this.panelWidth?(mt=Math.min(mt,pt-ft.x),this.element.style.marginLeft=-mt+"px",it(this,ft.x,-mt)):mt<_r&&(mt=Math.max(0,mt-ft.x/2),this.element.style.marginLeft=-mt+"px",it(this,ft.x,-mt))):(mt=Number(ct)*(this.panelHeight+3),mt>Yr+ft.y-this.panelHeight?(mt=Math.min(mt,gt-ft.y),this.element.style.marginTop=-mt+"px",it(this,ft.y,-mt)):mt<Yr&&(mt=Math.max(0,mt-ft.y/2),this.element.style.marginTop=-mt+"px",it(this,ft.y,-mt))),this.currentPage=ct,st.call(this,{eventSource:this.innerTracker}))},update:function(){return et[this.id].animating?(tt.console.log("image reference strip update"),!0):!1},destroy:function(){if(this.miniViewers)for(var ct in this.miniViewers)this.miniViewers[ct].destroy();this.element&&this.element.parentNode.removeChild(this.element)}});function nt(ct){var dt=Number(this.element.style.marginLeft.replace("px","")),ft=Number(this.element.style.marginTop.replace("px","")),pt=Number(this.element.style.width.replace("px","")),gt=Number(this.element.style.height.replace("px","")),_r=tt.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&(this.scroll=="horizontal"?-ct.delta.x>0?dt>-(pt-_r.x)&&(this.element.style.marginLeft=dt+ct.delta.x*2+"px",it(this,_r.x,dt+ct.delta.x*2)):-ct.delta.x<0&&dt<0&&(this.element.style.marginLeft=dt+ct.delta.x*2+"px",it(this,_r.x,dt+ct.delta.x*2)):-ct.delta.y>0?ft>-(gt-_r.y)&&(this.element.style.marginTop=ft+ct.delta.y*2+"px",it(this,_r.y,ft+ct.delta.y*2)):-ct.delta.y<0&&ft<0&&(this.element.style.marginTop=ft+ct.delta.y*2+"px",it(this,_r.y,ft+ct.delta.y*2))),!1}function rt(ct){var dt=Number(this.element.style.marginLeft.replace("px","")),ft=Number(this.element.style.marginTop.replace("px","")),pt=Number(this.element.style.width.replace("px","")),gt=Number(this.element.style.height.replace("px","")),_r=tt.getElementSize(this.viewer.canvas);return this.element&&(this.scroll=="horizontal"?ct.scroll>0?dt>-(pt-_r.x)&&(this.element.style.marginLeft=dt-ct.scroll*60+"px",it(this,_r.x,dt-ct.scroll*60)):ct.scroll<0&&dt<0&&(this.element.style.marginLeft=dt-ct.scroll*60+"px",it(this,_r.x,dt-ct.scroll*60)):ct.scroll<0?ft>_r.y-gt&&(this.element.style.marginTop=ft+ct.scroll*60+"px",it(this,_r.y,ft+ct.scroll*60)):ct.scroll>0&&ft<0&&(this.element.style.marginTop=ft+ct.scroll*60+"px",it(this,_r.y,ft+ct.scroll*60))),!1}function it(ct,dt,ft){var pt,gt,_r,Yr,mt,Kr,Xr;for(ct.scroll=="horizontal"?pt=ct.panelWidth:pt=ct.panelHeight,gt=Math.ceil(dt/pt)+5,_r=Math.ceil((Math.abs(ft)+dt)/pt)+1,gt=_r-gt,gt=gt<0?0:gt,Kr=gt;Kr<_r&&Kr<ct.panels.length;Kr++)if(Xr=ct.panels[Kr],!Xr.activePanel){var Zr,Qr=ct.viewer.tileSources[Kr];Qr.referenceStripThumbnailUrl?Zr={type:"image",url:Qr.referenceStripThumbnailUrl}:Zr=Qr,Yr=new tt.Viewer({id:Xr.id,tileSources:[Zr],element:Xr,navigatorSizeRatio:ct.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:ct.viewer.loadTilesWithAjax,ajaxHeaders:ct.viewer.ajaxHeaders,useCanvas:ct.useCanvas}),Yr.displayRegion=tt.makeNeutralElement("div"),Yr.displayRegion.id=Xr.id+"-displayregion",Yr.displayRegion.className="displayregion",mt=Yr.displayRegion.style,mt.position="relative",mt.top="0px",mt.left="0px",mt.fontSize="0px",mt.overflow="hidden",mt.float="left",mt.cssFloat="left",mt.styleFloat="left",mt.zIndex=999999999,mt.cursor="default",mt.width=ct.panelWidth-4+"px",mt.height=ct.panelHeight-4+"px",Yr.displayRegion.innerTracker=new tt.MouseTracker({element:Yr.displayRegion,startDisabled:!0}),Xr.getElementsByTagName("div")[0].appendChild(Yr.displayRegion),ct.miniViewers[Xr.id]=Yr,Xr.activePanel=!0}}function st(ct){var dt=ct.eventSource.element;return this.scroll=="horizontal"?dt.style.marginBottom="0px":dt.style.marginLeft="0px",!1}function ot(ct){var dt=ct.eventSource.element;return this.scroll=="horizontal"?dt.style.marginBottom="-"+tt.getElementSize(dt).y/2+"px":dt.style.marginLeft="-"+tt.getElementSize(dt).x/2+"px",!1}function lt(ct){if(!ct.preventDefaultAction&&!ct.ctrl&&!ct.alt&&!ct.meta)switch(ct.keyCode){case 38:return rt.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:return rt.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 37:return rt.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return rt.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}else return!0}function ut(ct){if(!ct.preventDefaultAction&&!ct.ctrl&&!ct.alt&&!ct.meta)switch(ct.keyCode){case 61:return rt.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return rt.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return rt.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:return rt.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 97:return rt.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return rt.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}else return!0}}(OpenSeadragon),function(tt){tt.DisplayRect=function(et,nt,rt,it,st,ot){tt.Rect.apply(this,[et,nt,rt,it]),this.minLevel=st,this.maxLevel=ot},tt.extend(tt.DisplayRect.prototype,tt.Rect.prototype)}(OpenSeadragon),function(tt){tt.Spring=function(nt){var rt=arguments;typeof nt!="object"&&(nt={initial:rt.length&&typeof rt[0]=="number"?rt[0]:void 0,springStiffness:rt.length>1?rt[1].springStiffness:5,animationTime:rt.length>1?rt[1].animationTime:1.5}),tt.console.assert(typeof nt.springStiffness=="number"&&nt.springStiffness!==0,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),tt.console.assert(typeof nt.animationTime=="number"&&nt.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),nt.exponential&&(this._exponential=!0,delete nt.exponential),tt.extend(!0,this,nt),this.current={value:typeof this.initial=="number"?this.initial:this._exponential?0:1,time:tt.now()},tt.console.assert(!this._exponential||this.current.value!==0,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},tt.Spring.prototype={resetTo:function(nt){tt.console.assert(!this._exponential||nt!==0,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=nt,this.start.time=this.target.time=this.current.time=tt.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(nt){tt.console.assert(!this._exponential||nt!==0,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=nt,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(nt){this.start.value+=nt,this.target.value+=nt,this._exponential&&(tt.console.assert(this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(nt){this._exponential=nt,this._exponential&&(tt.console.assert(this.current.value!==0&&this.target.value!==0&&this.start.value!==0,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=tt.now();var nt,rt;this._exponential?(nt=this.start._logValue,rt=this.target._logValue):(nt=this.start.value,rt=this.target.value);var it=this.current.time>=this.target.time?rt:nt+(rt-nt)*et(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),st=this.current.value;return this._exponential?this.current.value=Math.exp(it):this.current.value=it,st!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}};function et(nt,rt){return(1-Math.exp(nt*-rt))/(1-Math.exp(-nt))}}(OpenSeadragon),function(tt){function et(rt){tt.extend(!0,this,{timeout:tt.DEFAULT_SETTINGS.timeout,jobId:null},rt),this.image=null}et.prototype={errorMsg:null,start:function(){var rt=this,it=this.abort;this.image=new Image,this.image.onload=function(){rt.finish(!0)},this.image.onabort=this.image.onerror=function(){rt.errorMsg="Image load aborted",rt.finish(!1)},this.jobId=window.setTimeout(function(){rt.errorMsg="Image load exceeded timeout ("+rt.timeout+" ms)",rt.finish(!1)},this.timeout),this.loadWithAjax?(this.request=tt.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(st){var ot;try{ot=new window.Blob([st.response])}catch(dt){var lt=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(dt.name==="TypeError"&&lt){var ut=new lt;ut.append(st.response),ot=ut.getBlob()}}ot.size===0&&(rt.errorMsg="Empty image response.",rt.finish(!1));var ct=(window.URL||window.webkitURL).createObjectURL(ot);rt.image.src=ct},error:function(st){rt.errorMsg="Image load aborted - XHR error",rt.finish(!1)}}),this.abort=function(){rt.request.abort(),typeof it=="function"&&it()}):(this.crossOriginPolicy!==!1&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(rt){this.image.onload=this.image.onerror=this.image.onabort=null,rt||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},tt.ImageLoader=function(rt){tt.extend(!0,this,{jobLimit:tt.DEFAULT_SETTINGS.imageLoaderLimit,timeout:tt.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},rt)},tt.ImageLoader.prototype={addJob:function(rt){var it=this,st=function(ut){nt(it,ut,rt.callback)},ot={src:rt.src,loadWithAjax:rt.loadWithAjax,ajaxHeaders:rt.loadWithAjax?rt.ajaxHeaders:null,crossOriginPolicy:rt.crossOriginPolicy,ajaxWithCredentials:rt.ajaxWithCredentials,callback:st,abort:rt.abort,timeout:this.timeout},lt=new et(ot);!this.jobLimit||this.jobsInProgress<this.jobLimit?(lt.start(),this.jobsInProgress++):this.jobQueue.push(lt)},clear:function(){for(var rt=0;rt<this.jobQueue.length;rt++){var it=this.jobQueue[rt];typeof it.abort=="function"&&it.abort()}this.jobQueue=[]}};function nt(rt,it,st){var ot;rt.jobsInProgress--,(!rt.jobLimit||rt.jobsInProgress<rt.jobLimit)&&rt.jobQueue.length>0&&(ot=rt.jobQueue.shift(),ot.start(),rt.jobsInProgress++),st(it.image,it.errorMsg,it.request)}}(OpenSeadragon),function(tt){tt.Tile=function(et,nt,rt,it,st,ot,lt,ut,ct,dt){this.level=et,this.x=nt,this.y=rt,this.bounds=it,this.sourceBounds=dt,this.exists=st,this.url=ot,this.context2D=lt,this.loadWithAjax=ut,this.ajaxHeaders=ct,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},tt.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(et){if(!this.cacheImageRecord){tt.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString());return}if(!this.loaded){tt.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}this.element||(this.element=tt.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=et&&et.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",tt.setElementOpacity(this.element,this.opacity)},drawCanvas:function(et,nt,rt,it){var st=this.position.times(tt.pixelDensityRatio),ot=this.size.times(tt.pixelDensityRatio),lt;if(!this.context2D&&!this.cacheImageRecord){tt.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString());return}if(lt=this.context2D||this.cacheImageRecord.getRenderedContext(),!this.loaded||!lt){tt.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}et.save(),et.globalAlpha=this.opacity,typeof rt=="number"&&rt!==1&&(st=st.times(rt),ot=ot.times(rt)),it instanceof tt.Point&&(st=st.plus(it)),et.globalAlpha===1&&this._hasTransparencyChannel()&&et.clearRect(st.x,st.y,ot.x,ot.y),nt({context:et,tile:this,rendered:lt});var ut,ct;this.sourceBounds?(ut=Math.min(this.sourceBounds.width,lt.canvas.width),ct=Math.min(this.sourceBounds.height,lt.canvas.height)):(ut=lt.canvas.width,ct=lt.canvas.height),et.drawImage(lt.canvas,0,0,ut,ct,st.x,st.y,ot.x,ot.y),et.restore()},getScaleForEdgeSmoothing:function(){var et;if(this.cacheImageRecord)et=this.cacheImageRecord.getRenderedContext();else if(this.context2D)et=this.context2D;else return tt.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;return et.canvas.width/(this.size.x*tt.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(et,nt,rt){var it=Math.max(1,Math.ceil((rt.x-nt.x)/2)),st=Math.max(1,Math.ceil((rt.y-nt.y)/2));return new tt.Point(it,st).minus(this.position.times(tt.pixelDensityRatio).times(et||1).apply(function(ot){return ot%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(tt){tt.OverlayPlacement=tt.Placement,tt.OverlayRotationMode=tt.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),tt.Overlay=function(et,nt,rt){var it;tt.isPlainObject(et)?it=et:it={element:et,location:nt,placement:rt},this.element=it.element,this.style=it.element.style,this._init(it)},tt.Overlay.prototype={_init:function(et){this.location=et.location,this.placement=et.placement===void 0?tt.Placement.TOP_LEFT:et.placement,this.onDraw=et.onDraw,this.checkResize=et.checkResize===void 0?!0:et.checkResize,this.width=et.width===void 0?null:et.width,this.height=et.height===void 0?null:et.height,this.rotationMode=et.rotationMode||tt.OverlayRotationMode.EXACT,this.location instanceof tt.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=tt.Placement.TOP_LEFT),this.scales=this.width!==null&&this.height!==null,this.bounds=new tt.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(et,nt){var rt=tt.Placement.properties[this.placement];rt&&(rt.isHorizontallyCentered?et.x-=nt.x/2:rt.isRight&&(et.x-=nt.x),rt.isVerticallyCentered?et.y-=nt.y/2:rt.isBottom&&(et.y-=nt.y))},destroy:function(){var et=this.element,nt=this.style;et.parentNode&&(et.parentNode.removeChild(et),et.prevElementParent&&(nt.display="none",document.body.appendChild(et))),this.onDraw=null,nt.top="",nt.left="",nt.position="",this.width!==null&&(nt.width=""),this.height!==null&&(nt.height="");var rt=tt.getCssPropertyWithVendorPrefix("transformOrigin"),it=tt.getCssPropertyWithVendorPrefix("transform");rt&&it&&(nt[rt]="",nt[it]="")},drawHTML:function(et,nt){var rt=this.element;rt.parentNode!==et&&(rt.prevElementParent=rt.parentNode,rt.prevNextSibling=rt.nextSibling,et.appendChild(rt),this.style.position="absolute",this.size=tt.getElementSize(rt));var it=this._getOverlayPositionAndSize(nt),st=it.position,ot=this.size=it.size,lt=it.rotate;if(this.onDraw)this.onDraw(st,ot,this.element);else{var ut=this.style;ut.left=st.x+"px",ut.top=st.y+"px",this.width!==null&&(ut.width=ot.x+"px"),this.height!==null&&(ut.height=ot.y+"px");var ct=tt.getCssPropertyWithVendorPrefix("transformOrigin"),dt=tt.getCssPropertyWithVendorPrefix("transform");ct&&dt&&(lt?(ut[ct]=this._getTransformOrigin(),ut[dt]="rotate("+lt+"deg)"):(ut[ct]="",ut[dt]="")),ut.display!=="none"&&(ut.display="block")}},_getOverlayPositionAndSize:function(et){var nt=et.pixelFromPoint(this.location,!0),rt=this._getSizeInPixels(et);this.adjust(nt,rt);var it=0;if(et.degrees&&this.rotationMode!==tt.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===tt.OverlayRotationMode.BOUNDING_BOX&&this.width!==null&&this.height!==null){var st=new tt.Rect(nt.x,nt.y,rt.x,rt.y),ot=this._getBoundingBox(st,et.degrees);nt=ot.getTopLeft(),rt=ot.getSize()}else it=et.degrees;return{position:nt,size:rt,rotate:it}},_getSizeInPixels:function(et){var nt=this.size.x,rt=this.size.y;if(this.width!==null||this.height!==null){var it=et.deltaPixelsFromPointsNoRotate(new tt.Point(this.width||0,this.height||0),!0);this.width!==null&&(nt=it.x),this.height!==null&&(rt=it.y)}if(this.checkResize&&(this.width===null||this.height===null)){var st=this.size=tt.getElementSize(this.element);this.width===null&&(nt=st.x),this.height===null&&(rt=st.y)}return new tt.Point(nt,rt)},_getBoundingBox:function(et,nt){var rt=this._getPlacementPoint(et);return et.rotate(nt,rt).getBoundingBox()},_getPlacementPoint:function(et){var nt=new tt.Point(et.x,et.y),rt=tt.Placement.properties[this.placement];return rt&&(rt.isHorizontallyCentered?nt.x+=et.width/2:rt.isRight&&(nt.x+=et.width),rt.isVerticallyCentered?nt.y+=et.height/2:rt.isBottom&&(nt.y+=et.height)),nt},_getTransformOrigin:function(){var et="",nt=tt.Placement.properties[this.placement];return nt&&(nt.isLeft?et="left":nt.isRight&&(et="right"),nt.isTop?et+=" top":nt.isBottom&&(et+=" bottom")),et},update:function(et,nt){var rt=tt.isPlainObject(et)?et:{location:et,placement:nt};this._init({location:rt.location||this.location,placement:rt.placement!==void 0?rt.placement:this.placement,onDraw:rt.onDraw||this.onDraw,checkResize:rt.checkResize||this.checkResize,width:rt.width!==void 0?rt.width:this.width,height:rt.height!==void 0?rt.height:this.height,rotationMode:rt.rotationMode||this.rotationMode})},getBounds:function(et){tt.console.assert(et,"A viewport must now be passed to Overlay.getBounds.");var nt=this.width,rt=this.height;if(nt===null||rt===null){var it=et.deltaPointsFromPixelsNoRotate(this.size,!0);nt===null&&(nt=it.x),rt===null&&(rt=it.y)}var st=this.location.clone();return this.adjust(st,new tt.Point(nt,rt)),this._adjustBoundsForRotation(et,new tt.Rect(st.x,st.y,nt,rt))},_adjustBoundsForRotation:function(et,nt){if(!et||et.degrees===0||this.rotationMode===tt.OverlayRotationMode.EXACT)return nt;if(this.rotationMode===tt.OverlayRotationMode.BOUNDING_BOX){if(this.width===null||this.height===null)return nt;var rt=this._getOverlayPositionAndSize(et);return et.viewerElementToViewportRectangle(new tt.Rect(rt.position.x,rt.position.y,rt.size.x,rt.size.y))}return nt.rotate(-et.degrees,this._getPlacementPoint(nt))}}}(OpenSeadragon),function(tt){tt.Drawer=function(et){tt.console.assert(et.viewer,"[Drawer] options.viewer is required");var nt=arguments;if(tt.isPlainObject(et)||(et={source:nt[0],viewport:nt[1],element:nt[2]}),tt.console.assert(et.viewport,"[Drawer] options.viewport is required"),tt.console.assert(et.element,"[Drawer] options.element is required"),et.source&&tt.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=et.viewer,this.viewport=et.viewport,this.debugGridColor=typeof et.debugGridColor=="string"?[et.debugGridColor]:et.debugGridColor||tt.DEFAULT_SETTINGS.debugGridColor,et.opacity&&tt.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=tt.supportsCanvas&&(this.viewer?this.viewer.useCanvas:!0),this.container=tt.getElement(et.element),this.canvas=tt.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var rt=this._calculateCanvasSize();this.canvas.width=rt.x,this.canvas.height=rt.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",tt.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},tt.Drawer.prototype={addOverlay:function(et,nt,rt,it){return tt.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(et,nt,rt,it),this},updateOverlay:function(et,nt,rt){return tt.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(et,nt,rt),this},removeOverlay:function(et){return tt.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(et),this},clearOverlays:function(){return tt.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(et){var nt=this.viewport.pixelFromPointNoRotate(et,!0);return new tt.Point(nt.x*tt.pixelDensityRatio,nt.y*tt.pixelDensityRatio)},clipWithPolygons:function(et,nt){if(this.useCanvas){var rt=this._getContext(nt);rt.beginPath(),et.forEach(function(it){it.forEach(function(st,ot){rt[ot===0?"moveTo":"lineTo"](st.x,st.y)})}),rt.clip()}},setOpacity:function(et){tt.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var nt=this.viewer.world,rt=0;rt<nt.getItemCount();rt++)nt.getItemAt(rt).setOpacity(et);return this},getOpacity:function(){tt.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var et=this.viewer.world,nt=0,rt=0;rt<et.getItemCount();rt++){var it=et.getItemAt(rt).getOpacity();it>nt&&(nt=it)}return nt},needsUpdate:function(){return tt.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return tt.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return tt.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return tt.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var et=this._calculateCanvasSize();if((this.canvas.width!=et.x||this.canvas.height!=et.y)&&(this.canvas.width=et.x,this.canvas.height=et.y,this._updateImageSmoothingEnabled(this.context),this.sketchCanvas!==null)){var nt=this._calculateSketchCanvasSize();this.sketchCanvas.width=nt.x,this.sketchCanvas.height=nt.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(et,nt){if(this.useCanvas){var rt=this._getContext(et);if(nt)rt.clearRect(nt.x,nt.y,nt.width,nt.height);else{var it=rt.canvas;rt.clearRect(0,0,it.width,it.height)}}},viewportToDrawerRectangle:function(et){var nt=this.viewport.pixelFromPointNoRotate(et.getTopLeft(),!0),rt=this.viewport.deltaPixelsFromPointsNoRotate(et.getSize(),!0);return new tt.Rect(nt.x*tt.pixelDensityRatio,nt.y*tt.pixelDensityRatio,rt.x*tt.pixelDensityRatio,rt.y*tt.pixelDensityRatio)},drawTile:function(et,nt,rt,it,st){if(tt.console.assert(et,"[Drawer.drawTile] tile is required"),tt.console.assert(nt,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var ot=this._getContext(rt);it=it||1,et.drawCanvas(ot,nt,it,st)}else et.drawHTML(this.canvas)},_getContext:function(et){var nt=this.context;if(et){if(this.sketchCanvas===null){this.sketchCanvas=document.createElement("canvas");var rt=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=rt.x,this.sketchCanvas.height=rt.y,this.sketchContext=this.sketchCanvas.getContext("2d"),this.viewport.getRotation()===0){var it=this;this.viewer.addHandler("rotate",function st(){if(it.viewport.getRotation()!==0){it.viewer.removeHandler("rotate",st);var ot=it._calculateSketchCanvasSize();it.sketchCanvas.width=ot.x,it.sketchCanvas.height=ot.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}nt=this.sketchContext}return nt},saveContext:function(et){this.useCanvas&&this._getContext(et).save()},restoreContext:function(et){this.useCanvas&&this._getContext(et).restore()},setClip:function(et,nt){if(this.useCanvas){var rt=this._getContext(nt);rt.beginPath(),rt.rect(et.x,et.y,et.width,et.height),rt.clip()}},drawRectangle:function(et,nt,rt){if(this.useCanvas){var it=this._getContext(rt);it.save(),it.fillStyle=nt,it.fillRect(et.x,et.y,et.width,et.height),it.restore()}},blendSketch:function(et,nt,rt,it){var st=et;if(tt.isPlainObject(st)||(st={opacity:et,scale:nt,translate:rt,compositeOperation:it}),!(!this.useCanvas||!this.sketchCanvas)){et=st.opacity,it=st.compositeOperation;var ot=st.bounds;if(this.context.save(),this.context.globalAlpha=et,it&&(this.context.globalCompositeOperation=it),ot)ot.x<0&&(ot.width+=ot.x,ot.x=0),ot.x+ot.width>this.canvas.width&&(ot.width=this.canvas.width-ot.x),ot.y<0&&(ot.height+=ot.y,ot.y=0),ot.y+ot.height>this.canvas.height&&(ot.height=this.canvas.height-ot.y),this.context.drawImage(this.sketchCanvas,ot.x,ot.y,ot.width,ot.height,ot.x,ot.y,ot.width,ot.height);else{nt=st.scale||1,rt=st.translate;var lt=rt instanceof tt.Point?rt:new tt.Point(0,0),ut=0,ct=0;if(rt){var dt=this.sketchCanvas.width-this.canvas.width,ft=this.sketchCanvas.height-this.canvas.height;ut=Math.round(dt/2),ct=Math.round(ft/2)}this.context.drawImage(this.sketchCanvas,lt.x-ut*nt,lt.y-ct*nt,(this.canvas.width+2*ut)*nt,(this.canvas.height+2*ct)*nt,-ut,-ct,this.canvas.width+2*ut,this.canvas.height+2*ct)}this.context.restore()}},drawDebugInfo:function(et,nt,rt,it){if(this.useCanvas){var st=this.viewer.world.getIndexOfItem(it)%this.debugGridColor.length,ot=this.context;ot.save(),ot.lineWidth=2*tt.pixelDensityRatio,ot.font="small-caps bold "+13*tt.pixelDensityRatio+"px arial",ot.strokeStyle=this.debugGridColor[st],ot.fillStyle=this.debugGridColor[st],this.viewport.degrees!==0&&this._offsetForRotation({degrees:this.viewport.degrees}),it.getRotation(!0)%360!==0&&this._offsetForRotation({degrees:it.getRotation(!0),point:it.viewport.pixelFromPointNoRotate(it._getRotationPoint(!0),!0)}),it.viewport.degrees===0&&it.getRotation(!0)%360===0&&it._drawer.viewer.viewport.getFlip()&&it._drawer._flip(),ot.strokeRect(et.position.x*tt.pixelDensityRatio,et.position.y*tt.pixelDensityRatio,et.size.x*tt.pixelDensityRatio,et.size.y*tt.pixelDensityRatio);var lt=(et.position.x+et.size.x/2)*tt.pixelDensityRatio,ut=(et.position.y+et.size.y/2)*tt.pixelDensityRatio;ot.translate(lt,ut),ot.rotate(Math.PI/180*-this.viewport.degrees),ot.translate(-lt,-ut),et.x===0&&et.y===0&&(ot.fillText("Zoom: "+this.viewport.getZoom(),et.position.x*tt.pixelDensityRatio,(et.position.y-30)*tt.pixelDensityRatio),ot.fillText("Pan: "+this.viewport.getBounds().toString(),et.position.x*tt.pixelDensityRatio,(et.position.y-20)*tt.pixelDensityRatio)),ot.fillText("Level: "+et.level,(et.position.x+10)*tt.pixelDensityRatio,(et.position.y+20)*tt.pixelDensityRatio),ot.fillText("Column: "+et.x,(et.position.x+10)*tt.pixelDensityRatio,(et.position.y+30)*tt.pixelDensityRatio),ot.fillText("Row: "+et.y,(et.position.x+10)*tt.pixelDensityRatio,(et.position.y+40)*tt.pixelDensityRatio),ot.fillText("Order: "+rt+" of "+nt,(et.position.x+10)*tt.pixelDensityRatio,(et.position.y+50)*tt.pixelDensityRatio),ot.fillText("Size: "+et.size.toString(),(et.position.x+10)*tt.pixelDensityRatio,(et.position.y+60)*tt.pixelDensityRatio),ot.fillText("Position: "+et.position.toString(),(et.position.x+10)*tt.pixelDensityRatio,(et.position.y+70)*tt.pixelDensityRatio),this.viewport.degrees!==0&&this._restoreRotationChanges(),it.getRotation(!0)%360!==0&&this._restoreRotationChanges(),it.viewport.degrees===0&&it.getRotation(!0)%360===0&&it._drawer.viewer.viewport.getFlip()&&it._drawer._flip(),ot.restore()}},debugRect:function(et){if(this.useCanvas){var nt=this.context;nt.save(),nt.lineWidth=2*tt.pixelDensityRatio,nt.strokeStyle=this.debugGridColor[0],nt.fillStyle=this.debugGridColor[0],nt.strokeRect(et.x*tt.pixelDensityRatio,et.y*tt.pixelDensityRatio,et.width*tt.pixelDensityRatio,et.height*tt.pixelDensityRatio),nt.restore()}},setImageSmoothingEnabled:function(et){this.useCanvas&&(this._imageSmoothingEnabled=et,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(et){et.msImageSmoothingEnabled=this._imageSmoothingEnabled,et.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(et){var nt=this._getContext(et).canvas;return new tt.Point(nt.width,nt.height)},getCanvasCenter:function(){return new tt.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(et){var nt=et.point?et.point.times(tt.pixelDensityRatio):this.getCanvasCenter(),rt=this._getContext(et.useSketch);rt.save(),rt.translate(nt.x,nt.y),this.viewer.viewport.flipped?(rt.rotate(Math.PI/180*-et.degrees),rt.scale(-1,1)):rt.rotate(Math.PI/180*et.degrees),rt.translate(-nt.x,-nt.y)},_flip:function(et){et=et||{};var nt=et.point?et.point.times(tt.pixelDensityRatio):this.getCanvasCenter(),rt=this._getContext(et.useSketch);rt.translate(nt.x,0),rt.scale(-1,1),rt.translate(-nt.x,0)},_restoreRotationChanges:function(et){var nt=this._getContext(et);nt.restore()},_calculateCanvasSize:function(){var et=tt.pixelDensityRatio,nt=this.viewport.getContainerSize();return{x:Math.round(nt.x*et),y:Math.round(nt.y*et)}},_calculateSketchCanvasSize:function(){var et=this._calculateCanvasSize();if(this.viewport.getRotation()===0)return et;var nt=Math.ceil(Math.sqrt(et.x*et.x+et.y*et.y));return{x:nt,y:nt}}}}(OpenSeadragon),function(tt){tt.Viewport=function(et){var nt=arguments;nt.length&&nt[0]instanceof tt.Point&&(et={containerSize:nt[0],contentSize:nt[1],config:nt[2]}),et.config&&(tt.extend(!0,et,et.config),delete et.config),this._margins=tt.extend({left:0,top:0,right:0,bottom:0},et.margins||{}),delete et.margins,tt.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:tt.DEFAULT_SETTINGS.springStiffness,animationTime:tt.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:tt.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:tt.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:tt.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:tt.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:tt.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:tt.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:tt.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:tt.DEFAULT_SETTINGS.maxZoomLevel,degrees:tt.DEFAULT_SETTINGS.degrees,flipped:tt.DEFAULT_SETTINGS.flipped,homeFillsViewer:tt.DEFAULT_SETTINGS.homeFillsViewer},et),this._updateContainerInnerSize(),this.centerSpringX=new tt.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new tt.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new tt.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new tt.Rect(0,0,1,1),1),this.goHome(!0),this.update()},tt.Viewport.prototype={resetContentSize:function(et){return tt.console.assert(et,"[Viewport.resetContentSize] contentSize is required"),tt.console.assert(et instanceof tt.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),tt.console.assert(et.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),tt.console.assert(et.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new tt.Rect(0,0,1,et.y/et.x),et.x),this},setHomeBounds:function(et,nt){tt.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(et,nt)},_setContentBounds:function(et,nt){tt.console.assert(et,"[Viewport._setContentBounds] bounds is required"),tt.console.assert(et instanceof tt.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),tt.console.assert(et.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),tt.console.assert(et.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=et.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(nt),this._contentBounds=et.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(nt),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:nt,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var et=this._contentAspectRatio/this.getAspectRatio(),nt;return this.homeFillsViewer?nt=et>=1?et:1:nt=et>=1?1:et,nt/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var et=this._contentBounds.getCenter(),nt=1/this.getHomeZoom(),rt=nt/this.getAspectRatio();return new tt.Rect(et.x-nt/2,et.y-rt/2,nt,rt)},goHome:function(et){return this.viewer&&this.viewer.raiseEvent("home",{immediately:et}),this.fitBounds(this.getHomeBounds(),et)},getMinZoom:function(){var et=this.getHomeZoom(),nt=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*et;return nt},getMaxZoom:function(){var et=this.maxZoomLevel;return et||(et=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,et/=this._contentBounds.width),Math.max(et,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new tt.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return tt.extend({},this._margins)},setMargins:function(et){tt.console.assert(tt.type(et)==="object","[Viewport.setMargins] margins must be an object"),this._margins=tt.extend({left:0,top:0,right:0,bottom:0},et),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(et){return this.getBoundsNoRotate(et).rotate(-this.getRotation())},getBoundsNoRotate:function(et){var nt=this.getCenter(et),rt=1/this.getZoom(et),it=rt/this.getAspectRatio();return new tt.Rect(nt.x-rt/2,nt.y-it/2,rt,it)},getBoundsWithMargins:function(et){return this.getBoundsNoRotateWithMargins(et).rotate(-this.getRotation(),this.getCenter(et))},getBoundsNoRotateWithMargins:function(et){var nt=this.getBoundsNoRotate(et),rt=this._containerInnerSize.x*this.getZoom(et);return nt.x-=this._margins.left/rt,nt.y-=this._margins.top/rt,nt.width+=(this._margins.left+this._margins.right)/rt,nt.height+=(this._margins.top+this._margins.bottom)/rt,nt},getCenter:function(et){var nt=new tt.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),rt=new tt.Point(this.centerSpringX.target.value,this.centerSpringY.target.value),it,st,ot,lt,ut,ct,dt,ft;return et?nt:this.zoomPoint?(it=this.pixelFromPoint(this.zoomPoint,!0),st=this.getZoom(),ot=1/st,lt=ot/this.getAspectRatio(),ut=new tt.Rect(nt.x-ot/2,nt.y-lt/2,ot,lt),ct=this._pixelFromPoint(this.zoomPoint,ut),dt=ct.minus(it),ft=dt.divide(this._containerInnerSize.x*st),rt.plus(ft)):rt},getZoom:function(et){return et?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(et){return Math.max(Math.min(et,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(et){var nt=new tt.Rect(et.x,et.y,et.width,et.height);if(!this.wrapHorizontal){var rt=this.visibilityRatio*nt.width,it=nt.x+nt.width,st=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,ot=this._contentBoundsNoRotate.x-it+rt,lt=st-nt.x-rt;rt>this._contentBoundsNoRotate.width?nt.x+=(ot+lt)/2:lt<0?nt.x+=lt:ot>0&&(nt.x+=ot)}if(!this.wrapVertical){var ut=this.visibilityRatio*nt.height,ct=nt.y+nt.height,dt=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,ft=this._contentBoundsNoRotate.y-ct+ut,pt=dt-nt.y-ut;ut>this._contentBoundsNoRotate.height?nt.y+=(ft+pt)/2:pt<0?nt.y+=pt:ft>0&&(nt.y+=ft)}return nt},_raiseConstraintsEvent:function(et){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:et})},applyConstraints:function(et){var nt=this.getZoom(),rt=this._applyZoomConstraints(nt);nt!==rt&&this.zoomTo(rt,this.zoomPoint,et);var it=this.getBoundsNoRotate(),st=this._applyBoundaryConstraints(it);return this._raiseConstraintsEvent(et),(it.x!==st.x||it.y!==st.y||et)&&this.fitBounds(st.rotate(-this.getRotation()),et),this},ensureVisible:function(et){return this.applyConstraints(et)},_fitBounds:function(et,nt){nt=nt||{};var rt=nt.immediately||!1,it=nt.constraints||!1,st=this.getAspectRatio(),ot=et.getCenter(),lt=new tt.Rect(et.x,et.y,et.width,et.height,et.degrees+this.getRotation()).getBoundingBox();lt.getAspectRatio()>=st?lt.height=lt.width/st:lt.width=lt.height*st,lt.x=ot.x-lt.width/2,lt.y=ot.y-lt.height/2;var ut=1/lt.width;if(it){var ct=lt.getAspectRatio(),dt=this._applyZoomConstraints(ut);ut!==dt&&(ut=dt,lt.width=1/ut,lt.x=ot.x-lt.width/2,lt.height=lt.width/ct,lt.y=ot.y-lt.height/2),lt=this._applyBoundaryConstraints(lt),ot=lt.getCenter(),this._raiseConstraintsEvent(rt)}if(rt)return this.panTo(ot,!0),this.zoomTo(ut,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var ft=this.getBounds(),pt=this.getZoom();if(pt===0||Math.abs(ut/pt-1)<1e-8)return this.zoomTo(ut,!0),this.panTo(ot,rt);lt=lt.rotate(-this.getRotation());var gt=lt.getTopLeft().times(ut).minus(ft.getTopLeft().times(pt)).divide(ut-pt);return this.zoomTo(ut,gt,rt)},fitBounds:function(et,nt){return this._fitBounds(et,{immediately:nt,constraints:!1})},fitBoundsWithConstraints:function(et,nt){return this._fitBounds(et,{immediately:nt,constraints:!0})},fitVertically:function(et){var nt=new tt.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(nt,et)},fitHorizontally:function(et){var nt=new tt.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(nt,et)},getConstrainedBounds:function(et){var nt,rt;return nt=this.getBounds(et),rt=this._applyBoundaryConstraints(nt),rt},panBy:function(et,nt){var rt=new tt.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(rt.plus(et),nt)},panTo:function(et,nt){return nt?(this.centerSpringX.resetTo(et.x),this.centerSpringY.resetTo(et.y)):(this.centerSpringX.springTo(et.x),this.centerSpringY.springTo(et.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:et,immediately:nt}),this},zoomBy:function(et,nt,rt){return this.zoomTo(this.zoomSpring.target.value*et,nt,rt)},zoomTo:function(et,nt,rt){var it=this;return this.zoomPoint=nt instanceof tt.Point&&!isNaN(nt.x)&&!isNaN(nt.y)?nt:null,rt?this._adjustCenterSpringsForZoomPoint(function(){it.zoomSpring.resetTo(et)}):this.zoomSpring.springTo(et),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:et,refPoint:nt,immediately:rt}),this},setRotation:function(et){return!this.viewer||!this.viewer.drawer.canRotate()?this:(this.degrees=tt.positiveModulo(et,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:et}),this)},getRotation:function(){return this.degrees},resize:function(et,nt){var rt=this.getBoundsNoRotate(),it=rt,st;return this.containerSize.x=et.x,this.containerSize.y=et.y,this._updateContainerInnerSize(),nt&&(st=et.x/this.containerSize.x,it.width=rt.width*st,it.height=it.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:et,maintain:nt}),this.fitBounds(it,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new tt.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var et=this;this._adjustCenterSpringsForZoomPoint(function(){et.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var nt=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,nt},_adjustCenterSpringsForZoomPoint:function(et){if(this.zoomPoint){var nt=this.pixelFromPoint(this.zoomPoint,!0);et();var rt=this.pixelFromPoint(this.zoomPoint,!0),it=rt.minus(nt),st=this.deltaPointsFromPixels(it,!0);this.centerSpringX.shiftBy(st.x),this.centerSpringY.shiftBy(st.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else et()},deltaPixelsFromPointsNoRotate:function(et,nt){return et.times(this._containerInnerSize.x*this.getZoom(nt))},deltaPixelsFromPoints:function(et,nt){return this.deltaPixelsFromPointsNoRotate(et.rotate(this.getRotation()),nt)},deltaPointsFromPixelsNoRotate:function(et,nt){return et.divide(this._containerInnerSize.x*this.getZoom(nt))},deltaPointsFromPixels:function(et,nt){return this.deltaPointsFromPixelsNoRotate(et,nt).rotate(-this.getRotation())},pixelFromPointNoRotate:function(et,nt){return this._pixelFromPointNoRotate(et,this.getBoundsNoRotate(nt))},pixelFromPoint:function(et,nt){return this._pixelFromPoint(et,this.getBoundsNoRotate(nt))},_pixelFromPointNoRotate:function(et,nt){return et.minus(nt.getTopLeft()).times(this._containerInnerSize.x/nt.width).plus(new tt.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(et,nt){return this._pixelFromPointNoRotate(et.rotate(this.getRotation(),this.getCenter(!0)),nt)},pointFromPixelNoRotate:function(et,nt){var rt=this.getBoundsNoRotate(nt);return et.minus(new tt.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/rt.width).plus(rt.getTopLeft())},pointFromPixel:function(et,nt){return this.pointFromPixelNoRotate(et,nt).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(et,nt){var rt=this._contentBoundsNoRotate.width;return new tt.Point(et*this._contentSizeNoRotate.x/rt,nt*this._contentSizeNoRotate.x/rt)},viewportToImageCoordinates:function(et,nt){if(et instanceof tt.Point)return this.viewportToImageCoordinates(et.x,et.y);if(this.viewer){var rt=this.viewer.world.getItemCount();if(rt>1)tt.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(rt===1){var it=this.viewer.world.getItemAt(0);return it.viewportToImageCoordinates(et,nt,!0)}}return this._viewportToImageDelta(et-this._contentBoundsNoRotate.x,nt-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(et,nt){var rt=this._contentBoundsNoRotate.width;return new tt.Point(et/this._contentSizeNoRotate.x*rt,nt/this._contentSizeNoRotate.x*rt)},imageToViewportCoordinates:function(et,nt){if(et instanceof tt.Point)return this.imageToViewportCoordinates(et.x,et.y);if(this.viewer){var rt=this.viewer.world.getItemCount();if(rt>1)tt.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(rt===1){var it=this.viewer.world.getItemAt(0);return it.imageToViewportCoordinates(et,nt,!0)}}var st=this._imageToViewportDelta(et,nt);return st.x+=this._contentBoundsNoRotate.x,st.y+=this._contentBoundsNoRotate.y,st},imageToViewportRectangle:function(et,nt,rt,it){var st=et;if(st instanceof tt.Rect||(st=new tt.Rect(et,nt,rt,it)),this.viewer){var ot=this.viewer.world.getItemCount();if(ot>1)tt.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(ot===1){var lt=this.viewer.world.getItemAt(0);return lt.imageToViewportRectangle(et,nt,rt,it,!0)}}var ut=this.imageToViewportCoordinates(st.x,st.y),ct=this._imageToViewportDelta(st.width,st.height);return new tt.Rect(ut.x,ut.y,ct.x,ct.y,st.degrees)},viewportToImageRectangle:function(et,nt,rt,it){var st=et;if(st instanceof tt.Rect||(st=new tt.Rect(et,nt,rt,it)),this.viewer){var ot=this.viewer.world.getItemCount();if(ot>1)tt.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(ot===1){var lt=this.viewer.world.getItemAt(0);return lt.viewportToImageRectangle(et,nt,rt,it,!0)}}var ut=this.viewportToImageCoordinates(st.x,st.y),ct=this._viewportToImageDelta(st.width,st.height);return new tt.Rect(ut.x,ut.y,ct.x,ct.y,st.degrees)},viewerElementToImageCoordinates:function(et){var nt=this.pointFromPixel(et,!0);return this.viewportToImageCoordinates(nt)},imageToViewerElementCoordinates:function(et){var nt=this.imageToViewportCoordinates(et);return this.pixelFromPoint(nt,!0)},windowToImageCoordinates:function(et){tt.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var nt=et.minus(tt.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(nt)},imageToWindowCoordinates:function(et){tt.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var nt=this.imageToViewerElementCoordinates(et);return nt.plus(tt.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(et){return this.pointFromPixel(et,!0)},viewportToViewerElementCoordinates:function(et){return this.pixelFromPoint(et,!0)},viewerElementToViewportRectangle:function(et){return tt.Rect.fromSummits(this.pointFromPixel(et.getTopLeft(),!0),this.pointFromPixel(et.getTopRight(),!0),this.pointFromPixel(et.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(et){return tt.Rect.fromSummits(this.pixelFromPoint(et.getTopLeft(),!0),this.pixelFromPoint(et.getTopRight(),!0),this.pixelFromPoint(et.getBottomLeft(),!0))},windowToViewportCoordinates:function(et){tt.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var nt=et.minus(tt.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(nt)},viewportToWindowCoordinates:function(et){tt.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var nt=this.viewportToViewerElementCoordinates(et);return nt.plus(tt.getElementPosition(this.viewer.element))},viewportToImageZoom:function(et){if(this.viewer){var nt=this.viewer.world.getItemCount();if(nt>1)tt.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(nt===1){var rt=this.viewer.world.getItemAt(0);return rt.viewportToImageZoom(et)}}var it=this._contentSizeNoRotate.x,st=this._containerInnerSize.x,ot=this._contentBoundsNoRotate.width,lt=st/it*ot;return et*lt},imageToViewportZoom:function(et){if(this.viewer){var nt=this.viewer.world.getItemCount();if(nt>1)tt.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(nt===1){var rt=this.viewer.world.getItemAt(0);return rt.imageToViewportZoom(et)}}var it=this._contentSizeNoRotate.x,st=this._containerInnerSize.x,ot=this._contentBoundsNoRotate.width,lt=it/st/ot;return et*lt},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(et){return this.flipped===et?this:(this.flipped=et,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:et}),this)}}}(OpenSeadragon),function(tt){tt.TiledImage=function(mt){var Kr=this;tt.console.assert(mt.tileCache,"[TiledImage] options.tileCache is required"),tt.console.assert(mt.drawer,"[TiledImage] options.drawer is required"),tt.console.assert(mt.viewer,"[TiledImage] options.viewer is required"),tt.console.assert(mt.imageLoader,"[TiledImage] options.imageLoader is required"),tt.console.assert(mt.source,"[TiledImage] options.source is required"),tt.console.assert(!mt.clip||mt.clip instanceof tt.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),tt.EventSource.call(this),this._tileCache=mt.tileCache,delete mt.tileCache,this._drawer=mt.drawer,delete mt.drawer,this._imageLoader=mt.imageLoader,delete mt.imageLoader,mt.clip instanceof tt.Rect&&(this._clip=mt.clip.clone()),delete mt.clip;var Xr=mt.x||0;delete mt.x;var Zr=mt.y||0;delete mt.y,this.normHeight=mt.source.dimensions.y/mt.source.dimensions.x,this.contentAspectX=mt.source.dimensions.x/mt.source.dimensions.y;var Qr=1;mt.width?(Qr=mt.width,delete mt.width,mt.height&&(tt.console.error("specifying both width and height to a tiledImage is not supported"),delete mt.height)):mt.height&&(Qr=mt.height/this.normHeight,delete mt.height);var _i=mt.fitBounds;delete mt.fitBounds;var rs=mt.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete mt.fitBoundsPlacement;var ns=mt.degrees||0;delete mt.degrees,tt.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:tt.DEFAULT_SETTINGS.springStiffness,animationTime:tt.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:tt.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:tt.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:tt.DEFAULT_SETTINGS.wrapVertical,immediateRender:tt.DEFAULT_SETTINGS.immediateRender,blendTime:tt.DEFAULT_SETTINGS.blendTime,alwaysBlend:tt.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:tt.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:tt.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:tt.DEFAULT_SETTINGS.iOSDevice,debugMode:tt.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:tt.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:tt.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:tt.DEFAULT_SETTINGS.placeholderFillStyle,opacity:tt.DEFAULT_SETTINGS.opacity,preload:tt.DEFAULT_SETTINGS.preload,compositeOperation:tt.DEFAULT_SETTINGS.compositeOperation},mt),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new tt.Spring({initial:Xr,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new tt.Spring({initial:Zr,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new tt.Spring({initial:Qr,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new tt.Spring({initial:ns,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),_i&&this.fitBounds(_i,rs,!0),this._drawingHandler=function(ss){Kr.viewer.raiseEvent("tile-drawing",tt.extend({tiledImage:Kr},ss))}},tt.extend(tt.TiledImage.prototype,tt.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(mt){mt!==this._fullyLoaded&&(this._fullyLoaded=mt,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=tt.now(),this._needsDraw=!0},update:function(){var mt=this._xSpring.update(),Kr=this._ySpring.update(),Xr=this._scaleSpring.update(),Zr=this._degreesSpring.update();return mt||Kr||Xr||Zr?(this._updateForScale(),this._needsDraw=!0,!0):!1},draw:function(){this.opacity!==0||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(mt){return this.getBoundsNoRotate(mt).rotate(this.getRotation(mt),this._getRotationPoint(mt))},getBoundsNoRotate:function(mt){return mt?new tt.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new tt.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return tt.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(mt){var Kr=this.getBoundsNoRotate(mt);if(this._clip){var Xr=mt?this._worldWidthCurrent:this._worldWidthTarget,Zr=Xr/this.source.dimensions.x,Qr=this._clip.times(Zr);Kr=new tt.Rect(Kr.x+Qr.x,Kr.y+Qr.y,Qr.width,Qr.height)}return Kr.rotate(this.getRotation(mt),this._getRotationPoint(mt))},getContentSize:function(){return new tt.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(mt,Kr,Xr){var Zr=Xr?this._scaleSpring.current.value:this._scaleSpring.target.value;return new tt.Point(mt*(this.source.dimensions.x/Zr),Kr*(this.source.dimensions.y*this.contentAspectX/Zr))},viewportToImageCoordinates:function(mt,Kr,Xr){var Zr;return mt instanceof tt.Point?(Xr=Kr,Zr=mt):Zr=new tt.Point(mt,Kr),Zr=Zr.rotate(-this.getRotation(Xr),this._getRotationPoint(Xr)),Xr?this._viewportToImageDelta(Zr.x-this._xSpring.current.value,Zr.y-this._ySpring.current.value):this._viewportToImageDelta(Zr.x-this._xSpring.target.value,Zr.y-this._ySpring.target.value)},_imageToViewportDelta:function(mt,Kr,Xr){var Zr=Xr?this._scaleSpring.current.value:this._scaleSpring.target.value;return new tt.Point(mt/this.source.dimensions.x*Zr,Kr/this.source.dimensions.y/this.contentAspectX*Zr)},imageToViewportCoordinates:function(mt,Kr,Xr){mt instanceof tt.Point&&(Xr=Kr,Kr=mt.y,mt=mt.x);var Zr=this._imageToViewportDelta(mt,Kr);return Xr?(Zr.x+=this._xSpring.current.value,Zr.y+=this._ySpring.current.value):(Zr.x+=this._xSpring.target.value,Zr.y+=this._ySpring.target.value),Zr.rotate(this.getRotation(Xr),this._getRotationPoint(Xr))},imageToViewportRectangle:function(mt,Kr,Xr,Zr,Qr){var _i=mt;_i instanceof tt.Rect?Qr=Kr:_i=new tt.Rect(mt,Kr,Xr,Zr);var rs=this.imageToViewportCoordinates(_i.getTopLeft(),Qr),ns=this._imageToViewportDelta(_i.width,_i.height,Qr);return new tt.Rect(rs.x,rs.y,ns.x,ns.y,_i.degrees+this.getRotation(Qr))},viewportToImageRectangle:function(mt,Kr,Xr,Zr,Qr){var _i=mt;mt instanceof tt.Rect?Qr=Kr:_i=new tt.Rect(mt,Kr,Xr,Zr);var rs=this.viewportToImageCoordinates(_i.getTopLeft(),Qr),ns=this._viewportToImageDelta(_i.width,_i.height,Qr);return new tt.Rect(rs.x,rs.y,ns.x,ns.y,_i.degrees-this.getRotation(Qr))},viewerElementToImageCoordinates:function(mt){var Kr=this.viewport.pointFromPixel(mt,!0);return this.viewportToImageCoordinates(Kr)},imageToViewerElementCoordinates:function(mt){var Kr=this.imageToViewportCoordinates(mt);return this.viewport.pixelFromPoint(Kr,!0)},windowToImageCoordinates:function(mt){var Kr=mt.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(Kr)},imageToWindowCoordinates:function(mt){var Kr=this.imageToViewerElementCoordinates(mt);return Kr.plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(mt){var Kr=this._scaleSpring.current.value;return mt=mt.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new tt.Rect((mt.x-this._xSpring.current.value)/Kr,(mt.y-this._ySpring.current.value)/Kr,mt.width/Kr,mt.height/Kr,mt.degrees)},viewportToImageZoom:function(mt){var Kr=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return Kr*mt},imageToViewportZoom:function(mt){var Kr=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return mt/Kr},setPosition:function(mt,Kr){var Xr=this._xSpring.target.value===mt.x&&this._ySpring.target.value===mt.y;if(Kr){if(Xr&&this._xSpring.current.value===mt.x&&this._ySpring.current.value===mt.y)return;this._xSpring.resetTo(mt.x),this._ySpring.resetTo(mt.y),this._needsDraw=!0}else{if(Xr)return;this._xSpring.springTo(mt.x),this._ySpring.springTo(mt.y),this._needsDraw=!0}Xr||this._raiseBoundsChange()},setWidth:function(mt,Kr){this._setScale(mt,Kr)},setHeight:function(mt,Kr){this._setScale(mt/this.normHeight,Kr)},setCroppingPolygons:function(mt){var Kr=function(Zr){return Zr instanceof tt.Point||typeof Zr.x=="number"&&typeof Zr.y=="number"},Xr=function(Zr){return Zr.map(function(Qr){try{if(Kr(Qr))return{x:Qr.x,y:Qr.y};throw new Error}catch{throw new Error("A Provided cropping polygon point is not supported")}})};try{if(!tt.isArray(mt))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=mt.map(function(Zr){return Xr(Zr)})}catch(Zr){tt.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),tt.console.error(Zr),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(mt,Kr,Xr){Kr=Kr||tt.Placement.CENTER;var Zr=tt.Placement.properties[Kr],Qr=this.contentAspectX,_i=0,rs=0,ns=1,ss=1;if(this._clip&&(Qr=this._clip.getAspectRatio(),ns=this._clip.width/this.source.dimensions.x,ss=this._clip.height/this.source.dimensions.y,mt.getAspectRatio()>Qr?(_i=this._clip.x/this._clip.height*mt.height,rs=this._clip.y/this._clip.height*mt.height):(_i=this._clip.x/this._clip.width*mt.width,rs=this._clip.y/this._clip.width*mt.width)),mt.getAspectRatio()>Qr){var fs=mt.height/ss,os=0;Zr.isHorizontallyCentered?os=(mt.width-mt.height*Qr)/2:Zr.isRight&&(os=mt.width-mt.height*Qr),this.setPosition(new tt.Point(mt.x-_i+os,mt.y-rs),Xr),this.setHeight(fs,Xr)}else{var is=mt.width/ns,cs=0;Zr.isVerticallyCentered?cs=(mt.height-mt.width/Qr)/2:Zr.isBottom&&(cs=mt.height-mt.width/Qr),this.setPosition(new tt.Point(mt.x-_i,mt.y-rs+cs),Xr),this.setWidth(is,Xr)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(mt){tt.console.assert(!mt||mt instanceof tt.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),mt instanceof tt.Rect?this._clip=mt.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(mt){mt!==this.opacity&&(this.opacity=mt,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(mt){this._preload=!!mt,this._needsDraw=!0},getRotation:function(mt){return mt?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(mt,Kr){this._degreesSpring.target.value===mt&&this._degreesSpring.isAtTargetValue()||(Kr?this._degreesSpring.resetTo(mt):this._degreesSpring.springTo(mt),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(mt){return this.getBoundsNoRotate(mt).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(mt){mt!==this.compositeOperation&&(this.compositeOperation=mt,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(mt,Kr){var Xr=this._scaleSpring.target.value===mt;if(Kr){if(Xr&&this._scaleSpring.current.value===mt)return;this._scaleSpring.resetTo(mt),this._updateForScale(),this._needsDraw=!0}else{if(Xr)return;this._scaleSpring.springTo(mt),this._updateForScale(),this._needsDraw=!0}Xr||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var mt=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),Kr=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,Xr=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(Kr/this.minPixelRatio)/Math.log(2))));return Xr=Math.max(Xr,this.source.minLevel||0),mt=Math.min(mt,Xr),{lowestLevel:mt,highestLevel:Xr}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){var mt=this.lastDrawn.pop();mt.beingDrawn=!1}var Kr=this.viewport,Xr=this._viewportToTiledImageRectangle(Kr.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var Zr=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(Xr=Xr.intersection(Zr),Xr===null)return}for(var Qr=this._getLevelsInterval(),_i=Qr.lowestLevel,rs=Qr.highestLevel,ns=null,ss=!1,fs=tt.now(),os=rs;os>=_i;os--){var is=!1,cs=Kr.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(os),!0).x*this._scaleSpring.current.value;if(os===_i||!ss&&cs>=this.minPixelRatio)is=!0,ss=!0;else if(!ss)continue;var ps=Kr.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(os),!1).x*this._scaleSpring.current.value,vs=Kr.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,ls=this.immediateRender?1:vs,gs=Math.min(1,(cs-.5)/.5),us=ls/Math.abs(ls-ps);if(ns=et(this,ss,is,os,gs,us,Xr,fs,ns),ct(this.coverage,os))break}_r(this,this.lastDrawn),ns&&!ns.context2D?(it(this,ns,fs),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(this._tilesLoading===0)},_getCornerTiles:function(mt,Kr,Xr){var Zr,Qr;this.wrapHorizontal?(Zr=tt.positiveModulo(Kr.x,1),Qr=tt.positiveModulo(Xr.x,1)):(Zr=Math.max(0,Kr.x),Qr=Math.min(1,Xr.x));var _i,rs,ns=1/this.source.aspectRatio;this.wrapVertical?(_i=tt.positiveModulo(Kr.y,ns),rs=tt.positiveModulo(Xr.y,ns)):(_i=Math.max(0,Kr.y),rs=Math.min(ns,Xr.y));var ss=this.source.getTileAtPoint(mt,new tt.Point(Zr,_i)),fs=this.source.getTileAtPoint(mt,new tt.Point(Qr,rs)),os=this.source.getNumTiles(mt);return this.wrapHorizontal&&(ss.x+=os.x*Math.floor(Kr.x),fs.x+=os.x*Math.floor(Xr.x)),this.wrapVertical&&(ss.y+=os.y*Math.floor(Kr.y/ns),fs.y+=os.y*Math.floor(Xr.y/ns)),{topLeft:ss,bottomRight:fs}}});function et(mt,Kr,Xr,Zr,Qr,_i,rs,ns,ss){var fs=rs.getBoundingBox().getTopLeft(),os=rs.getBoundingBox().getBottomRight();mt.viewer&&mt.viewer.raiseEvent("update-level",{tiledImage:mt,havedrawn:Kr,level:Zr,opacity:Qr,visibility:_i,drawArea:rs,topleft:fs,bottomright:os,currenttime:ns,best:ss}),pt(mt.coverage,Zr),pt(mt.loadingCoverage,Zr);for(var is=mt._getCornerTiles(Zr,fs,os),cs=is.topLeft,ps=is.bottomRight,vs=mt.source.getNumTiles(Zr),ls=mt.viewport.pixelFromPoint(mt.viewport.getCenter()),gs=cs.x;gs<=ps.x;gs++)for(var us=cs.y;us<=ps.y;us++){if(!mt.wrapHorizontal&&!mt.wrapVertical){var ms=mt.source.getTileBounds(Zr,gs,us);if(rs.intersection(ms)===null)continue}ss=nt(mt,Xr,Kr,gs,us,Zr,Qr,_i,ls,vs,ns,ss)}return ss}function nt(mt,Kr,Xr,Zr,Qr,_i,rs,ns,ss,fs,os,is){var cs=rt(Zr,Qr,_i,mt,mt.source,mt.tilesMatrix,os,fs,mt._worldWidthCurrent,mt._worldHeightCurrent),ps=Xr;mt.viewer&&mt.viewer.raiseEvent("update-tile",{tiledImage:mt,tile:cs}),ft(mt.coverage,_i,Zr,Qr,!1);var vs=cs.loaded||cs.loading||dt(mt.loadingCoverage,_i,Zr,Qr);if(ft(mt.loadingCoverage,_i,Zr,Qr,vs),!cs.exists||(Kr&&!ps&&(dt(mt.coverage,_i,Zr,Qr)?ft(mt.coverage,_i,Zr,Qr,!0):ps=!0),!ps))return is;if(lt(cs,mt.source.tileOverlap,mt.viewport,ss,ns,mt),!cs.loaded)if(cs.context2D)ot(mt,cs);else{var ls=mt._tileCache.getImageRecord(cs.cacheKey);if(ls){var gs=ls.getImage();ot(mt,cs,gs)}}if(cs.loaded){var us=ut(mt,cs,Zr,Qr,_i,rs,os);us&&(mt._needsDraw=!0)}else cs.loading?mt._tilesLoading++:vs||(is=gt(is,cs));return is}function rt(mt,Kr,Xr,Zr,Qr,_i,rs,ns,ss,fs){var os,is,cs,ps,vs,ls,gs,us,ms;return _i[Xr]||(_i[Xr]={}),_i[Xr][mt]||(_i[Xr][mt]={}),_i[Xr][mt][Kr]||(os=(ns.x+mt%ns.x)%ns.x,is=(ns.y+Kr%ns.y)%ns.y,cs=Qr.getTileBounds(Xr,os,is),ps=Qr.getTileBounds(Xr,os,is,!0),vs=Qr.tileExists(Xr,os,is),ls=Qr.getTileUrl(Xr,os,is),Zr.loadTilesWithAjax?(gs=Qr.getTileAjaxHeaders(Xr,os,is),tt.isPlainObject(Zr.ajaxHeaders)&&(gs=tt.extend({},Zr.ajaxHeaders,gs))):gs=null,us=Qr.getContext2D?Qr.getContext2D(Xr,os,is):void 0,cs.x+=(mt-os)/ns.x,cs.y+=fs/ss*((Kr-is)/ns.y),ms=new tt.Tile(Xr,mt,Kr,cs,vs,ls,us,Zr.loadTilesWithAjax,gs,ps),os===ns.x-1&&(ms.isRightMost=!0),is===ns.y-1&&(ms.isBottomMost=!0),_i[Xr][mt][Kr]=ms),ms=_i[Xr][mt][Kr],ms.lastTouchTime=rs,ms}function it(mt,Kr,Xr){Kr.loading=!0,mt._imageLoader.addJob({src:Kr.url,loadWithAjax:Kr.loadWithAjax,ajaxHeaders:Kr.ajaxHeaders,crossOriginPolicy:mt.crossOriginPolicy,ajaxWithCredentials:mt.ajaxWithCredentials,callback:function(Zr,Qr,_i){st(mt,Kr,Xr,Zr,Qr,_i)},abort:function(){Kr.loading=!1}})}function st(mt,Kr,Xr,Zr,Qr,_i){if(!Zr){tt.console.log("Tile %s failed to load: %s - error: %s",Kr,Kr.url,Qr),mt.viewer.raiseEvent("tile-load-failed",{tile:Kr,tiledImage:mt,time:Xr,message:Qr,tileRequest:_i}),Kr.loading=!1,Kr.exists=!1;return}if(Xr<mt.lastResetTime){tt.console.log("Ignoring tile %s loaded before reset: %s",Kr,Kr.url),Kr.loading=!1;return}var rs=function(){var ns=mt.source.getClosestLevel();ot(mt,Kr,Zr,ns,_i)};mt._midDraw?window.setTimeout(rs,1):rs()}function ot(mt,Kr,Xr,Zr,Qr){var _i=0;function rs(){return _i++,ns}function ns(){_i--,_i===0&&(Kr.loading=!1,Kr.loaded=!0,Kr.context2D||mt._tileCache.cacheTile({image:Xr,tile:Kr,cutoff:Zr,tiledImage:mt}),mt._needsDraw=!0)}mt.viewer.raiseEvent("tile-loaded",{tile:Kr,tiledImage:mt,tileRequest:Qr,image:Xr,getCompletionCallback:rs}),rs()()}function lt(mt,Kr,Xr,Zr,Qr,_i){var rs=mt.bounds.getTopLeft();rs.x*=_i._scaleSpring.current.value,rs.y*=_i._scaleSpring.current.value,rs.x+=_i._xSpring.current.value,rs.y+=_i._ySpring.current.value;var ns=mt.bounds.getSize();ns.x*=_i._scaleSpring.current.value,ns.y*=_i._scaleSpring.current.value;var ss=Xr.pixelFromPointNoRotate(rs,!0),fs=Xr.pixelFromPointNoRotate(rs,!1),os=Xr.deltaPixelsFromPointsNoRotate(ns,!0),is=Xr.deltaPixelsFromPointsNoRotate(ns,!1),cs=fs.plus(is.divide(2)),ps=Zr.squaredDistanceTo(cs);Kr||(os=os.plus(new tt.Point(1,1))),mt.isRightMost&&_i.wrapHorizontal&&(os.x+=.75),mt.isBottomMost&&_i.wrapVertical&&(os.y+=.75),mt.position=ss,mt.size=os,mt.squaredDistance=ps,mt.visibility=Qr}function ut(mt,Kr,Xr,Zr,Qr,_i,rs){var ns=1e3*mt.blendTime,ss,fs;if(Kr.blendStart||(Kr.blendStart=rs),ss=rs-Kr.blendStart,fs=ns?Math.min(1,ss/ns):1,mt.alwaysBlend&&(fs*=_i),Kr.opacity=fs,mt.lastDrawn.push(Kr),fs===1)ft(mt.coverage,Qr,Xr,Zr,!0),mt._hasOpaqueTile=!0;else if(ss<ns)return!0;return!1}function ct(mt,Kr,Xr,Zr){var Qr,_i,rs,ns;if(!mt[Kr])return!1;if(Xr===void 0||Zr===void 0){Qr=mt[Kr];for(rs in Qr)if(Object.prototype.hasOwnProperty.call(Qr,rs)){_i=Qr[rs];for(ns in _i)if(Object.prototype.hasOwnProperty.call(_i,ns)&&!_i[ns])return!1}return!0}return mt[Kr][Xr]===void 0||mt[Kr][Xr][Zr]===void 0||mt[Kr][Xr][Zr]===!0}function dt(mt,Kr,Xr,Zr){return Xr===void 0||Zr===void 0?ct(mt,Kr+1):ct(mt,Kr+1,2*Xr,2*Zr)&&ct(mt,Kr+1,2*Xr,2*Zr+1)&&ct(mt,Kr+1,2*Xr+1,2*Zr)&&ct(mt,Kr+1,2*Xr+1,2*Zr+1)}function ft(mt,Kr,Xr,Zr,Qr){if(!mt[Kr]){tt.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",Kr);return}mt[Kr][Xr]||(mt[Kr][Xr]={}),mt[Kr][Xr][Zr]=Qr}function pt(mt,Kr){mt[Kr]={}}function gt(mt,Kr){return!mt||Kr.visibility>mt.visibility||Kr.visibility==mt.visibility&&Kr.squaredDistance<mt.squaredDistance?Kr:mt}function _r(mt,Kr){if(!(mt.opacity===0||Kr.length===0&&!mt.placeholderFillStyle)){var Xr=Kr[0],Zr;Xr&&(Zr=mt.opacity<1||mt.compositeOperation&&mt.compositeOperation!=="source-over"||!mt._isBottomItem()&&Xr._hasTransparencyChannel());var Qr,_i,rs=mt.viewport.getZoom(!0),ns=mt.viewportToImageZoom(rs);Kr.length>1&&ns>mt.smoothTileEdgesMinZoom&&!mt.iOSDevice&&mt.getRotation(!0)%360===0&&tt.supportsCanvas&&(Zr=!0,Qr=Xr.getScaleForEdgeSmoothing(),_i=Xr.getTranslationForEdgeSmoothing(Qr,mt._drawer.getCanvasSize(!1),mt._drawer.getCanvasSize(!0)));var ss;Zr&&(Qr||(ss=mt.viewport.viewportToViewerElementRectangle(mt.getClippedBounds(!0)).getIntegerBoundingBox(),mt._drawer.viewer.viewport.getFlip()&&(mt.viewport.degrees!==0||mt.getRotation(!0)%360!==0)&&(ss.x=mt._drawer.viewer.container.clientWidth-(ss.x+ss.width)),ss=ss.times(tt.pixelDensityRatio)),mt._drawer._clear(!0,ss)),Qr||(mt.viewport.degrees!==0&&mt._drawer._offsetForRotation({degrees:mt.viewport.degrees,useSketch:Zr}),mt.getRotation(!0)%360!==0&&mt._drawer._offsetForRotation({degrees:mt.getRotation(!0),point:mt.viewport.pixelFromPointNoRotate(mt._getRotationPoint(!0),!0),useSketch:Zr}),mt.viewport.degrees===0&&mt.getRotation(!0)%360===0&&mt._drawer.viewer.viewport.getFlip()&&mt._drawer._flip());var fs=!1;if(mt._clip){mt._drawer.saveContext(Zr);var os=mt.imageToViewportRectangle(mt._clip,!0);os=os.rotate(-mt.getRotation(!0),mt._getRotationPoint(!0));var is=mt._drawer.viewportToDrawerRectangle(os);Qr&&(is=is.times(Qr)),_i&&(is=is.translate(_i)),mt._drawer.setClip(is,Zr),fs=!0}if(mt._croppingPolygons){mt._drawer.saveContext(Zr);try{var cs=mt._croppingPolygons.map(function(gs){return gs.map(function(us){var ms=mt.imageToViewportCoordinates(us.x,us.y,!0).rotate(-mt.getRotation(!0),mt._getRotationPoint(!0)),ys=mt._drawer.viewportCoordToDrawerCoord(ms);return Qr&&(ys=ys.times(Qr)),ys})});mt._drawer.clipWithPolygons(cs,Zr)}catch(gs){tt.console.error(gs)}fs=!0}if(mt.placeholderFillStyle&&mt._hasOpaqueTile===!1){var ps=mt._drawer.viewportToDrawerRectangle(mt.getBounds(!0));Qr&&(ps=ps.times(Qr)),_i&&(ps=ps.translate(_i));var vs=null;typeof mt.placeholderFillStyle=="function"?vs=mt.placeholderFillStyle(mt,mt._drawer.context):vs=mt.placeholderFillStyle,mt._drawer.drawRectangle(ps,vs,Zr)}for(var ls=Kr.length-1;ls>=0;ls--)Xr=Kr[ls],mt._drawer.drawTile(Xr,mt._drawingHandler,Zr,Qr,_i),Xr.beingDrawn=!0,mt.viewer&&mt.viewer.raiseEvent("tile-drawn",{tiledImage:mt,tile:Xr});fs&&mt._drawer.restoreContext(Zr),Qr||(mt.getRotation(!0)%360!==0&&mt._drawer._restoreRotationChanges(Zr),mt.viewport.degrees!==0&&mt._drawer._restoreRotationChanges(Zr)),Zr&&(Qr&&(mt.viewport.degrees!==0&&mt._drawer._offsetForRotation({degrees:mt.viewport.degrees,useSketch:!1}),mt.getRotation(!0)%360!==0&&mt._drawer._offsetForRotation({degrees:mt.getRotation(!0),point:mt.viewport.pixelFromPointNoRotate(mt._getRotationPoint(!0),!0),useSketch:!1})),mt._drawer.blendSketch({opacity:mt.opacity,scale:Qr,translate:_i,compositeOperation:mt.compositeOperation,bounds:ss}),Qr&&(mt.getRotation(!0)%360!==0&&mt._drawer._restoreRotationChanges(!1),mt.viewport.degrees!==0&&mt._drawer._restoreRotationChanges(!1))),Qr||mt.viewport.degrees===0&&mt.getRotation(!0)%360===0&&mt._drawer.viewer.viewport.getFlip()&&mt._drawer._flip(),Yr(mt,Kr)}}function Yr(mt,Kr){if(mt.debugMode)for(var Xr=Kr.length-1;Xr>=0;Xr--){var Zr=Kr[Xr];try{mt._drawer.drawDebugInfo(Zr,Kr.length,Xr,mt)}catch(Qr){tt.console.error(Qr)}}}}(OpenSeadragon),function(tt){var et=function(rt){tt.console.assert(rt,"[TileCache.cacheTile] options is required"),tt.console.assert(rt.tile,"[TileCache.cacheTile] options.tile is required"),tt.console.assert(rt.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=rt.tile,this.tiledImage=rt.tiledImage},nt=function(rt){tt.console.assert(rt,"[ImageRecord] options is required"),tt.console.assert(rt.image,"[ImageRecord] options.image is required"),this._image=rt.image,this._tiles=[]};nt.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var rt=document.createElement("canvas");rt.width=this._image.width,rt.height=this._image.height,this._renderedContext=rt.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(rt){tt.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=rt},addTile:function(rt){tt.console.assert(rt,"[ImageRecord.addTile] tile is required"),this._tiles.push(rt)},removeTile:function(rt){for(var it=0;it<this._tiles.length;it++)if(this._tiles[it]===rt){this._tiles.splice(it,1);return}tt.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",rt)},getTileCount:function(){return this._tiles.length}},tt.TileCache=function(rt){rt=rt||{},this._maxImageCacheCount=rt.maxImageCacheCount||tt.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},tt.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(rt){tt.console.assert(rt,"[TileCache.cacheTile] options is required"),tt.console.assert(rt.tile,"[TileCache.cacheTile] options.tile is required"),tt.console.assert(rt.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),tt.console.assert(rt.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var it=rt.cutoff||0,st=this._tilesLoaded.length,ot=this._imagesLoaded[rt.tile.cacheKey];if(ot||(tt.console.assert(rt.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),ot=this._imagesLoaded[rt.tile.cacheKey]=new nt({image:rt.image}),this._imagesLoadedCount++),ot.addTile(rt.tile),rt.tile.cacheImageRecord=ot,this._imagesLoadedCount>this._maxImageCacheCount){for(var lt=null,ut=-1,ct=null,dt,ft,pt,gt,_r,Yr,mt=this._tilesLoaded.length-1;mt>=0;mt--)if(Yr=this._tilesLoaded[mt],dt=Yr.tile,!(dt.level<=it||dt.beingDrawn)){if(!lt){lt=dt,ut=mt,ct=Yr;continue}gt=dt.lastTouchTime,ft=lt.lastTouchTime,_r=dt.level,pt=lt.level,(gt<ft||gt==ft&&_r>pt)&&(lt=dt,ut=mt,ct=Yr)}lt&&ut>=0&&(this._unloadTile(ct),st=ut)}this._tilesLoaded[st]=new et({tile:rt.tile,tiledImage:rt.tiledImage})},clearTilesFor:function(rt){tt.console.assert(rt,"[TileCache.clearTilesFor] tiledImage is required");for(var it,st=0;st<this._tilesLoaded.length;++st)it=this._tilesLoaded[st],it.tiledImage===rt&&(this._unloadTile(it),this._tilesLoaded.splice(st,1),st--)},getImageRecord:function(rt){return tt.console.assert(rt,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[rt]},_unloadTile:function(rt){tt.console.assert(rt,"[TileCache._unloadTile] tileRecord is required");var it=rt.tile,st=rt.tiledImage;it.unload(),it.cacheImageRecord=null;var ot=this._imagesLoaded[it.cacheKey];ot.removeTile(it),ot.getTileCount()||(ot.destroy(),delete this._imagesLoaded[it.cacheKey],this._imagesLoadedCount--),st.viewer.raiseEvent("tile-unloaded",{tile:it,tiledImage:st})}}}(OpenSeadragon),function(tt){tt.World=function(et){var nt=this;tt.console.assert(et.viewer,"[World] options.viewer is required"),tt.EventSource.call(this),this.viewer=et.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(rt){nt._autoRefigureSizes?nt._figureSizes():nt._needsSizesFigured=!0},this._figureSizes()},tt.extend(tt.World.prototype,tt.EventSource.prototype,{addItem:function(et,nt){if(tt.console.assert(et,"[World.addItem] item is required"),tt.console.assert(et instanceof tt.TiledImage,"[World.addItem] only TiledImages supported at this time"),nt=nt||{},nt.index!==void 0){var rt=Math.max(0,Math.min(this._items.length,nt.index));this._items.splice(rt,0,et)}else this._items.push(et);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,et.addHandler("bounds-change",this._delegatedFigureSizes),et.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:et})},getItemAt:function(et){return tt.console.assert(et!==void 0,"[World.getItemAt] index is required"),this._items[et]},getIndexOfItem:function(et){return tt.console.assert(et,"[World.getIndexOfItem] item is required"),tt.indexOf(this._items,et)},getItemCount:function(){return this._items.length},setItemIndex:function(et,nt){tt.console.assert(et,"[World.setItemIndex] item is required"),tt.console.assert(nt!==void 0,"[World.setItemIndex] index is required");var rt=this.getIndexOfItem(et);if(nt>=this._items.length)throw new Error("Index bigger than number of layers.");nt===rt||rt===-1||(this._items.splice(rt,1),this._items.splice(nt,0,et),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:et,previousIndex:rt,newIndex:nt}))},removeItem:function(et){tt.console.assert(et,"[World.removeItem] item is required");var nt=tt.indexOf(this._items,et);nt!==-1&&(et.removeHandler("bounds-change",this._delegatedFigureSizes),et.removeHandler("clip-change",this._delegatedFigureSizes),et.destroy(),this._items.splice(nt,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(et))},removeAll:function(){this.viewer._cancelPendingImages();var et,nt;for(nt=0;nt<this._items.length;nt++)et=this._items[nt],et.removeHandler("bounds-change",this._delegatedFigureSizes),et.removeHandler("clip-change",this._delegatedFigureSizes),et.destroy();var rt=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,nt=0;nt<rt.length;nt++)et=rt[nt],this._raiseRemoveItem(et)},resetItems:function(){for(var et=0;et<this._items.length;et++)this._items[et].reset()},update:function(){for(var et=!1,nt=0;nt<this._items.length;nt++)et=this._items[nt].update()||et;return et},draw:function(){for(var et=0;et<this._items.length;et++)this._items[et].draw();this._needsDraw=!1},needsDraw:function(){for(var et=0;et<this._items.length;et++)if(this._items[et].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(et){this._autoRefigureSizes=et,et&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(et){et=et||{};var nt=et.immediately||!1,rt=et.layout||tt.DEFAULT_SETTINGS.collectionLayout,it=et.rows||tt.DEFAULT_SETTINGS.collectionRows,st=et.columns||tt.DEFAULT_SETTINGS.collectionColumns,ot=et.tileSize||tt.DEFAULT_SETTINGS.collectionTileSize,lt=et.tileMargin||tt.DEFAULT_SETTINGS.collectionTileMargin,ut=ot+lt,ct;!et.rows&&st?ct=st:ct=Math.ceil(this._items.length/it);var dt=0,ft=0,pt,gt,_r,Yr,mt;this.setAutoRefigureSizes(!1);for(var Kr=0;Kr<this._items.length;Kr++)Kr&&Kr%ct===0&&(rt==="horizontal"?(ft+=ut,dt=0):(dt+=ut,ft=0)),pt=this._items[Kr],gt=pt.getBounds(),gt.width>gt.height?_r=ot:_r=ot*(gt.width/gt.height),Yr=_r*(gt.height/gt.width),mt=new tt.Point(dt+(ot-_r)/2,ft+(ot-Yr)/2),pt.setPosition(mt,nt),pt.setWidth(_r,nt),rt==="horizontal"?dt+=ut:ft+=ut;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var et=this._homeBounds?this._homeBounds.clone():null,nt=this._contentSize?this._contentSize.clone():null,rt=this._contentFactor||0;if(!this._items.length)this._homeBounds=new tt.Rect(0,0,1,1),this._contentSize=new tt.Point(1,1),this._contentFactor=1;else{var it=this._items[0],st=it.getBounds();this._contentFactor=it.getContentSize().x/st.width;for(var ot=it.getClippedBounds().getBoundingBox(),lt=ot.x,ut=ot.y,ct=ot.x+ot.width,dt=ot.y+ot.height,ft=1;ft<this._items.length;ft++)it=this._items[ft],st=it.getBounds(),this._contentFactor=Math.max(this._contentFactor,it.getContentSize().x/st.width),ot=it.getClippedBounds().getBoundingBox(),lt=Math.min(lt,ot.x),ut=Math.min(ut,ot.y),ct=Math.max(ct,ot.x+ot.width),dt=Math.max(dt,ot.y+ot.height);this._homeBounds=new tt.Rect(lt,ut,ct-lt,dt-ut),this._contentSize=new tt.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}(this._contentFactor!==rt||!this._homeBounds.equals(et)||!this._contentSize.equals(nt))&&this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(et){this.raiseEvent("remove-item",{item:et})}})}(OpenSeadragon)})(openseadragon);var openseadragonExports=openseadragon.exports;const le=getDefaultExportFromCjs$1(openseadragonExports),$6be4966fd9bbc698$var$SWITCH_NAME="Switch",[$6be4966fd9bbc698$var$createSwitchContext,$6be4966fd9bbc698$export$cf7f5f17f69cbd43]=$c512c27ab02ef895$export$50c7b4e9d9f19c1($6be4966fd9bbc698$var$SWITCH_NAME),[$6be4966fd9bbc698$var$SwitchProvider,$6be4966fd9bbc698$var$useSwitchContext]=$6be4966fd9bbc698$var$createSwitchContext($6be4966fd9bbc698$var$SWITCH_NAME),$6be4966fd9bbc698$export$b5d5cf8927ab7262=N$3((tt,et)=>{const{__scopeSwitch:nt,name:rt,checked:it,defaultChecked:st,required:ot,disabled:lt,value:ut="on",onCheckedChange:ct,...dt}=tt,[ft,pt]=p$3(null),gt=$6ed0406888f73fc4$export$c7b2cbe3552a0d05(et,Xr=>pt(Xr)),_r=F$2(!1),Yr=ft?!!ft.closest("form"):!0,[mt=!1,Kr]=$71cd76cc60e0454e$export$6f32135080cb4c3({prop:it,defaultProp:st,onChange:ct});return y$3($6be4966fd9bbc698$var$SwitchProvider,{scope:nt,checked:mt,disabled:lt},y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.button,_extends$1({type:"button",role:"switch","aria-checked":mt,"aria-required":ot,"data-state":$6be4966fd9bbc698$var$getState(mt),"data-disabled":lt?"":void 0,disabled:lt,value:ut},dt,{ref:gt,onClick:$e42e1063c40fb3ef$export$b9ecd428b558ff10(tt.onClick,Xr=>{Kr(Zr=>!Zr),Yr&&(_r.current=Xr.isPropagationStopped(),_r.current||Xr.stopPropagation())})})),Yr&&y$3($6be4966fd9bbc698$var$BubbleInput,{control:ft,bubbles:!_r.current,name:rt,value:ut,checked:mt,required:ot,disabled:lt,style:{transform:"translateX(-100%)"}}))}),$6be4966fd9bbc698$var$THUMB_NAME="SwitchThumb",$6be4966fd9bbc698$export$4d07bf653ea69106=N$3((tt,et)=>{const{__scopeSwitch:nt,...rt}=tt,it=$6be4966fd9bbc698$var$useSwitchContext($6be4966fd9bbc698$var$THUMB_NAME,nt);return y$3($8927f6f2acc4f386$export$250ffa63cdc0d034.span,_extends$1({"data-state":$6be4966fd9bbc698$var$getState(it.checked),"data-disabled":it.disabled?"":void 0},rt,{ref:et}))}),$6be4966fd9bbc698$var$BubbleInput=tt=>{const{control:et,checked:nt,bubbles:rt=!0,...it}=tt,st=F$2(null),ot=$010c2913dbd2fe3d$export$5cae361ad82dce8b(nt),lt=$db6c3485150b8e66$export$1ab7ae714698c4b8(et);return _$1(()=>{const ut=st.current,ct=window.HTMLInputElement.prototype,ft=Object.getOwnPropertyDescriptor(ct,"checked").set;if(ot!==nt&&ft){const pt=new Event("click",{bubbles:rt});ft.call(ut,nt),ut.dispatchEvent(pt)}},[ot,nt,rt]),y$3("input",_extends$1({type:"checkbox","aria-hidden":!0,defaultChecked:nt},it,{tabIndex:-1,ref:st,style:{...tt.style,...lt,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function $6be4966fd9bbc698$var$getState(tt){return tt?"checked":"unchecked"}const $6be4966fd9bbc698$export$be92b6f5f03c0fe9=$6be4966fd9bbc698$export$b5d5cf8927ab7262,$6be4966fd9bbc698$export$6521433ed15a34db=$6be4966fd9bbc698$export$4d07bf653ea69106,ht=tt=>{const et=tt.toString().split(":"),nt=Math.ceil(parseInt(et[0])),rt=Math.ceil(parseInt(et[1])),it=xt(Math.ceil(parseInt(et[2])),2);let st=`${nt!==0&&rt<10?(rt+"").padStart(2,"0"):rt}:${it}`;return nt!==0&&(st=`${nt}:${st}`),st},Ee=tt=>{const et=new Date(tt*1e3).toISOString().substr(11,8);return ht(et)},we=(tt,et)=>{if(typeof tt!="object"||tt===null)return et;for(const nt in et)typeof et[nt]=="object"&&et[nt]!==null&&!Array.isArray(et[nt])?(tt[nt]||(tt[nt]={}),tt[nt]=we(tt[nt],et[nt])):tt[nt]=et[nt];return tt},Ce=(tt,et)=>Object.hasOwn(tt,et)?tt[et].toString():void 0,xt=(tt,et)=>String(tt).padStart(et,"0"),j={background:"transparent",canvasBackgroundColor:"#6662",canvasHeight:"61.8vh",ignoreCaptionLabels:[],informationPanel:{open:!0,renderAbout:!0,renderSupplementing:!0,renderToggle:!0},openSeadragon:{},requestHeaders:{"Content-Type":"application/json"},showIIIFBadge:!0,showTitle:!0,withCredentials:!1};var xe;const _={activeCanvas:"",activeManifest:"",collection:{},configOptions:j,customDisplays:[],informationOpen:(xe=j==null?void 0:j.informationPanel)==null?void 0:xe.open,isLoaded:!1,vault:new Vault},Se=wn$1.createContext(_),ke=wn$1.createContext(_);function vt(tt,et){switch(et.type){case"updateActiveCanvas":return et.canvasId||(et.canvasId=""),{...tt,activeCanvas:et.canvasId};case"updateActiveManifest":return{...tt,activeManifest:et.manifestId};case"updateCollection":return{...tt,collection:et.collection};case"updateConfigOptions":return{...tt,configOptions:we(tt.configOptions,et.configOptions)};case"updateInformationOpen":return{...tt,informationOpen:et.informationOpen};case"updateIsLoaded":return{...tt,isLoaded:et.isLoaded};default:throw new Error(`Unhandled action type: ${et.type}`)}}const bt=({initialState:tt=_,children:et})=>{const[nt,rt]=y$2(vt,tt);return wn$1.createElement(Se.Provider,{value:nt},wn$1.createElement(ke.Provider,{value:rt},et))};function k(){const tt=wn$1.useContext(Se);if(tt===void 0)throw new Error("useViewerState must be used within a ViewerProvider");return tt}function O(){const tt=wn$1.useContext(ke);if(tt===void 0)throw new Error("useViewerDispatch must be used within a ViewerProvider");return tt}const Ie=(tt,et,nt,rt)=>{var it,st;const ot={canvas:void 0,accompanyingCanvas:void 0,annotationPage:void 0,annotations:[]},lt=ut=>{if(ut){if(!ut.body||!ut.motivation){console.error("Invalid annotation after Hyperion parsing: missing either 'body' or 'motivation'",ut);return}let ct=ut.body;Array.isArray(ct)&&(ct=ct[0]);const dt=tt.get(ct.id);if(!dt)return;switch(nt){case"painting":return ut.target===et.id&&ut.motivation&&ut.motivation[0]==="painting"&&rt.includes(dt.type)&&(ut.body=dt),!!ut;case"supplementing":return;default:throw new Error("Invalid annotation motivation.")}}};if(ot.canvas=tt.get(et),ot.canvas&&(ot.annotationPage=tt.get(ot.canvas.items[0]),ot.accompanyingCanvas=(it=ot.canvas)!=null&&it.accompanyingCanvas?tt.get((st=ot.canvas)==null?void 0:st.accompanyingCanvas):void 0),ot.annotationPage){const ut=tt.get(ot.annotationPage.items).map(dt=>({body:tt.get(dt.body[0].id),motivation:dt.motivation,type:"Annotation"})),ct=[];ut.forEach(dt=>{dt.body.type==="Choice"?dt.body.items.forEach(ft=>ct.push({...dt,id:ft.id,body:tt.get(ft.id)})):ct.push(dt)}),ot.annotations=ct.filter(lt)}return ot},D=(tt,et="en")=>{if(!tt)return"";if(!tt[et]){const nt=Object.getOwnPropertyNames(tt);if(nt.length>0)return tt[nt[0]]}return tt[et]},N=(tt,et)=>{const nt=Ie(tt,{id:et,type:"Canvas"},"painting",["Image","Sound","Video"]);if(nt.annotations.length!==0&&nt.annotations&&nt.annotations)return nt.annotations.map(rt=>rt==null?void 0:rt.body)},yt=(tt,et,nt)=>{const rt=tt.get({id:et,type:"Canvas"});if(!(rt!=null&&rt.annotations)||!rt.annotations[0])return[];const it=tt.get(rt.annotations[0]),st=tt.get(it.items);return Array.isArray(st)?st.filter(ot=>{var lt;if(ot.body&&(lt=ot.motivation)!=null&&lt.includes("supplementing")){let ut=ot.body;Array.isArray(ut)&&(ut=ut[0]);const ct=tt.get(ut.id);if(ct.format===nt)return ot.body=ct,ot}}).map(ot=>ot.body):[]},Et=(tt,et,nt,rt)=>{const it=[];if(et.canvas&&et.canvas.thumbnail.length>0){const st=tt.get(et.canvas.thumbnail[0]);it.push(st)}if(et.annotations[0]){if(et.annotations[0].thumbnail&&et.annotations[0].thumbnail.length>0){const ot=tt.get(et.annotations[0].thumbnail[0]);it.push(ot)}if(!et.annotations[0].body)return;const st=et.annotations[0].body;st.type==="Image"&&it.push(st)}return it.length===0?void 0:{id:it[0].id,format:it[0].format,type:it[0].type,width:nt,height:rt}},X=209,wt={colors:{primary:"#1a1d1e",primaryMuted:"#26292b",primaryAlt:"#151718",accent:`hsl(${X} 100% 38.2%)`,accentMuted:`hsl(${X} 80% 61.8%)`,accentAlt:`hsl(${X} 80% 30%)`,secondary:"#FFFFFF",secondaryMuted:"#e6e8eb",secondaryAlt:"#c1c8cd"},fontSizes:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},lineHeights:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},sizes:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},space:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},radii:{1:"4px",2:"6px",3:"8px",4:"12px",round:"50%",pill:"9999px"},transitions:{all:"all 300ms cubic-bezier(0.16, 1, 0.3, 1)"},zIndices:{1:"100",2:"200",3:"300",4:"400",max:"999"}},te={xxs:"(max-width: 349px)",xs:"(max-width: 575px)",sm:"(max-width: 767px)",md:"(max-width: 991px)",lg:"(max-width: 90rem)",xl:"(min-width: calc(90rem + 1px))"},{styled:m,css:ro,keyframes:ne,createTheme:oo}=q({theme:wt,media:te}),Ct=m("div",{display:"flex",flexDirection:"column",alignItems:"center"}),St=m("p",{fontWeight:"bold",fontSize:"x-large"}),kt=m("span",{fontSize:"medium"}),It=({error:tt})=>{const{message:et}=tt;return wn$1.createElement(Ct,{role:"alert"},wn$1.createElement(St,{"data-testid":"headline"},"Something went wrong"),et&&wn$1.createElement(kt,null,`Error message: ${et}`," "))},$e=m("div",{position:"relative",zIndex:"0"}),Ae=m("div",{display:"flex",flexDirection:"row",overflow:"hidden","@sm":{flexDirection:"column"}}),Te=m("div",{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",width:"61.8%","@sm":{width:"100%"}}),Me=m($409067139f391064$export$41fb9f06171c75f4,{display:"none",border:"none",padding:"0",transition:"$all",opacity:"1",background:"#6663",margin:"1rem 0",borderRadius:"6px","&[data-information-panel='false']":{opacity:"0",marginTop:"-59px"},"@sm":{display:"flex","> span":{display:"flex",flexGrow:"1",fontSize:"0.8333em",justifyContent:"center",padding:"0.5rem",fontFamily:"inherit"}}}),Re=m($409067139f391064$export$7c6e2c02157bb7d2,{width:"100%",display:"flex"}),$t=m("aside",{display:"flex",flexGrow:"1",flexShrink:"0",width:"38.2%",maxHeight:"100%","@sm":{width:"100%"}}),At=m("div",{display:"flex",flexDirection:"column",fontSmooth:"auto",webkitFontSmoothing:"antialiased","> div":{display:"flex",flexDirection:"column",flexGrow:"1",justifyContent:"flex-start","@sm":{[`& ${Ae}`]:{flexGrow:"1"},[`& ${Te}`]:{flexGrow:"0"}}},"@sm":{padding:"0"},"&[data-information-panel-open='true']":{"@sm":{position:"fixed",height:"100%",width:"100%",top:"0",left:"0",zIndex:"2500000000",[`& ${$e}`]:{display:"none"},[`& ${Me}`]:{margin:"1rem"},[`& ${Re}`]:{height:"100%"}}}}),Tt=m($69cb30bb0017df05$export$be92b6f5f03c0fe9,{display:"flex",flexDirection:"column",width:"100%",height:"100%",flexGrow:"1",flexShrink:"0",position:"relative",zIndex:"1",maskImage:"linear-gradient(180deg, rgba(0, 0, 0, 1) calc(100% - 2rem), transparent 100%)","@sm":{marginTop:"0.5rem",boxShadow:"none"}}),Mt=m($69cb30bb0017df05$export$54c2e3dc7acea9f5,{display:"flex",flexGrow:"0",margin:"0 1.618rem",borderBottom:"4px solid #6663","@sm":{margin:"0 1rem"}}),se=m($69cb30bb0017df05$export$41fb9f06171c75f4,{display:"flex",position:"relative",padding:"0.5rem 1rem",background:"none",backgroundColor:"transparent",fontFamily:"inherit",border:"none",opacity:"0.7",fontSize:"1rem",marginRight:"1rem",lineHeight:"1rem",whiteSpace:"nowrap",cursor:"pointer",fontWeight:400,transition:"$all","&::after":{width:"0",height:"4px",content:"",position:"absolute",bottom:"-4px",left:"0",transition:"$all"},"&[data-state='active']":{opacity:"1",fontWeight:700,"&::after":{width:"100%",backgroundColor:"$accent"}}}),ce=m($69cb30bb0017df05$export$7c6e2c02157bb7d2,{display:"flex",flexGrow:"1",flexShrink:"0",position:"absolute",top:"0",left:"0","&[data-state='active']":{width:"100%",height:"calc(100% - 2rem)",padding:"1.618rem 0"}}),Rt=m("div",{position:"relative",height:"100%",width:"100%",overflowY:"scroll"}),zt=m("div",{padding:" 0 1.618rem 2rem",display:"flex",flexDirection:"column",overflow:"scroll",position:"absolute",fontWeight:"400",fontSize:"1rem",zIndex:"0",img:{maxWidth:"100px",maxHeight:"100px",objectFit:"contain",color:"transparent",margin:"0 0 1rem",borderRadius:"3px",backgroundColor:"$secondaryMuted"},video:{display:"none"},"a, a:visited":{color:"$accent"},p:{fontSize:"1rem",lineHeight:"1.45em",margin:"0"},dl:{margin:"0",dt:{fontWeight:"700",margin:"1rem 0 0.25rem"},dd:{margin:"0"}},".manifest-property-title":{fontWeight:"700",margin:"1rem 0 0.25rem"},"ul, ol":{padding:"0",margin:"0",li:{fontSize:"1rem",lineHeight:"1.45em",listStyle:"none",margin:"0.25rem 0 0.25rem"}}}),Lt=m("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),ze=(tt,et="none")=>{if(!tt)return null;if(typeof tt=="string")return[tt];if(!tt[et]){const nt=Object.getOwnPropertyNames(tt);if(nt.length>0)return tt[nt[0]]}return!tt[et]||!Array.isArray(tt[et])?null:tt[et]},R=(tt,et="none",nt=", ")=>{const rt=ze(tt,et);return Array.isArray(rt)?rt.join(`${nt}`):rt};function Ft(tt){return{__html:Pt(tt)}}function T(tt,et){const nt=Object.keys(tt).filter(it=>et.includes(it)?null:it),rt=new Object;return nt.forEach(it=>{rt[it]=tt[it]}),rt}function Pt(tt){return at(tt,{allowedAttributes:{a:["href"],img:["alt","src","height","width"]},allowedSchemes:["http","https","mailto"],allowedTags:["a","b","br","i","img","p","small","span","sub","sup"]})}const Vt=m("span",{}),L=tt=>{const{as:et,label:nt}=tt,rt=T(tt,["as","label"]);return wn$1.createElement(Vt,{as:et,...rt},R(nt,rt.lang))},Bt=(tt,et="200,",nt="full")=>{Array.isArray(tt)&&(tt=tt[0]);const{id:rt,service:it}=tt;let st;if(!it)return rt;if(Array.isArray(tt.service)&&tt.service.length>0&&(st=it[0]),st){if(st["@id"])return`${st["@id"]}/${nt}/${et}/0/default.jpg`;if(st.id)return`${st.id}/${nt}/${et}/0/default.jpg`}},de=m("img",{objectFit:"cover"}),Ht=tt=>{const et=F$2(null),{contentResource:nt,altAsLabel:rt,region:it="full"}=tt;let st;rt&&(st=R(rt));const ot=T(tt,["contentResource","altAsLabel"]),{type:lt,id:ut,width:ct=200,height:dt=200,duration:ft}=nt;_$1(()=>{if(!ut&&!et.current||["Image"].includes(lt)||!ut.includes("m3u8"))return;const _r=new Hls;return et.current&&(_r.attachMedia(et.current),_r.on(Hls.Events.MEDIA_ATTACHED,function(){_r.loadSource(ut)})),_r.on(Hls.Events.ERROR,function(Yr,mt){if(mt.fatal)switch(mt.type){case Hls.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${Yr} network error encountered, try to recover`),_r.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${Yr} media error encountered, try to recover`),_r.recoverMediaError();break;default:_r.destroy();break}}),()=>{_r&&(_r.detachMedia(),_r.destroy())}},[ut,lt]);const pt=x$3(()=>{if(!et.current)return;let _r=0,Yr=30;if(ft&&(Yr=ft),!ut.split("#t=")&&ft&&(_r=ft*.1),ut.split("#t=").pop()){const Kr=ut.split("#t=").pop();Kr&&(_r=parseInt(Kr.split(",")[0]))}const mt=et.current;mt.autoplay=!0,mt.currentTime=_r,setTimeout(()=>pt(),Yr*1e3)},[ft,ut]);_$1(()=>pt(),[pt]);const gt=Bt(nt,`${ct},${dt}`,it);switch(lt){case"Image":return wn$1.createElement(de,{as:"img",alt:st,css:{width:ct,height:dt},key:ut,src:gt,...ot});case"Video":return wn$1.createElement(de,{as:"video",css:{width:ct,height:dt},disablePictureInPicture:!0,key:ut,loop:!0,muted:!0,onPause:pt,ref:et,src:ut});default:return console.warn(`Resource type: ${lt} is not valid or not yet supported in Primitives.`),wn$1.createElement(wn$1.Fragment,null)}},Ot=m("a",{}),Dt=tt=>{const{children:et,homepage:nt}=tt,rt=T(tt,["children","homepage"]);return wn$1.createElement(wn$1.Fragment,null,nt&&nt.map(it=>{const st=R(it.label,rt.lang);return wn$1.createElement(Ot,{"aria-label":et?st:void 0,href:it.id,key:it.id,...rt},et||st)}))},Wt={delimiter:", "},re=G$3(void 0),Le=()=>{const tt=P$3(re);if(tt===void 0)throw new Error("usePrimitivesContext must be used with a PrimitivesProvider");return tt},oe=({children:tt,initialState:et=Wt})=>{const nt=jt(et,"delimiter");return wn$1.createElement(re.Provider,{value:{delimiter:nt}},tt)},jt=(tt,et)=>Object.hasOwn(tt,et)?tt[et].toString():void 0,Nt=m("span",{}),me=tt=>{const{as:et,markup:nt}=tt,{delimiter:rt}=Le();if(!nt)return wn$1.createElement(wn$1.Fragment,null);const it=T(tt,["as","markup"]),st=Ft(R(nt,it.lang,rt));return wn$1.createElement(Nt,{as:et,...it,dangerouslySetInnerHTML:st})},Fe=tt=>wn$1.useContext(re)?wn$1.createElement(me,{...tt}):wn$1.createElement(oe,null,wn$1.createElement(me,{...tt})),Gt=({as:tt="dd",lang:et,value:nt})=>wn$1.createElement(Fe,{markup:nt,as:tt,lang:et}),qt=m("span",{}),Ut=({as:tt="dd",customValueContent:et,lang:nt,value:rt})=>{var it;const{delimiter:st}=Le(),ot=(it=ze(rt,nt))==null?void 0:it.map(lt=>sn$1(et,{value:lt}));return wn$1.createElement(qt,{as:tt,lang:nt},ot==null?void 0:ot.map((lt,ut)=>[ut>0&&`${st}`,wn$1.createElement(g$3,{key:ut},lt)]))},Pe=tt=>{var et;const{item:nt,lang:rt,customValueContent:it}=tt,{label:st,value:ot}=nt,lt=(et=R(st))==null?void 0:et.replace(" ","-").toLowerCase();return wn$1.createElement("div",{role:"group","data-label":lt},wn$1.createElement(L,{as:"dt",label:st,lang:rt}),it?wn$1.createElement(Ut,{as:"dd",customValueContent:it,value:ot,lang:rt}):wn$1.createElement(Gt,{as:"dd",value:ot,lang:rt}))};function _t(tt,et){const nt=et.filter(rt=>{const{matchingLabel:it}=rt,st=Object.keys(rt.matchingLabel)[0],ot=R(it,st);if(R(tt,st)===ot)return!0}).map(rt=>rt.Content);if(Array.isArray(nt))return nt[0]}const Zt=m("dl",{}),Xt=tt=>{const{as:et,customValueContent:nt,metadata:rt}=tt;if(!Array.isArray(rt))return wn$1.createElement(wn$1.Fragment,null);const it=Ce(tt,"customValueDelimiter"),st=T(tt,["as","customValueContent","customValueDelimiter","metadata"]);return wn$1.createElement(oe,{...typeof it=="string"?{initialState:{delimiter:it}}:void 0},rt.length>0&&wn$1.createElement(Zt,{as:et,...st},rt.map((ot,lt)=>{const ut=nt?_t(ot.label,nt):void 0;return wn$1.createElement(Pe,{customValueContent:ut,item:ot,key:lt,lang:st==null?void 0:st.lang})})))};m("li",{}),m("ul",{});const Yt=m("dl",{}),Kt=tt=>{const{as:et,requiredStatement:nt}=tt;if(!nt)return wn$1.createElement(wn$1.Fragment,null);const rt=Ce(tt,"customValueDelimiter"),it=T(tt,["as","customValueDelimiter","requiredStatement"]);return wn$1.createElement(oe,{...typeof rt=="string"?{initialState:{delimiter:rt}}:void 0},wn$1.createElement(Yt,{as:et,...it},wn$1.createElement(Pe,{item:nt,lang:it.lang})))},Jt=m("li",{}),Qt=m("ul",{}),en=tt=>{const{as:et,seeAlso:nt}=tt,rt=T(tt,["as","seeAlso"]);return wn$1.createElement(Qt,{as:et},nt&&nt.map(it=>{const st=R(it.label,rt.lang);return wn$1.createElement(Jt,{key:it.id},wn$1.createElement("a",{href:it.id,...rt},st||it.id))}))},tn=tt=>{const{as:et,summary:nt}=tt,rt=T(tt,["as","customValueDelimiter","summary"]);return wn$1.createElement(Fe,{as:et,markup:nt,...rt})},Ve=tt=>{const{thumbnail:et,region:nt}=tt,rt=T(tt,["thumbnail"]);return wn$1.createElement(wn$1.Fragment,null,et&&et.map(it=>wn$1.createElement(Ht,{contentResource:it,key:it.id,region:nt,...rt})))},nn=({homepage:tt})=>(tt==null?void 0:tt.length)===0?wn$1.createElement(wn$1.Fragment,null):wn$1.createElement(wn$1.Fragment,null,wn$1.createElement("span",{className:"manifest-property-title"},"Homepage"),wn$1.createElement(Dt,{homepage:tt})),rn=({id:tt,htmlLabel:et,parent:nt="manifest"})=>wn$1.createElement(wn$1.Fragment,null,wn$1.createElement("span",{className:"manifest-property-title"},et),wn$1.createElement("a",{href:tt,target:"_blank",id:`iiif-${nt}-id`},tt)),on=({metadata:tt,parent:et="manifest"})=>tt?wn$1.createElement(wn$1.Fragment,null,wn$1.createElement(Xt,{metadata:tt,id:`iiif-${et}-metadata`})):wn$1.createElement(wn$1.Fragment,null),an=({requiredStatement:tt,parent:et="manifest"})=>tt?wn$1.createElement(wn$1.Fragment,null,wn$1.createElement(Kt,{requiredStatement:tt,id:`iiif-${et}-required-statement`})):wn$1.createElement(wn$1.Fragment,null),ln=({rights:tt})=>tt?wn$1.createElement(wn$1.Fragment,null,wn$1.createElement("span",{className:"manifest-property-title"},"Rights"),wn$1.createElement("a",{href:tt,target:"_blank"},tt)):wn$1.createElement(wn$1.Fragment,null),sn=({seeAlso:tt})=>(tt==null?void 0:tt.length)===0?wn$1.createElement(wn$1.Fragment,null):wn$1.createElement(wn$1.Fragment,null,wn$1.createElement("span",{className:"manifest-property-title"},"See Also"),wn$1.createElement(en,{seeAlso:tt})),cn=({summary:tt,parent:et="manifest"})=>tt?wn$1.createElement(wn$1.Fragment,null,wn$1.createElement(tn,{summary:tt,as:"p",id:`iiif-${et}-summary`})):wn$1.createElement(wn$1.Fragment,null),dn=({label:tt,thumbnail:et})=>(et==null?void 0:et.length)===0?wn$1.createElement(wn$1.Fragment,null):wn$1.createElement(wn$1.Fragment,null,wn$1.createElement(Ve,{altAsLabel:tt||{none:["resource"]},thumbnail:et,style:{backgroundColor:"#6663",objectFit:"cover"}})),mn=()=>{const tt=k(),{activeManifest:et,vault:nt}=tt,[rt,it]=p$3(),[st,ot]=p$3([]),[lt,ut]=p$3([]),[ct,dt]=p$3([]);return _$1(()=>{var ft,pt,gt;const _r=nt.get(et);it(_r),((ft=_r.homepage)==null?void 0:ft.length)>0&&ot(nt.get(_r.homepage)),((pt=_r.seeAlso)==null?void 0:pt.length)>0&&ut(nt.get(_r.seeAlso)),((gt=_r.thumbnail)==null?void 0:gt.length)>0&&dt(nt.get(_r.thumbnail))},[et,nt]),rt?wn$1.createElement(Lt,null,wn$1.createElement(zt,null,wn$1.createElement(dn,{thumbnail:ct,label:rt.label}),wn$1.createElement(cn,{summary:rt.summary}),wn$1.createElement(on,{metadata:rt.metadata}),wn$1.createElement(an,{requiredStatement:rt.requiredStatement}),wn$1.createElement(ln,{rights:rt.rights}),wn$1.createElement(nn,{homepage:st}),wn$1.createElement(sn,{seeAlso:lt}),wn$1.createElement(rn,{id:rt.id,htmlLabel:"IIIF Manifest"}))):wn$1.createElement(wn$1.Fragment,null)},un=()=>{function tt(it){return it.map(st=>{const ot=st.identifier||v4();return{...st,identifier:ot}})}function et(it){var st;const ot=[],lt=[],ut=tt(it);for(const ct of ut){for(;lt.length>0&&lt[lt.length-1].end<=ct.start;)lt.pop();lt.length>0?(lt[lt.length-1].children||(lt[lt.length-1].children=[]),(st=lt[lt.length-1].children)==null||st.push(ct),lt.push(ct)):(ot.push(ct),lt.push(ct))}return ot}function nt(it,st=[]){return st.some(ot=>it.start>=ot.start&&it.end<=ot.end)}function rt(it=[]){return it.sort((st,ot)=>st.start-ot.start)}return{addIdentifiersToParsedCues:tt,createNestedCues:et,isChild:nt,orderCuesByTime:rt}},ue=ne({from:{transform:"rotate(360deg)"},to:{transform:"rotate(0deg)"}}),pn=m($f99a8c78507165f7$export$be92b6f5f03c0fe9,{display:"flex",flexDirection:"column",width:"100%"}),Be=m($f99a8c78507165f7$export$6d08773d2e66f8f2,{position:"relative",cursor:"pointer",display:"flex",width:"100%",justifyContent:"space-between",textAlign:"left",margin:"0",padding:"0.5rem 1.618rem",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",color:"inherit",border:"none",background:"none","@sm":{padding:"0.5rem 1rem",fontSize:"0.8333rem"},"&::before":{content:"",width:"12px",height:"12px",borderRadius:"12px",position:"absolute",backgroundColor:"$primaryMuted",opacity:"0",left:"8px",marginTop:"3px",boxSizing:"content-box","@sm":{content:"unset"}},"&::after":{content:"",width:"4px",height:"6px",position:"absolute",backgroundColor:"$secondary",opacity:"0",clipPath:"polygon(100% 50%, 0 100%, 0 0)",left:"13px",marginTop:"6px",boxSizing:"content-box","@sm":{content:"unset"}},strong:{marginLeft:"1rem"},"&:hover":{color:"$accent","&::before":{backgroundColor:"$accent",opacity:"1"},"&::after":{content:"",width:"4px",height:"6px",position:"absolute",backgroundColor:"$secondary",clipPath:"polygon(100% 50%, 0 100%, 0 0)",opacity:"1"}},"&[aria-checked='true']":{backgroundColor:"#6663","&::before":{content:"",width:"6px",height:"6px",position:"absolute",backgroundColor:"transparent",border:"3px solid $accentMuted",borderRadius:"12px",left:"8px",marginTop:"4px",opacity:"1",animation:"1s linear infinite",animationName:ue,boxSizing:"content-box","@sm":{content:"unset"}},"&::after":{content:"",width:"6px",height:"6px",position:"absolute",backgroundColor:"transparent",border:"3px solid $accent",clipPath:"polygon(100% 0, 100% 100%, 0 0)",borderRadius:"12px",left:"8px",marginTop:"4px",opacity:"1",animation:"1.5s linear infinite",animationName:ue,boxSizing:"content-box","@sm":{content:"unset"}}}}),fn=({label:tt,start:et,end:nt})=>{const[rt,it]=p$3(!1),st=document.getElementById("clover-iiif-video");_$1(()=>(st==null||st.addEventListener("timeupdate",()=>{const{currentTime:lt}=st;it(et<=lt&&lt<nt)}),()=>document.removeEventListener("timeupdate",()=>{})),[nt,et,st]);const ot=()=>{st&&(st.pause(),st.currentTime=et,st.play())};return wn$1.createElement(Be,{"aria-checked":rt,"data-testid":"information-panel-cue",onClick:ot,value:tt},tt,wn$1.createElement("strong",null,Ee(et)))},gn=m("ul",{listStyle:"none",paddingLeft:"1rem",position:"relative","&&:first-child":{paddingLeft:"0"},"& li ul":{[`& ${Be}`]:{backgroundColor:"unset","&::before":{content:"none"},"&::after":{content:"none"}}},"&:first-child":{margin:"0 0 1.618rem"}}),He=({items:tt})=>wn$1.createElement(gn,null,tt.map(et=>{const{text:nt,start:rt,end:it,children:st,identifier:ot}=et;return wn$1.createElement("li",{key:ot},wn$1.createElement(fn,{label:nt,start:rt,end:it}),st&&wn$1.createElement(He,{items:st}))})),hn=({resource:tt})=>{const[et,nt]=wn$1.useState([]),{id:rt,label:it}=tt,{createNestedCues:st,orderCuesByTime:ot}=un();return _$1(()=>{rt&&fetch(rt,{headers:{"Content-Type":"text/plain",Accept:"application/json"}}).then(lt=>lt.text()).then(lt=>{const ut=nodeWebvtt.parse(lt).cues,ct=ot(ut),dt=st(ct);nt(dt)}).catch(lt=>console.error(rt,lt.toString()))},[rt]),wn$1.createElement(pn,{"aria-label":`navigate ${D(it,"en")}`},wn$1.createElement(He,{items:et}))},xn=({activeCanvas:tt,resources:et})=>{var nt;const rt=k(),{configOptions:it}=rt,{informationPanel:st}=it,[ot,lt]=p$3(),ut=(st==null?void 0:st.renderAbout)||((nt=it==null?void 0:it.informationPanel)==null?void 0:nt.renderAbout),ct=st==null?void 0:st.renderSupplementing;_$1(()=>{ut?lt("manifest-about"):et&&(et==null?void 0:et.length)>0&&!ut&&lt(et[0].id)},[tt,ut,et]);const dt=ft=>{lt(ft)};return et?wn$1.createElement(Tt,{"data-testid":"information-panel",defaultValue:ot,onValueChange:dt,orientation:"horizontal",value:ot,className:"clover-viewer-information-panel"},wn$1.createElement(Mt,{"aria-label":"select chapter","data-testid":"information-panel-list"},ut&&wn$1.createElement(se,{value:"manifest-about"},"About"),ct&&et&&et.map(({id:ft,label:pt})=>wn$1.createElement(se,{key:ft,value:ft},wn$1.createElement(L,{label:pt})))),wn$1.createElement(Rt,null,ut&&wn$1.createElement(ce,{value:"manifest-about"},wn$1.createElement(mn,null)),ct&&et&&et.map(ft=>wn$1.createElement(ce,{key:ft.id,value:ft.id},wn$1.createElement(hn,{resource:ft}))))):wn$1.createElement(wn$1.Fragment,null)},Oe=m("div",{position:"absolute",right:"1rem",top:"1rem",display:"flex",justifyContent:"flex-end",zIndex:"1"}),vn=m("input",{flexGrow:"1",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"2rem",fontFamily:"inherit",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0003","&::placeholder":{color:"$primaryMuted"}}),Y=m("button",{display:"flex",background:"none",border:"none",width:"2rem !important",height:"2rem !important",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box !important",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),bn=m("div",{display:"flex",marginRight:"0.618rem",backgroundColor:"$accentAlt",borderRadius:"2rem",boxShadow:"5px 5px 5px #0003",color:"$secondary",alignItems:"center","> span":{display:"flex",margin:"0 0.5rem",fontSize:"0.7222rem"}}),yn=m("div",{display:"flex",position:"relative",zIndex:"1",width:"100%",padding:"0",transition:"$all",variants:{isToggle:{true:{paddingTop:"2.618rem",[`& ${Oe}`]:{width:"calc(100% - 2rem)","@sm":{width:"calc(100% - 2rem)"}}}}}}),En=(tt,et)=>{_$1(()=>{function nt(rt){rt.key===tt&&et()}return window.addEventListener("keyup",nt),()=>window.removeEventListener("keyup",nt)},[])},wn=()=>wn$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},wn$1.createElement("title",null,"Arrow Back"),wn$1.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M244 400L100 256l144-144M120 256h292"})),Cn=()=>wn$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},wn$1.createElement("title",null,"Arrow Forward"),wn$1.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M268 112l144 144-144 144M392 256H100"})),Sn=()=>wn$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},wn$1.createElement("title",null,"Close"),wn$1.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),kn=()=>wn$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},wn$1.createElement("title",null,"Search"),wn$1.createElement("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"})),In=({handleCanvasToggle:tt,handleFilter:et,activeIndex:nt,canvasLength:rt})=>{const[it,st]=p$3(!1),[ot,lt]=p$3(!1),[ut,ct]=p$3(!1);_$1(()=>{ct(nt===0),nt===rt-1?lt(!0):lt(!1)},[nt,rt]),En("Escape",()=>{st(!1),et("")});const dt=()=>{st(pt=>!pt),et("")},ft=pt=>et(pt.target.value);return wn$1.createElement(yn,{isToggle:it},wn$1.createElement(Oe,null,it&&wn$1.createElement(vn,{autoFocus:!0,onChange:ft,placeholder:"Search"}),!it&&wn$1.createElement(bn,null,wn$1.createElement(Y,{onClick:()=>tt(-1),disabled:ut,type:"button"},wn$1.createElement(wn,null)),wn$1.createElement("span",null,nt+1," of ",rt),wn$1.createElement(Y,{onClick:()=>tt(1),disabled:ot,type:"button"},wn$1.createElement(Cn,null))),wn$1.createElement(Y,{onClick:dt,type:"button"},it?wn$1.createElement(Sn,null):wn$1.createElement(kn,null))))},$n=m($f99a8c78507165f7$export$be92b6f5f03c0fe9,{display:"flex",flexDirection:"row",flexGrow:"1",padding:"1.618rem",overflowX:"scroll",position:"relative",zIndex:"0"}),An=()=>wn$1.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M256 112v288M400 256H112"}),Tn=()=>wn$1.createElement(wn$1.Fragment,null,wn$1.createElement("path",{d:"M232 416a23.88 23.88 0 01-14.2-4.68 8.27 8.27 0 01-.66-.51L125.76 336H56a24 24 0 01-24-24V200a24 24 0 0124-24h69.75l91.37-74.81a8.27 8.27 0 01.66-.51A24 24 0 01256 120v272a24 24 0 01-24 24zm-106.18-80zm-.27-159.86zM320 336a16 16 0 01-14.29-23.19c9.49-18.87 14.3-38 14.3-56.81 0-19.38-4.66-37.94-14.25-56.73a16 16 0 0128.5-14.54C346.19 208.12 352 231.44 352 256c0 23.86-6 47.81-17.7 71.19A16 16 0 01320 336z"}),wn$1.createElement("path",{d:"M368 384a16 16 0 01-13.86-24C373.05 327.09 384 299.51 384 256c0-44.17-10.93-71.56-29.82-103.94a16 16 0 0127.64-16.12C402.92 172.11 416 204.81 416 256c0 50.43-13.06 83.29-34.13 120a16 16 0 01-13.87 8z"}),wn$1.createElement("path",{d:"M416 432a16 16 0 01-13.39-24.74C429.85 365.47 448 323.76 448 256c0-66.5-18.18-108.62-45.49-151.39a16 16 0 1127-17.22C459.81 134.89 480 181.74 480 256c0 64.75-14.66 113.63-50.6 168.74A16 16 0 01416 432z"})),Mn=()=>wn$1.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"}),Rn=()=>wn$1.createElement("path",{d:"M416 64H96a64.07 64.07 0 00-64 64v256a64.07 64.07 0 0064 64h320a64.07 64.07 0 0064-64V128a64.07 64.07 0 00-64-64zm-80 64a48 48 0 11-48 48 48.05 48.05 0 0148-48zM96 416a32 32 0 01-32-32v-67.63l94.84-84.3a48.06 48.06 0 0165.8 1.9l64.95 64.81L172.37 416zm352-32a32 32 0 01-32 32H217.63l121.42-121.42a47.72 47.72 0 0161.64-.16L448 333.84z"}),zn=()=>wn$1.createElement("path",{d:"M464 384.39a32 32 0 01-13-2.77 15.77 15.77 0 01-2.71-1.54l-82.71-58.22A32 32 0 01352 295.7v-79.4a32 32 0 0113.58-26.16l82.71-58.22a15.77 15.77 0 012.71-1.54 32 32 0 0145 29.24v192.76a32 32 0 01-32 32zM268 400H84a68.07 68.07 0 01-68-68V180a68.07 68.07 0 0168-68h184.48A67.6 67.6 0 01336 179.52V332a68.07 68.07 0 01-68 68z"}),De=m("svg",{display:"inline-flex",variants:{isLarge:{true:{height:"4rem",width:"4rem"}},isMedium:{true:{height:"2rem",width:"2rem"}},isSmall:{true:{height:"1rem",width:"1rem"}}}}),Ln=({children:tt})=>wn$1.createElement("title",null,tt),S=tt=>wn$1.createElement(De,{...tt,"data-testid":"icon-svg",role:"img",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},tt.children);S.Title=Ln,S.Add=An,S.Audio=Tn,S.Close=Mn,S.Image=Rn,S.Video=zn;const Fn=ne({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),Pn=ne({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),We=m($cb5cc270b50c6fcd$export$21b07c8f274aebd5,{fill:"$secondaryAlt"}),Vn=m($cb5cc270b50c6fcd$export$f39c2d165cd861fe,{position:"absolute",right:"0",top:"0",padding:"0.5rem",margin:"0",cursor:"pointer",border:"none",background:"none",fill:"inherit","&:hover":{opacity:"0.75"}}),Bn=m($cb5cc270b50c6fcd$export$7c6e2c02157bb7d2,{border:"none",backgroundColor:"white",fill:"inhrerit",padding:"1rem 2rem 1rem 1rem",width:"auto",minWidth:"200px",maxWidth:"350px",borderRadius:"3px",boxShadow:"5px 5px 13px #0002",animationDuration:"0.3s",animationTimingFunction:"cubic-bezier(0.16, 1, 0.3, 1)",'&[data-side="top"]':{animationName:Pn},'&[data-side="bottom"]':{animationName:Fn},'&[data-align="end"]':{[`& ${We}`]:{margin:"0 0.7rem"}}}),Hn=m($cb5cc270b50c6fcd$export$41fb9f06171c75f4,{display:"inline-flex",padding:"0.5rem 0",margin:"0 0.5rem 0 0",cursor:"pointer",border:"none",background:"none","> button, > span":{margin:"0"}}),On=m($cb5cc270b50c6fcd$export$be92b6f5f03c0fe9,{boxSizing:"content-box"}),Dn=tt=>wn$1.createElement(Hn,{...tt},tt.children),Wn=tt=>wn$1.createElement(Bn,{...tt},wn$1.createElement(We,null),wn$1.createElement(Vn,null,wn$1.createElement(S,{isSmall:!0},wn$1.createElement(S.Close,null))),tt.children),W=({children:tt})=>wn$1.createElement(On,null,tt);W.Trigger=Dn,W.Content=Wn;const J=m("div",{boxSizing:"border-box",display:"inline-flex",alignItems:"center",borderRadius:"5px",padding:"$1",marginBottom:"$2",marginRight:"$2",backgroundColor:"$lightGrey",color:"$richBlack50",textTransform:"uppercase",fontSize:"$2",objectFit:"contain",lineHeight:"1em !important","&:last-child":{marginRight:"0"},[`${De}`]:{position:"absolute",left:"$1",height:"$3",width:"$3"},variants:{isIcon:{true:{position:"relative",paddingLeft:"$5"}}}}),Q=m("span",{display:"flex"}),jn=m("span",{display:"flex",width:"1.2111rem",height:"0.7222rem"}),Nn=m("span",{display:"inline-flex",marginLeft:"5px",marginBottom:"-1px"}),Gn=m($f99a8c78507165f7$export$6d08773d2e66f8f2,{display:"flex",flexShrink:"0",margin:"0 1.618rem 0 0",padding:"0",cursor:"pointer",background:"none",border:"none",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",textAlign:"left","&:last-child":{marginRight:"1rem"},figure:{margin:"0",width:"161.8px","> div":{position:"relative",display:"flex",backgroundColor:"$secondaryAlt",width:"inherit",height:"100px",overflow:"hidden",borderRadius:"3px",transition:"$all",img:{width:"100%",height:"100%",objectFit:"cover",filter:"blur(0)",transform:"scale3d(1, 1, 1)",transition:"$all",color:"transparent"},[`& ${Q}`]:{position:"absolute",right:"0",bottom:"0",[`& ${J}`]:{margin:"0",paddingLeft:"0",fontSize:"0.7222rem",backgroundColor:"#000d",color:"$secondary",fill:"$secondary",borderBottomLeftRadius:"0",borderTopRightRadius:"0"}}},figcaption:{marginTop:"0.5rem",fontWeight:"400",fontSize:"0.8333rem",display:"-webkit-box",overflow:"hidden",MozBoxOrient:"vertical",WebkitBoxOrient:"vertical",WebkitLineClamp:"5","@sm":{fontSize:"0.8333rem"}}},"&[aria-checked='true']":{figure:{"> div":{backgroundColor:"$primaryAlt","&::before":{position:"absolute",zIndex:"1",color:"$secondaryMuted",content:"Active Item",textTransform:"uppercase",fontWeight:"700",fontSize:"0.6111rem",letterSpacing:"0.03rem",display:"flex",width:"100%",height:"100%",flexDirection:"column",justifyContent:"center",textAlign:"center",textShadow:"5px 5px 5px #0003"},img:{opacity:"0.3",transform:"scale3d(1.1, 1.1, 1.1)",filter:"blur(2px)"},[`& ${Q}`]:{[`& ${J}`]:{backgroundColor:"$accent"}}}},figcaption:{fontWeight:"700"}}}),qn=({type:tt})=>{switch(tt){case"Sound":return wn$1.createElement(S.Audio,null);case"Image":return wn$1.createElement(S.Image,null);case"Video":return wn$1.createElement(S.Video,null);default:return wn$1.createElement(S.Image,null)}},Un=({canvas:tt,canvasIndex:et,isActive:nt,thumbnail:rt,type:it,handleChange:st})=>wn$1.createElement(Gn,{"aria-checked":nt,"data-testid":"media-thumbnail","data-canvas":et,onClick:()=>st(tt.id),value:tt.id},wn$1.createElement("figure",null,wn$1.createElement("div",null,(rt==null?void 0:rt.id)&&wn$1.createElement("img",{src:rt.id,alt:tt!=null&&tt.label?D(tt.label):""}),wn$1.createElement(Q,null,wn$1.createElement(J,{isIcon:!0,"data-testid":"thumbnail-tag"},wn$1.createElement(jn,null),wn$1.createElement(S,{"aria-label":it},wn$1.createElement(qn,{type:it})),["Video","Sound"].includes(it)&&wn$1.createElement(Nn,null,Ee(tt.duration))))),(tt==null?void 0:tt.label)&&wn$1.createElement("figcaption",{"data-testid":"fig-caption"},wn$1.createElement(L,{label:tt.label})))),_n=tt=>tt.body?tt.body.type:"Image",Zn=({items:tt})=>{const et=O(),nt=k(),{activeCanvas:rt,vault:it}=nt,[st,ot]=p$3(""),[lt,ut]=p$3([]),[ct,dt]=p$3(0),ft=wn$1.useRef(null),pt="painting",gt=mt=>{rt!==mt&&et({type:"updateActiveCanvas",canvasId:mt})};_$1(()=>{if(!lt.length){const mt=["Image","Sound","Video"],Kr=tt.map(Xr=>Ie(it,Xr,pt,mt)).filter(Xr=>Xr.annotations.length>0);ut(Kr)}},[tt,lt.length,it]),_$1(()=>{lt.forEach((mt,Kr)=>{mt!=null&&mt.canvas&&mt.canvas.id===rt&&dt(Kr)})},[rt,lt]),_$1(()=>{const mt=document.querySelector(`[data-canvas="${ct}"]`);if(mt instanceof HTMLElement&&ft.current){const Kr=mt.offsetLeft-ft.current.offsetWidth/2+mt.offsetWidth/2;ft.current.scrollTo({left:Kr,behavior:"smooth"})}},[ct]);const _r=mt=>ot(mt),Yr=mt=>{const Kr=lt[ct+mt];Kr!=null&&Kr.canvas&&gt(Kr.canvas.id)};return wn$1.createElement(wn$1.Fragment,null,wn$1.createElement(In,{handleFilter:_r,handleCanvasToggle:Yr,activeIndex:ct,canvasLength:lt.length}),wn$1.createElement($n,{"aria-label":"select item","data-testid":"media",ref:ft},lt.filter(mt=>{var Kr;if((Kr=mt.canvas)!=null&&Kr.label){const Xr=D(mt.canvas.label);if(Array.isArray(Xr))return Xr[0].toLowerCase().includes(st.toLowerCase())}}).map((mt,Kr)=>{var Xr,Zr;return wn$1.createElement(Un,{canvas:mt.canvas,canvasIndex:Kr,handleChange:gt,isActive:rt===((Xr=mt==null?void 0:mt.canvas)==null?void 0:Xr.id),key:(Zr=mt==null?void 0:mt.canvas)==null?void 0:Zr.id,thumbnail:Et(it,mt,200,200),type:_n(mt.annotations[0])})})))},je=m("button",{background:"none",border:"none",cursor:"zoom-in",width:"100%",height:"100%",margin:"0",padding:"0",transition:"$all","& img":{width:"100%",height:"100%",objectFit:"contain",color:"transparent",transition:"$all"},variants:{isMedia:{true:{cursor:"pointer"}}}}),Ne=m("button",{display:"flex",height:"2rem",width:"2rem",borderRadius:"2rem",padding:"0",margin:"0",fontFamily:"inherit",background:"none",border:"none",color:"white",cursor:"pointer",marginLeft:"0.618rem",backgroundColor:"$primary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"content-box !important","&:first-child":{marginLeft:"0"},"@xs":{marginBottom:"0.618rem",marginLeft:"0","&:last-child":{marginBottom:"0"}},svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"inherit"},"&:hover, &:focus":{backgroundColor:"$accent"},"&#rotateRight":{"&:hover, &:focus":{svg:{rotate:"45deg"}}},"&#rotateLeft":{transform:"scaleX(-1)","&:hover, &:focus":{svg:{rotate:"45deg"}}},"&#reset":{"&:hover, &:focus":{svg:{rotate:"-15deg"}}}}),Ge=m(Ne,{position:"absolute",width:"2rem",top:"1rem",right:"1rem",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",transition:"$all",borderRadius:"50%",backgroundColor:"$accent",cursor:"pointer","&:hover, &:focus":{backgroundColor:"$accent !important"},variants:{isInteractive:{true:{"&:hover":{opacity:"1"}},false:{}},isMedia:{true:{cursor:"pointer !important"}}},compoundVariants:[{isInteractive:!1,isMedia:!0,css:{top:"50%",right:"50%",width:"4rem",height:"4rem",transform:"translate(50%,-50%)"}}]}),Xn=m("div",{position:"relative",zIndex:"0",display:"flex",flexDirection:"column",gap:"1rem","&:hover":{[`${Ge}`]:{backgroundColor:"$accent"},[`${je}`]:{backgroundColor:"#6662",img:{filter:"brightness(0.85)"}}}}),Yn=m("div",{}),Kn=m("svg",{height:"19px",color:"$accent",fill:"$accent",stroke:"$accent",display:"flex",margin:"0.25rem 0.85rem"}),Jn=m($cc7e05a45900e73f$export$41fb9f06171c75f4,{fontSize:"1.25rem",fontWeight:"400",fontFamily:"inherit",alignSelf:"flex-start",flexGrow:"1",cursor:"pointer",transition:"$all",border:"1px solid #6663",boxShadow:"2px 2px 5px #0001",borderRadius:"3px",display:"flex",alignItems:"center",paddingLeft:"0.5rem",width:"100%","@sm":{fontSize:"1rem"}}),Qn=m($cc7e05a45900e73f$export$7c6e2c02157bb7d2,{borderRadius:"3px",boxShadow:"3px 3px 8px #0003",backgroundColor:"$secondary",marginTop:"2.25rem",marginLeft:"6px",paddingBottom:"0.25rem",maxHeight:"calc(61.8vh - 2.5rem) !important",borderTopLeftRadius:"0",border:"1px solid $secondaryMuted",maxWidth:"90vw"}),er=m($cc7e05a45900e73f$export$6d08773d2e66f8f2,{display:"flex",alignItems:"center",fontFamily:"inherit",padding:"0.25rem 0.5rem",color:"$primary",fontWeight:"400",fontSize:"0.8333rem",cursor:"pointer",backgroundColor:"$secondary",width:"calc(100% - 1rem)","> span":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},'&[data-state="checked"]':{fontWeight:"700",color:"$primary !important"},"&:hover":{color:"$accent"},img:{width:"31px",height:"31px",marginRight:"0.5rem",borderRadius:"3px"}}),tr=m($cc7e05a45900e73f$export$b04be29aa201d4f5,{color:"$primaryMuted",fontFamily:"inherit",fontSize:"0.85rem",padding:"0.5rem 1rem 0.5rem 0.5rem",display:"flex",alignItems:"center",marginBottom:"0.25rem",borderRadius:"3px",borderTopLeftRadius:"0",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",backgroundColor:"$secondaryMuted"}),qe=m($cc7e05a45900e73f$export$be92b6f5f03c0fe9,{position:"relative",zIndex:"5",width:"100%"}),K=({direction:tt,title:et})=>{const nt=()=>wn$1.createElement("path",{d:"M414 321.94L274.22 158.82a24 24 0 00-36.44 0L98 321.94c-13.34 15.57-2.28 39.62 18.22 39.62h279.6c20.5 0 31.56-24.05 18.18-39.62z"}),rt=()=>wn$1.createElement("path",{d:"M98 190.06l139.78 163.12a24 24 0 0036.44 0L414 190.06c13.34-15.57 2.28-39.62-18.22-39.62h-279.6c-20.5 0-31.56 24.05-18.18 39.62z"});return wn$1.createElement(Kn,{xmlns:"http://www.w3.org/2000/svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},wn$1.createElement("title",null,et),tt==="up"&&wn$1.createElement(nt,null),tt==="down"&&wn$1.createElement(rt,null))},Ue=({children:tt,label:et,maxHeight:nt,onValueChange:rt,value:it})=>wn$1.createElement(qe,{onValueChange:rt,value:it},wn$1.createElement(Jn,{"data-testid":"select-button"},wn$1.createElement($cc7e05a45900e73f$export$e288731fd71264f0,{"data-testid":"select-button-value"}),wn$1.createElement($cc7e05a45900e73f$export$99b400cabb58c515,null,wn$1.createElement(K,{direction:"down",title:"select"}))),wn$1.createElement($cc7e05a45900e73f$export$b2af6c9944296213,null,wn$1.createElement(Qn,{css:{maxHeight:`${nt} !important`},"data-testid":"select-content"},wn$1.createElement($cc7e05a45900e73f$export$d8117927658af6d7,null,wn$1.createElement(K,{direction:"up",title:"scroll up for more"})),wn$1.createElement($cc7e05a45900e73f$export$9ed6e7b40248d36d,null,wn$1.createElement($cc7e05a45900e73f$export$ee25a334c55de1f4,null,et&&wn$1.createElement(tr,null,wn$1.createElement(L,{"data-testid":"select-label",label:et})),tt)),wn$1.createElement($cc7e05a45900e73f$export$ff951e476c12189,null,wn$1.createElement(K,{direction:"down",title:"scroll down for more"}))))),_e=tt=>wn$1.createElement(er,{...tt},tt.thumbnail&&wn$1.createElement(Ve,{thumbnail:tt.thumbnail}),wn$1.createElement($cc7e05a45900e73f$export$3572fb0fb821ff49,null,wn$1.createElement(L,{label:tt.label})),wn$1.createElement($cc7e05a45900e73f$export$6b9198de19accfe6,null)),nr=m("div",{position:"absolute !important",zIndex:"1",top:"1rem",left:"1rem",width:"161.8px",height:"100px",backgroundColor:"#000D",boxShadow:"5px 5px 5px #0002",borderRadius:"3px",".displayregion":{border:" 3px solid $accent !important",boxShadow:"0 0 3px #0006"},"@sm":{width:"123px",height:"76px"},"@xs":{width:"100px",height:"61.8px"}}),rr=m("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),or=m("div",{width:"100%",height:"61.8vh",maxHeight:"100vh",background:"black",backgroundSize:"contain",color:"white",position:"relative",zIndex:"1",overflow:"hidden"}),z=({id:tt,label:et,children:nt})=>wn$1.createElement(Ne,{id:tt,"data-testid":"openseadragon-button"},wn$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":`${tt}-svg-title`,"data-testid":"openseadragon-button-svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},wn$1.createElement("title",{id:`${tt}-svg-title`},et),nt)),ar=m("div",{position:"absolute",zIndex:"1",top:"1rem",display:"flex","@xs":{flexDirection:"column",zIndex:"2"},variants:{hasPlaceholder:{true:{right:"3.618rem","@xs":{top:"3.618rem",right:"1rem"}},false:{right:"1rem","@xs":{top:"1rem",right:"1rem"}}}}}),ir=()=>wn$1.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M256 112v288M400 256H112"}),lr=()=>wn$1.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 256H112"}),sr=()=>wn$1.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M432 320v112H320M421.8 421.77L304 304M80 192V80h112M90.2 90.23L208 208M320 80h112v112M421.77 90.2L304 208M192 432H80V320M90.23 421.8L208 304"}),cr=()=>wn$1.createElement("path",{d:"M448 440a16 16 0 01-12.61-6.15c-22.86-29.27-44.07-51.86-73.32-67C335 352.88 301 345.59 256 344.23V424a16 16 0 01-27 11.57l-176-168a16 16 0 010-23.14l176-168A16 16 0 01256 88v80.36c74.14 3.41 129.38 30.91 164.35 81.87C449.32 292.44 464 350.9 464 424a16 16 0 01-16 16z"}),pe=()=>wn$1.createElement(wn$1.Fragment,null,wn$1.createElement("path",{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 148l-21.12-24.57A191.43 191.43 0 00240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 00181.07-128"}),wn$1.createElement("path",{d:"M464 97.42V208a16 16 0 01-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z"})),dr=({hasPlaceholder:tt,options:et})=>wn$1.createElement(ar,{"data-testid":"openseadragon-controls",hasPlaceholder:tt,id:"openseadragon-controls"},et.showZoomControl&&wn$1.createElement(wn$1.Fragment,null,wn$1.createElement(z,{id:"zoomIn",label:"zoom in"},wn$1.createElement(ir,null)),wn$1.createElement(z,{id:"zoomOut",label:"zoom out"},wn$1.createElement(lr,null))),et.showFullPageControl&&wn$1.createElement(z,{id:"fullPage",label:"full page"},wn$1.createElement(sr,null)),et.showRotationControl&&wn$1.createElement(wn$1.Fragment,null,wn$1.createElement(z,{id:"rotateRight",label:"rotate right"},wn$1.createElement(pe,null)),wn$1.createElement(z,{id:"rotateLeft",label:"rotate left"},wn$1.createElement(pe,null))),et.showHomeControl&&wn$1.createElement(z,{id:"reset",label:"reset"},wn$1.createElement(cr,null))),mr=tt=>fetch(`${tt.replace(/\/$/,"")}/info.json`).then(et=>et.json()).then(et=>et).catch(et=>{console.error(`The IIIF tilesource ${tt.replace(/\/$/,"")}/info.json failed to load: ${et}`)}),ur=tt=>{let et,nt;if(Array.isArray(tt)&&(et=tt[0],et)){let rt;"@id"in et?rt=et["@id"]:rt=et.id,nt=rt}return nt},pr=({uri:tt,hasPlaceholder:et,imageType:nt})=>{const[rt,it]=p$3(),[st,ot]=p$3(),lt=k(),{configOptions:ut}=lt,ct={id:`openseadragon-viewport-${st}`,loadTilesWithAjax:!0,fullPageButton:"fullPage",homeButton:"reset",rotateLeftButton:"rotateLeft",rotateRightButton:"rotateRight",zoomInButton:"zoomIn",zoomOutButton:"zoomOut",showNavigator:!0,showFullPageControl:!0,showHomeControl:!0,showRotationControl:!0,showZoomControl:!0,navigatorBorderColor:"transparent",navigatorId:`openseadragon-navigator-${st}`,gestureSettingsMouse:{clickToZoom:!0,dblClickToZoom:!0,pinchToZoom:!0,scrollToZoom:!0},...ut.openSeadragon,ajaxWithCredentials:ut.withCredentials};return _$1(()=>{tt!==rt&&(it(tt),ot(v4()))},[rt,tt]),_$1(()=>{if(rt)switch(nt){case"simpleImage":le(ct).addSimpleImage({url:rt});break;case"tiledImage":mr(rt).then(dt=>le(ct).addTiledImage({tileSource:dt}));break;default:console.warn(`Unable to render ${rt} in OpenSeadragon as type: "${nt}"`);break}},[rt]),st?wn$1.createElement(or,{css:{backgroundColor:ut.canvasBackgroundColor,height:ut.canvasHeight},className:"clover-viewer-osd-wrapper","data-testid":"clover-viewer-osd-wrapper"},wn$1.createElement(dr,{hasPlaceholder:et,options:ct}),wn$1.createElement(nr,{id:`openseadragon-navigator-${st}`}),wn$1.createElement(rr,{id:`openseadragon-viewport-${st}`})):null},fr=({painting:tt,hasPlaceholder:et})=>{const[nt,rt]=p$3(),[it,st]=p$3();return _$1(()=>{Array.isArray(tt==null?void 0:tt.service)&&(tt==null?void 0:tt.service.length)>0?(rt("tiledImage"),st(ur(tt==null?void 0:tt.service))):(rt("simpleImage"),st(tt==null?void 0:tt.id))},[tt]),wn$1.createElement(pr,{uri:it,key:it,hasPlaceholder:et,imageType:nt})},gr=({isMedia:tt,label:et,placeholderCanvas:nt,setIsInteractive:rt})=>{const{vault:it}=k(),st=N(it,nt),ot=st?st[0]:void 0,lt=et?D(et):["placeholder image"];return wn$1.createElement(je,{onClick:()=>rt(!0),isMedia:tt,className:"clover-viewer-placeholder"},wn$1.createElement("img",{src:(ot==null?void 0:ot.id)||"",alt:lt.join(),height:ot==null?void 0:ot.height,width:ot==null?void 0:ot.width}))},hr=m("canvas",{position:"absolute",width:"100%",height:"100%",zIndex:"0"}),xr=wn$1.forwardRef((tt,et)=>{const nt=wn$1.useRef(null),rt=x$3(()=>{var st,ot;if((st=et.current)!=null&&st.currentTime&&((ot=et.current)==null?void 0:ot.currentTime)>0)return;const lt=et.current;if(!lt)return;const ut=new AudioContext,ct=ut.createMediaElementSource(lt),dt=ut.createAnalyser(),ft=nt.current;if(!ft)return;ft.width=lt.offsetWidth,ft.height=lt.offsetHeight;const pt=ft.getContext("2d");ct.connect(dt),dt.connect(ut.destination),dt.fftSize=256;const gt=dt.frequencyBinCount,_r=new Uint8Array(gt);setInterval(function(){it(dt,pt,gt,_r,ft.width,ft.height)},20)},[et]);wn$1.useEffect(()=>{!et||!et.current||(et.current.onplay=rt)},[rt,et]);function it(st,ot,lt,ut,ct,dt){const ft=ct/lt*2.6;let pt,gt=0;st.getByteFrequencyData(ut),ot.fillStyle="#000000",ot.fillRect(0,0,ct,dt);for(let _r=0;_r<lt;_r++)pt=ut[_r]*2,ot.fillStyle="rgba(78, 42, 132, 1)",ot.fillRect(gt,dt-pt,ft,pt),gt+=ft+6}return wn$1.createElement(hr,{ref:nt,role:"presentation"})}),vr=m("div",{position:"relative",backgroundColor:"$primaryAlt",display:"flex",flexGrow:"0",flexShrink:"1",maxHeight:"500px",zIndex:"1",video:{backgroundColor:"transparent",objectFit:"contain",width:"100%",height:"100%",position:"relative",zIndex:"1"}}),br=({resource:tt,ignoreCaptionLabels:et})=>{const nt=D(tt.label,"en");return Array.isArray(nt)&&nt.some(rt=>et.includes(rt))?null:wn$1.createElement("track",{key:tt.id,src:tt.id,label:Array.isArray(nt)?nt[0]:nt,srcLang:"en","data-testid":"player-track"})},yr=({allSources:tt,resources:et,painting:nt})=>{const[rt,it]=wn$1.useState(0),[st,ot]=wn$1.useState(),lt=wn$1.useRef(null),ut=(nt==null?void 0:nt.type)==="Sound",ct=k(),{activeCanvas:dt,configOptions:ft,vault:pt}=ct;return _$1(()=>{if(!nt.id||!lt.current)return;if(lt!=null&&lt.current){const Yr=lt.current;Yr.src=nt.id,Yr.load()}if(nt.id.split(".").pop()!=="m3u8")return;const gt={xhrSetup:function(Yr,mt){Yr.withCredentials=!!ft.withCredentials}},_r=new Hls(gt);return _r.attachMedia(lt.current),_r.on(Hls.Events.MEDIA_ATTACHED,function(){_r.loadSource(nt.id)}),_r.on(Hls.Events.ERROR,function(Yr,mt){if(mt.fatal)switch(mt.type){case Hls.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${Yr} network error encountered, try to recover`),_r.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${Yr} media error encountered, try to recover`),_r.recoverMediaError();break;default:_r.destroy();break}}),()=>{if(_r&&lt.current){const Yr=lt.current;_r.detachMedia(),_r.destroy(),Yr.currentTime=0}}},[ft.withCredentials,nt.id]),_$1(()=>{var gt,_r,Yr,mt;const Kr=pt.get(dt),Xr=(gt=Kr.accompanyingCanvas)!=null&&gt.id?N(pt,(_r=Kr.accompanyingCanvas)==null?void 0:_r.id):null,Zr=(Yr=Kr.placeholderCanvas)!=null&&Yr.id?N(pt,(mt=Kr.placeholderCanvas)==null?void 0:mt.id):null;Xr&&Zr?ot(rt===0?Zr[0].id:Xr[0].id):(Xr&&ot(Xr[0].id),Zr&&ot(Zr[0].id))},[dt,rt,pt]),_$1(()=>{if(lt!=null&&lt.current){const gt=lt.current;return gt==null||gt.addEventListener("timeupdate",()=>it(gt.currentTime)),()=>document.removeEventListener("timeupdate",()=>{})}},[]),wn$1.createElement(vr,{css:{backgroundColor:ft.canvasBackgroundColor,maxHeight:ft.canvasHeight,position:"relative"},"data-testid":"player-wrapper",className:"clover-viewer-player-wrapper"},wn$1.createElement("video",{id:"clover-iiif-video",key:nt.id,ref:lt,controls:!0,height:nt.height,width:nt.width,crossOrigin:"anonymous",poster:st,style:{maxHeight:ft.canvasHeight,position:"relative",zIndex:"1"}},tt.map(gt=>wn$1.createElement("source",{src:gt.id,type:gt.format,key:gt.id})),et.length>0&&et.map(gt=>wn$1.createElement(br,{resource:gt,ignoreCaptionLabels:ft.ignoreCaptionLabels||[],key:gt.id})),"Sorry, your browser doesn't support embedded videos."),ut&&wn$1.createElement(xr,{ref:lt}))},Er=()=>wn$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"close-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},wn$1.createElement("title",{id:"close-svg-title"},"close"),wn$1.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),wr=({isMedia:tt})=>wn$1.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"open-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},wn$1.createElement("title",{id:"open-svg-title"},"open"),tt?wn$1.createElement("path",{d:"M133 440a35.37 35.37 0 01-17.5-4.67c-12-6.8-19.46-20-19.46-34.33V111c0-14.37 7.46-27.53 19.46-34.33a35.13 35.13 0 0135.77.45l247.85 148.36a36 36 0 010 61l-247.89 148.4A35.5 35.5 0 01133 440z"}):wn$1.createElement(wn$1.Fragment,null,wn$1.createElement("path",{d:"m456.69,421.39l-94.09-94.09c22.65-30.16,34.88-66.86,34.84-104.58,0-96.34-78.38-174.72-174.72-174.72S48,126.38,48,222.72s78.38,174.72,174.72,174.72c37.72.04,74.42-12.19,104.58-34.84l94.09,94.09c10.29,9.2,26.1,8.32,35.3-1.98,8.48-9.49,8.48-23.83,0-33.32Zm-233.97-73.87c-68.89-.08-124.72-55.91-124.8-124.8h0c0-68.93,55.87-124.8,124.8-124.8s124.8,55.87,124.8,124.8-55.87,124.8-124.8,124.8Z"}),wn$1.createElement("path",{d:"m279.5,197.76h-3.35s-28.47,0-28.47,0v-31.82c-.77-13.79-12.57-24.33-26.36-23.56-12.71.71-22.85,10.86-23.56,23.56v3.35h0v28.47h-31.82c-13.79.77-24.33,12.57-23.56,26.36.71,12.71,10.86,22.85,23.56,23.56h3.35s28.47,0,28.47,0v31.82c.77,13.79,12.57,24.33,26.36,23.56,12.71-.71,22.85-10.86,23.56-23.56v-3.35h0v-28.47h31.82c13.79-.77,24.33-12.57,23.56-26.36-.71-12.71-10.86-22.85-23.56-23.56Z"}))),Cr=({handleToggle:tt,isInteractive:et,isMedia:nt})=>wn$1.createElement(Ge,{onClick:tt,isInteractive:et,isMedia:nt,"data-testid":"placeholder-toggle"},et?wn$1.createElement(Er,null):wn$1.createElement(wr,{isMedia:nt})),Sr=({activeCanvas:tt,isMedia:et,painting:nt,resources:rt})=>{var it,st,ot;const[lt,ut]=wn$1.useState(0),[ct,dt]=wn$1.useState(!1),{configOptions:ft,customDisplays:pt,vault:gt}=k(),_r=gt.get(tt),Yr=(it=_r==null?void 0:_r.placeholderCanvas)==null?void 0:it.id,mt=!!Yr,Kr=(nt==null?void 0:nt.length)>1,Xr=Yr&&!ct&&!et,Zr=()=>dt(!ct),Qr=ns=>{const ss=nt.findIndex(fs=>fs.id===ns);ut(ss)},_i=pt.find(ns=>{var ss;let fs=!1;const{canvasId:os,paintingFormat:is}=ns.target;if(Array.isArray(os)&&os.length>0&&(fs=os.includes(tt)),Array.isArray(is)&&is.length>0){const cs=((ss=nt[lt])==null?void 0:ss.format)||"";fs=!!(cs&&is.includes(cs))}return fs}),rs=(st=_i==null?void 0:_i.display)==null?void 0:st.component;return wn$1.createElement(Xn,{className:"clover-viewer-painting"},wn$1.createElement(Yn,{style:{backgroundColor:ft.canvasBackgroundColor,maxHeight:ft.canvasHeight}},Yr&&!et&&wn$1.createElement(Cr,{handleToggle:Zr,isInteractive:ct,isMedia:et}),Xr&&!et&&wn$1.createElement(gr,{isMedia:et,label:_r==null?void 0:_r.label,placeholderCanvas:Yr,setIsInteractive:dt}),!Xr&&!_i&&(et?wn$1.createElement(yr,{allSources:nt,painting:nt[lt],resources:rt}):nt&&wn$1.createElement(fr,{painting:nt[lt],hasPlaceholder:mt,key:tt})),!Xr&&rs&&wn$1.createElement(rs,{id:tt,annotationBody:nt[lt],..._i==null?void 0:_i.display.componentProps})),Kr&&wn$1.createElement(Ue,{value:(ot=nt[lt])==null?void 0:ot.id,onValueChange:Qr,maxHeight:"200px"},nt==null?void 0:nt.map(ns=>wn$1.createElement(_e,{value:ns==null?void 0:ns.id,key:ns==null?void 0:ns.id,label:ns==null?void 0:ns.label}))))},kr=({activeCanvas:tt,painting:et,resources:nt,items:rt,isAudioVideo:it})=>{const{informationOpen:st,configOptions:ot}=k(),{informationPanel:lt}=ot,ut=(lt==null?void 0:lt.renderAbout)||(lt==null?void 0:lt.renderSupplementing)&&nt.length>0;return wn$1.createElement(Ae,{className:"clover-viewer-content","data-testid":"clover-viewer-content"},wn$1.createElement(Te,null,wn$1.createElement(Sr,{activeCanvas:tt,isMedia:it,painting:et,resources:nt}),ut&&wn$1.createElement(Me,null,wn$1.createElement("span",null,st?"View Items":"More Information")),rt.length>1&&wn$1.createElement($e,{className:"clover-viewer-media-wrapper"},wn$1.createElement(Zn,{items:rt,activeItem:0}))),st&&ut&&wn$1.createElement($t,null,wn$1.createElement(Re,null,wn$1.createElement(xn,{activeCanvas:tt,resources:nt}))))},Ir=m(W.Trigger,{width:"30px",padding:"5px"}),$r=m(W.Content,{display:"flex",flexDirection:"column",fontSize:"0.8333rem",border:"none",boxShadow:"2px 2px 5px #0003",zIndex:"2",button:{display:"flex",textDecoration:"none",marginBottom:"0.5em",color:"$accentAlt",cursor:"pointer",background:"$secondary",border:"none","&:last-child":{marginBottom:"0"}}}),Ar=m("span",{fontSize:"1.33rem",alignSelf:"flex-start",flexGrow:"0",flexShrink:"1",padding:"1rem","@sm":{fontSize:"1rem"},"&.visually-hidden":{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:"0"}}),Tr=m("header",{display:"flex",backgroundColor:"transparent !important",justifyContent:"space-between",alignItems:"flex-start",width:"100%",[`> ${qe}`]:{flexGrow:"1",flexShrink:"0"},form:{flexGrow:"0",flexShrink:"1"}}),Mr=m("div",{display:"flex",alignItems:"flex-end",justifyContent:"flex-end",padding:"1rem",flexShrink:"0",flexGrow:"1"}),Rr=()=>{var tt;const et=O(),nt=k(),{activeManifest:rt,collection:it,configOptions:st,vault:ot}=nt,lt=st==null?void 0:st.canvasHeight,ut=ct=>{et({type:"updateActiveManifest",manifestId:ct})};return wn$1.createElement("div",{style:{margin:"0.75rem"}},wn$1.createElement(Ue,{label:it.label,maxHeight:lt,value:rt,onValueChange:ut},(tt=it==null?void 0:it.items)==null?void 0:tt.map(ct=>wn$1.createElement(_e,{value:ct.id,key:ct.id,thumbnail:ct!=null&&ct.thumbnail?ot.get(ct==null?void 0:ct.thumbnail):void 0,label:ct.label}))))},zr=(tt,et=2500)=>{const[nt,rt]=p$3(),it=x$3(()=>{navigator.clipboard.writeText(tt).then(()=>rt("copied"),()=>rt("failed"))},[tt]);return _$1(()=>{if(!nt)return;const st=setTimeout(()=>rt(void 0),et);return()=>clearTimeout(st)},[nt]),[nt,it]},Lr=m("span",{display:"flex",alignContent:"center",alignItems:"center",padding:"0.125rem 0.25rem 0",marginTop:"-0.125rem",marginLeft:"0.5rem",backgroundColor:"$accent",color:"$secondary",borderRadius:"3px",fontSize:"0.6111rem",textTransform:"uppercase",lineHeight:"1em"}),Fr=({status:tt})=>tt?wn$1.createElement(Lr,{"data-copy-status":tt},tt):null,fe=({textPrompt:tt,textToCopy:et})=>{const[nt,rt]=zr(et);return wn$1.createElement("button",{onClick:rt},tt," ",wn$1.createElement(Fr,{status:nt}))},Pr=()=>{const tt="#ed1d33",et="#2873ab";return wn$1.createElement("svg",{viewBox:"0 0 493.35999 441.33334",id:"iiif-logo",version:"1.1"},wn$1.createElement("title",null,"IIIF Manifest Options"),wn$1.createElement("g",{transform:"matrix(1.3333333,0,0,-1.3333333,0,441.33333)"},wn$1.createElement("g",{transform:"scale(0.1)"},wn$1.createElement("path",{style:{fill:et},d:"M 65.2422,2178.75 775.242,1915 773.992,15 65.2422,276.25 v 1902.5"}),wn$1.createElement("path",{style:{fill:et},d:"m 804.145,2640.09 c 81.441,-240.91 -26.473,-436.2 -241.04,-436.2 -214.558,0 -454.511,195.29 -535.9527,436.2 -81.4335,240.89 26.4805,436.18 241.0387,436.18 214.567,0 454.512,-195.29 535.954,-436.18"}),wn$1.createElement("path",{style:{fill:tt},d:"M 1678.58,2178.75 968.578,1915 969.828,15 1678.58,276.25 v 1902.5"}),wn$1.createElement("path",{style:{fill:tt},d:"m 935.082,2640.09 c -81.437,-240.91 26.477,-436.2 241.038,-436.2 214.56,0 454.51,195.29 535.96,436.2 81.43,240.89 -26.48,436.18 -241.04,436.18 -214.57,0 -454.52,-195.29 -535.958,-436.18"}),wn$1.createElement("path",{style:{fill:et},d:"m 1860.24,2178.75 710,-263.75 -1.25,-1900 -708.75,261.25 v 1902.5"}),wn$1.createElement("path",{style:{fill:et},d:"m 2603.74,2640.09 c 81.45,-240.91 -26.47,-436.2 -241.03,-436.2 -214.58,0 -454.52,195.29 -535.96,436.2 -81.44,240.89 26.48,436.18 241.03,436.18 214.57,0 454.51,-195.29 535.96,-436.18"}),wn$1.createElement("path",{style:{fill:tt},d:"m 3700.24,3310 v -652.5 c 0,0 -230,90 -257.5,-142.5 -2.5,-247.5 0,-336.25 0,-336.25 l 257.5,83.75 V 1690 l -258.61,-92.5 V 262.5 L 2735.24,0 v 2360 c 0,0 -15,850 965,950"}))))},Vr=m($6be4966fd9bbc698$export$be92b6f5f03c0fe9,{all:"unset",height:"2rem",width:"3.236rem",backgroundColor:"#6663",borderRadius:"9999px",position:"relative",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:focus":{boxShadow:"0 0 0 2px $secondaryAlt"},'&[data-state="checked"]':{backgroundColor:"$accent",boxShadow:"inset 2px 2px 5px #0003"}}),Br=m($6be4966fd9bbc698$export$6521433ed15a34db,{display:"block",height:"calc(2rem - 12px)",width:"calc(2rem - 12px)",backgroundColor:"$secondary",borderRadius:"100%",boxShadow:"2px 2px 5px #0001",transition:"$all",transform:"translateX(6px)",willChange:"transform",'&[data-state="checked"]':{transform:"translateX(calc(1.236rem + 6px))"}}),Hr=m("label",{fontSize:"0.8333rem",fontWeight:"400",lineHeight:"1em",userSelect:"none",cursor:"pointer",paddingRight:"0.618rem"}),Or=m("form",{display:"flex",flexShrink:"0",flexGrow:"1",alignItems:"center",marginLeft:"1.618rem"}),Dr=()=>{var tt;const{configOptions:et}=k(),nt=O(),[rt,it]=p$3((tt=et==null?void 0:et.informationPanel)==null?void 0:tt.open);return _$1(()=>{nt({type:"updateInformationOpen",informationOpen:rt})},[rt]),wn$1.createElement(Or,null,wn$1.createElement(Hr,{htmlFor:"information-toggle",css:rt?{opacity:"1"}:{}},"More Information"),wn$1.createElement(Vr,{checked:rt,onCheckedChange:()=>it(!rt),id:"information-toggle","aria-label":"information panel toggle",name:"toggled?"},wn$1.createElement(Br,null)))},Ze=tt=>{const et=()=>window.matchMedia?window.matchMedia(tt).matches:!1,[nt,rt]=p$3(et);return _$1(()=>{const it=()=>rt(et);return window.addEventListener("resize",it),()=>window.removeEventListener("resize",it)}),nt},Wr=({manifestId:tt,manifestLabel:et})=>{const nt=k(),{collection:rt,configOptions:it}=nt,{showTitle:st,showIIIFBadge:ot,informationPanel:lt}=it,ut=ot||(lt==null?void 0:lt.renderToggle),ct=Ze(te.sm);return wn$1.createElement(Tr,{className:"clover-viewer-header"},rt!=null&&rt.items?wn$1.createElement(Rr,null):wn$1.createElement(Ar,{className:st?"":"visually-hidden"},st&&wn$1.createElement(L,{label:et,className:"label"})),ut&&wn$1.createElement(Mr,null,ot&&wn$1.createElement(W,null,wn$1.createElement(Ir,null,wn$1.createElement(Pr,null)),wn$1.createElement($r,null,(rt==null?void 0:rt.items)&&wn$1.createElement("button",{onClick:dt=>{dt.preventDefault(),window.open(rt.id,"_blank")}},"View Collection"),wn$1.createElement("button",{onClick:dt=>{dt.preventDefault(),window.open(tt,"_blank")}},"View Manifest")," ",(rt==null?void 0:rt.items)&&wn$1.createElement(fe,{textPrompt:"Copy Collection URL",textToCopy:rt.id}),wn$1.createElement(fe,{textPrompt:"Copy Manifest URL",textToCopy:tt}))),(lt==null?void 0:lt.renderToggle)&&!ct&&wn$1.createElement(Dr,null)))},jr=(tt=!1)=>{const[et,nt]=p$3(tt);return A$3(()=>{if(!et)return;const rt=document.documentElement.style.overflow;return document.documentElement.style.overflow="hidden",()=>{document.documentElement.style.overflow=rt}},[et]),_$1(()=>{et!==tt&&nt(tt)},[tt]),[et,nt]},Nr=({manifest:tt,theme:et})=>{var nt;const rt=k(),it=O(),{activeCanvas:st,informationOpen:ot,vault:lt,configOptions:ut}=rt,[ct,dt]=p$3(!1),[ft,pt]=p$3(!1),[gt,_r]=p$3([]),[Yr,mt]=p$3([]),[Kr,Xr]=jr(!1),Zr=Ze(te.sm),Qr=x$3(_i=>{it({type:"updateInformationOpen",informationOpen:_i})},[it]);return _$1(()=>{var _i;(_i=ut==null?void 0:ut.informationPanel)!=null&&_i.open&&Qr(!Zr)},[Zr,(nt=ut==null?void 0:ut.informationPanel)==null?void 0:nt.open,Qr]),_$1(()=>{if(!Zr){Xr(!1);return}Xr(ot)},[ot,Zr,Xr]),_$1(()=>{const _i=N(lt,st),rs=yt(lt,st,"text/vtt");_i&&(pt(["Sound","Video"].indexOf(_i[0].type)>-1),_r(_i)),mt(rs),dt(rs.length!==0)},[st,lt]),wn$1.createElement(ErrorBoundary,{FallbackComponent:It},wn$1.createElement(At,{className:`${et} clover-viewer`,css:{background:ut==null?void 0:ut.background},"data-body-locked":Kr,"data-information-panel":ct,"data-information-panel-open":ot},wn$1.createElement($409067139f391064$export$be92b6f5f03c0fe9,{open:ot,onOpenChange:Qr},wn$1.createElement(Wr,{manifestLabel:tt.label,manifestId:tt.id}),wn$1.createElement(kr,{activeCanvas:st,painting:gt,resources:Yr,items:tt.items,isAudioVideo:ft}))))},ge={ignoreCache:!1,headers:{Accept:"application/json, text/javascript, text/plain"},timeout:5e3,withCredentials:!1};function Gr(tt){return{ok:tt.status>=200&&tt.status<300,status:tt.status,statusText:tt.statusText,headers:tt.getAllResponseHeaders(),data:tt.responseText,json:()=>JSON.parse(tt.responseText)}}function he(tt,et=null){return{ok:!1,status:tt.status,statusText:tt.statusText,headers:tt.getAllResponseHeaders(),data:et||tt.statusText,json:()=>JSON.parse(et||tt.statusText)}}function qr(tt,et=ge){const nt=et.headers||ge.headers;return new Promise((rt,it)=>{const st=new XMLHttpRequest;st.open("get",tt),st.withCredentials=et.withCredentials,nt&&Object.keys(nt).forEach(ot=>st.setRequestHeader(ot,nt[ot])),st.onload=()=>{rt(Gr(st))},st.onerror=()=>{it(he(st,"Failed to make request."))},st.ontimeout=()=>{it(he(st,"Request took longer than expected."))},st.send()})}const ao=({canvasIdCallback:tt=()=>{},customDisplays:et=[],customTheme:nt,iiifContent:rt,id:it,manifestId:st,options:ot})=>{var lt;let ut=rt;return it&&(ut=it),st&&(ut=st),wn$1.createElement(bt,{initialState:{..._,customDisplays:et,informationOpen:!!((lt=ot==null?void 0:ot.informationPanel)!=null&&lt.open),vault:new Vault({customFetcher:ct=>qr(ct,{withCredentials:ot==null?void 0:ot.withCredentials,headers:ot==null?void 0:ot.requestHeaders}).then(dt=>JSON.parse(dt.data))})}},wn$1.createElement(Ur,{iiifContent:ut,canvasIdCallback:tt,customTheme:nt,options:ot}))},Ur=({canvasIdCallback:tt,customTheme:et,iiifContent:nt,options:rt})=>{const it=O(),st=k(),{activeCanvas:ot,activeManifest:lt,isLoaded:ut,vault:ct}=st,[dt,ft]=p$3(),[pt,gt]=p$3();let _r={};return et&&(_r=Q$1("custom",et)),_$1(()=>{tt&&tt(ot)},[ot,tt]),_$1(()=>{lt&&ct.loadManifest(lt).then(Yr=>{gt(Yr),it({type:"updateActiveCanvas",canvasId:Yr.items[0]&&Yr.items[0].id})}).catch(Yr=>{console.error(`Manifest failed to load: ${Yr}`)}).finally(()=>{it({type:"updateIsLoaded",isLoaded:!0})})},[lt,it,ct]),_$1(()=>{it({type:"updateConfigOptions",configOptions:rt}),ct.load(nt).then(Yr=>{ft(Yr)}).catch(Yr=>{console.error(`The IIIF resource ${nt} failed to load: ${Yr}`)})},[it,nt,rt,ct]),_$1(()=>{let Yr=[];(dt==null?void 0:dt.type)==="Collection"?(it({type:"updateCollection",collection:dt}),Yr=dt.items.filter(mt=>mt.type==="Manifest").map(mt=>mt.id),Yr.length>0&&it({type:"updateActiveManifest",manifestId:Yr[0]})):(dt==null?void 0:dt.type)==="Manifest"&&it({type:"updateActiveManifest",manifestId:dt.id})},[it,dt]),ut?!pt||!pt.items?(console.log(`The IIIF manifest ${nt} failed to load.`),wn$1.createElement(wn$1.Fragment,null)):pt.items.length===0?(console.log(`The IIIF manifest ${nt} does not contain canvases.`),wn$1.createElement(wn$1.Fragment,null)):wn$1.createElement(Nr,{manifest:pt,theme:_r,key:pt.id}):wn$1.createElement(wn$1.Fragment,null,"Loading")};function r(){return(r=Object.assign?Object.assign.bind():function(tt){for(var et=1;et<arguments.length;et++){var nt=arguments[et];for(var rt in nt)Object.prototype.hasOwnProperty.call(nt,rt)&&(tt[rt]=nt[rt])}return tt}).apply(this,arguments)}var i=["context","children"];function a(tt){this.getChildContext=function(){return tt.context};var et=tt.children,nt=function(rt,it){if(rt==null)return{};var st,ot,lt={},ut=Object.keys(rt);for(ot=0;ot<ut.length;ot++)it.indexOf(st=ut[ot])>=0||(lt[st]=rt[st]);return lt}(tt,i);return F$3(et,nt)}function s(){var tt=new CustomEvent("_preact",{detail:{},bubbles:!0,cancelable:!0});this.dispatchEvent(tt),this._vdom=y$3(a,r({},this._props,{context:tt.detail.context}),function et(nt,rt){if(nt.nodeType===3)return nt.data;if(nt.nodeType!==1)return null;var it=[],st={},ot=0,lt=nt.attributes,ut=nt.childNodes;for(ot=lt.length;ot--;)lt[ot].name!=="slot"&&(st[lt[ot].name]=lt[ot].value,st[c(lt[ot].name)]=lt[ot].value);for(ot=ut.length;ot--;){var ct=et(ut[ot],null),dt=ut[ot].slot;dt?st[dt]=y$3(p,{name:dt},ct):it[ot]=ct}var ft=rt?y$3(p,null,it):it;return y$3(rt||nt.nodeName.toLowerCase(),st,ft)}(this,this._vdomComponent)),(this.hasAttribute("hydrate")?E$3:B$4)(this._vdom,this._root)}function c(tt){return tt.replace(/-(\w)/g,function(et,nt){return nt?nt.toUpperCase():""})}function l(tt,et,nt){if(this._vdom){var rt={};rt[tt]=nt=nt??void 0,rt[c(tt)]=nt,this._vdom=F$3(this._vdom,rt),B$4(this._vdom,this._root)}}function u(){B$4(this._vdom=null,this._root)}function p(tt,et){var nt=this;return y$3("slot",r({},tt,{ref:function(rt){rt?(nt.ref=rt,nt._listener||(nt._listener=function(it){it.stopPropagation(),it.detail.context=et},rt.addEventListener("_preact",nt._listener))):nt.ref.removeEventListener("_preact",nt._listener)}}))}function register(tt,et,nt,rt){function it(){var st=Reflect.construct(HTMLElement,[],it);return st._vdomComponent=tt,st._root=rt&&rt.shadow?st.attachShadow({mode:rt.mode||"open"}):st,st}return(it.prototype=Object.create(HTMLElement.prototype)).constructor=it,it.prototype.connectedCallback=s,it.prototype.attributeChangedCallback=l,it.prototype.disconnectedCallback=u,nt=nt||tt.observedAttributes||Object.keys(tt.propTypes||{}),it.observedAttributes=nt,nt.forEach(function(st){Object.defineProperty(it.prototype,st,{get:function(){return this._vdom.props[st]},set:function(ot){this._vdom?this.attributeChangedCallback(st,null,ot):(this._props||(this._props={}),this._props[st]=ot,this.connectedCallback());var lt=typeof ot;ot!=null&&lt!=="string"&&lt!=="boolean"&&lt!=="number"||this.setAttribute(st,ot)}})}),customElements.define(et||tt.tagName||tt.displayName||tt.name,it)}const AudioPlayer={display:{component:({id:tt,annotationBody:et,...nt})=>y$3("audio",{src:et.id,controls:!0})},target:{paintingFormat:["audio/mpeg","audio/mp3"]}},PDFViewer={display:{component:({id:tt,annotationBody:et,...nt})=>y$3("div",{style:"height: 100%"},y$3("iframe",{src:et.id,type:"application/pdf",data:et.id,width:"100%",height:"100%"}))},target:{paintingFormat:["application/pdf"]}},customDisplays=[PDFViewer,AudioPlayer];function CloverViewerWebComponent(tt){const et=F$2(),{id:nt}=tt,rt={showTitle:!1,canvasHeight:"100%",showIIIFBadge:!1,informationPanel:{open:!1,renderToggle:!1}},it=st=>{st&&document.body.classList.add("clover-loaded")};return A$3(()=>{tt.__registerPublicApi&&tt.__registerPublicApi(st=>{et.current=st})},[]),y$3(ao,{id:nt,canvasIdCallback:it,options:rt,customDisplays})}const cloverViewerWCProps=["id"];typeof window<"u"&&register(CloverViewerWebComponent,"clover-viewer",cloverViewerWCProps,{shadow:!1,onConstruct(tt){tt._props={__registerPublicApi:et=>{Object.assign(tt,et(tt))}}}})});
//# sourceMappingURL=clover.umd.js.map
